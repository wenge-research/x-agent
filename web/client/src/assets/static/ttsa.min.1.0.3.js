"use strict";var e=function(){return e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)};function t(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function r(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError,function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.io=t():e.io=t()}(window,(function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function n(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n=i(e),o=n.source,d=n.id,u=n.path,p=c[d]&&u in c[d].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||p?(a("ignoring socket cache for %s",o),r=s(o,t)):(c[d]||(a("new io instance for %s",o),c[d]=s(o,t)),r=c[d]),n.query&&!t.query&&(t.query=n.query),r.socket(n.path,t)}var i=r(1),o=r(7),s=r(15),a=r(3)("socket.io-client");e.exports=t=n;var c=t.managers={};t.protocol=o.protocol,t.connect=n,t.Manager=r(15),t.Socket=r(39)},function(e,t,r){var n=r(2),i=r(3)("socket.io-client:url");e.exports=function(e,t){var r=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),r=n(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port,r.href=r.protocol+"://"+o+(t&&t.port===r.port?"":":"+r.port),r}},function(e,t){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=r.exec(e||""),a={},c=14;c--;)a[n[c]]=s[c]||"";return-1!=i&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t,r){(function(n){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e=void 0;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(5)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(t,r(4))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(d===setTimeout)return setTimeout(e,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function o(){f&&l&&(f=!1,l.length?h=l.concat(h):m=-1,h.length&&s())}function s(){if(!f){var e=i(o);f=!0;for(var t=h.length;t;){for(l=h,h=[];++m<t;)l&&l[m].run();m=-1,t=h.length}l=null,f=!1,function(e){if(u===clearTimeout)return clearTimeout(e);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var d,u,p=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:r}catch(e){d=r}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(e){u=n}}();var l,h=[],f=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new a(e,t)),1!==h.length||f||i(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,r){function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}e.exports=function(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return i.colors[Math.abs(t)%i.colors.length]}function i(e){function r(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];if(r.enabled){var s=r,a=Number(new Date),c=a-(n||a);s.diff=c,s.prev=n,s.curr=a,n=a,t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var d=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;d++;var n=i.formatters[r];if("function"==typeof n){var o=t[d];e=n.call(s,o),t.splice(d,1),d--}return e})),i.formatArgs.call(s,t),(s.log||i.log).apply(s,t)}}var n=void 0;return r.namespace=e,r.enabled=i.enabled(e),r.useColors=i.useColors(),r.color=t(e),r.destroy=o,r.extend=s,"function"==typeof i.init&&i.init(r),i.instances.push(r),r}function o(){var e=i.instances.indexOf(this);return-1!==e&&(i.instances.splice(e,1),!0)}function s(e,t){var r=i(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(e){return e instanceof Error?e.stack||e.message:e},i.disable=function(){var e=[].concat(n(i.names.map(a)),n(i.skips.map(a).map((function(e){return"-"+e})))).join(",");return i.enable(""),e},i.enable=function(e){i.save(e),i.names=[],i.skips=[];var t=void 0,r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")));for(t=0;t<i.instances.length;t++){var o=i.instances[t];o.enabled=i.enabled(o.namespace)}},i.enabled=function(e){if("*"===e[e.length-1])return!0;var t=void 0,r=void 0;for(t=0,r=i.skips.length;t<r;t++)if(i.skips[t].test(e))return!1;for(t=0,r=i.names.length;t<r;t++)if(i.names[t].test(e))return!0;return!1},i.humanize=r(6),Object.keys(e).forEach((function(t){i[t]=e[t]})),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=t,i.enable(i.load()),i}},function(e,t){function r(e){var t=Math.abs(e);return t>=a?n(e,t,a,"day"):t>=s?n(e,t,s,"hour"):t>=o?n(e,t,o,"minute"):t>=i?n(e,t,i,"second"):e+" ms"}function n(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}var i=1e3,o=60*i,s=60*o,a=24*s,c=7*a,d=365.25*a;e.exports=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*d;case"weeks":case"week":case"w":return r*c;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*s;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===n&&isFinite(e))return t.long?r(e):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=s?Math.round(e/s)+"h":t>=o?Math.round(e/o)+"m":t>=i?Math.round(e/i)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){function n(){}function i(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var n=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===n)return f;r+=n}return d("encoded %j as %s",e,r),r}function o(){this.reconstructor=null}function s(e){var r=0,n={type:Number(e.charAt(0))};if(null==t.types[n.type])return c("unknown packet type "+n.type);if(t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type){for(var i="";"-"!==e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!==e.charAt(r))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(r+1))for(n.nsp="";++r;){if(","===(s=e.charAt(r)))break;if(n.nsp+=s,r===e.length)break}else n.nsp="/";var o=e.charAt(r+1);if(""!==o&&Number(o)==o){for(n.id="";++r;){var s;if(null==(s=e.charAt(r))||Number(s)!=s){--r;break}if(n.id+=e.charAt(r),r===e.length)break}n.id=Number(n.id)}if(e.charAt(++r)){var a=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r));if(!(!1!==a&&(n.type===t.ERROR||l(a))))return c("invalid payload");n.data=a}return d("decoded %s as %j",e,n),n}function a(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}var d=r(8)("socket.io-parser"),u=r(11),p=r(12),l=r(13),h=r(14);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=n,t.Decoder=o;var f=t.ERROR+'"encode error"';n.prototype.encode=function(e,r){(d("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){p.removeBlobs(e,(function(e){var r=p.deconstructPacket(e),n=i(r.packet),o=r.buffers;o.unshift(n),t(o)}))}(e,r):r([i(e)])},u(o.prototype),o.prototype.add=function(e){var r;if("string"==typeof e)r=s(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new a(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!h(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=p.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,r){(function(n){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(t=e.exports=r(9)).log=function(){return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),r){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,n)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(t,r(4))},function(e,t,r){function n(e){function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(r,n){if("%%"===r)return r;c++;var i=t.formatters[n];if("function"==typeof i){var o=s[c];r=i.call(e,o),s.splice(c,1),c--}return r})),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}var n;return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var r,n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var o=t.instances[r];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(10),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function r(e){return n(e,a,"day")||n(e,s,"hour")||n(e,o,"minute")||n(e,i,"second")||e+" ms"}function n(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var i=1e3,o=60*i,s=60*o,a=24*s,c=365.25*a;e.exports=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*c;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*s;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===n&&!1===isNaN(e))return t.long?r(e):function(e){return e>=a?Math.round(e/a)+"d":e>=s?Math.round(e/s)+"h":e>=o?Math.round(e/o)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n,i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){function n(e,t){if(!e)return e;if(s(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(o(e)){for(var i=new Array(e.length),a=0;a<e.length;a++)i[a]=n(e[a],t);return i}if("object"==typeof e&&!(e instanceof Date)){i={};for(var c in e)i[c]=n(e[c],t);return i}return e}function i(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(o(e))for(var r=0;r<e.length;r++)e[r]=i(e[r],t);else if("object"==typeof e)for(var n in e)e[n]=i(e[n],t);return e}var o=r(13),s=r(14),a=Object.prototype.toString,c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===a.call(Blob),d="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===a.call(File);t.deconstructPacket=function(e){var t=[],r=e.data,i=e;return i.data=n(r,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=i(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var r=0,n=e;(function e(i,a,u){if(!i)return i;if(c&&i instanceof Blob||d&&i instanceof File){r++;var p=new FileReader;p.onload=function(){u?u[a]=this.result:n=this.result,--r||t(n)},p.readAsArrayBuffer(i)}else if(o(i))for(var l=0;l<i.length;l++)e(i[l],l,i);else if("object"==typeof i&&!s(i))for(var h in i)e(i[h],h,i)})(n),r||t(n)}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t){e.exports=function(e){return r&&Buffer.isBuffer(e)||n&&(e instanceof ArrayBuffer||i(e))};var r="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,n="function"==typeof ArrayBuffer,i=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}},function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||a;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var i=r(16),o=r(39),s=r(11),a=r(7),c=r(41),d=r(42),u=r(3)("socket.io-client:manager"),p=r(38),l=r(43),h=Object.prototype.hasOwnProperty;e.exports=n,n.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)h.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},n.prototype.updateSocketIds=function(){for(var e in this.nsps)h.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},n.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},s(n.prototype),n.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},n.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},n.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},n.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},n.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},n.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},n.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},n.prototype.open=n.prototype.connect=function(e,t){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=i(this.uri,this.opts);var r=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var o=c(r,"open",(function(){n.onopen(),e&&e()})),s=c(r,"error",(function(t){if(u("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;u("connect attempt will timeout after %d",a);var d=setTimeout((function(){u("connect attempt timed out after %d",a),o.destroy(),r.close(),r.emit("error","timeout"),n.emitAll("connect_timeout",a)}),a);this.subs.push({destroy:function(){clearTimeout(d)}})}return this.subs.push(o),this.subs.push(s),this},n.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},n.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},n.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},n.prototype.ondata=function(e){this.decoder.add(e)},n.prototype.ondecoded=function(e){this.emit("packet",e)},n.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},n.prototype.socket=function(e,t){function r(){~p(i.connecting,n)||i.connecting.push(n)}var n=this.nsps[e];if(!n){n=new o(this,e,t),this.nsps[e]=n;var i=this;n.on("connecting",r),n.on("connect",(function(){n.id=i.generateId(e)})),this.autoConnect&&r()}return n},n.prototype.destroy=function(e){var t=p(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},n.prototype.packet=function(e){u("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()})))},n.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},n.prototype.cleanup=function(){u("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},n.prototype.close=n.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},n.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},n.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout((function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(r)}})}},n.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,r){e.exports=r(17),e.exports.parser=r(24)},function(e,t,r){function n(e,t){return this instanceof n?(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=d(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=d(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new n(e,t)}var i=r(18),o=r(11),s=r(3)("engine.io-client:socket"),a=r(38),c=r(24),d=r(2),u=r(32);e.exports=n,n.priorWebsocketSuccess=!1,o(n.prototype),n.protocol=c.protocol,n.Socket=n,n.Transport=r(23),n.transports=r(18),n.parser=r(24),n.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);t.EIO=c.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new i[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative})},n.prototype.open=function(){var e;if(this.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},n.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},n.prototype.probe=function(e){function t(){if(l.onlyBinaryUpgrades){var t=!this.supportsBinary&&l.transport.supportsBinary;p=p||t}p||(s('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",(function(t){if(!p)if("pong"===t.type&&"probe"===t.data){if(s('probe transport "%s" pong',e),l.upgrading=!0,l.emit("upgrading",u),!u)return;n.priorWebsocketSuccess="websocket"===u.name,s('pausing current transport "%s"',l.transport.name),l.transport.pause((function(){p||"closed"!==l.readyState&&(s("changing transport and sending upgrade packet"),d(),l.setTransport(u),u.send([{type:"upgrade"}]),l.emit("upgrade",u),u=null,l.upgrading=!1,l.flush())}))}else{s('probe transport "%s" failed',e);var r=new Error("probe error");r.transport=u.name,l.emit("upgradeError",r)}})))}function r(){p||(p=!0,d(),u.close(),u=null)}function i(t){var n=new Error("probe error: "+t);n.transport=u.name,r(),s('probe transport "%s" failed because of error: %s',e,t),l.emit("upgradeError",n)}function o(){i("transport closed")}function a(){i("socket closed")}function c(e){u&&e.name!==u.name&&(s('"%s" works - aborting "%s"',e.name,u.name),r())}function d(){u.removeListener("open",t),u.removeListener("error",i),u.removeListener("close",o),l.removeListener("close",a),l.removeListener("upgrading",c)}s('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),p=!1,l=this;n.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",i),u.once("close",o),this.once("close",a),this.once("upgrading",c),u.open()},n.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},n.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},n.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},n.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},n.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},n.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},n.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},n.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},n.prototype.write=n.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},n.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},n.prototype.close=function(){function e(){n.onClose("forced close"),s("socket closing - telling transport to close"),n.transport.close()}function t(){n.removeListener("upgrade",t),n.removeListener("upgradeError",t),e()}function r(){n.once("upgrade",t),n.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():e()})):this.upgrading?r():e()}return this},n.prototype.onError=function(e){s("socket error %j",e),n.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},n.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},n.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~a(this.transports,e[r])&&t.push(e[r]);return t}},function(e,t,r){var n=r(19),i=r(21),o=r(35),s=r(36);t.polling=function(e){var t=!1,r=!1,s=!1!==e.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!==location.hostname||c!==e.port,r=e.secure!==a}if(e.xdomain=t,e.xscheme=r,"open"in new n(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new o(e)},t.websocket=s},function(e,t,r){var n=r(20);e.exports=function(e){var t=e.xdomain,r=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,r){function n(){}function i(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,r=location.port;r||(r=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function s(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var a=r(19),c=r(22),d=r(11),u=r(33),p=r(3)("engine.io-client:polling-xhr");if(e.exports=i,e.exports.Request=o,u(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new o(e)},i.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",(function(e){i.onError("xhr post error",e)})),this.sendXhr=n},i.prototype.doPoll=function(){p("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},d(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),r=this;try{p("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var n in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.extraHeaders[n])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(r.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout((function(){r.onError("number"==typeof t.status?t.status:0)}),0))},p("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){r.onError(e)}),0)}"undefined"!=typeof document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},o.requestsCount=0,o.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",s);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,s,!1)}},function(e,t,r){function n(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),i.call(this,e)}var i=r(23),o=r(32),s=r(24),a=r(33),c=r(34),d=r(3)("engine.io-client:polling");e.exports=n;var u=null!=new(r(19))({xdomain:!1}).responseType;a(n,i),n.prototype.name="polling",n.prototype.doOpen=function(){this.poll()},n.prototype.pause=function(e){function t(){d("paused"),r.readyState="paused",e()}var r=this;if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(d("we are currently polling - waiting to pause"),n++,this.once("pollComplete",(function(){d("pre-pause polling complete"),--n||t()}))),this.writable||(d("we are currently writing - waiting to pause"),n++,this.once("drain",(function(){d("pre-pause writing complete"),--n||t()})))}else t()},n.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},n.prototype.onData=function(e){var t=this;d("polling got data %s",e);s.decodePayload(e,this.socket.binaryType,(function(e,r,n){return"opening"===t.readyState&&t.onOpen(),"close"===e.type?(t.onClose(),!1):void t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},n.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},n.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};s.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,r)}))},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},function(e,t,r){function n(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var i=r(24),o=r(11);e.exports=n,o(n.prototype),n.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},n.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},n.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},n.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},n.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},n.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},n.prototype.onPacket=function(e){this.emit("packet",e)},n.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,r){function n(e,r){return r("b"+t.packets[e.type]+e.data.data)}function i(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=v[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return n(s.buffer)}function o(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(m)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){t.encodePacket({type:e.type,data:i.result},r,!0,n)},i.readAsArrayBuffer(e.data)}(e,r,n);var i=new Uint8Array(1);return i[0]=v[e.type],n(new b([i.buffer,e.data]))}function s(e,t,r){for(var n=new Array(e.length),i=p(e.length,r),o=function(e,r,i){t(r,(function(t,r){n[e]=r,i(t,n)}))},s=0;s<e.length;s++)o(s,e[s],i)}var a,c=r(25),d=r(26),u=r(27),p=r(28),l=r(29);"undefined"!=typeof ArrayBuffer&&(a=r(30));var h="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),f="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),m=h||f;t.protocol=3;var v=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},g=c(v),y={type:"error",data:"parser error"},b=r(31);t.encodePacket=function(e,t,r,s){"function"==typeof t&&(s=t,t=!1),"function"==typeof r&&(s=r,r=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return i(e,t,s);if(void 0!==b&&a instanceof b)return o(e,t,s);if(a&&a.base64)return n(e,s);var c=v[e.type];return void 0!==e.data&&(c+=r?l.encode(String(e.data),{strict:!1}):String(e.data)),s(""+c)},t.encodeBase64Packet=function(e,r){var n,i="b"+t.packets[e.type];if(void 0!==b&&e.data instanceof b){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];r(i+e)},o.readAsDataURL(e.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];n=String.fromCharCode.apply(null,a)}return i+=btoa(n),r(i)},t.decodePacket=function(e,r,n){if(void 0===e)return y;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&!1===(e=function(e){try{e=l.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return y;var i=e.charAt(0);return Number(i)==i&&g[i]?e.length>1?{type:g[i],data:e.substring(1)}:{type:g[i]}:y}i=new Uint8Array(e)[0];var o=u(e,1);return b&&"blob"===r&&(o=new b([o])),{type:g[i],data:o}},t.decodeBase64Packet=function(e,t){var r=g[e.charAt(0)];if(!a)return{type:r,data:{base64:!0,data:e.substr(1)}};var n=a.decode(e.substr(1));return"blob"===t&&b&&(n=new b([n])),{type:r,data:n}},t.encodePayload=function(e,r,n){"function"==typeof r&&(n=r,r=null);var i=d(e);return r&&i?b&&!m?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n):e.length?void s(e,(function(e,n){t.encodePacket(e,!!i&&r,!1,(function(e){n(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return n(t.join(""))})):n("0:")},t.decodePayload=function(e,r,n){if("string"!=typeof e)return t.decodePayloadAsBinary(e,r,n);var i;if("function"==typeof r&&(n=r,r=null),""===e)return n(y,0,1);for(var o,s,a="",c=0,d=e.length;c<d;c++){var u=e.charAt(c);if(":"===u){if(""===a||a!=(o=Number(a)))return n(y,0,1);if(a!=(s=e.substr(c+1,o)).length)return n(y,0,1);if(s.length){if(i=t.decodePacket(s,r,!1),y.type===i.type&&y.data===i.data)return n(y,0,1);if(!1===n(i,c+o,d))return}c+=o,a=""}else a+=u}return""!==a?n(y,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){return e.length?void s(e,(function(e,r){t.encodePacket(e,!0,!0,(function(e){return r(null,e)}))}),(function(e,t){var n=t.reduce((function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2}),0),i=new Uint8Array(n),o=0;return t.forEach((function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);r=n.buffer}i[o++]=t?0:1;var a=r.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(n=new Uint8Array(r),s=0;s<n.length;s++)i[o++]=n[s]})),r(i.buffer)})):r(new ArrayBuffer(0))},t.encodePayloadAsBlob=function(e,r){s(e,(function(e,r){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,b){var a=new b([t.buffer,s.buffer,e]);r(null,a)}}))}),(function(e,t){return r(new b(t))}))},t.decodePayloadAsBinary=function(e,r,n){"function"==typeof r&&(n=r,r=null);for(var i=e,o=[];i.byteLength>0;){for(var s=new Uint8Array(i),a=0===s[0],c="",d=1;255!==s[d];d++){if(c.length>310)return n(y,0,1);c+=s[d]}i=u(i,2+c.length),c=parseInt(c);var p=u(i,0,c);if(a)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var l=new Uint8Array(p);p="";for(d=0;d<l.length;d++)p+=String.fromCharCode(l[d])}o.push(p),i=u(i,c)}var h=o.length;o.forEach((function(e,i){n(t.decodePacket(e,r,!0),i,h)}))}},function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},function(e,t,r){var n=r(13),i=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);e.exports=function e(t){if(!t||"object"!=typeof t)return!1;if(n(t)){for(var r=0,i=t.length;r<i;r++)if(e(t[r]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||o&&t instanceof Blob||s&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&e(t[a]))return!0;return!1}},function(e,t){e.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(r-t),s=t,a=0;s<r;s++,a++)o[a]=i[s];return o.buffer}},function(e,t){function r(){}e.exports=function(e,t,n){function i(e,r){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=n):0!==i.count||o||t(null,r)}var o=!1;return n=n||r,i.count=e,0===e?t():i}},function(e,t){function r(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function n(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function i(e,t){return p(e>>t&63|128)}function o(e,t){if(!(4294967168&e))return p(e);var r="";return 4294965248&e?4294901760&e?!(4292870144&e)&&(r=p(e>>18&7|240),r+=i(e,12),r+=i(e,6)):(n(e,t)||(e=65533),r=p(e>>12&15|224),r+=i(e,6)):r=p(e>>6&31|192),r+p(63&e|128)}function s(){if(u>=d)throw Error("Invalid byte index");var e=255&c[u];if(u++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function a(e){var t,r;if(u>d)throw Error("Invalid byte index");if(u==d)return!1;if(t=255&c[u],u++,!(128&t))return t;if(192==(224&t)){if((r=(31&t)<<6|s())>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&t)){if((r=(15&t)<<12|s()<<6|s())>=2048)return n(r,e)?r:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&((r=(7&t)<<18|s()<<12|s()<<6|s())>=65536&&r<=1114111))return r;throw Error("Invalid UTF-8 detected")}var c,d,u,p=String.fromCharCode;e.exports={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,i=r(e),s=i.length,a=-1,c="";++a<s;)c+=o(i[a],n);return c},decode:function(e,t){var n=!1!==(t=t||{}).strict;c=r(e),d=c.length,u=0;for(var i,o=[];!1!==(i=a(n));)o.push(i);return function(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=p(t);return i}(o)}}},function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<64;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),i=n.length,o="";for(r=0;r<i;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,i,o,s,a=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),p=new Uint8Array(u);for(t=0;t<c;t+=4)n=r[e.charCodeAt(t)],i=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],s=r[e.charCodeAt(t+3)],p[d++]=n<<2|i>>4,p[d++]=(15&i)<<4|o>>2,p[d++]=(3&o)<<6|63&s;return u}}()},function(e,t){function r(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=r.buffer}return t}return e}))}function n(e,t){t=t||{};var n=new o;return r(e).forEach((function(e){n.append(e)})),t.type?n.getBlob(t.type):n.getBlob()}function i(e,t){return new Blob(r(e),t||{})}var o=void 0!==o?o:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,s=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),a=s&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;"undefined"!=typeof Blob&&(n.prototype=Blob.prototype,i.prototype=Blob.prototype),e.exports=s?a?Blob:i:c?n:void 0},function(e,t){t.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},t.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){function r(e){var t="";do{t=o[e%s]+t,e=Math.floor(e/s)}while(e>0);return t}function n(){var e=r(+new Date);return e!==i?(c=0,i=e):e+"."+r(c++)}for(var i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s=64,a={},c=0,d=0;d<s;d++)a[o[d]]=d;n.encode=r,n.decode=function(e){var t=0;for(d=0;d<e.length;d++)t=t*s+a[e.charAt(d)];return t},e.exports=n},function(e,t,r){(function(t){function n(){}function i(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function o(e){if(s.call(this,e),this.query=this.query||{},!c){var t=i();c=t.___eio=t.___eio||[]}this.index=c.length;var r=this;c.push((function(e){r.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){r.script&&(r.script.onerror=n)}),!1)}var s=r(22),a=r(33);e.exports=o;var c,d=/\n/g,u=/\\n/g;a(o,s),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},o.prototype.doWrite=function(e,t){function r(){n(),t()}function n(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(e){(o=document.createElement("iframe")).name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),n(),e=e.replace(u,"\\\n"),this.area.value=e.replace(d,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&r()}:this.iframe.onload=r}}).call(t,function(){return this}())},function(e,t,r){function n(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=i&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=o),s.call(this,e)}var i,o,s=r(23),a=r(24),c=r(32),d=r(33),u=r(34),p=r(3)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?i=WebSocket:"undefined"!=typeof self&&(i=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{o=r(37)}catch(e){}var l=i||o;e.exports=n,d(n,s),n.prototype.name="websocket",n.prototype.supportsBinary=!0,n.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new l(e,t):new l(e):new l(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},n.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},n.prototype.write=function(e){var t=this;this.writable=!1;for(var r=e.length,n=0,i=r;n<i;n++)!function(e){a.encodePacket(e,t.supportsBinary,(function(n){if(!t.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),t.perMessageDeflate)("string"==typeof n?Buffer.byteLength(n):n.length)<t.perMessageDeflate.threshold&&(i.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(n):t.ws.send(n,i)}catch(e){p("websocket closed before onclose event")}--r||(t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0))}))}(e[n])},n.prototype.onClose=function(){s.prototype.onClose.call(this)},n.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),(e=c.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},n.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===n.prototype.name)}},function(e,t){},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,r){function n(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}var i=r(7),o=r(11),s=r(40),a=r(41),c=r(42),d=r(3)("socket.io-client:socket"),u=r(32),p=r(26);e.exports=n;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=o.prototype.emit;o(n.prototype),n.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",c(this,"onopen")),a(e,"packet",c(this,"onpacket")),a(e,"close",c(this,"onclose"))]}},n.prototype.open=n.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},n.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},n.prototype.emit=function(e){if(l.hasOwnProperty(e))return h.apply(this,arguments),this;var t=s(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:p(t))?i.BINARY_EVENT:i.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},n.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},n.prototype.onopen=function(){if(d("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?u.encode(this.query):this.query;d("sending connect packet with query %s",e),this.packet({type:i.CONNECT,query:e})}else this.packet({type:i.CONNECT})},n.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},n.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===i.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data)}},n.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?h.apply(this,t):this.receiveBuffer.push(t)},n.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var n=s(arguments);d("sending ack %j",n),t.packet({type:p(n)?i.BINARY_ACK:i.ACK,id:e,data:n})}}},n.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},n.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},n.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)h.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},n.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},n.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},n.prototype.close=n.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},n.prototype.compress=function(e){return this.flags.compress=e,this},n.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){e.exports=function(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}},function(e,t){e.exports=function(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}},function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+r:e-r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}}])}));let n=!0,i=!0;function o(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function s(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,o),i.apply(this,[e,o])};const o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(r))return o.apply(this,arguments);const n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function a(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function c(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function d(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function u(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")}function p(e){return"[object Object]"===Object.prototype.toString.call(e)}function l(e){return p(e)?Object.keys(e).reduce((function(t,r){const n=p(e[r]),i=n?l(e[r]):e[r],o=n&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[r]:i})}),{}):e}function h(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?h(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((t=>{h(e,e.get(t),r)}))})))}function f(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((r=>{r.type===n&&r.trackId===t.id&&h(e,r,i)}))})),i}const m=d;function v(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[i("min",r)]=n.ideal,t.optional.push(e),e={},e[i("max",r)]=n.ideal,t.optional.push(e)):(e[i("",r)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let s=(r=r.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&r.length&&t.includes("back")&&(s=r[r.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=n(e.video),m("chrome: "+JSON.stringify(e)),i(e)}))}e.video=n(e.video)}return m("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){i(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{n&&n(o(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function g(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function y(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const i=new Event("track");i.track=r.track,i.receiver=n,i.transceiver={receiver:n},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const i=new Event("track");i.track=r,i.receiver=n,i.transceiver={receiver:n},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else s(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function b(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function S(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const n=function(e){r(o(i(e)))};return t.apply(this,[n,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(o(i(t)))},r])})).then(r,n)}}function C(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>f(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),s(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>f(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,n;return this.getSenders().forEach((r=>{r.track===e&&(t?n=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?n=!0:r=t),t.track===e))),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function w(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function T(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return w(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=o(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function k(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function R(e,t){s(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var E=Object.freeze({__proto__:null,shimMediaStream:g,shimOnTrack:y,shimGetSendersWithDtmf:b,shimGetStats:S,shimSenderReceiverGetStats:C,shimAddTrackRemoveTrackWithNative:w,shimAddTrackRemoveTrack:T,shimPeerConnection:k,fixNegotiationNeeded:R,shimGetUserMedia:v,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});var D=function(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}((function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){var r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((function(e){return 0===e.indexOf(r)}))},t.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){var n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],i=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],s=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=t.parseRtpMap(s),c=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?t.parseFmtp(c[0]):{},a.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),r.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(a.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){var n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((function(e){n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));var i=0;return r.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",r.headerExtensions&&r.headerExtensions.forEach((function(e){n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){var r,n=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,d=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(r=d[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),n.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&c&&n.push({ssrc:c});var u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){var r={},n=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=0===i.length;var o=t.matchPrefix(e,"a=rtcp-mux");return r.mux=o.length>0,r},t.parseMsid=function(e){var r,n=t.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(r=n[0].substr(7).split(" "))[0],track:r[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(r=i[0].value.split(" "))[0],track:r[1]}:void 0},t.parseSctpDescription=function(e){var r,n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};if(t.matchPrefix(e,"a=sctpmap:").length>0){var s=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,n){var i=void 0!==r?r:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,r,n,i){var o=t.writeRtpDescription(e.kind,r);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),o},t.getDirection=function(e,r){for(var n=t.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var r=t.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){var r=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var r=t.splitLines(e),n=0;n<r.length;n++)if(r[n].length<2||"="!==r[n].charAt(1))return!1;return!0},e.exports=t}));function P(e,t,r,n,i){var o=D.writeRtpDescription(e.kind,t);if(o+=D.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=D.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var a="msid:"+(n?n.id:"-")+" "+s+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+D.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+D.localCName+"\r\n"),o}function x(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),s=n(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach((function(n){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!i(n,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(n.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}})),r}function A(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function _(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function I(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var O=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function n(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var i=function(r){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){n[e]=i[e].bind(i)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw I("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=i?n[0]:n,!!n.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var o=r.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=D.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},i.prototype.addTrack=function(t,r){if(this._isClosed)throw I("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw I("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},i.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),n.getTracks().forEach((function(e){r.addTrack(e,n)}))}},i.prototype.removeTrack=function(t){if(this._isClosed)throw I("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw I("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null;var i=this.transceivers.map((function(e){return e.stream}));-1===i.indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},i.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},i.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},i.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,a=!s||0===Object.keys(s).length;if(a)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),s.component=1,s.ufrag=i.getLocalParameters().usernameFragment;var c=D.writeCandidate(s);o.candidate=Object.assign(o.candidate,D.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=D.getMediaSections(n._localDescription.sdp);d[o.candidate.sdpMLineIndex]+=a?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",n._localDescription.sdp=D.getDescription(n._localDescription.sdp)+d.join("");var u=n.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),a||n._dispatchEvent("icecandidate",o),u&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){i.onlocalcandidate(e)}))}),0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,r,n){var i=x(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:D.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t,r,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(I("TypeError",'Unsupported type "'+e.type+'"'));if(!A("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(I("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=D.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=D.parseRtpParameters(e);n.transceivers[t].localCapabilities=r})),n.transceivers.forEach((function(e,t){n._gather(e.mid,t)}));else if("answer"===e.type){t=D.splitSections(n._remoteDescription.sdp),r=t.shift();var i=D.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var o=n.transceivers[t],s=o.iceGatherer,a=o.iceTransport,c=o.dtlsTransport,d=o.localCapabilities,u=o.remoteCapabilities;if(!(D.isRejected(e)&&0===D.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var p=D.getIceParameters(e,r),l=D.getDtlsParameters(e,r);i&&(l.role="server"),n.usingBundle&&0!==t||(n._gather(o.mid,t),"new"===a.state&&a.start(s,p,i?"controlling":"controlled"),"new"===c.state&&c.start(l));var h=x(d,u);n._transceive(o,h.codecs.length>0,!1)}}))}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(I("TypeError",'Unsupported type "'+i.type+'"'));if(!A("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(I("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var s={};o.remoteStreams.forEach((function(e){s[e.id]=e}));var a=[],c=D.splitSections(i.sdp),d=c.shift(),u=D.matchPrefix(d,"a=ice-lite").length>0,p=D.matchPrefix(d,"a=group:BUNDLE ").length>0;o.usingBundle=p;var l=D.matchPrefix(d,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!l&&l.substr(14).split(" ").indexOf("trickle")>=0,c.forEach((function(n,c){var l=D.splitLines(n),h=D.getKind(n),f=D.isRejected(n)&&0===D.matchPrefix(n,"a=bundle-only").length,m=l[0].substr(2).split(" ")[2],v=D.getDirection(n,d),g=D.parseMsid(n),y=D.getMid(n)||D.generateIdentifier();if(f||"application"===h&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))o.transceivers[c]={mid:y,kind:h,protocol:m,rejected:!0};else{var b,S,C,w,T,k,R,E,P;!f&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(h,!0));var A,I,O=D.parseRtpParameters(n);f||(A=D.getIceParameters(n,d),(I=D.getDtlsParameters(n,d)).role="client"),R=D.parseRtpEncodingParameters(n);var M=D.parseRtcpParameters(n),j=D.matchPrefix(n,"a=end-of-candidates",d).length>0,B=D.matchPrefix(n,"a=candidate:").map((function(e){return D.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!f&&p&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||f){if("answer"===i.type&&!f){S=(b=o.transceivers[c]).iceGatherer,C=b.iceTransport,w=b.dtlsTransport,T=b.rtpReceiver,k=b.sendEncodingParameters,E=b.localCapabilities,o.transceivers[c].recvEncodingParameters=R,o.transceivers[c].remoteCapabilities=O,o.transceivers[c].rtcpParameters=M,B.length&&"new"===C.state&&(!u&&!j||p&&0!==c?B.forEach((function(e){_(b.iceTransport,e)})):C.setRemoteCandidates(B)),p&&0!==c||("new"===C.state&&C.start(S,A,"controlling"),"new"===w.state&&w.start(I)),!x(b.localCapabilities,b.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,o._transceive(b,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!T||"sendrecv"!==v&&"sendonly"!==v?delete b.rtpReceiver:(P=T.track,g?(s[g.stream]||(s[g.stream]=new e.MediaStream),r(P,s[g.stream]),a.push([P,T,s[g.stream]])):(s.default||(s.default=new e.MediaStream),r(P,s.default),a.push([P,T,s.default])))}}else{(b=o.transceivers[c]||o._createTransceiver(h)).mid=y,b.iceGatherer||(b.iceGatherer=o._createIceGatherer(c,p)),B.length&&"new"===b.iceTransport.state&&(!j||p&&0!==c?B.forEach((function(e){_(b.iceTransport,e)})):b.iceTransport.setRemoteCandidates(B)),E=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(E.codecs=E.codecs.filter((function(e){return"rtx"!==e.name}))),k=b.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,L=!1;if("sendrecv"===v||"sendonly"===v){if(L=!b.rtpReceiver,T=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,h),L)P=T.track,g&&"-"===g.stream||(g?(s[g.stream]||(s[g.stream]=new e.MediaStream,Object.defineProperty(s[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(P,"id",{get:function(){return g.track}}),N=s[g.stream]):(s.default||(s.default=new e.MediaStream),N=s.default)),N&&(r(P,N),b.associatedRemoteMediaStreams.push(N)),a.push([P,T,N])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===b.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),b.associatedRemoteMediaStreams=[]);b.localCapabilities=E,b.remoteCapabilities=O,b.rtpReceiver=T,b.rtcpParameters=M,b.sendEncodingParameters=k,b.recvEncodingParameters=R,o._transceive(o.transceivers[c],!1,L)}}})),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(s).forEach((function(t){var r=s[t];if(r.getTracks().length){if(-1===o.remoteStreams.indexOf(r)){o.remoteStreams.push(r);var i=new Event("addstream");i.stream=r,e.setTimeout((function(){o._dispatchEvent("addstream",i)}))}a.forEach((function(e){var t=e[0],i=e[1];r.id===e[2].id&&n(o,t,i,[r])}))}})),a.forEach((function(e){e[2]||n(o,e[0],e[1],[])})),e.setTimeout((function(){o&&o.transceivers&&o.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},i.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(I("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter((function(e){return"audio"===e.kind})).length,i=r.transceivers.filter((function(e){return"video"===e.kind})).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(n=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(i=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)}));n>0||i>0;)n>0&&(r._createTransceiver("audio"),n--),i>0&&(r._createTransceiver("video"),i--);var s=D.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(n,i){var o=n.track,s=n.kind,a=n.mid||D.generateIdentifier();n.mid=a,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(s);t<15019&&(c.codecs=c.codecs.filter((function(e){return"rtx"!==e.name}))),c.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),c.headerExtensions.forEach((function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===s&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=c,n.sendEncodingParameters=d})),"max-compat"!==r._config.bundlePolicy&&(s+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){s+=P(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,s+="a="+D.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))}));var a=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(a)},i.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(I("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(I("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=D.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var i=D.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,o){if(!(o+1>i)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?n+="m=application 0 DTLS/SCTP 5000\r\n":n+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var s;if(e.stream)"audio"===e.kind?s=e.stream.getAudioTracks()[0]:"video"===e.kind&&(s=e.stream.getVideoTracks()[0]),s&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var a=x(e.localCapabilities,e.remoteCapabilities);!a.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=P(e,a,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}}));var o=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(o)},i.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(n,i){if(!r._remoteDescription)return i(I("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<r.transceivers.length;s++)if(r.transceivers[s].mid===e.sdpMid){o=s;break}var a=r.transceivers[o];if(!a)return i(I("OperationError","Can not add ICE candidate"));if(a.rejected)return n();var c=Object.keys(e.candidate).length>0?D.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return n();if(c.component&&1!==c.component)return n();if((0===o||o>0&&a.iceTransport!==r.transceivers[0].iceTransport)&&!_(a.iceTransport,c))return i(I("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=D.getMediaSections(r._remoteDescription.sdp))[o]+="a="+(c.type?d:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=D.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var u=0;u<r.transceivers.length&&(r.transceivers[u].rejected||(r.transceivers[u].iceTransport.addRemoteCandidate({}),(t=D.getMediaSections(r._remoteDescription.sdp))[u]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=D.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));u++);n()}))},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw I("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])})),t}))}}}));var o=["createOffer","createAnswer"];return o.forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),i};function M(e){const t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e))))}}function j(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function B(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const r=new Event("enabled");r.enabled=e,this.dispatchEvent(r)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const r=O(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e){let t=!1;return(e=JSON.parse(JSON.stringify(e))).filter((e=>{if(e&&(e.urls||e.url)){let r=e.urls||e.url;e.url&&!e.urls&&u("RTCIceServer.url","RTCIceServer.urls");const n="string"==typeof r;return n&&(r=[r]),r=r.filter((e=>{if(0===e.indexOf("stun:"))return!1;const r=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return r&&!t?(t=!0,!0):r&&!t})),delete e.url,e.urls=n?r[0]:r,!!r.length}}))}(e.iceServers,t.version),d("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype}function N(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var L=Object.freeze({__proto__:null,shimPeerConnection:B,shimReplaceTrack:N,shimGetUserMedia:M,shimGetDisplayMedia:j});function F(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){u("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function V(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function U(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(i,o)}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function H(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),s(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function z(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){u("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function G(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function J(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(r){const{sender:t}=n,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function W(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function K(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function X(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Y=Object.freeze({__proto__:null,shimOnTrack:V,shimPeerConnection:U,shimSenderGetStats:q,shimReceiverGetStats:H,shimRemoveStream:z,shimRTCDataChannel:G,shimAddTransceiver:J,shimGetParameters:W,shimCreateOffer:K,shimCreateAnswer:X,shimGetUserMedia:F,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function $(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function Z(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function Q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};let a=function(e,t,r){const n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,r){const n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,r){const n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=a}function ee(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(te(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function te(e){return e&&void 0!==e.video?Object.assign({},e,{video:l(e.video)}):e}function re(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(u("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ne(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ie(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}}function oe(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var se=Object.freeze({__proto__:null,shimLocalStreamsAPI:$,shimRemoteStreamsAPI:Z,shimCallbacksAPI:Q,shimGetUserMedia:ee,shimConstraints:te,shimRTCIceServerUrls:re,shimTrackEventTransceiver:ne,shimCreateOfferLegacy:ie,shimAudioContext:oe});function ae(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const r=new t(e),n=D.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,s(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function ce(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=D.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=D.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),r=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(e),n=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const i=D.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],e);let i;i=0===r&&0===n?Number.POSITIVE_INFINITY:0===r||0===n?Math.max(r,n):Math.min(r,n);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>i}),this._sctp=o}return r.apply(this,arguments)}}function de(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},s(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function ue(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function pe(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function le(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var he=Object.freeze({__proto__:null,shimRTCIceCandidate:ae,shimMaxMessageSize:ce,shimSendThrowTypeError:de,shimConnectionState:ue,removeExtmapAllowMixed:pe,shimAddIceCandidateNullOrEmpty:le});const fe=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const r=d,n=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=o(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=o(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=o(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=o(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:n,commonShim:he,extractVersion:o,disableLog:a,disableWarnings:c};switch(n.browser){case"chrome":if(!E||!k||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=E,le(e,n),v(e,n),g(e),k(e,n),y(e),T(e,n),b(e),S(e),C(e),R(e,n),ae(e),ue(e),ce(e,n),de(e),pe(e,n);break;case"firefox":if(!Y||!U||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=Y,le(e,n),F(e,n),U(e,n),V(e),z(e),q(e),H(e),G(e),J(e),W(e),K(e),X(e),ae(e),ue(e),ce(e,n),de(e);break;case"edge":if(!L||!B||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),i.browserShim=L,M(e),j(e),B(e,n),N(e),ce(e,n),de(e);break;case"safari":if(!se||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=se,le(e,n),re(e),ie(e),Q(e),$(e),Z(e),ne(e),ee(e),oe(e),ae(e),ce(e,n),de(e),pe(e,n);break;default:r("Unsupported browser!")}return i}({window:"undefined"==typeof window?void 0:window});function me(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function ve(e,t){return e&t}function ge(e,t){return e|t}function ye(e,t){return e^t}function be(e,t){return e&~t}function Se(e){if(0==e)return-1;var t=0;return 65535&e||(e>>=16,t+=16),255&e||(e>>=8,t+=8),15&e||(e>>=4,t+=4),3&e||(e>>=2,t+=2),1&e||++t,t}function Ce(e){for(var t=0;0!=e;)e&=e-1,++t;return t}var we,Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function ke(e){var t,r,n="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),n+=Te.charAt(r>>6)+Te.charAt(63&r);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=Te.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=Te.charAt(r>>2)+Te.charAt((3&r)<<4));(3&n.length)>0;)n+="=";return n}function Re(e){var t,r="",n=0,i=0;for(t=0;t<e.length&&"="!=e.charAt(t);++t){var o=Te.indexOf(e.charAt(t));o<0||(0==n?(r+=me(o>>2),i=3&o,n=1):1==n?(r+=me(i<<2|o>>4),i=15&o,n=2):2==n?(r+=me(i),r+=me(o>>2),i=3&o,n=3):(r+=me(i<<2|o>>4),r+=me(15&o),n=0))}return 1==n&&(r+=me(i<<2)),r}var Ee,De=function(e){var t;if(void 0===we){var r="0123456789ABCDEF",n=" \f\n\r\t \u2028\u2029";for(we={},t=0;t<16;++t)we[r.charAt(t)]=t;for(r=r.toLowerCase(),t=10;t<16;++t)we[r.charAt(t)]=t;for(t=0;t<8;++t)we[n.charAt(t)]=-1}var i=[],o=0,s=0;for(t=0;t<e.length;++t){var a=e.charAt(t);if("="==a)break;if(-1!=(a=we[a])){if(void 0===a)throw new Error("Illegal character at offset "+t);o|=a,++s>=2?(i[i.length]=o,o=0,s=0):o<<=4}}if(s)throw new Error("Hex encoding incomplete: 4 bits missing");return i},Pe={decode:function(e){var t;if(void 0===Ee){var r="= \f\n\r\t \u2028\u2029";for(Ee=Object.create(null),t=0;t<64;++t)Ee["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(Ee["-"]=62,Ee._=63,t=0;t<9;++t)Ee[r.charAt(t)]=-1}var n=[],i=0,o=0;for(t=0;t<e.length;++t){var s=e.charAt(t);if("="==s)break;if(-1!=(s=Ee[s])){if(void 0===s)throw new Error("Illegal character at offset "+t);i|=s,++o>=4?(n[n.length]=i>>16,n[n.length]=i>>8&255,n[n.length]=255&i,i=0,o=0):i<<=6}}switch(o){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:n[n.length]=i>>10;break;case 3:n[n.length]=i>>16,n[n.length]=i>>8&255}return n},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(e){var t=Pe.re.exec(e);if(t)if(t[1])e=t[1];else{if(!t[2])throw new Error("RegExp out of sync");e=t[2]}return Pe.decode(e)}},xe=1e13,Ae=function(){function e(e){this.buf=[+e||0]}return e.prototype.mulAdd=function(e,t){var r,n,i=this.buf,o=i.length;for(r=0;r<o;++r)(n=i[r]*e+t)<xe?t=0:n-=(t=0|n/xe)*xe,i[r]=n;t>0&&(i[r]=t)},e.prototype.sub=function(e){var t,r,n=this.buf,i=n.length;for(t=0;t<i;++t)(r=n[t]-e)<0?(r+=xe,e=1):e=0,n[t]=r;for(;0===n[n.length-1];)n.pop()},e.prototype.toString=function(e){if(10!=(e||10))throw new Error("only base 10 is supported");for(var t=this.buf,r=t[t.length-1].toString(),n=t.length-2;n>=0;--n)r+=(xe+t[n]).toString().substring(1);return r},e.prototype.valueOf=function(){for(var e=this.buf,t=0,r=e.length-1;r>=0;--r)t=t*xe+e[r];return t},e.prototype.simplify=function(){var e=this.buf;return 1==e.length?e[0]:this},e}(),_e=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,Ie=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;function Oe(e,t){return e.length>t&&(e=e.substring(0,t)+""),e}var Me,je=function(){function e(t,r){this.hexDigits="0123456789ABCDEF",t instanceof e?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=r)}return e.prototype.get=function(e){if(void 0===e&&(e=this.pos++),e>=this.enc.length)throw new Error("Requesting byte offset ".concat(e," on a stream of length ").concat(this.enc.length));return"string"==typeof this.enc?this.enc.charCodeAt(e):this.enc[e]},e.prototype.hexByte=function(e){return this.hexDigits.charAt(e>>4&15)+this.hexDigits.charAt(15&e)},e.prototype.hexDump=function(e,t,r){for(var n="",i=e;i<t;++i)if(n+=this.hexByte(this.get(i)),!0!==r)switch(15&i){case 7:n+="  ";break;case 15:n+="\n";break;default:n+=" "}return n},e.prototype.isASCII=function(e,t){for(var r=e;r<t;++r){var n=this.get(r);if(n<32||n>176)return!1}return!0},e.prototype.parseStringISO=function(e,t){for(var r="",n=e;n<t;++n)r+=String.fromCharCode(this.get(n));return r},e.prototype.parseStringUTF=function(e,t){for(var r="",n=e;n<t;){var i=this.get(n++);r+=i<128?String.fromCharCode(i):i>191&&i<224?String.fromCharCode((31&i)<<6|63&this.get(n++)):String.fromCharCode((15&i)<<12|(63&this.get(n++))<<6|63&this.get(n++))}return r},e.prototype.parseStringBMP=function(e,t){for(var r,n,i="",o=e;o<t;)r=this.get(o++),n=this.get(o++),i+=String.fromCharCode(r<<8|n);return i},e.prototype.parseTime=function(e,t,r){var n=this.parseStringISO(e,t),i=(r?_e:Ie).exec(n);return i?(r&&(i[1]=+i[1],i[1]+=+i[1]<70?2e3:1900),n=i[1]+"-"+i[2]+"-"+i[3]+" "+i[4],i[5]&&(n+=":"+i[5],i[6]&&(n+=":"+i[6],i[7]&&(n+="."+i[7]))),i[8]&&(n+=" UTC","Z"!=i[8]&&(n+=i[8],i[9]&&(n+=":"+i[9]))),n):"Unrecognized time: "+n},e.prototype.parseInteger=function(e,t){for(var r,n=this.get(e),i=n>127,o=i?255:0,s="";n==o&&++e<t;)n=this.get(e);if(0===(r=t-e))return i?-1:0;if(r>4){for(s=n,r<<=3;!(128&(+s^o));)s=+s<<1,--r;s="("+r+" bit)\n"}i&&(n-=256);for(var a=new Ae(n),c=e+1;c<t;++c)a.mulAdd(256,this.get(c));return s+a.toString()},e.prototype.parseBitString=function(e,t,r){for(var n=this.get(e),i="("+((t-e-1<<3)-n)+" bit)\n",o="",s=e+1;s<t;++s){for(var a=this.get(s),c=s==t-1?n:0,d=7;d>=c;--d)o+=a>>d&1?"1":"0";if(o.length>r)return i+Oe(o,r)}return i+o},e.prototype.parseOctetString=function(e,t,r){if(this.isASCII(e,t))return Oe(this.parseStringISO(e,t),r);var n=t-e,i="("+n+" byte)\n";n>(r/=2)&&(t=e+r);for(var o=e;o<t;++o)i+=this.hexByte(this.get(o));return n>r&&(i+=""),i},e.prototype.parseOID=function(e,t,r){for(var n="",i=new Ae,o=0,s=e;s<t;++s){var a=this.get(s);if(i.mulAdd(128,127&a),o+=7,!(128&a)){if(""===n)if((i=i.simplify())instanceof Ae)i.sub(80),n="2."+i.toString();else{var c=i<80?i<40?0:1:2;n=c+"."+(i-40*c)}else n+="."+i.toString();if(n.length>r)return Oe(n,r);i=new Ae,o=0}}return o>0&&(n+=".incomplete"),n},e}(),Be=function(){function e(e,t,r,n,i){if(!(n instanceof Ne))throw new Error("Invalid tag value.");this.stream=e,this.header=t,this.length=r,this.tag=n,this.sub=i}return e.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},e.prototype.content=function(e){if(void 0===this.tag)return null;void 0===e&&(e=1/0);var t=this.posContent(),r=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+r,e);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(t)?"false":"true";case 2:return this.stream.parseInteger(t,t+r);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(t,t+r,e);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(t,t+r,e);case 6:return this.stream.parseOID(t,t+r,e);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return Oe(this.stream.parseStringUTF(t,t+r),e);case 18:case 19:case 20:case 21:case 22:case 26:return Oe(this.stream.parseStringISO(t,t+r),e);case 30:return Oe(this.stream.parseStringBMP(t,t+r),e);case 23:case 24:return this.stream.parseTime(t,t+r,23==this.tag.tagNumber)}return null},e.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},e.prototype.toPrettyString=function(e){void 0===e&&(e="");var t=e+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(t+="+"),t+=this.length,this.tag.tagConstructed?t+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(t+=" (encapsulates)"),t+="\n",null!==this.sub){e+="  ";for(var r=0,n=this.sub.length;r<n;++r)t+=this.sub[r].toPrettyString(e)}return t},e.prototype.posStart=function(){return this.stream.pos},e.prototype.posContent=function(){return this.stream.pos+this.header},e.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},e.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},e.decodeLength=function(e){var t=e.get(),r=127&t;if(r==t)return r;if(r>6)throw new Error("Length over 48 bits not supported at position "+(e.pos-1));if(0===r)return null;t=0;for(var n=0;n<r;++n)t=256*t+e.get();return t},e.prototype.getHexStringValue=function(){var e=this.toHexString(),t=2*this.header,r=2*this.length;return e.substr(t,r)},e.decode=function(t){var r;r=t instanceof je?t:new je(t,0);var n=new je(r),i=new Ne(r),o=e.decodeLength(r),s=r.pos,a=s-n.pos,c=null,d=function(){var t=[];if(null!==o){for(var n=s+o;r.pos<n;)t[t.length]=e.decode(r);if(r.pos!=n)throw new Error("Content size is not correct for container starting at offset "+s)}else try{for(;;){var i=e.decode(r);if(i.tag.isEOC())break;t[t.length]=i}o=s-r.pos}catch(e){throw new Error("Exception while decoding undefined length content: "+e)}return t};if(i.tagConstructed)c=d();else if(i.isUniversal()&&(3==i.tagNumber||4==i.tagNumber))try{if(3==i.tagNumber&&0!=r.get())throw new Error("BIT STRINGs with unused bits cannot encapsulate.");c=d();for(var u=0;u<c.length;++u)if(c[u].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch(e){c=null}if(null===c){if(null===o)throw new Error("We can't skip over an invalid tag with undefined length at offset "+s);r.pos=s+Math.abs(o)}return new e(n,a,o,i,c)},e}(),Ne=function(){function e(e){var t=e.get();if(this.tagClass=t>>6,this.tagConstructed=!!(32&t),this.tagNumber=31&t,31==this.tagNumber){var r=new Ae;do{t=e.get(),r.mulAdd(128,127&t)}while(128&t);this.tagNumber=r.simplify()}}return e.prototype.isUniversal=function(){return 0===this.tagClass},e.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},e}(),Le=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Fe=(1<<26)/Le[Le.length-1],Ve=function(){function e(e,t,r){null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}return e.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,o="",s=this.t,a=this.DB-s*this.DB%t;if(s-- >0)for(a<this.DB&&(r=this[s]>>a)>0&&(i=!0,o=me(r));s>=0;)a<t?(r=(this[s]&(1<<a)-1)<<t-a,r|=this[--s]>>(a+=this.DB-t)):(r=this[s]>>(a-=t)&n,a<=0&&(a+=this.DB,--s)),r>0&&(i=!0),i&&(o+=me(r));return i?o:"0"},e.prototype.negate=function(){var t=Ge();return e.ZERO.subTo(this,t),t},e.prototype.abs=function(){return this.s<0?this.negate():this},e.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0},e.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Qe(this[this.t-1]^this.s&this.DM)},e.prototype.mod=function(t){var r=Ge();return this.abs().divRemTo(t,null,r),this.s<0&&r.compareTo(e.ZERO)>0&&t.subTo(r,r),r},e.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new qe(t):new He(t),this.exp(e,r)},e.prototype.clone=function(){var e=Ge();return this.copyTo(e),e},e.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},e.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},e.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},e.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},e.prototype.toByteArray=function(){var e=this.t,t=[];t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),128&r&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t},e.prototype.equals=function(e){return 0==this.compareTo(e)},e.prototype.min=function(e){return this.compareTo(e)<0?this:e},e.prototype.max=function(e){return this.compareTo(e)>0?this:e},e.prototype.and=function(e){var t=Ge();return this.bitwiseTo(e,ve,t),t},e.prototype.or=function(e){var t=Ge();return this.bitwiseTo(e,ge,t),t},e.prototype.xor=function(e){var t=Ge();return this.bitwiseTo(e,ye,t),t},e.prototype.andNot=function(e){var t=Ge();return this.bitwiseTo(e,be,t),t},e.prototype.not=function(){for(var e=Ge(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},e.prototype.shiftLeft=function(e){var t=Ge();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},e.prototype.shiftRight=function(e){var t=Ge();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},e.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+Se(this[e]);return this.s<0?this.t*this.DB:-1},e.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=Ce(this[r]^t);return e},e.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:!!(this[t]&1<<e%this.DB)},e.prototype.setBit=function(e){return this.changeBit(e,ge)},e.prototype.clearBit=function(e){return this.changeBit(e,be)},e.prototype.flipBit=function(e){return this.changeBit(e,ye)},e.prototype.add=function(e){var t=Ge();return this.addTo(e,t),t},e.prototype.subtract=function(e){var t=Ge();return this.subTo(e,t),t},e.prototype.multiply=function(e){var t=Ge();return this.multiplyTo(e,t),t},e.prototype.divide=function(e){var t=Ge();return this.divRemTo(e,t,null),t},e.prototype.remainder=function(e){var t=Ge();return this.divRemTo(e,null,t),t},e.prototype.divideAndRemainder=function(e){var t=Ge(),r=Ge();return this.divRemTo(e,t,r),[t,r]},e.prototype.modPow=function(e,t){var r,n,i=e.bitLength(),o=Ze(1);if(i<=0)return o;r=i<18?1:i<48?3:i<144?4:i<768?5:6,n=i<8?new qe(t):t.isEven()?new ze(t):new He(t);var s=[],a=3,c=r-1,d=(1<<r)-1;if(s[1]=n.convert(this),r>1){var u=Ge();for(n.sqrTo(s[1],u);a<=d;)s[a]=Ge(),n.mulTo(u,s[a-2],s[a]),a+=2}var p,l,h=e.t-1,f=!0,m=Ge();for(i=Qe(e[h])-1;h>=0;){for(i>=c?p=e[h]>>i-c&d:(p=(e[h]&(1<<i+1)-1)<<c-i,h>0&&(p|=e[h-1]>>this.DB+i-c)),a=r;!(1&p);)p>>=1,--a;if((i-=a)<0&&(i+=this.DB,--h),f)s[p].copyTo(o),f=!1;else{for(;a>1;)n.sqrTo(o,m),n.sqrTo(m,o),a-=2;a>0?n.sqrTo(o,m):(l=o,o=m,m=l),n.mulTo(m,s[p],o)}for(;h>=0&&!(e[h]&1<<i);)n.sqrTo(o,m),l=o,o=m,m=l,--i<0&&(i=this.DB-1,--h)}return n.revert(o)},e.prototype.modInverse=function(t){var r=t.isEven();if(this.isEven()&&r||0==t.signum())return e.ZERO;for(var n=t.clone(),i=this.clone(),o=Ze(1),s=Ze(0),a=Ze(0),c=Ze(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),r?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(t,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),r?(a.isEven()&&c.isEven()||(a.addTo(this,a),c.subTo(t,c)),a.rShiftTo(1,a)):c.isEven()||c.subTo(t,c),c.rShiftTo(1,c);n.compareTo(i)>=0?(n.subTo(i,n),r&&o.subTo(a,o),s.subTo(c,s)):(i.subTo(n,i),r&&a.subTo(o,a),c.subTo(s,c))}return 0!=i.compareTo(e.ONE)?e.ZERO:c.compareTo(t)>=0?c.subtract(t):c.signum()<0?(c.addTo(t,c),c.signum()<0?c.add(t):c):c},e.prototype.pow=function(e){return this.exp(e,new Ue)},e.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),o=r.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),o>0&&(t.rShiftTo(o,t),r.rShiftTo(o,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return o>0&&r.lShiftTo(o,r),r},e.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=Le[Le.length-1]){for(t=0;t<Le.length;++t)if(r[0]==Le[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<Le.length;){for(var n=Le[t],i=t+1;i<Le.length&&n<Fe;)n*=Le[i++];for(n=r.modInt(n);t<i;)if(n%Le[t++]==0)return!1}return r.millerRabin(e)},e.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},e.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},e.prototype.fromString=function(t,r){var n;if(16==r)n=4;else if(8==r)n=3;else if(256==r)n=8;else if(2==r)n=1;else if(32==r)n=5;else{if(4!=r)return void this.fromRadix(t,r);n=2}this.t=0,this.s=0;for(var i=t.length,o=!1,s=0;--i>=0;){var a=8==n?255&+t[i]:$e(t,i);a<0?"-"==t.charAt(i)&&(o=!0):(o=!1,0==s?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&128&+t[0]&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),o&&e.ZERO.subTo(this,this)},e.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},e.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s},e.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},e.prototype.lShiftTo=function(e,t){for(var r=e%this.DB,n=this.DB-r,i=(1<<n)-1,o=Math.floor(e/this.DB),s=this.s<<r&this.DM,a=this.t-1;a>=0;--a)t[a+o+1]=this[a]>>n|s,s=(this[a]&i)<<r;for(a=o-1;a>=0;--a)t[a]=0;t[o]=s,t.t=this.t+o+1,t.s=this.s,t.clamp()},e.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,o=(1<<n)-1;t[0]=this[r]>>n;for(var s=r+1;s<this.t;++s)t[s-r-1]|=(this[s]&o)<<i,t[s-r]=this[s]>>n;n>0&&(t[this.t-r-1]|=(this.s&o)<<i),t.t=this.t-r,t.clamp()}},e.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()},e.prototype.multiplyTo=function(t,r){var n=this.abs(),i=t.abs(),o=n.t;for(r.t=o+i.t;--o>=0;)r[o]=0;for(o=0;o<i.t;++o)r[o+n.t]=n.am(0,i[o],r,o,0,n.t);r.s=0,r.clamp(),this.s!=t.s&&e.ZERO.subTo(r,r)},e.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},e.prototype.divRemTo=function(t,r,n){var i=t.abs();if(!(i.t<=0)){var o=this.abs();if(o.t<i.t)return null!=r&&r.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=Ge());var s=Ge(),a=this.s,c=t.s,d=this.DB-Qe(i[i.t-1]);d>0?(i.lShiftTo(d,s),o.lShiftTo(d,n)):(i.copyTo(s),o.copyTo(n));var u=s.t,p=s[u-1];if(0!=p){var l=p*(1<<this.F1)+(u>1?s[u-2]>>this.F2:0),h=this.FV/l,f=(1<<this.F1)/l,m=1<<this.F2,v=n.t,g=v-u,y=null==r?Ge():r;for(s.dlShiftTo(g,y),n.compareTo(y)>=0&&(n[n.t++]=1,n.subTo(y,n)),e.ONE.dlShiftTo(u,y),y.subTo(s,s);s.t<u;)s[s.t++]=0;for(;--g>=0;){var b=n[--v]==p?this.DM:Math.floor(n[v]*h+(n[v-1]+m)*f);if((n[v]+=s.am(0,b,n,g,0,u))<b)for(s.dlShiftTo(g,y),n.subTo(y,n);n[v]<--b;)n.subTo(y,n)}null!=r&&(n.drShiftTo(u,r),a!=c&&e.ZERO.subTo(r,r)),n.t=u,n.clamp(),d>0&&n.rShiftTo(d,n),a<0&&e.ZERO.subTo(n,n)}}},e.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(!(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},e.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},e.prototype.exp=function(t,r){if(t>4294967295||t<1)return e.ONE;var n=Ge(),i=Ge(),o=r.convert(this),s=Qe(t)-1;for(o.copyTo(n);--s>=0;)if(r.sqrTo(n,i),(t&1<<s)>0)r.mulTo(i,o,n);else{var a=n;n=i,i=a}return r.revert(n)},e.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},e.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=Ze(r),i=Ge(),o=Ge(),s="";for(this.divRemTo(n,i,o);i.signum()>0;)s=(r+o.intValue()).toString(e).substr(1)+s,i.divRemTo(n,i,o);return o.intValue().toString(e)+s},e.prototype.fromRadix=function(t,r){this.fromInt(0),null==r&&(r=10);for(var n=this.chunkSize(r),i=Math.pow(r,n),o=!1,s=0,a=0,c=0;c<t.length;++c){var d=$e(t,c);d<0?"-"==t.charAt(c)&&0==this.signum()&&(o=!0):(a=r*a+d,++s>=n&&(this.dMultiply(i),this.dAddOffset(a,0),s=0,a=0))}s>0&&(this.dMultiply(Math.pow(r,s)),this.dAddOffset(a,0)),o&&e.ZERO.subTo(this,this)},e.prototype.fromNumber=function(t,r,n){if("number"==typeof r)if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),ge,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(e.ONE.shiftLeft(t-1),this);else{var i=[],o=7&t;i.length=1+(t>>3),r.nextBytes(i),o>0?i[0]&=(1<<o)-1:i[0]=0,this.fromString(i,256)}},e.prototype.bitwiseTo=function(e,t,r){var n,i,o=Math.min(e.t,this.t);for(n=0;n<o;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){for(i=e.s&this.DM,n=o;n<this.t;++n)r[n]=t(this[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=o;n<e.t;++n)r[n]=t(i,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},e.prototype.changeBit=function(t,r){var n=e.ONE.shiftLeft(t);return this.bitwiseTo(n,r,n),n},e.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()},e.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},e.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},e.prototype.multiplyLowerTo=function(e,t,r){var n=Math.min(this.t+e.t,t);for(r.s=0,r.t=n;n>0;)r[--n]=0;for(var i=r.t-this.t;n<i;++n)r[n+this.t]=this.am(0,e[n],r,n,0,this.t);for(i=Math.min(e.t,t);n<i;++n)this.am(0,e[n],r,n,0,t-n);r.clamp()},e.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},e.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this[n])%e;return r},e.prototype.millerRabin=function(t){var r=this.subtract(e.ONE),n=r.getLowestSetBit();if(n<=0)return!1;var i=r.shiftRight(n);(t=t+1>>1)>Le.length&&(t=Le.length);for(var o=Ge(),s=0;s<t;++s){o.fromInt(Le[Math.floor(Math.random()*Le.length)]);var a=o.modPow(i,this);if(0!=a.compareTo(e.ONE)&&0!=a.compareTo(r)){for(var c=1;c++<n&&0!=a.compareTo(r);)if(0==(a=a.modPowInt(2,this)).compareTo(e.ONE))return!1;if(0!=a.compareTo(r))return!1}}return!0},e.prototype.square=function(){var e=Ge();return this.squareTo(e),e},e.prototype.gcda=function(e,t){var r=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(r.compareTo(n)<0){var i=r;r=n,n=i}var o=r.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)t(r);else{o<s&&(s=o),s>0&&(r.rShiftTo(s,r),n.rShiftTo(s,n));var a=function(){(o=r.getLowestSetBit())>0&&r.rShiftTo(o,r),(o=n.getLowestSetBit())>0&&n.rShiftTo(o,n),r.compareTo(n)>=0?(r.subTo(n,r),r.rShiftTo(1,r)):(n.subTo(r,n),n.rShiftTo(1,n)),r.signum()>0?setTimeout(a,0):(s>0&&n.lShiftTo(s,n),setTimeout((function(){t(n)}),0))};setTimeout(a,10)}},e.prototype.fromNumberAsync=function(t,r,n,i){if("number"==typeof r)if(t<2)this.fromInt(1);else{this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),ge,this),this.isEven()&&this.dAddOffset(1,0);var o=this,s=function(){o.dAddOffset(2,0),o.bitLength()>t&&o.subTo(e.ONE.shiftLeft(t-1),o),o.isProbablePrime(r)?setTimeout((function(){i()}),0):setTimeout(s,0)};setTimeout(s,0)}else{var a=[],c=7&t;a.length=1+(t>>3),r.nextBytes(a),c>0?a[0]&=(1<<c)-1:a[0]=0,this.fromString(a,256)}},e}(),Ue=function(){function e(){}return e.prototype.convert=function(e){return e},e.prototype.revert=function(e){return e},e.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},e.prototype.sqrTo=function(e,t){e.squareTo(t)},e}(),qe=function(){function e(e){this.m=e}return e.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},e.prototype.revert=function(e){return e},e.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},e.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}(),He=function(){function e(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}return e.prototype.convert=function(e){var t=Ge();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(Ve.ZERO)>0&&this.m.subTo(t,t),t},e.prototype.revert=function(e){var t=Ge();return e.copyTo(t),this.reduce(t),t},e.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},e.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}(),ze=function(){function e(e){this.m=e,this.r2=Ge(),this.q3=Ge(),Ve.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e)}return e.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=Ge();return e.copyTo(t),this.reduce(t),t},e.prototype.revert=function(e){return e},e.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},e.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},e.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e}();function Ge(){return new Ve(null)}function Je(e,t){return new Ve(e,t)}var We="undefined"!=typeof navigator;We&&"Microsoft Internet Explorer"==navigator.appName?(Ve.prototype.am=function(e,t,r,n,i,o){for(var s=32767&t,a=t>>15;--o>=0;){var c=32767&this[e],d=this[e++]>>15,u=a*c+d*s;i=((c=s*c+((32767&u)<<15)+r[n]+(1073741823&i))>>>30)+(u>>>15)+a*d+(i>>>30),r[n++]=1073741823&c}return i},Me=30):We&&"Netscape"!=navigator.appName?(Ve.prototype.am=function(e,t,r,n,i,o){for(;--o>=0;){var s=t*this[e++]+r[n]+i;i=Math.floor(s/67108864),r[n++]=67108863&s}return i},Me=26):(Ve.prototype.am=function(e,t,r,n,i,o){for(var s=16383&t,a=t>>14;--o>=0;){var c=16383&this[e],d=this[e++]>>14,u=a*c+d*s;i=((c=s*c+((16383&u)<<14)+r[n]+i)>>28)+(u>>14)+a*d,r[n++]=268435455&c}return i},Me=28),Ve.prototype.DB=Me,Ve.prototype.DM=(1<<Me)-1,Ve.prototype.DV=1<<Me;Ve.prototype.FV=Math.pow(2,52),Ve.prototype.F1=52-Me,Ve.prototype.F2=2*Me-52;var Ke,Xe,Ye=[];for(Ke="0".charCodeAt(0),Xe=0;Xe<=9;++Xe)Ye[Ke++]=Xe;for(Ke="a".charCodeAt(0),Xe=10;Xe<36;++Xe)Ye[Ke++]=Xe;for(Ke="A".charCodeAt(0),Xe=10;Xe<36;++Xe)Ye[Ke++]=Xe;function $e(e,t){var r=Ye[e.charCodeAt(t)];return null==r?-1:r}function Ze(e){var t=Ge();return t.fromInt(e),t}function Qe(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}Ve.ZERO=Ze(0),Ve.ONE=Ze(1);var et=function(){function e(){this.i=0,this.j=0,this.S=[]}return e.prototype.init=function(e){var t,r,n;for(t=0;t<256;++t)this.S[t]=t;for(r=0,t=0;t<256;++t)r=r+this.S[t]+e[t%e.length]&255,n=this.S[t],this.S[t]=this.S[r],this.S[r]=n;this.i=0,this.j=0},e.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]},e}();var tt,rt,nt=null;if(null==nt){nt=[],rt=0;var it=void 0;if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){var ot=new Uint32Array(256);for(window.crypto.getRandomValues(ot),it=0;it<ot.length;++it)nt[rt++]=255&ot[it]}var st=0,at=function(e){if((st=st||0)>=256||rt>=256)window.removeEventListener?window.removeEventListener("mousemove",at,!1):window.detachEvent&&window.detachEvent("onmousemove",at);else try{var t=e.x+e.y;nt[rt++]=255&t,st+=1}catch(e){}};"undefined"!=typeof window&&(window.addEventListener?window.addEventListener("mousemove",at,!1):window.attachEvent&&window.attachEvent("onmousemove",at))}function ct(){if(null==tt){for(tt=new et;rt<256;){var e=Math.floor(65536*Math.random());nt[rt++]=255&e}for(tt.init(nt),rt=0;rt<nt.length;++rt)nt[rt]=0;rt=0}return tt.next()}var dt=function(){function e(){}return e.prototype.nextBytes=function(e){for(var t=0;t<e.length;++t)e[t]=ct()},e}();var ut=function(){function e(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return e.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},e.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),r=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(r)<0;)t=t.add(this.p);return t.subtract(r).multiply(this.coeff).mod(this.p).multiply(this.q).add(r)},e.prototype.setPublic=function(e,t){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=Je(e,16),this.e=parseInt(t,16)):console.error("Invalid RSA public key")},e.prototype.encrypt=function(e){var t=this.n.bitLength()+7>>3,r=function(e,t){if(t<e.length+11)return console.error("Message too long for RSA"),null;for(var r=[],n=e.length-1;n>=0&&t>0;){var i=e.charCodeAt(n--);i<128?r[--t]=i:i>127&&i<2048?(r[--t]=63&i|128,r[--t]=i>>6|192):(r[--t]=63&i|128,r[--t]=i>>6&63|128,r[--t]=i>>12|224)}r[--t]=0;for(var o=new dt,s=[];t>2;){for(s[0]=0;0==s[0];)o.nextBytes(s);r[--t]=s[0]}return r[--t]=2,r[--t]=0,new Ve(r)}(e,t);if(null==r)return null;var n=this.doPublic(r);if(null==n)return null;for(var i=n.toString(16),o=i.length,s=0;s<2*t-o;s++)i="0"+i;return i},e.prototype.setPrivate=function(e,t,r){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=Je(e,16),this.e=parseInt(t,16),this.d=Je(r,16)):console.error("Invalid RSA private key")},e.prototype.setPrivateEx=function(e,t,r,n,i,o,s,a){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=Je(e,16),this.e=parseInt(t,16),this.d=Je(r,16),this.p=Je(n,16),this.q=Je(i,16),this.dmp1=Je(o,16),this.dmq1=Je(s,16),this.coeff=Je(a,16)):console.error("Invalid RSA private key")},e.prototype.generate=function(e,t){var r=new dt,n=e>>1;this.e=parseInt(t,16);for(var i=new Ve(t,16);;){for(;this.p=new Ve(e-n,1,r),0!=this.p.subtract(Ve.ONE).gcd(i).compareTo(Ve.ONE)||!this.p.isProbablePrime(10););for(;this.q=new Ve(n,1,r),0!=this.q.subtract(Ve.ONE).gcd(i).compareTo(Ve.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var s=this.p.subtract(Ve.ONE),a=this.q.subtract(Ve.ONE),c=s.multiply(a);if(0==c.gcd(i).compareTo(Ve.ONE)){this.n=this.p.multiply(this.q),this.d=i.modInverse(c),this.dmp1=this.d.mod(s),this.dmq1=this.d.mod(a),this.coeff=this.q.modInverse(this.p);break}}},e.prototype.decrypt=function(e){var t=Je(e,16),r=this.doPrivate(t);return null==r?null:function(e,t){var r=e.toByteArray(),n=0;for(;n<r.length&&0==r[n];)++n;if(r.length-n!=t-1||2!=r[n])return null;++n;for(;0!=r[n];)if(++n>=r.length)return null;var i="";for(;++n<r.length;){var o=255&r[n];o<128?i+=String.fromCharCode(o):o>191&&o<224?(i+=String.fromCharCode((31&o)<<6|63&r[n+1]),++n):(i+=String.fromCharCode((15&o)<<12|(63&r[n+1])<<6|63&r[n+2]),n+=2)}return i}(r,this.n.bitLength()+7>>3)},e.prototype.generateAsync=function(e,t,r){var n=new dt,i=e>>1;this.e=parseInt(t,16);var o=new Ve(t,16),s=this,a=function(){var t=function(){if(s.p.compareTo(s.q)<=0){var e=s.p;s.p=s.q,s.q=e}var t=s.p.subtract(Ve.ONE),n=s.q.subtract(Ve.ONE),i=t.multiply(n);0==i.gcd(o).compareTo(Ve.ONE)?(s.n=s.p.multiply(s.q),s.d=o.modInverse(i),s.dmp1=s.d.mod(t),s.dmq1=s.d.mod(n),s.coeff=s.q.modInverse(s.p),setTimeout((function(){r()}),0)):setTimeout(a,0)},c=function(){s.q=Ge(),s.q.fromNumberAsync(i,1,n,(function(){s.q.subtract(Ve.ONE).gcda(o,(function(e){0==e.compareTo(Ve.ONE)&&s.q.isProbablePrime(10)?setTimeout(t,0):setTimeout(c,0)}))}))},d=function(){s.p=Ge(),s.p.fromNumberAsync(e-i,1,n,(function(){s.p.subtract(Ve.ONE).gcda(o,(function(e){0==e.compareTo(Ve.ONE)&&s.p.isProbablePrime(10)?setTimeout(c,0):setTimeout(d,0)}))}))};setTimeout(d,0)};setTimeout(a,0)},e.prototype.sign=function(e,t,r){var n=function(e){return pt[e]||""}(r),i=function(e,t){if(t<e.length+22)return console.error("Message too long for RSA"),null;for(var r=t-e.length-6,n="",i=0;i<r;i+=2)n+="ff";return Je("0001"+n+"00"+e,16)}(n+t(e).toString(),this.n.bitLength()/4);if(null==i)return null;var o=this.doPrivate(i);if(null==o)return null;var s=o.toString(16);return 1&s.length?"0"+s:s},e.prototype.verify=function(e,t,r){var n=Je(t,16),i=this.doPublic(n);return null==i?null:function(e){for(var t in pt)if(pt.hasOwnProperty(t)){var r=pt[t],n=r.length;if(e.substr(0,n)==r)return e.substr(n)}return e}(i.toString(16).replace(/^1f+00/,""))==r(e).toString()},e}();var pt={md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",ripemd160:"3021300906052b2403020105000414"};var lt={};lt.lang={extend:function(e,t,r){if(!t||!e)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var n=function(){};if(n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t),r){var i;for(i in r)e.prototype[i]=r[i];var o=function(){},s=["toString","valueOf"];try{/MSIE/.test(navigator.userAgent)&&(o=function(e,t){for(i=0;i<s.length;i+=1){var r=s[i],n=t[r];"function"==typeof n&&n!=Object.prototype[r]&&(e[r]=n)}})}catch(e){}o(e.prototype,r)}}};var ht={};void 0!==ht.asn1&&ht.asn1||(ht.asn1={}),ht.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if("-"!=t.substr(0,1))t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var r=t.substr(1).length;r%2==1?r+=1:t.match(/^[0-7]/)||(r+=2);for(var n="",i=0;i<r;i++)n+="f";t=new Ve(n,16).xor(e).add(Ve.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return hextopem(e,t)},this.newObject=function(e){var t=ht.asn1,r=t.DERBoolean,n=t.DERInteger,i=t.DERBitString,o=t.DEROctetString,s=t.DERNull,a=t.DERObjectIdentifier,c=t.DEREnumerated,d=t.DERUTF8String,u=t.DERNumericString,p=t.DERPrintableString,l=t.DERTeletexString,h=t.DERIA5String,f=t.DERUTCTime,m=t.DERGeneralizedTime,v=t.DERSequence,g=t.DERSet,y=t.DERTaggedObject,b=t.ASN1Util.newObject,S=Object.keys(e);if(1!=S.length)throw"key of param shall be only one.";var C=S[0];if(-1==":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+C+":"))throw"undefined key: "+C;if("bool"==C)return new r(e[C]);if("int"==C)return new n(e[C]);if("bitstr"==C)return new i(e[C]);if("octstr"==C)return new o(e[C]);if("null"==C)return new s(e[C]);if("oid"==C)return new a(e[C]);if("enum"==C)return new c(e[C]);if("utf8str"==C)return new d(e[C]);if("numstr"==C)return new u(e[C]);if("prnstr"==C)return new p(e[C]);if("telstr"==C)return new l(e[C]);if("ia5str"==C)return new h(e[C]);if("utctime"==C)return new f(e[C]);if("gentime"==C)return new m(e[C]);if("seq"==C){for(var w=e[C],T=[],k=0;k<w.length;k++){var R=b(w[k]);T.push(R)}return new v({array:T})}if("set"==C){for(w=e[C],T=[],k=0;k<w.length;k++){R=b(w[k]);T.push(R)}return new g({array:T})}if("tag"==C){var E=e[C];if("[object Array]"===Object.prototype.toString.call(E)&&3==E.length){var D=b(E[2]);return new y({tag:E[0],explicit:E[1],obj:D})}var P={};if(void 0!==E.explicit&&(P.explicit=E.explicit),void 0!==E.tag&&(P.tag=E.tag),void 0===E.obj)throw"obj shall be specified for 'tag'.";return P.obj=b(E.obj),new y(P)}},this.jsonToASN1HEX=function(e){return this.newObject(e).getEncodedHex()}},ht.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",r=parseInt(e.substr(0,2),16),n=(t=Math.floor(r/40)+"."+r%40,""),i=2;i<e.length;i+=2){var o=("00000000"+parseInt(e.substr(i,2),16).toString(2)).slice(-8);if(n+=o.substr(1,7),"0"==o.substr(0,1))t=t+"."+new Ve(n,2).toString(10),n=""}return t},ht.asn1.ASN1Util.oidIntToHex=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},r=function(e){var r="",n=new Ve(e,10).toString(2),i=7-n.length%7;7==i&&(i=0);for(var o="",s=0;s<i;s++)o+="0";n=o+n;for(s=0;s<n.length-1;s+=7){var a=n.substr(s,7);s!=n.length-7&&(a="1"+a),r+=t(parseInt(a,2))}return r};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var n="",i=e.split("."),o=40*parseInt(i[0])+parseInt(i[1]);n+=t(o),i.splice(0,2);for(var s=0;s<i.length;s++)n+=r(i[s]);return n},ht.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n=0,v="+this.hV;var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var r=t.length/2;if(r>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+r).toString(16)+t},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},ht.asn1.DERAbstractString=function(e){ht.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(this.s)},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?this.setString(e):void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},lt.lang.extend(ht.asn1.DERAbstractString,ht.asn1.ASN1Object),ht.asn1.DERAbstractTime=function(e){ht.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){return utc=e.getTime()+6e4*e.getTimezoneOffset(),new Date(utc)},this.formatDate=function(e,t,r){var n=this.zeroPadding,i=this.localDateToUTC(e),o=String(i.getFullYear());"utc"==t&&(o=o.substr(2,2));var s=o+n(String(i.getMonth()+1),2)+n(String(i.getDate()),2)+n(String(i.getHours()),2)+n(String(i.getMinutes()),2)+n(String(i.getSeconds()),2);if(!0===r){var a=i.getMilliseconds();if(0!=a){var c=n(String(a),3);s=s+"."+(c=c.replace(/[0]+$/,""))}}return s+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=stohex(e)},this.setByDateValue=function(e,t,r,n,i,o){var s=new Date(Date.UTC(e,t-1,r,n,i,o,0));this.setByDate(s)},this.getFreshValueHex=function(){return this.hV}},lt.lang.extend(ht.asn1.DERAbstractTime,ht.asn1.ASN1Object),ht.asn1.DERAbstractStructured=function(e){ht.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},lt.lang.extend(ht.asn1.DERAbstractStructured,ht.asn1.ASN1Object),ht.asn1.DERBoolean=function(){ht.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},lt.lang.extend(ht.asn1.DERBoolean,ht.asn1.ASN1Object),ht.asn1.DERInteger=function(e){ht.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=ht.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new Ve(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.bigint?this.setByBigInteger(e.bigint):void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},lt.lang.extend(ht.asn1.DERInteger,ht.asn1.ASN1Object),ht.asn1.DERBitString=function(e){if(void 0!==e&&void 0!==e.obj){var t=ht.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.getEncodedHex()}ht.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var r="0"+e;this.hTLV=null,this.isModified=!0,this.hV=r+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0);for(var r=0;r<=t;r++)e+="0";var n="";for(r=0;r<e.length-1;r+=8){var i=e.substr(r,8),o=parseInt(i,2).toString(16);1==o.length&&(o="0"+o),n+=o}this.hTLV=null,this.isModified=!0,this.hV="0"+t+n},this.setByBooleanArray=function(e){for(var t="",r=0;r<e.length;r++)1==e[r]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},lt.lang.extend(ht.asn1.DERBitString,ht.asn1.ASN1Object),ht.asn1.DEROctetString=function(e){if(void 0!==e&&void 0!==e.obj){var t=ht.asn1.ASN1Util.newObject(e.obj);e.hex=t.getEncodedHex()}ht.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},lt.lang.extend(ht.asn1.DEROctetString,ht.asn1.DERAbstractString),ht.asn1.DERNull=function(){ht.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},lt.lang.extend(ht.asn1.DERNull,ht.asn1.ASN1Object),ht.asn1.DERObjectIdentifier=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},r=function(e){var r="",n=new Ve(e,10).toString(2),i=7-n.length%7;7==i&&(i=0);for(var o="",s=0;s<i;s++)o+="0";n=o+n;for(s=0;s<n.length-1;s+=7){var a=n.substr(s,7);s!=n.length-7&&(a="1"+a),r+=t(parseInt(a,2))}return r};ht.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var n="",i=e.split("."),o=40*parseInt(i[0])+parseInt(i[1]);n+=t(o),i.splice(0,2);for(var s=0;s<i.length;s++)n+=r(i[s]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=n},this.setValueName=function(e){var t=ht.asn1.x509.OID.name2oid(e);if(""===t)throw"DERObjectIdentifier oidName undefined: "+e;this.setValueOidString(t)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e):void 0!==e.oid?this.setValueOidString(e.oid):void 0!==e.hex?this.setValueHex(e.hex):void 0!==e.name&&this.setValueName(e.name))},lt.lang.extend(ht.asn1.DERObjectIdentifier,ht.asn1.ASN1Object),ht.asn1.DEREnumerated=function(e){ht.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=ht.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new Ve(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},lt.lang.extend(ht.asn1.DEREnumerated,ht.asn1.ASN1Object),ht.asn1.DERUTF8String=function(e){ht.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},lt.lang.extend(ht.asn1.DERUTF8String,ht.asn1.DERAbstractString),ht.asn1.DERNumericString=function(e){ht.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},lt.lang.extend(ht.asn1.DERNumericString,ht.asn1.DERAbstractString),ht.asn1.DERPrintableString=function(e){ht.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},lt.lang.extend(ht.asn1.DERPrintableString,ht.asn1.DERAbstractString),ht.asn1.DERTeletexString=function(e){ht.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},lt.lang.extend(ht.asn1.DERTeletexString,ht.asn1.DERAbstractString),ht.asn1.DERIA5String=function(e){ht.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},lt.lang.extend(ht.asn1.DERIA5String,ht.asn1.DERAbstractString),ht.asn1.DERUTCTime=function(e){ht.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{12}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date))},lt.lang.extend(ht.asn1.DERUTCTime,ht.asn1.DERAbstractTime),ht.asn1.DERGeneralizedTime=function(e){ht.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)),this.hV},void 0!==e&&(void 0!==e.str?this.setString(e.str):"string"==typeof e&&e.match(/^[0-9]{14}Z$/)?this.setString(e):void 0!==e.hex?this.setStringHex(e.hex):void 0!==e.date&&this.setByDate(e.date),!0===e.millis&&(this.withMillis=!0))},lt.lang.extend(ht.asn1.DERGeneralizedTime,ht.asn1.DERAbstractTime),ht.asn1.DERSequence=function(e){ht.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++){e+=this.asn1Array[t].getEncodedHex()}return this.hV=e,this.hV}},lt.lang.extend(ht.asn1.DERSequence,ht.asn1.DERAbstractStructured),ht.asn1.DERSet=function(e){ht.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var r=this.asn1Array[t];e.push(r.getEncodedHex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},void 0!==e&&void 0!==e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},lt.lang.extend(ht.asn1.DERSet,ht.asn1.DERAbstractStructured),ht.asn1.DERTaggedObject=function(e){ht.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(e,t,r){this.hT=t,this.isExplicit=e,this.asn1Object=r,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=r.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,t),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.tag&&(this.hT=e.tag),void 0!==e.explicit&&(this.isExplicit=e.explicit),void 0!==e.obj&&(this.asn1Object=e.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},lt.lang.extend(ht.asn1.DERTaggedObject,ht.asn1.ASN1Object);var ft,mt,vt,gt=window&&window.__extends||(ft=function(e,t){return ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},ft(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ft(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),yt=function(e){function t(r){var n=e.call(this)||this;return r&&("string"==typeof r?n.parseKey(r):(t.hasPrivateKeyProperty(r)||t.hasPublicKeyProperty(r))&&n.parsePropertiesFrom(r)),n}return gt(t,e),t.prototype.parseKey=function(e){try{var t=0,r=0,n=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(e)?De(e):Pe.unarmor(e),i=Be.decode(n);if(3===i.sub.length&&(i=i.sub[2].sub[0]),9===i.sub.length){t=i.sub[1].getHexStringValue(),this.n=Je(t,16),r=i.sub[2].getHexStringValue(),this.e=parseInt(r,16);var o=i.sub[3].getHexStringValue();this.d=Je(o,16);var s=i.sub[4].getHexStringValue();this.p=Je(s,16);var a=i.sub[5].getHexStringValue();this.q=Je(a,16);var c=i.sub[6].getHexStringValue();this.dmp1=Je(c,16);var d=i.sub[7].getHexStringValue();this.dmq1=Je(d,16);var u=i.sub[8].getHexStringValue();this.coeff=Je(u,16)}else{if(2!==i.sub.length)return!1;if(i.sub[0].sub){var p=i.sub[1].sub[0];t=p.sub[0].getHexStringValue(),this.n=Je(t,16),r=p.sub[1].getHexStringValue(),this.e=parseInt(r,16)}else t=i.sub[0].getHexStringValue(),this.n=Je(t,16),r=i.sub[1].getHexStringValue(),this.e=parseInt(r,16)}return!0}catch(e){return!1}},t.prototype.getPrivateBaseKey=function(){var e={array:[new ht.asn1.DERInteger({int:0}),new ht.asn1.DERInteger({bigint:this.n}),new ht.asn1.DERInteger({int:this.e}),new ht.asn1.DERInteger({bigint:this.d}),new ht.asn1.DERInteger({bigint:this.p}),new ht.asn1.DERInteger({bigint:this.q}),new ht.asn1.DERInteger({bigint:this.dmp1}),new ht.asn1.DERInteger({bigint:this.dmq1}),new ht.asn1.DERInteger({bigint:this.coeff})]};return new ht.asn1.DERSequence(e).getEncodedHex()},t.prototype.getPrivateBaseKeyB64=function(){return ke(this.getPrivateBaseKey())},t.prototype.getPublicBaseKey=function(){var e=new ht.asn1.DERSequence({array:[new ht.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new ht.asn1.DERNull]}),t=new ht.asn1.DERSequence({array:[new ht.asn1.DERInteger({bigint:this.n}),new ht.asn1.DERInteger({int:this.e})]}),r=new ht.asn1.DERBitString({hex:"00"+t.getEncodedHex()});return new ht.asn1.DERSequence({array:[e,r]}).getEncodedHex()},t.prototype.getPublicBaseKeyB64=function(){return ke(this.getPublicBaseKey())},t.wordwrap=function(e,t){if(!e)return e;var r="(.{1,"+(t=t||64)+"})( +|$\n?)|(.{1,"+t+"})";return e.match(RegExp(r,"g")).join("\n")},t.prototype.getPrivateKey=function(){var e="-----BEGIN RSA PRIVATE KEY-----\n";return e+=t.wordwrap(this.getPrivateBaseKeyB64())+"\n",e+="-----END RSA PRIVATE KEY-----"},t.prototype.getPublicKey=function(){var e="-----BEGIN PUBLIC KEY-----\n";return e+=t.wordwrap(this.getPublicBaseKeyB64())+"\n",e+="-----END PUBLIC KEY-----"},t.hasPublicKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")},t.hasPrivateKeyProperty=function(e){return(e=e||{}).hasOwnProperty("n")&&e.hasOwnProperty("e")&&e.hasOwnProperty("d")&&e.hasOwnProperty("p")&&e.hasOwnProperty("q")&&e.hasOwnProperty("dmp1")&&e.hasOwnProperty("dmq1")&&e.hasOwnProperty("coeff")},t.prototype.parsePropertiesFrom=function(e){this.n=e.n,this.e=e.e,e.hasOwnProperty("d")&&(this.d=e.d,this.p=e.p,this.q=e.q,this.dmp1=e.dmp1,this.dmq1=e.dmq1,this.coeff=e.coeff)},t}(ut),bt="undefined"!=typeof process?null===(mt=process.env)||void 0===mt?void 0:mt.npm_package_version:void 0,St=function(){function e(e){void 0===e&&(e={}),e=e||{},this.default_key_size=e.default_key_size?parseInt(e.default_key_size,10):1024,this.default_public_exponent=e.default_public_exponent||"010001",this.log=e.log||!1,this.key=null}return e.prototype.setKey=function(e){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new yt(e)},e.prototype.setPrivateKey=function(e){this.setKey(e)},e.prototype.setPublicKey=function(e){this.setKey(e)},e.prototype.decrypt=function(e){try{return this.getKey().decrypt(Re(e))}catch(e){return!1}},e.prototype.encrypt=function(e){try{return ke(this.getKey().encrypt(e))}catch(e){return!1}},e.prototype.sign=function(e,t,r){try{return ke(this.getKey().sign(e,t,r))}catch(e){return!1}},e.prototype.verify=function(e,t,r){try{return this.getKey().verify(e,Re(t),r)}catch(e){return!1}},e.prototype.getKey=function(e){if(!this.key){if(this.key=new yt,e&&"[object Function]"==={}.toString.call(e))return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,e);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},e.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},e.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},e.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},e.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},e.version=bt,e}(),Ct="[Xmov Nebula TTSA SDK v".concat("1.0.3","]");function wt(e){return e[0]!==Ct&&e.unshift(Ct),e}function Tt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(window,wt(e))}function kt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(window,wt(e))}function Rt(e){var t;return"".concat(null===(t=toString.call(e).match(/\[object (\S*)]/i))||void 0===t?void 0:t[1]).toLowerCase()}function Et(e){return"function"===Rt(HTMLElement)&&"function"===Rt(HTMLElement.constructor)?e instanceof HTMLElement:e&&"string"===Rt(null==e?void 0:e.nodeName)&&(null==e?void 0:e.nodeType)===((null===Node||void 0===Node?void 0:Node.ELEMENT_NODE)||1)}function Dt(e){return"string"===Rt(e)?document.querySelector(e):Et(e)?e:e||null}function Pt(e){if(e&&"object"===Rt(e)){var t=[];for(var r in e)t.push("".concat((n=r,n?"".concat(n).replace(/([A-Z])/g,"-$1").toLowerCase():""),": ").concat(e[r]));return t.join(String.fromCharCode(59)).replace(/px{2,}/gi,"px")}var n;return"".concat(e)}!function(e){e.GET="GET",e.POST="POST"}(vt||(vt={}));var xt=function(){function e(e){this.baseURL=e}return e.prototype.send=function(e){var t="".concat(e.method||vt.GET).toUpperCase(),r=t===vt.GET,n=this.baseURL+e.path;return new Promise((function(i,o){var s=new XMLHttpRequest;s.responseType="json",s.onreadystatechange=function(){this.readyState===s.DONE&&(this.response?i(this.response):o(":".concat(n)))};var a=Object.entries(e.body).map((function(e){var t=e[0],r=e[1];return"&".concat(t,"=").concat(r)})),c=a.join("").replace("&",""),d=r?n+"?"+c:n,u=r?null:JSON.stringify(e.body);s.open(t.toLocaleLowerCase(),d,!0),s.setRequestHeader("Content-Type","application/json;charset=utf-8"),s.setRequestHeader("Accept","application/json;charset=utf-8"),e.body.user_id&&e.body.key&&s.setRequestHeader("Authorization","token ".concat(e.body.user_id," ").concat(e.body.key)),s.send(u)}))},e}();function At(e){return t(this,void 0,void 0,(function(){return r(this,(function(t){return[2,new Promise((function(t,r){var n,i,o;if(null==(null==e?void 0:e.videoElement))return kt(o="'options.videoElement' is required"),void r(new Error(o));if(!Et(e.videoElement)||"function"!=typeof e.videoElement.play)return kt(o="'options.videoElement' should be a DOM object mapped through <video> of HTML, and the current value [".concat(e.videoElement,"] is invalid")),void r(new Error(o));var s=Dt(e.container)||document.body;(null===(n=e.videoElement)||void 0===n?void 0:n.hasAttribute("muted"))||null===(i=e.videoElement)||void 0===i||i.setAttribute("muted","");var a=(e=Object.assign({},{width:24,height:24,top:12,left:12,color:"white"},e)).id||"svg-".concat("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))),c=Pt({cursor:"pointer",position:"absolute",top:"50%",left:"50%",margin:"calc(-50vh + ".concat(e.top,"px) 0 0 calc(-50vw + ").concat(e.left,"px)"),zIndex:(~~e.videoElement.style.zIndex||0)+1,width:"".concat(e.width,"px"),height:"".concat(e.height,"px")}),d=null;if(e.icon)if("string"===Rt(e.icon))if((l="".concat(e.icon)).startsWith("#")||l.startsWith(".")){var u=Dt(l);u?d=u:kt("The DOM object pointed to by selector '".concat(l,"' is empty"))}else{var p=document.createElement("img");p.src=l,d=p}else if(Et(e.icon)){var l;(l=e.icon).setAttribute("id",l.getAttribute("id")||a),(d=Dt("#".concat(l.getAttribute("id"))))||kt("The DOM object pointed to by selector '".concat(l,"' is empty"))}else kt('The value of the "icon" field is not within the legal range: "class or id selector", "DOM object", "image path of string type"');if(d)d.setAttribute("id",d.getAttribute("id")||a),Et(e.icon)||d.setAttribute("style",c),d.setAttribute("style",c),s.appendChild(d);else{var h=s.querySelectorAll("svg[data-id='voice-icon']")[0];h||(h=document.createElementNS("http://www.w3.org/2000/svg","svg"),s.appendChild(h)),h.setAttribute("viewBox","0 0 1026 1024"),h.setAttribute("version","1.0.0"),h.setAttribute("id",a),h.setAttribute("t","".concat(Date.now())),h.setAttribute("width","".concat(e.width)),h.setAttribute("height","".concat(e.height)),h.setAttribute("fill","".concat(e.color)),h.setAttribute("style",c),h.setAttribute("data-id","voice-icon"),h.innerHTML='\n        <path\n          d="M240.023158 329.356725H144.719298c-8.819774 0-15.968811 7.149037-15.968811 15.968811v328.358675c0 8.819774 7.149037 15.968811 15.968811 15.96881h193.621833c0 0.07685 0.036928 0.149708 0.099805 0.195618l182.323898 133.236772a7.984405 7.984405 0 0 0 12.695205-6.446409V622.793606l64.374269 64.374269v240.995306c0 8.819774-7.149037 15.968811-15.968811 15.968811a15.968811 15.968811 0 0 1-9.422596-3.075992L320.078799 756.605255a15.968811 15.968811 0 0 0-9.422596-3.07699H128.750487c-35.277099 0-63.875244-28.598144-63.875243-63.875244V329.356725c0-35.277099 28.598144-63.875244 63.875243-63.875244h47.397427l63.875244 63.875244zM533.460039 442.126472V203.34584a7.984405 7.984405 0 0 0-12.695205-6.446409l-134.351594 98.180242-45.171774-45.171774L572.443899 80.92694c7.120094-5.204834 17.110581-3.650869 22.314417 3.469224A15.968811 15.968811 0 0 1 597.834308 93.816764v412.683977l-64.374269-64.374269z m336.776234 336.776234l-43.516008-43.51501C873.074729 672.799938 896.251462 598.005021 896.251462 511.001949c0-138.745014-58.939883-246.440671-176.820647-323.088967A47.906433 47.906433 0 0 1 697.639376 147.751423V144.717349c0-14.036585 11.378776-25.415361 25.415361-25.415361 4.359485 0 8.644117 1.120811 12.445692 3.255642C885.249949 206.655376 960.126706 336.137481 960.126706 511.001949c0 114.37062-40.59671 203.053411-89.890433 267.900757z m-90.129965 90.537169C737.183142 902.479345 702.280312 917.638737 697.639376 916.210526c-12.974659-3.992203-19.961014-16.269224-19.961013-34.931774 0-11.10531 5.301645-21.265466 15.903937-30.480467a45.910331 45.910331 0 0 1 6.746823-4.863501c11.948663-7.066199 23.35239-14.421832 34.208187-22.063907l45.568998 45.568998z m0.504016-180.163119l-47.753731-47.753731C755.502363 603.286706 768.500975 558.661864 768.500975 511.001949c0-88.404335-44.723649-166.363072-112.779727-212.48499-15.968811-11.078363-33.933723-31.039376-29.941521-48.006238s17.964912-29.94152 29.941521-25.916382C760.489622 277.271454 832.376218 385.741598 832.376218 511.001949c0 67.674823-18.361138 128.419181-51.765894 178.274807zM688.117973 777.45154A323.332491 323.332491 0 0 1 664.703704 790.45614c-13.97271 4.895439-24.951267 4.990253-36.927876-14.97076-9.769918-16.283197-1.60786-29.909583 15.275166-43.100819l45.066979 45.065981zM90.7537 90.752749c12.472639-12.472639 32.694144-12.472639 45.166783 0L936.922027 891.753294c12.472639 12.472639 12.472639 32.694144 0 45.166784s-32.694144 12.472639-45.166783 0L90.754698 135.918534c-12.472639-12.472639-12.472639-32.694144 0-45.166784z"\n          p-id="0"\n        ></path>\n      '}setTimeout((function(){var r=d||document.querySelector("#".concat(a));r&&setTimeout((function(){var e=function(e,t){void 0===t&&(t=!1);var r=e.getBoundingClientRect(),n=r.top,i=r.left,o=r.bottom,s=r.right,a=window.innerHeight,c=window.innerWidth;return t?(n>0&&n<a||o>0&&o<a)&&(i>0&&i<c||s>0&&s<c):n>=0&&i>=0&&o<=a&&s<=c}(r);e||function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(window,wt(e))}("The mute button may be outside the visible area, so it is recommended to check it",r)}),3e3);var n=function(){r&&(r.style.display="none",r.setAttribute("style","".concat(r.getAttribute("style"),";display: none!important;")),null==r||r.removeEventListener("click",o))},i=function(){r&&(r.style.display="block",r.addEventListener("click",o))},o=function(){var t,r;return e.videoElement.muted=!1,e.videoElement.removeAttribute("muted"),null===(r=null===(t=e.videoElement)||void 0===t?void 0:t.play)||void 0===r?void 0:r.call(t).then((function(){n()})).catch((function(e){kt(e)}))};i(),t({$el:r,hide:n,show:i,closeMute:o})}),0)}))]}))}))}It.sessions={},It.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||It.extension.isInstalled()}return!0};var _t={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var r=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",r(n)}else r(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function It(e){if((e=e||{}).success="function"==typeof e.success?e.success:It.noop,e.error="function"==typeof e.error?e.error:It.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:It.noop,!It.initDone)return e.error("Library not initialized"),{};if(!It.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(It.log("Library initialized: "+It.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,r=null,n={},i=null,o=null,s=0,a=e.server;It.isArray(a)?(It.log("Multiple servers provided ("+a.length+"), will use the first that works"),a=null,o=e.server,It.debug(o)):0===a.indexOf("ws")?(t=!0,It.log("Using WebSockets to contact Janus: "+a)):(t=!1,It.log("Using REST API to contact Janus: "+a));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],d=e.iceTransportPolicy,u=e.bundlePolicy,p=!0===e.ipv6,l=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(l=!0===e.withCredentials);var h=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(h=e.max_poll_events),h<1&&(h=1);var f=null;void 0!==e.token&&null!==e.token&&(f=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var v=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(v=e.keepAlivePeriod),isNaN(v)&&(v=25e3);var g=6e4;function y(e){var t={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(g=e.longPollTimeout),isNaN(g)&&(g=6e4);var b,S=!1,C=null,w={},T=this,k=0,R={};function E(){if(null!=C)if(It.debug("Long poll..."),S){var t=a+"/"+C+"?rid="+(new Date).getTime();h&&(t=t+"&maxev="+h),f&&(t=t+"&token="+encodeURIComponent(f)),m&&(t=t+"&apisecret="+encodeURIComponent(m)),It.httpAPICall(t,{verb:"GET",withCredentials:l,success:D,timeout:g,error:function(t,r){if(It.error(t+":",r),++k>3)return S=!1,void e.error("Lost connection to the server (is it down?)");E()}})}else It.warn("Is the server down? (connected=false)")}function D(e,n){if(k=0,t||null==C||!0===n||E(),t||!It.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(c=e.sender))return void It.warn("Missing sender...");if(!(u=w[c]))return void It.debug("This handle is not attached to this session");var i=e.candidate;It.debug("Got a trickled candidate on session "+C),It.debug(i);var o=u.webrtcStuff;o.pc&&o.remoteSdp?(It.debug("Adding remote candidate:",i),i&&!0!==i.completed?o.pc.addIceCandidate(i):o.pc.addIceCandidate(It.endOfCandidates)):(It.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(i),It.debug(o.candidates))}else{if("webrtcup"===e.janus)return It.debug("Got a webrtcup event on session "+C),It.debug(e),(c=e.sender)?(u=w[c])?void u.webrtcState(!0):void It.debug("This handle is not attached to this session"):void It.warn("Missing sender...");if("hangup"===e.janus){if(It.debug("Got a hangup event on session "+C),It.debug(e),!(c=e.sender))return void It.warn("Missing sender...");if(!(u=w[c]))return void It.debug("This handle is not attached to this session");u.webrtcState(!1,e.reason),u.hangup()}else if("detached"===e.janus){if(It.debug("Got a detached event on session "+C),It.debug(e),!(c=e.sender))return void It.warn("Missing sender...");if(!(u=w[c]))return;u.detached=!0,u.ondetached(),u.detach()}else if("media"===e.janus){if(It.debug("Got a media event on session "+C),It.debug(e),!(c=e.sender))return void It.warn("Missing sender...");if(!(u=w[c]))return void It.debug("This handle is not attached to this session");u.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(It.debug("Got a slowlink event on session "+C),It.debug(e),!(c=e.sender))return void It.warn("Missing sender...");if(!(u=w[c]))return void It.debug("This handle is not attached to this session");u.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var s,a;if(It.error("Ooops: "+e.error.code+" "+e.error.reason),It.debug(e),s=e.transaction)(a=R[s])&&a(e),delete R[s];return}if("event"===e.janus){var c;if(It.debug("Got a plugin event on session "+C),It.debug(e),!(c=e.sender))return void It.warn("Missing sender...");var d=e.plugindata;if(!d)return void It.warn("Missing plugindata...");It.debug("  -- Event is coming from "+c+" ("+d.plugin+")");var u,p=d.data;if(It.debug(p),!(u=w[c]))return void It.warn("This handle is not attached to this session");var l=e.jsep;l&&(It.debug("Handling SDP as well..."),It.debug(l));var h=u.onmessage;h?(It.debug("Notifying application..."),h(p,l)):It.debug("No provided notification callback")}else{if("timeout"===e.janus)return It.error("Timeout on session "+C),It.debug(e),void(t&&r.close(3504,"Gateway timeout"));It.warn("Unknown message/event  '"+e.janus+"' on session "+C),It.debug(e)}}}else It.debug("Got a success on session "+C),It.debug(e),(s=e.transaction)&&((a=R[s])&&a(e),delete R[s]);else It.debug("Got an ack on session "+C),It.debug(e),(s=e.transaction)&&((a=R[s])&&a(e),delete R[s]);else It.vdebug("Got a keepalive on session "+C);else for(var f=0;f<e.length;f++)D(e[f],!0)}function P(){if(a&&t&&S){i=setTimeout(P,v);var e={janus:"keepalive",session_id:C,transaction:It.randomString(12)};f&&(e.token=f),m&&(e.apisecret=m),r.send(JSON.stringify(e))}}function x(c){var d=It.randomString(12),u={janus:"create",transaction:d};if(c.reconnect&&(S=!1,u.janus="claim",u.session_id=C,r&&(r.onopen=null,r.onerror=null,r.onclose=null,i&&(clearTimeout(i),i=null))),f&&(u.token=f),m&&(u.apisecret=m),!a&&It.isArray(o)&&(0===(a=o[s]).indexOf("ws")?(t=!0,It.log("Server #"+(s+1)+": trying WebSockets to contact Janus ("+a+")")):(t=!1,It.log("Server #"+(s+1)+": trying REST API to contact Janus ("+a+")"))),t)for(var p in r=It.newWebSocket(a,"janus-protocol"),n={error:function(){if(It.error("Error connecting to the Janus WebSockets server... "+a),It.isArray(o)&&!c.reconnect)return++s===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(a=null,void setTimeout((function(){x(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){R[d]=function(e){if(It.debug(e),"success"!==e.janus)return It.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);i=setTimeout(P,v),S=!0,C=e.session_id?e.session_id:e.data.id,c.reconnect?It.log("Claimed session: "+C):It.log("Created session: "+C),It.sessions[C]=T,c.success()},r.send(JSON.stringify(u))},message:function(e){D(JSON.parse(e.data))},close:function(){a&&S&&(S=!1,e.error("Lost connection to the server (is it down?)"))}})r.addEventListener(p,n[p]);else It.httpAPICall(a,{verb:"POST",withCredentials:l,body:u,success:function(e){if(It.debug(e),"success"!==e.janus)return It.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);S=!0,C=e.session_id?e.session_id:e.data.id,c.reconnect?It.log("Claimed session: "+C):It.log("Created session: "+C),It.sessions[C]=T,E(),c.success()},error:function(e,t){if(It.error(e+":",t),It.isArray(o)&&!c.reconnect)return++s===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(a=null,void setTimeout((function(){x(c)}),200));""===t?c.error(e+": Is the server down?"):c.error(e+": "+t)}})}function A(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:It.noop,n.error="function"==typeof n.error?n.error:It.noop,!S)return It.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var i=w[e];if(!i||!i.webrtcStuff)return It.warn("Invalid handle"),void n.error("Invalid handle");var o=n.message,s=n.jsep,c=It.randomString(12),d={janus:"message",body:o,transaction:c};if(i.token&&(d.token=i.token),m&&(d.apisecret=m),s&&(d.jsep=s),It.debug("Sending message to plugin (handle="+e+"):"),It.debug(d),t)return d.session_id=C,d.handle_id=e,R[c]=function(e){if(It.debug("Message sent!"),It.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return It.warn("Request succeeded, but missing plugindata..."),void n.success();It.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return It.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(It.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(It.error("Unknown error"),n.error("Unknown error"))},void r.send(JSON.stringify(d));It.httpAPICall(a+"/"+C+"/"+e,{verb:"POST",withCredentials:l,body:d,success:function(e){if(It.debug("Message sent!"),It.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return It.warn("Request succeeded, but missing plugindata..."),void n.success();It.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return It.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(It.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(It.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){It.error(e+":",t),n.error(e+": "+t)}})}function _(e,n){if(S){var i=w[e];if(i&&i.webrtcStuff){var o={janus:"trickle",candidate:n,transaction:It.randomString(12)};if(i.token&&(o.token=i.token),m&&(o.apisecret=m),It.vdebug("Sending trickle candidate (handle="+e+"):"),It.vdebug(o),t)return o.session_id=C,o.handle_id=e,void r.send(JSON.stringify(o));It.httpAPICall(a+"/"+C+"/"+e,{verb:"POST",withCredentials:l,body:o,success:function(e){It.vdebug("Candidate sent!"),It.vdebug(e),"ack"===e.janus||It.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){It.error(e+":",t)}})}else It.warn("Invalid handle")}else It.warn("Is the server down? (connected=false)")}x(e),this.getServer=function(){return a},this.isConnected=function(){return S},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:It.noop,e.error="function"==typeof e.error?e.error:It.noop,e.reconnect=!0,x(e)},this.getSessionId=function(){return C},this.destroy=function(o){!function(o){clearTimeout(It.statCheckId),o=o||{},o.success="function"==typeof o.success?o.success:It.noop,o.error="function"==typeof o.error?o.error:It.noop;var s=!0===o.unload,c=!0;void 0!==o.notifyDestroyed&&null!==o.notifyDestroyed&&(c=!0===o.notifyDestroyed);var d=!0===o.cleanupHandles;if(It.log("Destroying session "+C+" (unload="+s+")"),!C)return It.warn("No session to destroy"),o.success(),void(c&&e.destroyed());if(d)for(var u in w)N(u,{noRequest:!0});if(!S)return It.warn("Is the server down? (connected=false)"),C=null,void o.success();var p={janus:"destroy",transaction:It.randomString(12)};f&&(p.token=f);m&&(p.apisecret=m);if(s)return t?(r.onclose=null,r.close(),r=null):navigator.sendBeacon(a+"/"+C,JSON.stringify(p)),It.log("Destroyed session:"),C=null,S=!1,o.success(),void(c&&e.destroyed());if(t){p.session_id=C;var h=function(){for(var e in n)r.removeEventListener(e,n[e]);r.removeEventListener("message",v),r.removeEventListener("error",g),i&&clearTimeout(i),r.close()},v=function(t){var r=JSON.parse(t.data);r.session_id==p.session_id&&r.transaction==p.transaction&&(h(),o.success(),c&&e.destroyed())},g=function(t){h(),o.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return r.addEventListener("message",v),r.addEventListener("error",g),void r.send(JSON.stringify(p))}It.httpAPICall(a+"/"+C,{verb:"POST",withCredentials:l,body:p,success:function(t){It.log("Destroyed session:"),It.debug(t),C=null,S=!1,"success"!==t.janus&&It.error("Ooops: "+t.error.code+" "+t.error.reason),o.success(),c&&e.destroyed()},error:function(t,r){It.error(t+":",r),C=null,S=!1,o.success(),c&&e.destroyed()}})}(o)},this.attach=function(e){!function(e){if(e=e||{},e.success="function"==typeof e.success?e.success:It.noop,e.error="function"==typeof e.error?e.error:It.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:It.noop,e.iceState="function"==typeof e.iceState?e.iceState:It.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:It.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:It.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:It.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:It.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:It.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:It.noop,e.ondata="function"==typeof e.ondata?e.ondata:It.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:It.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:It.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:It.noop,!S)return It.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return It.error("Invalid plugin"),void e.error("Invalid plugin");var i=e.opaqueId,o=e.token?e.token:f,s=It.randomString(12),c={janus:"attach",plugin:n,opaque_id:i,transaction:s};o&&(c.token=o);m&&(c.apisecret=m);if(t)return R[s]=function(t){if(It.debug(t),"success"!==t.janus)return It.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;It.log("Created handle: "+r);var i={session:T,plugin:n,id:r,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return U(r,!0)},getRemoteVolume:function(){return U(r,!0)},getLocalVolume:function(){return U(r,!1)},isAudioMuted:function(){return q(r,!1)},muteAudio:function(){return H(r,!1,!0)},unmuteAudio:function(){return H(r,!1,!1)},isVideoMuted:function(){return q(r,!0)},muteVideo:function(){return H(r,!0,!0)},unmuteVideo:function(){return H(r,!0,!1)},getBitrate:function(){return z(r)},send:function(e){A(r,e)},data:function(e){j(r,e)},dtmf:function(e){B(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){F(r,!0,e)},createAnswer:function(e){F(r,!1,e)},handleRemoteJsep:function(e){V(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){J(r,!0===e)},detach:function(e){N(r,e)}};w[r]=i,e.success(i)},c.session_id=C,void r.send(JSON.stringify(c));It.httpAPICall(a+"/"+C,{verb:"POST",withCredentials:l,body:c,success:function(t){if(It.debug(t),"success"!==t.janus)return It.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;It.log("Created handle: "+r);var i={session:T,plugin:n,id:r,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return U(r,!0)},getRemoteVolume:function(){return U(r,!0)},getLocalVolume:function(){return U(r,!1)},isAudioMuted:function(){return q(r,!1)},muteAudio:function(){return H(r,!1,!0)},unmuteAudio:function(){return H(r,!1,!1)},isVideoMuted:function(){return q(r,!0)},muteVideo:function(){return H(r,!0,!0)},unmuteVideo:function(){return H(r,!0,!1)},getBitrate:function(){return z(r)},send:function(e){A(r,e)},data:function(e){j(r,e)},dtmf:function(e){B(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){F(r,!0,e)},createAnswer:function(e){F(r,!1,e)},handleRemoteJsep:function(e){V(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){J(r,!0===e)},detach:function(e){N(r,e)}};w[r]=i,e.success(i)},error:function(t,r){It.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}(e)};var I=window.frameInterval||1500;function O(e){It.statCallback&&(It.statCheckId&&clearTimeout(It.statCheckId),It.statCheckId=setTimeout((function(){e.getStats().then((function(t){t.forEach((function(t){if(t&&"video"===t.kind&&"inbound-rtp"===t.type){if(console.log("lastPacketReceivedTimestamp:",t.lastPacketReceivedTimestamp),!b)return b=t.lastPacketReceivedTimestamp,void O(e);var r=t.lastPacketReceivedTimestamp-b<I;It.statCallback(r,t.lastPacketReceivedTimestamp),b=t.lastPacketReceivedTimestamp,O(e)}}))}))}),1e3))}function M(e,t,r,n){var i=w[e];if(i&&i.webrtcStuff){var o=i.webrtcStuff,s=function(e){It.log("Received state change on data channel:",e);var t=e.target.label,r=o.dataChannel[t]?o.dataChannel[t].readyState:"null";if(It.log("State change on <"+t+"> data channel: "+r),"open"===r){if(O(o.pc),o.dataChannel[t].pending&&o.dataChannel[t].pending.length>0){for(var n of(It.log("Sending pending messages on <"+t+">:",o.dataChannel[t].pending.length),o.dataChannel[t].pending))It.log("Sending data on data channel <"+t+">"),It.debug(n),o.dataChannel[t].send(n);o.dataChannel[t].pending=[]}i.ondataopen(t)}"closed"===r&&clearTimeout(It.statCheckId)};o.dataChannel[t]=r||o.pc.createDataChannel(t,{ordered:!0}),o.dataChannel[t].onmessage=function(e){It.log("Received message on data channel:",e);var t=e.target.label;i.ondata(e.data,t)},o.dataChannel[t].onopen=s,o.dataChannel[t].onclose=s,o.dataChannel[t].onerror=function(e){It.error("Got error on data channel:",e)},o.dataChannel[t].pending=[],n&&o.dataChannel[t].pending.push(n)}else It.warn("Invalid handle")}function j(e,t){(t=t||{}).success="function"==typeof t.success?t.success:It.noop,t.error="function"==typeof t.error?t.error:It.noop;var r=w[e];if(!r||!r.webrtcStuff)return It.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff,i=t.text||t.data;if(!i)return It.warn("Invalid data"),void t.error("Invalid data");var o=t.label?t.label:It.dataChanDefaultLabel;return n.dataChannel[o]?"open"!==n.dataChannel[o].readyState?(n.dataChannel[o].pending.push(i),void t.success()):(It.log("Sending data on data channel <"+o+">"),It.debug(i),n.dataChannel[o].send(i),void t.success()):(M(e,o,!1,i),void t.success())}function B(e,t){(t=t||{}).success="function"==typeof t.success?t.success:It.noop,t.error="function"==typeof t.error?t.error:It.noop;var r=w[e];if(!r||!r.webrtcStuff)return It.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff;if(!n.dtmfSender){if(n.pc){var i=n.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!i)return It.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=i.dtmf,n.dtmfSender&&(It.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){It.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return It.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(!o)return It.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var s=o.tones;if(!s)return It.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var a="number"==typeof o.duration?o.duration:500,c="number"==typeof o.gap?o.gap:50;It.debug("Sending DTMF string "+s+" (duration "+a+"ms, gap "+c+"ms)"),n.dtmfSender.insertDTMF(s,a,c),t.success()}function N(e,n){(n=n||{}).success="function"==typeof n.success?n.success:It.noop,n.error="function"==typeof n.error?n.error:It.noop;var i=!0===n.noRequest;It.log("Destroying handle "+e+" (only-locally="+i+")"),J(e);var o=w[e];if(!o||o.detached)return delete w[e],void n.success();if(i)return delete w[e],void n.success();if(!S)return It.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var s={janus:"detach",transaction:It.randomString(12)};if(o.token&&(s.token=o.token),m&&(s.apisecret=m),t)return s.session_id=C,s.handle_id=e,r.send(JSON.stringify(s)),delete w[e],void n.success();It.httpAPICall(a+"/"+C+"/"+e,{verb:"POST",withCredentials:l,body:s,success:function(t){It.log("Destroyed handle:"),It.debug(t),"success"!==t.janus&&It.error("Ooops: "+t.error.code+" "+t.error.reason),delete w[e],n.success()},error:function(t,r){It.error(t+":",r),delete w[e],n.success()}})}function L(e,t,r,n,i){var o=w[e];if(!o||!o.webrtcStuff)return It.warn("Invalid handle"),void n.error("Invalid handle");var s=o.webrtcStuff;It.debug("streamsDone:",i),i&&(It.debug("  -- Audio tracks:",i.getAudioTracks()),It.debug("  -- Video tracks:",i.getVideoTracks()));var a=!1;if(s.myStream&&r.update&&!s.streamExternal){if((!r.update&&W(r)||r.update&&(r.addAudio||r.replaceAudio))&&i.getAudioTracks()&&i.getAudioTracks().length)if(s.myStream.addTrack(i.getAudioTracks()[0]),It.unifiedPlan){It.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",i.getAudioTracks()[0]);var l=null;if((f=s.pc.getTransceivers())&&f.length>0)for(var h of f)if(h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind){l=h;break}l&&l.sender?l.sender.replaceTrack(i.getAudioTracks()[0]):s.pc.addTrack(i.getAudioTracks()[0],i)}else It.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",i.getAudioTracks()[0]),s.pc.addTrack(i.getAudioTracks()[0],i);if((!r.update&&X(r)||r.update&&(r.addVideo||r.replaceVideo))&&i.getVideoTracks()&&i.getVideoTracks().length)if(s.myStream.addTrack(i.getVideoTracks()[0]),It.unifiedPlan){It.log((r.replaceVideo?"Replacing":"Adding")+" video track:",i.getVideoTracks()[0]);var f,m=null;if((f=s.pc.getTransceivers())&&f.length>0)for(var h of f)if(h.sender&&h.sender.track&&"video"===h.sender.track.kind||h.receiver&&h.receiver.track&&"video"===h.receiver.track.kind){m=h;break}m&&m.sender?m.sender.replaceTrack(i.getVideoTracks()[0]):s.pc.addTrack(i.getVideoTracks()[0],i)}else It.log((r.replaceVideo?"Replacing":"Adding")+" video track:",i.getVideoTracks()[0]),s.pc.addTrack(i.getVideoTracks()[0],i)}else s.myStream=i,a=!0;if(!s.pc){var v={iceServers:c,iceTransportPolicy:d,bundlePolicy:u};"chrome"===It.webRTCAdapter.browserDetails.browser&&(v.sdpSemantics=It.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var g={optional:[{DtlsSrtpKeyAgreement:!0}]};if(p&&g.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"==typeof n.rtcConstraints)for(var b in It.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)g.optional.push(n.rtcConstraints[b]);"edge"===It.webRTCAdapter.browserDetails.browser&&(v.bundlePolicy="max-bundle"),It.log("Creating PeerConnection"),It.debug(g),s.pc=new RTCPeerConnection(v,g),It.debug(s.pc),s.pc.getStats&&(s.volume={},s.bitrate.value="0 kbits/sec"),It.log("Preparing local SDP and gathering candidates (trickle="+s.trickle+")"),s.pc.oniceconnectionstatechange=function(e){s.pc&&o.iceState(s.pc.iceConnectionState)},s.pc.onicecandidate=function(t){if(!t.candidate||"edge"===It.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)It.log("End of candidates."),s.iceDone=!0,!0===s.trickle?_(e,{completed:!0}):function(e,t){t=t||{},t.success="function"==typeof t.success?t.success:It.noop,t.error="function"==typeof t.error?t.error:It.noop;var r=w[e];if(!r||!r.webrtcStuff)return void It.warn("Invalid handle, not sending anything");var n=r.webrtcStuff;if(It.log("Sending offer/answer SDP..."),!n.mySdp)return void It.warn("Local SDP instance is invalid, not sending anything...");n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1);It.debug(t),n.sdpSent=!0,t.success(n.mySdp)}(e,n);else{var r={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===s.trickle&&_(e,r)}},s.pc.ontrack=function(e){It.log("Handling Remote Track"),It.debug(e),e.streams&&(s.remoteStream=e.streams[0],o.onremotestream(s.remoteStream),e.track.onended||It.log("Adding onended callback to track:",e.track))}}if(a&&i){It.log("Adding local stream");var S=!0===n.simulcast2;i.getTracks().forEach((function(e){if(It.log("Adding local track:",e),S)if("audio"===e.kind)s.pc.addTrack(e,i);else{It.log("Enabling rid-based simulcasting:",e);var t=y(n.simulcastMaxBitrates);s.pc.addTransceiver(e,{direction:"sendrecv",streams:[i],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else s.pc.addTrack(e,i)}))}(function(e){if(It.debug("isDataEnabled:",e),"edge"===It.webRTCAdapter.browserDetails.browser)return It.warn("Edge doesn't support data channels yet"),!1;return null!=e&&!0===e.data})(r)&&!s.dataChannel[It.dataChanDefaultLabel]&&(It.log("Creating data channel"),M(e,It.dataChanDefaultLabel,!1),s.pc.ondatachannel=function(t){It.log("Data channel created by Janus:",t),M(e,t.channel.label,t.channel)}),s.myStream&&o.onlocalstream(s.myStream),t?s.pc.setRemoteDescription(t).then((function(){if(It.log("Remote description accepted!"),s.remoteSdp=t.sdp,s.candidates&&s.candidates.length>0){for(var i=0;i<s.candidates.length;i++){var o=s.candidates[i];It.debug("Adding remote candidate:",o),o&&!0!==o.completed?s.pc.addIceCandidate(o):s.pc.addIceCandidate(It.endOfCandidates)}s.candidates=[]}!function(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:It.noop,r.error="function"==typeof r.error?r.error:It.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:It.noop;var n=w[e];if(!n||!n.webrtcStuff)return It.warn("Invalid handle"),void r.error("Invalid handle");var i=n.webrtcStuff,o=!0===r.simulcast;o?It.log("Creating answer (iceDone="+i.iceDone+", simulcast="+o+")"):It.log("Creating answer (iceDone="+i.iceDone+")");var s=null;if(It.unifiedPlan){s={};var a=null,c=null,d=i.pc.getTransceivers();if(d&&d.length>0)for(var u of d)u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?a||(a=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(c||(c=u));var p=W(t),l=K(t);if(p||l){if(p&&l){if(a)try{a.setDirection?a.setDirection("sendrecv"):a.direction="sendrecv",It.log("Setting audio transceiver to sendrecv:",a)}catch(e){It.error(e)}}else if(p&&!l)try{a&&(a.setDirection?a.setDirection("sendonly"):a.direction="sendonly",It.log("Setting audio transceiver to sendonly:",a))}catch(e){It.error(e)}else if(!p&&l)if(a)try{a.setDirection?a.setDirection("recvonly"):a.direction="recvonly",It.log("Setting audio transceiver to recvonly:",a)}catch(e){It.error(e)}else a=i.pc.addTransceiver("audio",{direction:"recvonly"}),It.log("Adding recvonly audio transceiver:",a)}else if(t.removeAudio&&a)try{a.setDirection?a.setDirection("inactive"):a.direction="inactive",It.log("Setting audio transceiver to inactive:",a)}catch(e){It.error(e)}var h=X(t),f=Y(t);if(h||f){if(h&&f){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",It.log("Setting video transceiver to sendrecv:",c)}catch(e){It.error(e)}}else if(h&&!f){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",It.log("Setting video transceiver to sendonly:",c)}catch(e){It.error(e)}}else if(!h&&f)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",It.log("Setting video transceiver to recvonly:",c)}catch(e){It.error(e)}else c=i.pc.addTransceiver("video",{direction:"recvonly"}),It.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",It.log("Setting video transceiver to inactive:",c)}catch(e){It.error(e)}}else s="firefox"===It.webRTCAdapter.browserDetails.browser||"edge"===It.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:K(t),offerToReceiveVideo:Y(t)}:{mandatory:{OfferToReceiveAudio:K(t),OfferToReceiveVideo:Y(t)}};It.debug(s);var m=X(t);if(m&&o&&"firefox"===It.webRTCAdapter.browserDetails.browser){It.log("Enabling Simulcasting for Firefox (RID)");var v=i.pc.getSenders()[1];It.log(v);var g=v.getParameters();It.log(g);var b=y(r.simulcastMaxBitrates);v.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:b.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:b.medium},{rid:"low",active:!0,priority:"low",maxBitrate:b.low}]})}i.pc.createAnswer(s).then((function(e){It.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,It.log("Setting local description"),m&&o&&("chrome"===It.webRTCAdapter.browserDetails.browser?It.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==It.webRTCAdapter.browserDetails.browser&&It.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=e.sdp,i.pc.setLocalDescription(e).catch(r.error),i.mediaConstraints=s,i.iceDone||i.trickle?r.success(e):It.log("Waiting for all candidates...")}),r.error)}(e,r,n)}),n.error):function(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:It.noop,r.error="function"==typeof r.error?r.error:It.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:It.noop;var n=w[e];if(!n||!n.webrtcStuff)return It.warn("Invalid handle"),void r.error("Invalid handle");var i=n.webrtcStuff,o=!0===r.simulcast;o?It.log("Creating offer (iceDone="+i.iceDone+", simulcast="+o+")"):It.log("Creating offer (iceDone="+i.iceDone+")");var s={};if(It.unifiedPlan){var a=null,c=null,d=i.pc.getTransceivers();if(d&&d.length>0)for(var u of d)u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?a||(a=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(c||(c=u));var p=W(t),l=K(t);p||l?p&&l?a&&(a.setDirection?a.setDirection("sendrecv"):a.direction="sendrecv",It.log("Setting audio transceiver to sendrecv:",a)):p&&!l?a&&(a.setDirection?a.setDirection("sendonly"):a.direction="sendonly",It.log("Setting audio transceiver to sendonly:",a)):!p&&l&&(a?(a.setDirection?a.setDirection("recvonly"):a.direction="recvonly",It.log("Setting audio transceiver to recvonly:",a)):(a=i.pc.addTransceiver("audio",{direction:"recvonly"}),It.log("Adding recvonly audio transceiver:",a))):t.removeAudio&&a&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive",It.log("Setting audio transceiver to inactive:",a));var h=X(t),f=Y(t);h||f?h&&f?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",It.log("Setting video transceiver to sendrecv:",c)):h&&!f?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",It.log("Setting video transceiver to sendonly:",c)):!h&&f&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",It.log("Setting video transceiver to recvonly:",c)):(c=i.pc.addTransceiver("video",{direction:"recvonly"}),It.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",It.log("Setting video transceiver to inactive:",c))}else s.offerToReceiveAudio=K(t),s.offerToReceiveVideo=Y(t);var m=!0===r.iceRestart;m&&(s.iceRestart=!0);It.debug(s);var v=X(t);if(v&&o&&"firefox"===It.webRTCAdapter.browserDetails.browser){It.log("Enabling Simulcasting for Firefox (RID)");var g=i.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(g){var b=g.getParameters();b||(b={});var S=y(r.simulcastMaxBitrates);b.encodings=[{rid:"h",active:!0,maxBitrate:S.high},{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:S.low,scaleResolutionDownBy:4}],g.setParameters(b)}}i.pc.createOffer(s).then((function(e){It.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,It.log("Setting local description"),v&&o&&("chrome"===It.webRTCAdapter.browserDetails.browser||"safari"===It.webRTCAdapter.browserDetails.browser?(It.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),r=!1,n=[-1],i=[-1],o=null,s=null,a=null,c=null,d=-1,u=0;u<t.length;u++){if(l=t[u].match(/m=(\w+) */)){if("video"===l[1]){if(!(n[0]<0)){d=u;break}r=!0}else if(n[0]>-1){d=u;break}}else if(r){var p=t[u].match(/a=ssrc-group:FID (\d+) (\d+)/);if(p)n[0]=p[1],i[0]=p[2],t.splice(u,1),u--;else{if(n[0]){if((f=t[u].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(o=f[1]),(f=t[u].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(s=f[1]),(f=t[u].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(a=f[1]),(f=t[u].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=f[1]),0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+n[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}}if(n[0]<0){d=-1,r=!1;for(u=0;u<t.length;u++){var l;if(l=t[u].match(/m=(\w+) */)){if("video"===l[1]){if(!(n[0]<0)){d=u;break}r=!0}else if(n[0]>-1){d=u;break}}else if(r){if(n[0]<0){var h=t[u].match(/a=ssrc:(\d+)/);if(h){n[0]=h[1],t.splice(u,1),u--;continue}}else{var f;if((f=t[u].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(o=f[1]),(f=t[u].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(s=f[1]),(f=t[u].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(a=f[1]),(f=t[u].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=f[1]),0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+n[0])){t.splice(u,1),u--;continue}}0!==t[u].length||(t.splice(u,1),u--)}}}if(n[0]<0)return It.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=t.length);n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),i[1]=Math.floor(4294967295*Math.random()),i[2]=Math.floor(4294967295*Math.random());for(u=0;u<n.length;u++)o&&(t.splice(d,0,"a=ssrc:"+n[u]+" cname:"+o),d++),s&&(t.splice(d,0,"a=ssrc:"+n[u]+" msid:"+s),d++),a&&(t.splice(d,0,"a=ssrc:"+n[u]+" mslabel:"+a),d++),c&&(t.splice(d,0,"a=ssrc:"+n[u]+" label:"+c),d++),o&&(t.splice(d,0,"a=ssrc:"+i[u]+" cname:"+o),d++),s&&(t.splice(d,0,"a=ssrc:"+i[u]+" msid:"+s),d++),a&&(t.splice(d,0,"a=ssrc:"+i[u]+" mslabel:"+a),d++),c&&(t.splice(d,0,"a=ssrc:"+i[u]+" label:"+c),d++);t.splice(d,0,"a=ssrc-group:FID "+n[2]+" "+i[2]),t.splice(d,0,"a=ssrc-group:FID "+n[1]+" "+i[1]),t.splice(d,0,"a=ssrc-group:FID "+n[0]+" "+i[0]),t.splice(d,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==It.webRTCAdapter.browserDetails.browser&&It.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=e.sdp,i.pc.setLocalDescription(e).catch(r.error),i.mediaConstraints=s,i.iceDone||i.trickle?(It.log("Offer ready"),It.debug(r),r.success(e)):It.log("Waiting for all candidates...")}),r.error)}(e,r,n)}function F(e,t,r){(r=r||{}).success="function"==typeof r.success?r.success:It.noop,r.error="function"==typeof r.error?r.error:G;var n=r.jsep;if(t&&n)return It.error("Provided a JSEP to a createOffer"),void r.error("Provided a JSEP to a createOffer");if(!(t||n&&n.type&&n.sdp))return It.error("A valid JSEP is required for createAnswer"),void r.error("A valid JSEP is required for createAnswer");r.media="object"==typeof r.media&&r.media?r.media:{audio:!0,video:!0};var i=r.media,o=w[e];if(!o||!o.webrtcStuff)return It.warn("Invalid handle"),void r.error("Invalid handle");var s,a=o.webrtcStuff;if(a.trickle=(s=r.trickle,It.debug("isTrickleEnabled:",s),!!s),a.pc){if(It.log("Updating existing media session"),i.update=!0,r.stream)r.stream!==a.myStream&&It.log("Renegotiation involves a new external stream");else{if(i.addAudio){if(i.keepAudio=!1,i.replaceAudio=!1,i.removeAudio=!1,i.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return It.error("Can't add audio stream, there already is one"),void r.error("Can't add audio stream, there already is one")}else i.removeAudio?(i.keepAudio=!1,i.replaceAudio=!1,i.addAudio=!1,i.audioSend=!1):i.replaceAudio&&(i.keepAudio=!1,i.addAudio=!1,i.removeAudio=!1,i.audioSend=!0);if(a.myStream&&a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!W(i)||i.removeAudio||i.replaceAudio||(i.keepAudio=!0):(i.replaceAudio&&(i.keepAudio=!1,i.replaceAudio=!1,i.addAudio=!0,i.audioSend=!0),W(i)&&(i.keepAudio=!1,i.addAudio=!0)),i.addVideo){if(i.keepVideo=!1,i.replaceVideo=!1,i.removeVideo=!1,i.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return It.error("Can't add video stream, there already is one"),void r.error("Can't add video stream, there already is one")}else i.removeVideo?(i.keepVideo=!1,i.replaceVideo=!1,i.addVideo=!1,i.videoSend=!1):i.replaceVideo&&(i.keepVideo=!1,i.addVideo=!1,i.removeVideo=!1,i.videoSend=!0);a.myStream&&a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!X(i)||i.removeVideo||i.replaceVideo||(i.keepVideo=!0):(i.replaceVideo&&(i.keepVideo=!1,i.replaceVideo=!1,i.addVideo=!0,i.videoSend=!0),X(i)&&(i.keepVideo=!1,i.addVideo=!0)),i.addData&&(i.data=!0)}if(W(i)&&i.keepAudio&&X(i)&&i.keepVideo)return o.consentDialog(!1),void L(e,n,i,r,a.myStream)}else i.update=!1,i.keepAudio=!1,i.keepVideo=!1;if(i.update&&!a.streamExternal){if(i.removeAudio||i.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var c=a.myStream.getAudioTracks()[0];It.log("Removing audio track:",c),a.myStream.removeTrack(c);try{c.stop()}catch(P){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var d=!0;if(i.replaceAudio&&It.unifiedPlan&&(d=!1),d)for(var u of a.pc.getSenders())u&&u.track&&"audio"===u.track.kind&&(It.log("Removing audio sender:",u),a.pc.removeTrack(u))}}if(i.removeVideo||i.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){var p=a.myStream.getVideoTracks()[0];It.log("Removing video track:",p),a.myStream.removeTrack(p);try{p.stop()}catch(x){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var l=!0;if(i.replaceVideo&&It.unifiedPlan&&(l=!1),l)for(var h of a.pc.getSenders())h&&h.track&&"video"===h.track.kind&&(It.log("Removing video sender:",h),a.pc.removeTrack(h))}}}if(r.stream){var f=r.stream;if(It.log("MediaStream provided by the application"),It.debug(f),i.update&&a.myStream&&a.myStream!==r.stream&&!a.streamExternal){try{var m=a.myStream.getTracks();for(var v of m)It.log(v),v&&v.stop()}catch(A){}a.myStream=null}return a.streamExternal=!0,o.consentDialog(!1),void L(e,n,i,r,f)}if(W(i)||X(i)){if(!It.isGetUserMediaAvailable())return void r.error("getUserMedia not available");var g={mandatory:{},optional:[]};o.consentDialog(!0);var y=W(i);y&&i&&"object"==typeof i.audio&&(y=i.audio);var b=X(i);if(b&&i){var S=!0===r.simulcast,C=!0===r.simulcast2;if(!S&&!C||n||i.video||(i.video="hires"),i.video&&"screen"!=i.video&&"window"!=i.video)if("object"==typeof i.video)b=i.video;else{var T=0,k=0;"lowres"===i.video?(k=240,T=320):"lowres-16:9"===i.video?(k=180,T=320):"hires"===i.video||"hires-16:9"===i.video||"hdres"===i.video?(k=720,T=1280):"fhdres"===i.video?(k=1080,T=1920):"4kres"===i.video?(k=2160,T=3840):"stdres"===i.video?(k=480,T=640):"stdres-16:9"===i.video?(k=360,T=640):(It.log("Default video setting is stdres 4:3"),k=480,T=640),It.log("Adding media constraint:",i.video),b={height:{ideal:k},width:{ideal:T}},It.log("Adding video constraint:",b)}else if("screen"===i.video||"window"===i.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return g.video={},i.screenshareFrameRate&&(g.video.frameRate=i.screenshareFrameRate),i.screenshareHeight&&(g.video.height=i.screenshareHeight),i.screenshareWidth&&(g.video.width=i.screenshareWidth),g.audio=i.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(g).then((function(t){o.consentDialog(!1),W(i)&&!i.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(o){t.addTrack(o.getAudioTracks()[0]),L(e,n,i,r,t)})):L(e,n,i,r,t)}),(function(e){o.consentDialog(!1),r.error(e)}));function _(t,s){o.consentDialog(!1),t?r.error(t):L(e,n,i,r,s)}function I(e,t,r){It.log("Adding media constraint (screen capture)"),It.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){r?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(r){e.addTrack(r.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){o.consentDialog(!1),t(e)}))}if("chrome"===It.webRTCAdapter.browserDetails.browser){var R=It.webRTCAdapter.browserDetails.version,E=33;window.navigator.userAgent.match("Linux")&&(E=35),R>=26&&R<=E?I(g={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate,chromeMediaSource:"screen"}},audio:W(i)&&!i.keepAudio},_):It.extension.getScreen((function(e,t){if(e)return o.consentDialog(!1),r.error(e);(g={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,I(g,_,W(i)&&!i.keepAudio)}))}else if("firefox"===It.webRTCAdapter.browserDetails.browser){if(!(It.webRTCAdapter.browserDetails.version>=33)){var D=new Error("NavigatorUserMediaError");return D.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void r.error(D)}I(g={video:{mozMediaSource:i.video,mediaSource:i.video},audio:W(i)&&!i.keepAudio},(function(e,t){if(_(e,t),!e)var r=t.currentTime,n=window.setInterval((function(){t||window.clearInterval(n),t.currentTime==r&&(window.clearInterval(n),t.onended&&t.onended()),r=t.currentTime}),500)}))}return}}i&&"screen"===i.video||navigator.mediaDevices.enumerateDevices().then((function(t){var s=t.some((function(e){return"audioinput"===e.kind})),a=function(e){if(It.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!=typeof e.video||"object"!=typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(i)||t.some((function(e){return"videoinput"===e.kind})),c=W(i),d=X(i),u=function(e){return It.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(i),p=function(e){return It.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(i);if(c||d||u||p){var l=!!c&&s,h=!!d&&a;if(!l&&!h)return o.consentDialog(!1),r.error("No capture device found"),!1;if(!l&&u)return o.consentDialog(!1),r.error("Audio capture is required, but no capture device found"),!1;if(!h&&p)return o.consentDialog(!1),r.error("Video capture is required, but no capture device found"),!1}var m={audio:!(!s||i.keepAudio)&&y,video:!(!a||i.keepVideo)&&b};It.debug("getUserMedia constraints",m),m.audio||m.video?navigator.mediaDevices.getUserMedia(m).then((function(t){o.consentDialog(!1),L(e,n,i,r,t)})).catch((function(e){o.consentDialog(!1),r.error({code:e.code,name:e.name,message:e.message})})):(o.consentDialog(!1),L(e,n,i,r,f))})).catch((function(e){o.consentDialog(!1),r.error("enumerateDevices error",e)}))}else L(e,n,i,r)}function V(e,t){(t=t||{}).success="function"==typeof t.success?t.success:It.noop,t.error="function"==typeof t.error?t.error:G;var r=t.jsep,n=w[e];if(!n||!n.webrtcStuff)return It.warn("Invalid handle"),void t.error("Invalid handle");var i=n.webrtcStuff;if(r){if(!i.pc)return It.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");i.pc.setRemoteDescription(r).then((function(){if(It.log("Remote description accepted!"),i.remoteSdp=r.sdp,i.candidates&&i.candidates.length>0){for(var e=0;e<i.candidates.length;e++){var n=i.candidates[e];It.debug("Adding remote candidate:",n),n&&!0!==n.completed?i.pc.addIceCandidate(n):i.pc.addIceCandidate(It.endOfCandidates)}i.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function U(e,t){var r=w[e];if(!r||!r.webrtcStuff)return It.warn("Invalid handle"),0;var n=t?"remote":"local",i=r.webrtcStuff;return i.volume[n]||(i.volume[n]={value:0}),!i.pc.getStats||"chrome"!==It.webRTCAdapter.browserDetails.browser&&"safari"!==It.webRTCAdapter.browserDetails.browser?(It.warn("Getting the "+n+" volume unsupported by browser"),0):t&&!i.remoteStream?(It.warn("Remote stream unavailable"),0):t||i.myStream?i.volume[n].timer?i.volume[n].value:(It.log("Starting "+n+" volume monitor"),i.volume[n].timer=setInterval((function(){i.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(i.volume[n].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(It.warn("Local stream unavailable"),0)}function q(e,t){var r=w[e];if(!r||!r.webrtcStuff)return It.warn("Invalid handle"),!0;var n=r.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(It.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(It.warn("No audio track"),!0):(It.warn("Invalid local MediaStream"),!0):(It.warn("Invalid PeerConnection"),!0)}function H(e,t,r){var n=w[e];if(!n||!n.webrtcStuff)return It.warn("Invalid handle"),!1;var i=n.webrtcStuff;return i.pc?i.myStream?t?i.myStream.getVideoTracks()&&0!==i.myStream.getVideoTracks().length?(i.myStream.getVideoTracks()[0].enabled=!r,!0):(It.warn("No video track"),!1):i.myStream.getAudioTracks()&&0!==i.myStream.getAudioTracks().length?(i.myStream.getAudioTracks()[0].enabled=!r,!0):(It.warn("No audio track"),!1):(It.warn("Invalid local MediaStream"),!1):(It.warn("Invalid PeerConnection"),!1)}function z(e){var t=w[e];if(!t||!t.webrtcStuff)return It.warn("Invalid handle"),"Invalid handle";var r=t.webrtcStuff;return r.pc?r.pc.getStats?r.bitrate.timer?r.bitrate.value:(It.log("Starting bitrate timer (via getStats)"),r.bitrate.timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(r.bitrate.bsnow=e.bytesReceived,r.bitrate.tsnow=e.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var n=r.bitrate.tsnow-r.bitrate.tsbefore;"safari"===It.webRTCAdapter.browserDetails.browser&&(n/=1e3);var i=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/n);"safari"===It.webRTCAdapter.browserDetails.browser&&(i=parseInt(i/1e3)),r.bitrate.value=i+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(It.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function G(e){It.error("WebRTC error:",e)}function J(e,n){It.log("Cleaning WebRTC stuff");var i=w[e];if(i){var o=i.webrtcStuff;if(o){if(!0===n){var s={janus:"hangup",transaction:It.randomString(12)};i.token&&(s.token=i.token),m&&(s.apisecret=m),It.debug("Sending hangup request (handle="+e+"):"),It.debug(s),t?(s.session_id=C,s.handle_id=e,r.send(JSON.stringify(s))):It.httpAPICall(a+"/"+C+"/"+e,{verb:"POST",withCredentials:l,body:s})}o.remoteStream=null,o.volume&&(o.volume.local&&o.volume.local.timer&&clearInterval(o.volume.local.timer),o.volume.remote&&o.volume.remote.timer&&clearInterval(o.volume.remote.timer)),o.volume={},o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null;try{if(!o.streamExternal&&o.myStream){It.log("Stopping local stream tracks");var c=o.myStream.getTracks();for(var d of c)It.log(d),d&&d.stop()}}catch(e){}o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(e){}o.pc=null,o.candidates=null,o.mySdp=null,o.remoteSdp=null,o.iceDone=!1,o.dataChannel={},o.dtmfSender=null}i.oncleanup()}}function W(e){return It.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function K(e){return It.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function X(e){return It.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function Y(e){return It.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}}It.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||_t,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,n){var i={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(i.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(i.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(i.body=JSON.stringify(n.body));var o=t(e,i).catch((function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var s=new r((function(e,t){var r=setTimeout((function(){return clearTimeout(r),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));o=r.race([o,s])}return o.then((function(e){return e.ok?typeof n.success==typeof It.noop?e.json().then((function(e){n.success(e)})).catch((function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:r.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error==typeof It.noop&&n.error(e.message||"<< internal error >>",e)})),o}}},It.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||_t,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,r){var n=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},i=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return t.ajax(t.extend(n,i,{url:e,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(e){typeof r.success==typeof It.noop&&r.success(e)},error:function(e,t,n){typeof r.error==typeof It.noop&&r.error(t,n)}}))}}},It.noop=function(){},It.dataChanDefaultLabel="JanusDataChannel",It.endOfCandidates=null,It.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:It.noop,It.statCallback=e.statCallback,It.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),It.trace=It.noop,It.debug=It.noop,It.vdebug=It.noop,It.log=It.noop,It.warn=It.noop,It.error=It.noop,!0===e.debug||"all"===e.debug)It.trace=console.trace.bind(console),It.debug=console.debug.bind(console),It.vdebug=console.debug.bind(console),It.log=console.log.bind(console),It.warn=console.warn.bind(console),It.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t of e.debug)switch(t){case"trace":It.trace=console.trace.bind(console);break;case"debug":It.debug=console.debug.bind(console);break;case"vdebug":It.vdebug=console.debug.bind(console);break;case"log":It.log=console.log.bind(console);break;case"warn":It.warn=console.warn.bind(console);break;case"error":It.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}It.log("Initializing library");var r=e.dependencies||It.useDefaultDependencies();It.isArray=r.isArray,It.webRTCAdapter=r.webRTCAdapter,It.httpAPICall=r.httpAPICall,It.newWebSocket=r.newWebSocket,It.extension=r.extension,It.extension.init(),It.listDevices=function(e,t){e="function"==typeof e?e:It.noop,null==t&&(t={audio:!0,video:!0}),It.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(r){It.debug(r),e(r);try{var n=t.getTracks();for(var i of n)i&&i.stop()}catch(e){}}))})).catch((function(t){It.error(t),e([])})):(It.warn("navigator.mediaDevices unavailable"),e([]))},It.attachMediaStream=function(e,t){try{e.srcObject=t}catch(r){try{e.src=URL.createObjectURL(t)}catch(e){It.error("Error attaching stream to element")}}},It.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(r){try{e.src=t.src}catch(e){It.error("Error reattaching stream to element")}}};var n=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",i=window["on"+n];if(window.addEventListener(n,(function(e){for(var t in It.log("Closing window"),It.sessions)It.sessions[t]&&It.sessions[t].destroyOnUnload&&(It.log("Destroying session "+t),It.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));i&&"function"==typeof i&&i()})),It.safariVp8=!1,"safari"===It.webRTCAdapter.browserDetails.browser&&It.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var o of RTCRtpSender.getCapabilities("video").codecs)if(o&&o.mimeType&&"video/vp8"===o.mimeType.toLowerCase()){It.safariVp8=!0;break}It.safariVp8?It.log("This version of Safari supports VP8"):It.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var s=new RTCPeerConnection({});s.createOffer({offerToReceiveVideo:!0}).then((function(e){It.safariVp8=-1!==e.sdp.indexOf("VP8"),It.safariVp8?It.log("This version of Safari supports VP8"):It.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),s.close(),s=null}))}if(It.unifiedPlan=!1,"firefox"===It.webRTCAdapter.browserDetails.browser&&It.webRTCAdapter.browserDetails.version>=59)It.unifiedPlan=!0;else if("chrome"===It.webRTCAdapter.browserDetails.browser&&It.webRTCAdapter.browserDetails.version<72)It.unifiedPlan=!1;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var a=new RTCPeerConnection;try{a.addTransceiver("audio"),It.unifiedPlan=!0}catch(e){}a.close()}else It.unifiedPlan=!1;It.initDone=!0,e.callback()}},It.isWebrtcSupported=function(){return!!window.RTCPeerConnection},It.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},It.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",n=0;n<e;n++){var i=Math.floor(62*Math.random());r+=t.substring(i,i+1)}return r};var Ot,Mt=It,jt=Object.freeze({fps:24,framesDroppedTolerants:[5,55],sampleLength:8,sampleDensity:1e3}),Bt=function(){function e(e,t){var r,n;this.fps=jt.fps,this.statReportLasted={},this.sampleStats=[],this.aggregateStatsTimerId=null,this.statistician={timestamp:0,sampleCount:0,sampleDensity:0,sampleLength:0,packetsReceived:0,packetsLost:0,packetsLostCount:0,framesReceived:0,framesDropped:0,framesDroppedCount:0},this.remoteFeed=e,this.options=t,this.fps=~~((null===(n=null===(r=this.options)||void 0===r?void 0:r.config)||void 0===n?void 0:n.fps)||0)||this.fps;var i=t.rtcAggReportConfig||{},o=i.sampleLength,s=void 0===o?0:o,a=i.sampleDensity,c=void 0===a?0:a;this.statistician.sampleLength=s>>>0||jt.sampleLength,this.statistician.sampleDensity=c>>>0||jt.sampleDensity}return e.prototype.checkFramesLost=function(e){var t,r=this.fps;if(null==e?void 0:e.framerate){var n=(r-e.framerate)/r,i=jt.framesDroppedTolerants,o=i[0],s=i[1];if(n>Math.min(Math.max((null===(t=this.options.rtcAggReportConfig)||void 0===t?void 0:t.framesDroppedTolerant)||o,o),s)/100)return n}return 0},e.prototype.keepAccounts=function(e,t){var r,n,i,o,s,a,c=this.fps;this.statistician.timestamp=Date.now(),this.statistician.sampleCount++,this.statistician.framesReceived=e.framesReceived,this.statistician.packetsReceived=e.packetsReceived,this.statReportLasted=e;var d=this.statistician.sampleLength;if(this.sampleStats.unshift(e),this.sampleStats.length>=d){this.sampleStats.length=d;for(var u={packetsLostCount:0,packetsLost:0,framesDroppedCount:0,framesDropped:0,packetsReceived:0,framesReceived:0},p=d-1;p>=0;p--){var l=this.sampleStats[p];p===d-1?(u.packetsReceived=l.packetsReceived,u.framesReceived=l.framesReceived):0===p&&(u.packetsReceived=l.packetsReceived-u.packetsReceived,u.framesReceived=l.framesReceived-u.framesReceived),(null==l?void 0:l.packetsLostImmediate)&&(u.packetsLostCount++,u.packetsLost+=l.packetsLostImmediate);var h=this.checkFramesLost(l);h&&(u.framesDroppedCount++,u.framesDropped+=h)}if(u.packetsLost){var f=u.packetsLost/u.packetsReceived*100;null===(n=null===(r=this.options)||void 0===r?void 0:r.packetsLostRateCallback)||void 0===n||n.call(r,f,{stats:t,periodicStats:u,sampleStats:this.sampleStats})}if(u.framesDropped){var m=u.framesDropped/(d*c)*100;null===(o=null===(i=this.options)||void 0===i?void 0:i.framesDroppedRateCallback)||void 0===o||o.call(i,m,{stats:t,periodicStats:u,sampleStats:this.sampleStats})}this.sampleStats.length=0}e.packetsLostImmediate&&(this.statistician.packetsLostCount++,this.statistician.packetsLost+=e.packetsLostImmediate);var v=this.checkFramesLost(e);v&&(this.statistician.framesDroppedCount++,this.statistician.framesDropped+=v),null===(a=null===(s=this.options)||void 0===s?void 0:s.aggregatedStatsCallback)||void 0===a||a.call(s,e,t,this.statistician)},e.prototype.onAggregatedStats=function(e){var t=this,r={},n=this.statReportLasted||{};e.forEach((function(e){if("inbound-rtp"===e.type&&!e.isRemote&&("video"===e.mediaType||e.id.toLowerCase().includes("video"))&&(r.timestamp=e.timestamp,r.bytesReceived=e.bytesReceived,r.framesDecoded=e.framesDecoded,r.packetsLost=e.packetsLost,r.packetsReceived=e.packetsReceived,r.packetsLostImmediate=e.packetsLost-~~n.packetsLost||0,r.bytesReceivedStart=n.bytesReceivedStart||e.bytesReceived,r.framesDecodedStart=n.framesDecodedStart||e.framesDecoded,r.timestampStart=n.timestampStart||e.timestamp,r.framesDropped=e.framesDropped,r.framesDroppedImmediate=e.framesDropped-~~n.framesDropped||0,r.framesReceived=e.framesReceived,r.framesDroppedRate=e.framesDropped/e.framesReceived*100,r.frameHeight=e.frameHeight,r.frameWidth=e.frameWidth,r.frameHeightStart=n.frameHeightStart||e.frameHeight,r.frameWidthStart=n.frameWidthStart||e.frameWidth,n.timestamp)){var i=r.timestamp-n.timestamp;n.bytesReceived&&(r.bitrate=+(8*(r.bytesReceived-n.bytesReceived)/i).toFixed(2),r.lowBitrate=Math.min(n.lowBitrate||0,r.bitrate||0),r.highBitrate=Math.max(n.highBitrate||0,r.bitrate||0)),n.bytesReceivedStart&&(r.avgBitrate=+(8*(r.bytesReceived-n.bytesReceivedStart)/i).toFixed(2)),n.framesDecoded&&(r.framerate=+((r.framesDecoded-n.framesDecoded)/(i/1e3)).toFixed(2),r.lowFramerate=Math.min(n.lowFramerate||0,r.framerate||0),r.highFramerate=Math.max(n.highFramerate||0,r.framerate||0)),t.statReportLasted.framesDecodedStart&&(r.avgframerate=+((r.framesDecoded-n.framesDecodedStart)/(i/1e3)).toFixed(2))}"candidate-pair"===e.type&&e.hasOwnProperty("currentRoundTripTime")&&(r.currentRoundTripTime=e.currentRoundTripTime)})),this.keepAccounts(r,e)},e.prototype.launch=function(){var e=this,t=this.statistician.sampleDensity;this.aggregateStatsTimerId=window.setTimeout((function(){var t,r,n,i,o,s;e.aggregateStatsTimerId&&(clearTimeout(e.aggregateStatsTimerId),e.aggregateStatsTimerId=null),null===(s=null===(o=null===(i=null===(n=null===(r=null===(t=e.remoteFeed)||void 0===t?void 0:t.webrtcStuff)||void 0===r?void 0:r.pc)||void 0===n?void 0:n.getStats)||void 0===i?void 0:i.call(n,null))||void 0===o?void 0:o.then)||void 0===s||s.call(o,(function(t){e.onAggregatedStats(t)})),e.launch()}),t)},e}(),Nt=function(){function t(e,t){void 0===t&&(t={}),this.tag=":::[JanusClient]",this.videoEl=null,this.janus=null,this.opaqueId="videoroomtest".concat(Mt.randomString(12)),this.closed=!1,this.containerEl=e,this.options=t,this.videoConfig=t.videoOptions||{}}return t.prototype.setup=function(e,t){var r=this;return this.closed=!1,this.roomId=parseInt(e.room_id),this.pin=e.pin,this.server=e.janus_server_info,this.webrtcCallback=t,new Promise((function(e,t){r.resolve=e,r.reject=t,Mt.init({debug:window.location.search.indexOf("janus=true")>-1,callback:function(){r.janus=new Mt({server:r.server,success:function(){r.attachVideoRoom()},error:function(e){Tt(r.tag,"create janus error",e),Mt.error(e)},destroyed:function(){Tt(r.tag,"janus destroyed")}})}})}))},t.prototype.attachVideoRoom=function(){var e=this;this.janus?this.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.opaqueId,success:function(t){var r,n;Mt.log("pluginHandle: ",t),e.sfutest=t,Mt.log("Plugin attached! (".concat(null===(r=e.sfutest)||void 0===r?void 0:r.getPlugin(),",id=").concat(null===(n=e.sfutest)||void 0===n?void 0:n.getId(),")")),Mt.log("  -- This is a publisher/manager"),e.registerUsername()},error:function(e){Mt.error("  -- Error attaching plugin...",e)},onmessage:function(t,r){Mt.debug(" ::: Got a message (publisher) :::",t);var n=t.videoroom;if(Mt.debug("Event: "+n),n){if("joined"===n){if(e.myid=t.id,e.mypvtid=t.private_id,Mt.log("Successfully joined room:".concat(t.room," with ID:").concat(e.myid)),t.publishers){var i=t.publishers;for(var o in Mt.log("Got a list of available publishers/feeds:",i),i){var s=i[o].id,a=i[o].display,c=i[o].audio_codec,d=i[o].video_codec;Mt.log("  >> [".concat(s,"] ").concat(a," (audio: ").concat(c,", video: ").concat(d,")")),null==e.remoteFeed&&e.newRemoteFeed(s,a,c,d)}}}else if("destroyed"===n)Mt.warn("The room has been destroyed!");else if("event"===n)if(t.publishers){i=t.publishers;for(var o in Mt.log("Got a list of available publishers/feeds:",i),i){s=i[o].id,a=i[o].display,c=i[o].audio_codec,d=i[o].video_codec;Mt.log("  >> [".concat(s,"] ").concat(a," (audio: ").concat(c,", video: ").concat(d,")")),null==e.remoteFeed&&e.newRemoteFeed(s,a,c,d)}}else if(t.leaving){var u=t.leaving;Mt.log("Publisher left: "+u),e.webrtcCallback&&"ok"===u&&e.webrtcCallback(!1)}else if(t.unpublished){var p=t.unpublished;if(Mt.log("Publisher left: "+p),"ok"===p&&e.sfutest)return void e.sfutest.hangup()}else t.error&&(426===t.error_code?Tt(e.tag,"<p>Apparently room <code>".concat(e.roomId,"</code> (the one this demo uses as a test room) does not exist...</p><p>Do you have an updated <code>janus.plugin.videoroom.jcfg</code> configuration file? If not, make sure you copy the details of room <code>").concat(e.roomId,"</code> from that sample in your current configuration file, then restart Janus and try again.")):Tt(t.error))}else e.reject("invalid event")}}):Tt(this.tag,"invalid janus instance")},t.prototype.registerUsername=function(){var e=Mt.randomString(5);Mt.log("username:".concat(e));var t={request:"join",room:this.roomId,pin:this.pin,ptype:"publisher",display:e};this.sfutest&&this.sfutest.send({message:t})},t.prototype.newRemoteFeed=function(t,r,n,i){var o=this;if(this.janus){var s=this.videoConfig;this.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.opaqueId,success:function(e){o.remoteFeed=e,Mt.log("Plugin attached! (".concat(o.remoteFeed.getPlugin(),", id=").concat(o.remoteFeed.getId(),")")),Mt.log("  -- This is a subscriber");var r={request:"join",room:o.roomId,pin:o.pin,ptype:"subscriber",feed:t,private_id:o.mypvtid};o.remoteFeed&&o.remoteFeed.send({message:r})},error:function(e){Mt.error("  -- Error attaching plugin...",e)},onmessage:function(e,t){var r;Mt.log(" ::: Got a message (subscriber) :::",e);var n=e.videoroom;if(Mt.debug("Event: ".concat(n)),e.error)Tt(e.error);else if(n&&"attached"===n){o.rfindex=1;var i=e.id,s=e.display;Mt.log("Successfully attached to feed ".concat(i," (").concat(s,") in room ").concat(e.room))}t&&(Mt.log("Handling SDP as well...",t),null===(r=o.remoteFeed)||void 0===r||r.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){Mt.debug("Got SDP!",e);var t={request:"start",room:o.roomId};o.remoteFeed&&o.remoteFeed.send({message:t,jsep:e})},error:function(e){Mt.error("WebRTC error:",e),Tt("WebRTC error... ".concat(e.message))}}))},iceState:function(e){var t,r;null===(r=null===(t=o.options)||void 0===t?void 0:t.iceStateCallback)||void 0===r||r.call(t,e),Mt.log("ICE state of this WebRTC PeerConnection (feed #".concat(o.rfindex,") changed to ").concat(e))},webrtcState:function(e){var t;null===(t=o.webrtcCallback)||void 0===t||t.call(o,e),Mt.log("Janus says this WebRTC PeerConnection (feed #"+o.rfindex+") is "+(e?"up":"down")+" now")},onremotestream:function(t){if(o.closed)Mt.debug("closed()");else{Mt.debug("Remote feed #"+o.rfindex+", stream:",t);var r=!1!==o.videoConfig.muted,n=o.containerEl.querySelectorAll("video")[0];n||(n=document.createElement("video"),o.containerEl.appendChild(n)),n.setAttribute("style",Pt({display:"block",width:"100%",height:"100%"})),n.setAttribute("playsinline","playsinline"),n.setAttribute("webkit-playsInline","webkit-playsinline"),n.setAttribute("x-webkit-airplay","allow"),n.setAttribute("x5-video-player-type","h5-page"),n.setAttribute("controls","true"),!1!==s.autoplay&&(n.setAttribute("autoplay","true"),r&&(n.muted="muted")),n.addEventListener("click",(function(e){var t,r,i;null===(t=e.stopPropagation)||void 0===t||t.call(e),n.muted=!1,n.removeAttribute("muted"),n.play(),null===(i=null===(r=o.muteButtonRef)||void 0===r?void 0:r.hide)||void 0===i||i.call(r)})),Mt.attachMediaStream(n,t),Mt.log("Streaming attached"),n.onloadeddata=function(){if(o.options){var e=o.options,t=e.packetsLostRateCallback,r=e.framesDroppedRateCallback,i=e.aggregatedStatsCallback;"function"==typeof(t||r||i)&&(o.rtcAggReport=new Bt(o.remoteFeed,o.options),o.rtcAggReport.launch())}setTimeout((function(){n.removeAttribute("controls")}),0)},o.containerEl.appendChild(n),o.videoEl=n;var i=s.muteButtonOptions||{},a=i.teleport,c=null!=a?a:o.containerEl,d=e(e({},i),{videoElement:n,container:c});!1!==o.videoConfig.showMutedButton&&At(d).then((function(e){o.muteButtonRef=e})),o.resolve()}},ondata:function(e,t){Mt.log("receive data: ".concat(e,", label: ").concat(t))},oncleanup:function(){Mt.log(" ::: Got a cleanup notification (remote feed ".concat(t,") :::")),o.remoteFeed=void 0}})}else Tt(this.tag,"invalid janus instance")},t.prototype.leaveRoom=function(){this.remoteFeed&&(this.remoteFeed.send({message:{request:"leave"}}),this.remoteFeed.send({message:{request:"destroy"}}),this.remoteFeed=void 0),this.janus&&this.janus.destroy(),this.videoEl&&this.containerEl.removeChild(this.videoEl),this.closed=!0},t}();!function(e){e.ChatError="onChatError",e.CloseRoomError="onCloseRoomError",e.ReleaseRoomError="onReleaseRoomError",e.ContainerNonExistent="onContainerNonExistent",e.InterruptError="onInterruptError",e.LoginError="onLoginError",e.MuteError="onMuteError",e.OpenAccount="onOpenAccountError",e.OpenRoom="onOpenRoomError",e.RoomConfigError="onRoomConfigError",e.SendTextError="onSendTextError",e.SendStreamTextError="onSendStreamTextError",e.Unauthorized="onUnauthorized",e.WidgetSocketDisconnect="onWidgetSocketDisconnect",e.WidgetSocketError="onWidgetSocketError"}(Ot||(Ot={}));var Lt=function(){function e(e){this._storage_key_="xmov_ttsa_recovery_room",this._storage_=sessionStorage,this.state={},this._storage_key_=e||this._storage_key_,this.align()}return e.prototype.align=function(){var e=this._storage_.getItem(this._storage_key_);if(e)try{this.state=JSON.parse(e)}catch(e){this.state={},this.persistence()}},e.prototype.persistence=function(){this.state.modifyTimestamp=Date.now(),this._storage_.setItem(this._storage_key_,JSON.stringify(this.state))},e.prototype.patch=function(e){var t=this;e&&(Object.keys(e).forEach((function(r){t.state[r]=e[r]})),this.persistence())},e.prototype.clear=function(){this.state={},this._storage_.removeItem(this._storage_key_)},e}();window.adapter=fe;var Ft=function(){function n(e){var t=this;this.token=null,this.room=null,this.recoveryRoom=new Lt(n.NODES._STORAGE_KEY_ROOM_RECOVERY_),this.widgetCallback=function(e){return Tt(e)},this.widgetSocket=null,this.closed=!1,this.need_refresh=!1;var r=e.width,i=e.height,o=e.widgetCallback,s=e.webrtcCallback;this.options=e,this.widgetCallback=o,this.webrtcCallback=s,this.http=new xt(e.server);var a=Dt(e.container);a?(a.style.width="".concat(r,"px"),a.style.height="".concat(i,"px"),this.containerEl=a):this.errorReport(Ot.ContainerNonExistent," ",e.container);var c=new St;c.setPublicKey("-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCfbvUTkS/XamHAfirkNkOGPIhn\nn0bI2taNF6usDYVwSOAwp0v+cS9mKq68mdoDGaXgKVNTptbgJIU/oARp1Lef7ny4\neOCc6MSXoj42bmXafhOlmzYNNv8Ira5u663vJvKE3o5z7jqyct1+P5+O6OMx0pd9\ndQYwiJkdr/Vhk418FQIDAQAB\n-----END PUBLIC KEY-----"),this.encryptObj=c,window.onbeforeunload=function(){var r,n,i,o=e.server,s=new URLSearchParams;s.append("session_id",(null===(r=t.token)||void 0===r?void 0:r.session_id)||""),s.append("user_id",(null===(n=t.token)||void 0===n?void 0:n.user_id.toString())||""),s.append("key",(null===(i=t.token)||void 0===i?void 0:i.key)||""),navigator.sendBeacon("".concat(o,"/api/v1/sc/ttsa/close/"),s)}}return n.prototype.setup=function(e){var t=this;return this.need_refresh=e||!1,this.openRoom().then((function(e){if(t.closed)return Promise.reject("closed");t.room=e;var r,n,i=(r=t.containerEl,n=t.options,new Nt(r,n));return t.webrtcClient=i,i.setup(e,t.webrtcCallback)})).then((function(){return t.setupWidgetSocket()}))},n.prototype.errorReport=function(e){for(var t,r,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return null===(r=(t=this.options).onError)||void 0===r||r.call(t,e,{eventName:e,instance:this,messages:n}),kt.apply(this,function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}(["[:".concat(e,":]")],n,!0)),{errorType:e,message:n.join(""),messages:n}},n.prototype.openRoom=function(){return t(this,void 0,void 0,(function(){var t=this;return r(this,(function(r){return this.options.account?[2,this.closeRoom().then((function(){return t.loginAccount()})).then((function(r){return t.token=r,t.openAccount().then((function(n){var i=n.room,o=n.data;return t.token.session_id=o.session_id,t.recoveryRoom.patch(e(e({},r),i)),i}))}))]:[2,Promise.reject(this.errorReport(Ot.Unauthorized," ".concat(JSON.stringify(this.options))))]}))}))},n.prototype.loginAccount=function(){return t(this,void 0,void 0,(function(){var t,n,i,o,s,a=this;return r(this,(function(r){return t=this.options.account,n=t.username,i=t.app_id,o=t.app_secret,s=t.token,this.recoveryRoom.patch(t),s?[2,Promise.resolve(s)]:[2,new Promise((function(t,r){a.http.send({method:vt.POST,path:"/api/v1/sc/app_center/sdk/login",body:{name:n,app_id:i,app_secret:a.encryptObj.encrypt(o),need_refresh:a.need_refresh}}).then((function(n){if(n.error_code)r(e(e({},a.errorReport(Ot.LoginError,":",n.error_reason)),{respostData:n}));else{var i=n.data||{};t(i)}})).catch((function(e){r(a.errorReport(Ot.LoginError,":",JSON.stringify(e)))}))}))]}))}))},n.prototype.openAccount=function(){return t(this,void 0,void 0,(function(){var t,n,i,o,s,a,c,d,u,p,l;return r(this,(function(r){switch(r.label){case 0:return this.token?(this.closed=!1,Tt("open()"),t=this.options,n=t.config,i=t.width,o=t.height,s=t.account,a=this.token,c=a.user_id,d=a.key,i&&o&&(u="".concat(i,"x").concat(o)),p=Object.assign({user_id:c,key:d,app_id:s.app_id,resolution:u,room_type:"janus"},n),[4,this.http.send({method:vt.POST,path:"/api/v1/sc/ttsa/open/",body:p})]):[2,Promise.reject("")];case 1:return(l=r.sent()).error_code?[2,Promise.reject(e(e({},this.errorReport(Ot.OpenAccount,l.error_reason)),{responseData:l}))]:[2,{room:l.data,data:l.query_data}]}}))}))},n.prototype.sendText=function(n,i){return t(this,void 0,void 0,(function(){var t,o,s,a,c,d,u=this;return r(this,(function(r){return this.token?(Tt("sendText()"),t=this.token,o=t.session_id,s=t.user_id,a=t.key,c=this.options.account,d=e({user_id:s,key:a,async:!0,interrupt:!0,auto_action:!0,strict_mode:!1,app_id:c.app_id,session_id:o,query_text:"ttsa",text:n},i),[2,new Promise((function(t,r){u.http.send({method:vt.POST,path:"/api/v1/sc/ttsa/ttsa/",body:d}).then((function(e){e.error_code?"STREAMING"===(null==i?void 0:i.task_type)?r(u.errorReport(Ot.SendStreamTextError,"sendStreamText() error:",e.error_reason)):r(u.errorReport(Ot.SendTextError,"sendText() error:",e.error_reason)):t(e)})).catch((function(t){r(e(e({},u.errorReport(Ot.SendTextError,"",JSON.stringify(t))),{responseData:t}))}))}))]):[2,Promise.reject(this.errorReport(Ot.Unauthorized,""))]}))}))},n.prototype.sendStreamText=function(n,i){return t(this,void 0,void 0,(function(){var t,o;return r(this,(function(r){return t=(i||{}).is_stream_end,o=void 0!==t&&t,[2,this.sendText(n,e(e({},i),{is_stream_end:o,task_type:"STREAMING",interrupt:!1}))]}))}))},n.prototype.interrupt=function(){return t(this,void 0,void 0,(function(){var e,t,n,i,o,s=this;return r(this,(function(r){return this.token?(e=this.token,t=e.session_id,n=e.user_id,i=e.key,o=this.options.account,[2,new Promise((function(e,r){s.http.send({method:vt.POST,path:"/api/v1/sc/ttsa/interrupt/",body:{user_id:n,key:i,app_id:o.app_id,session_id:t}}).then((function(t){t.error_code?r(s.errorReport(Ot.InterruptError,"interrupt() error:",t.error_reason)):e(t)})).catch((function(e){r(s.errorReport(Ot.InterruptError,JSON.stringify(e)))}))}))]):[2,this.errorReport(Ot.Unauthorized,"")]}))}))},n.prototype.mute=function(n){return t(this,void 0,void 0,(function(){var t,i,o,s,a,c,d=this;return r(this,(function(r){return this.token?(Tt("mute()"),t=this.token,i=t.session_id,o=t.user_id,s=t.key,a=this.options.account,c={mute:n?"1":"0",app_id:a.app_id,user_id:o,key:s,session_id:i},[2,new Promise((function(t,r){d.http.send({method:vt.POST,path:"/api/v1/sc/ttsa/mute/",body:c}).then((function(e){e.error_code?r(d.errorReport(Ot.MuteError,"mute() error:",e.error_reason)):t(e)})).catch((function(t){r(e(e({},d.errorReport(Ot.MuteError,JSON.stringify(t))),{respostData:t}))}))}))]):[2,this.errorReport(Ot.Unauthorized,"")]}))}))},n.prototype.roomConfig=function(n){return t(this,void 0,void 0,(function(){var t,i,o,s,a,c,d=this;return r(this,(function(r){return this.token?(t=this.token,i=t.session_id,o=t.user_id,s=t.key,a=this.options.account,c=e({app_id:a.app_id,session_id:i,user_id:o,key:s},n),[2,new Promise((function(t,r){d.http.send({method:vt.POST,path:"/api/v1/sc/ttsa/ue4_config/",body:c}).then((function(n){n.error_code?r(e(e({},d.errorReport(Ot.RoomConfigError,"roomConfig() error:",n.error_reason)),{responseData:n})):t(n)})).catch((function(t){r(e(e({},d.errorReport(Ot.RoomConfigError,JSON.stringify(t))),{responseData:t}))}))}))]):[2,this.errorReport(Ot.Unauthorized,"")]}))}))},n.prototype.releaseRoom=function(n,i,o){return t(this,void 0,void 0,(function(){var t=this;return r(this,(function(r){return Tt("releaseRoom()"),[2,new Promise((function(r,s){t.http.send({method:vt.POST,path:"/api/v1/sc/ttsa/close/",body:{user_id:i,key:o,session_id:n}}).then((function(n){n.error_code?s(e(e({},t.errorReport(Ot.ReleaseRoomError,"releaseRoom() error:",n.error_reason)),{responseData:n})):(t.recoveryRoom.clear(),r(n))})).catch((function(r){s(e(e({},t.errorReport(Ot.ReleaseRoomError,JSON.stringify(r))),{responseData:r}))}))}))]}))}))},n.prototype.implementRecoveryRoom=function(){return t(this,void 0,void 0,(function(){var e,t,n,i;return r(this,(function(r){return e=this.recoveryRoom.state,t=e.session_id,n=e.user_id,i=e.key,t?[2,this.releaseRoom(t,n,i)]:(this.recoveryRoom.clear(),[2,Promise.reject(!1)])}))}))},n.prototype.closeRoom=function(){return t(this,void 0,void 0,(function(){var t,n,i,o,s=this;return r(this,(function(r){return this.closed=!0,this.token&&this.room?(Tt("closeRoom()"),t=this.token,n=t.session_id,i=t.user_id,o=t.key,this.widgetSocket&&this.widgetSocket.close(),this.webrtcClient&&this.webrtcClient.leaveRoom(),[2,this.releaseRoom(n,i,o).then((function(e){var t,r;return e.error_code&&s.errorReport(Ot.CloseRoomError,"closeRoom() error:",e.error_reason),null===(r=(t=s.options).onRoomClosed)||void 0===r||r.call(t,e),s.token=null,s.room=null,e})).catch((function(t){var r=t.responseData;return e(e({},s.errorReport(Ot.CloseRoomError,JSON.stringify(r))),{responseData:r})}))]):[2,Promise.resolve(null)]}))}))},n.prototype.setupWidgetSocket=function(){var e=this;return new Promise((function(t,r){if(e.token&&e.room){var n=e.token.user_id,i=e.room.app_server_info;e.widgetSocket=io(i),e.widgetSocket?(e.widgetSocket.on("connect",(function(){var r,o,s;if(Tt("".concat(i," connected")),e.widgetSocket&&e.token){var a={user_id:n,session_id:e.token.session_id,support_ack:null===(r=e.options)||void 0===r?void 0:r.support_ack};e.widgetSocket.emit("session_info",a),null===(s=null===(o=e.options)||void 0===o?void 0:o.socketCallback)||void 0===s||s.call(o,"connect",e.widgetSocket),t(e.room)}})),e.widgetSocket.on("ui_callback",(function(t,r){var n,i;e.widgetCallback(t),null===(i=null===(n=e.options)||void 0===n?void 0:n.socketCallback)||void 0===i||i.call(n,"ui_callback",t),r&&r()})),e.widgetSocket.on("error",(function(t){var r,n;e.errorReport(Ot.WidgetSocketError,t),null===(n=null===(r=e.options)||void 0===r?void 0:r.socketCallback)||void 0===n||n.call(r,"error",t)})),e.widgetSocket.on("disconnect",(function(t){var r,n;e.errorReport(Ot.WidgetSocketDisconnect,"disconnect:",t),null===(n=null===(r=e.options)||void 0===r?void 0:r.socketCallback)||void 0===n||n.call(r,"disconnect",t),e.widgetSocket=null}))):t(e.room)}else r(e.errorReport(Ot.Unauthorized," "))}))},n.NODES=Object.freeze({v:"0.0.1",_STORAGE_KEY_ROOM_RECOVERY_:"xmov_ttsa_recovery_room"}),n}();Tt(" loaded"),void 0!==window?window.XmovTTSA=Ft:module.exports=Ft;