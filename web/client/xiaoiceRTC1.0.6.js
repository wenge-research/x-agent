/*! For license information please see xiaoice.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(self,(()=>(()=>{var __webpack_modules__={184:(e,t)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var o=typeof n;if("string"===o||"number"===o)e.push(n);else if(Array.isArray(n)){if(n.length){var a=r.apply(null,n);a&&e.push(a)}}else if("object"===o){if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]")){e.push(n.toString());continue}for(var s in n)i.call(n,s)&&n[s]&&e.push(s)}}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},707:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(81),r=n.n(i),o=n(645),a=n.n(o)()(r());a.push([e.id,".moke-wrap {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  background-size: cover;\n  overflow: hidden;\n  background-repeat: no-repeat;\n}\n.moke-wrap * {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n.moke-wrap .mask-init {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.5);\n}\n.moke-wrap .app-come-back {\n  position: absolute;\n  width: 0.66em;\n  height: 0.66em;\n  left: 0.38em;\n  top: 1.2em;\n}\n.moke-wrap .app-come-back img {\n  width: 100%;\n  height: 100%;\n}\n.svg {\n  z-index: 100;\n  position: fixed;\n}\n.iphone {\n  height: 100%;\n  width: 100%;\n}\n.rtc-container {\n  display: flex;\n  justify-content: flex-start;\n  align-items: flex-start;\n  position: absolute;\n  overflow: hidden;\n}\n.rtc-container .show-video {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n.rtc-container .show-video .default_canvas_2d_canvas {\n  width: 100% !important;\n  height: 100% !important;\n}\n.rtc-container .rtc-human {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: space-between;\n  background-size: cover;\n  aspect-ratio: 0.5625;\n  position: relative;\n  top: 0;\n  left: 0;\n  overflow: hidden;\n}\n.rtc-container .rtc-human .rtc-human-area {\n  position: absolute;\n}\n.rtc-container .rtc-human .global-image,\n.rtc-container .rtc-human .global-text,\n.rtc-container .rtc-human .display-image,\n.rtc-container .rtc-human .display-text,\n.rtc-container .rtc-human .display-caption {\n  position: absolute;\n  white-space: nowrap;\n}\n.rtc-container .rtc-human .think-bs {\n  position: absolute;\n}\n.rtc-container .rtc-human .think-bs img {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  object-fit: contain;\n}\n.rtc-container .rtc-human .big-screen-action {\n  position: absolute;\n  box-sizing: border-box;\n  backdrop-filter: blur(0.01em);\n  background: linear-gradient(148.45deg, rgba(255, 255, 255, 0.7) -1.73%, rgba(255, 255, 255, 0.2) 42.09%);\n  border: 0.025em solid rgba(255, 255, 255, 0.2);\n  border-bottom: 0;\n  transition: all 0.3s ease-in-out;\n}\n.rtc-container .rtc-human .big-screen-action .bs-action-bottom-bottom {\n  box-sizing: border-box;\n  position: absolute;\n  bottom: 0em;\n  width: calc(100% + 0.05em);\n  transform: translate(-0.025em, 100.1%);\n}\n.rtc-container .rtc-human .big-screen-action .big-bg-wrap {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n.rtc-container .rtc-human .big-screen-action .big-bg-wrap img {\n  width: 100%;\n  object-fit: contain;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak-wrap {\n  position: absolute;\n  left: 50%;\n  width: calc(20% + 0.1em);\n  background: rgba(255, 255, 255, 0.5);\n  aspect-ratio: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak {\n  position: absolute;\n  width: calc(100% - 0.1em);\n  aspect-ratio: 1;\n  border-radius: 50%;\n  background: linear-gradient(180deg, #62C6FF 0%, rgba(67, 128, 248, 0.8) 100%), #5991FF;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak .animation-wrap {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  transition: all 5s cubic-bezier(0.68, -0.55, 0.27, 1.55);\n  width: 100%;\n  height: 100%;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak .animation-wrap div {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak .hidden {\n  opacity: 0 !important;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak .yuyin {\n  opacity: 0;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak span {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  transition: all 5s cubic-bezier(0.68, -0.55, 0.27, 1.55);\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-speak .show {\n  opacity: 1 !important;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap .no-opening {\n  height: 0 !important;\n  padding: 0 !important;\n  background-color: rgba(255, 255, 255, 0) !important;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap .bs-action-top {\n  background-color: rgba(255, 255, 255, 0.7);\n  padding: 10% 6% 6%;\n  word-wrap: break-word;\n  word-break: break-all;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: all 0.5s ease-in-out;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap .bs-action-top .bs-top-text {\n  text-align: center;\n  width: 100%;\n  height: 100%;\n  font-weight: 400;\n  color: #35394D;\n  font-family: 'PingFang SC';\n  font-style: normal;\n  font-weight: 500;\n  font-size: 0.28em;\n  line-height: 100%;\n  max-height: 60%;\n  text-overflow: -o-ellipsis-lastline;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap .bs-action-top .bs-top-speak {\n  width: 100%;\n  height: 100%;\n  transform: translate(0, 25%);\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap .bs-action-bottom {\n  padding: 6%;\n  word-wrap: break-word;\n  word-break: break-all;\n  height: 100%;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap .bs-action-bottom .bs-bottom-text {\n  text-align: center;\n  font-weight: 400;\n  font-size: 0.3em;\n  line-height: 1.5em;\n  color: #35394D;\n}\n.rtc-container .rtc-human .big-screen-action .big-screen-wrap .bs-action-bottom .bs-bottom-text.ans-padding {\n  padding-top: 10%;\n}\n.rtc-container .rtc-human .mobile-action {\n  position: absolute;\n  top: 4.4em;\n  left: 0.1em;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.2) 100%);\n  border: 0.03em solid #FFFFFF;\n  border-radius: 0.36em;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n}\n.rtc-container .rtc-human .mobile-action .action-top {\n  min-height: 30%;\n  border-bottom: 0.01em solid #FFFFFF;\n  padding: 2.5% 5%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.rtc-container .rtc-human .mobile-action .action-top .mobile-text {\n  word-wrap: break-word;\n  word-break: break-all;\n  flex: 1;\n  font-size: 0.36em;\n  line-height: 1.66666667em;\n  max-height: 5em;\n  overflow: hidden;\n  -webkit-line-clamp: 3;\n  text-overflow: ellipsis;\n}\n.rtc-container .rtc-human .mobile-action .action-top .mobile-wos {\n  min-width: 10%;\n  max-width: 10%;\n  aspect-ratio: 1;\n  border-radius: 50%;\n  background-color: #5991ff;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-right: 2.5%;\n}\n.rtc-container .rtc-human .mobile-action .action-top .mobile-ioa {\n  display: flex;\n  align-items: center;\n  flex: 1;\n  height: 62.5%;\n}\n.rtc-container .rtc-human .mobile-action .action-top .mobile-ioa div {\n  transform: translate(-10%);\n}\n.rtc-container .rtc-human .mobile-action .action-bottom {\n  flex: 1;\n  overflow-y: overlay;\n  -webkit-mask-image: -webkit-linear-gradient(bottom, rgba(0, 0, 0, 0) 5%, #000000 100%);\n}\n.rtc-container .rtc-human .mobile-action .action-bottom::-webkit-scrollbar {\n  width: 6px;\n}\n.rtc-container .rtc-human .mobile-action .action-bottom::-webkit-scrollbar-track {\n  background-color: transparent;\n  width: 6px;\n  border-radius: 0;\n}\n.rtc-container .rtc-human .mobile-action .action-bottom::-webkit-scrollbar-thumb {\n  background-color: rgba(0, 0, 0, 0.2);\n  border-radius: 10px;\n  -webkit-box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);\n}\n.rtc-container .rtc-human .mobile-action .action-bottom .action-content {\n  padding: 5% 5% 0;\n  word-break: break-word;\n  word-wrap: break-word;\n  font-size: 0.39em;\n  line-height: 1.53846154em;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-speak-wrap {\n  position: absolute;\n  left: 50%;\n  width: calc(20% + 0.1em);\n  background: rgba(255, 255, 255, 0.5);\n  aspect-ratio: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1;\n  top: 0;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-speak {\n  position: absolute;\n  width: calc(100% - 0.1em);\n  aspect-ratio: 1;\n  border-radius: 50%;\n  background: linear-gradient(180deg, #62C6FF 0%, rgba(67, 128, 248, 0.8) 100%), #5991FF;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-speak .animation-wrap {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  transition: all 5s cubic-bezier(0.68, -0.55, 0.27, 1.55);\n  width: 100%;\n  height: 100%;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-speak .hidden {\n  opacity: 0 !important;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-speak .yuyin {\n  opacity: 0;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-speak span {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  transition: all 5s cubic-bezier(0.68, -0.55, 0.27, 1.55);\n}\n.rtc-container .rtc-human .mobile-action .big-screen-speak .show {\n  opacity: 1 !important;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .no-opening {\n  height: 0 !important;\n  padding: 0 !important;\n  background-color: rgba(255, 255, 255, 0) !important;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .bs-action-top {\n  background-color: rgba(255, 255, 255, 0.7);\n  padding: 10% 6% 6%;\n  word-wrap: break-word;\n  word-break: break-all;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: all 0.5s ease-in-out;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .bs-action-top .bs-top-text {\n  text-align: center;\n  width: 100%;\n  height: 100%;\n  font-weight: 400;\n  color: #35394D;\n  font-family: 'PingFang SC';\n  font-style: normal;\n  font-weight: 500;\n  font-size: 0.39em;\n  line-height: 100%;\n  max-height: 60%;\n  text-overflow: -o-ellipsis-lastline;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .bs-action-top .bs-top-speak {\n  width: 100%;\n  height: 100%;\n  transform: translate(0, 25%);\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .bs-action-bottom {\n  padding: 15% 12% 12% 12%;\n  word-wrap: break-word;\n  word-break: break-all;\n  height: 100%;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .bs-action-bottom .bs-bottom-text {\n  text-align: center;\n  font-weight: 400;\n  font-size: 0.39em;\n  line-height: 1.15384615em;\n  color: #35394D;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .bs-action-bottom .bs-bottom-text.ans-padding {\n  padding-top: 4%;\n}\n.rtc-container .rtc-human .mobile-action .big-screen-wrap .bs-action-bottom .bs-bottom-text .pre-ans {\n  opacity: 0.3;\n}\n.rtc-container .rtc-human .mobile-point {\n  position: absolute;\n  right: 0;\n}\n.rtc-container .rtc-human .mobile-point .mobile-load {\n  position: absolute;\n  right: 0;\n  top: 0;\n  width: 54%;\n  height: 39%;\n  background-size: contain;\n}\n.rtc-container .rtc-human .mobile-point .mobile-load .svg-wrap {\n  position: absolute;\n  top: 26%;\n  left: 50%;\n  width: 24%;\n  height: 37.5%;\n  transform: translate(-50%);\n}\n.rtc-container .rtc-human .clear {\n  position: absolute;\n  background: #3071c2;\n  box-shadow: 0 0 0.1em #0000000d;\n  border-radius: 50%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.rtc-container .rtc-human .clear .button-self {\n  height: 100%;\n  width: 100%;\n  box-shadow: 0 0 0.625em #0000000d;\n  border-radius: 50%;\n  padding: 0;\n  outline: 0;\n  border: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background: transparent;\n}\n.rtc-container .rtc-human .clear .button-self span {\n  width: 50%;\n  height: 50%;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  color: white;\n}\n.rtc-container .rtc-human .func-area {\n  display: none !important;\n}\n.rtc-container .rtc-human .human-main {\n  width: 598.91666667em;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 0.12em;\n}\n.rtc-container .rtc-human .human-main .body_canvas {\n  filter: unset !important;\n  position: relative;\n  height: unset !important;\n  transition: 0.5s;\n}\n.rtc-container .rtc-human .human-main .chest_up .body_canvas {\n  width: 93.75em !important;\n  top: 48.12em !important;\n}\n.rtc-container .rtc-human .human-main .full_body .body_canvas {\n  width: 34.375em !important;\n  top: 1.25em !important;\n}\n.rtc-container .rtc-human .human-main .thigh_up .body_canvas {\n  width: 56.25em !important;\n  top: 20.625em !important;\n}\n.rtc-container .rtc-human .human-main .shoulder_up .body_canvas {\n  width: 112.5em !important;\n  top: 65.62em !important;\n}\n.rtc-container .rtc-human .chat-box {\n  opacity: 0;\n}\n.rtc-container .rtc-human .chat .body_canvas {\n  transform: translate(-24.06em);\n}\n.rtc-container .rtc-human .chat .chat-list::-webkit-scrollbar {\n  width: 6px;\n}\n.rtc-container .rtc-human .chat .chat-list::-webkit-scrollbar-track {\n  background-color: transparent;\n  width: 6px;\n  border-radius: 0;\n}\n.rtc-container .rtc-human .chat .chat-list::-webkit-scrollbar-thumb {\n  background-color: rgba(0, 0, 0, 0.2);\n  border-radius: 10px;\n  -webkit-box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);\n}\n.rtc-container .rtc-human .chat .chat-box {\n  opacity: 1;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column-reverse;\n  font-style: normal;\n  font-weight: 400;\n  font-size: inherit;\n  line-height: 1em;\n  word-wrap: break-word;\n  -webkit-mask-image: -webkit-linear-gradient(top, rgba(0, 0, 0, 0) 5%, #000000 25%);\n}\n.rtc-container .rtc-human .chat .chat-box .chat-list {\n  display: flex;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  flex-direction: column-reverse;\n  transition: all 2s;\n}\n.rtc-container .rtc-human .chat .chat-box .chat-list .position-top {\n  width: 100%;\n  min-height: 5em;\n}\n.rtc-container .rtc-human .chat .chat-box .chat-item-wrap {\n  margin-bottom: 3.41%;\n  display: flex;\n}\n.rtc-container .rtc-human .chat .chat-box .chat-item-wrap .chat-child {\n  padding: 3.421%;\n  max-width: 77.16%;\n  font-size: 0.2em;\n  line-height: 1.4em;\n  border-radius: 0.4em;\n  min-height: 3em;\n}\n.rtc-container .rtc-human .chat .chat-box .ans-wrap {\n  color: #fff;\n  justify-content: flex-start;\n}\n.rtc-container .rtc-human .chat .chat-box .que-wrap {\n  color: #fff;\n  justify-content: flex-end;\n}\n.rtc-container .rtc-human .chat-container {\n  flex: 1;\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n}\n.rtc-container .rtc-human .action-bar {\n  display: flex;\n  height: 0.72em;\n  justify-content: flex-end;\n}\n.rtc-container .rtc-human .action-bar .button-wrap {\n  height: 0.72em;\n  width: 0.72em;\n  border-radius: 50%;\n  margin-left: 0.2em;\n  opacity: 1;\n}\n.rtc-container .rtc-human .action-bar .action-bar-start {\n  font-family: 'PingFang SC';\n  font-style: normal;\n  font-weight: 400;\n  font-size: 0.24em;\n  text-align: center;\n  color: #AAABB3;\n  user-select: none;\n  cursor: pointer;\n}\n.rtc-container .rtc-human .action-bar .button-self {\n  height: 0.72em;\n  width: 0.72em;\n  border-radius: 50%;\n  padding: 0;\n  outline: 0;\n  border: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background: transparent;\n}\n.rtc-container .rtc-human .action-bar .button-self span {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 0.28em;\n  color: white;\n}\n.rtc-container .rtc-human .action-bar .input-wrap {\n  width: 5em;\n  height: 0.72em;\n  background: rgba(255, 255, 255, 0.8);\n  box-shadow: 0 0 0.625em #0000000d;\n  border-radius: 0.36em;\n  justify-content: center;\n  align-items: center;\n  display: flex;\n  padding: 0 0.4em;\n  border: 2px solid rgba(0, 0, 0, 0.05);\n}\n.rtc-container .rtc-human .action-bar .input-wrap .ant-input-affix-wrapper {\n  font-size: 0.21em;\n}\n.rtc-container .rtc-human .action-bar .input-wrap .ant-input-suffix div {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.28em;\n}\n.rtc-container .rtc-human .action-bar .input-wrap input {\n  font-weight: 400;\n  font-size: 0.24em;\n  line-height: 1.33333333em;\n}\n.rtc-container .rtc-human .action-bar .input-wrap .animation-wrap {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.rtc-container .pre-init-wrap {\n  width: 100%;\n  height: 100%;\n  background-size: cover;\n  position: relative;\n}\n.rtc-container .pre-init-wrap .pre-init-mask {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .role-loading {\n  position: absolute;\n  top: 5.375em;\n  color: #FFF;\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.48em;\n  font-style: normal;\n  font-weight: 500;\n  line-height: normal;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .role-loading-webp {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background-size: 100% 100%;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info {\n  height: 12em;\n  aspect-ratio: 0.7;\n  background-size: 100% 100%;\n  position: relative;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-head {\n  width: 2.64em;\n  height: 2.64em;\n  border-radius: 2.64em;\n  overflow: hidden;\n  position: absolute;\n  top: 2.28em;\n  left: 50%;\n  transform: translateX(-50%);\n  background-color: #fff;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-head img {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  transform: scale(1.15);\n  transform-origin: top center;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-name {\n  position: absolute;\n  top: 6.14285714em;\n  left: 50%;\n  transform: translateX(-50%);\n  font-size: 0.84em;\n  background: linear-gradient(90deg, #1C51BA 0%, #5498FF 100%);\n  background-clip: text;\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  font-weight: 600;\n  line-height: normal;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-role {\n  position: absolute;\n  top: 15.35714286em;\n  left: 50%;\n  transform: translateX(-50%);\n  color: var(--1, #35394D);\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.42em;\n  font-style: normal;\n  font-weight: 500;\n  line-height: normal;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-hobis {\n  position: absolute;\n  width: 7.68em;\n  height: 3.84em;\n  top: 7.8em;\n  left: 50%;\n  transform: translateX(-50%);\n  padding: 0.24em 0.48em;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-hobis .human-jianjie {\n  flex: 1;\n  display: flex;\n  padding: 0.3em 0;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-hobis .human-jianjie-label {\n  width: 2.66666667em;\n  height: 1.33333333em;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 0.16666667em;\n  background: var(--1, #35394D);\n  color: #FFF;\n  font-family: PingFang SC;\n  font-size: 0.36em;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 1.33333333em;\n  margin-right: 0.66666667em;\n  /* 133.333% */\n}\n.rtc-container .pre-init-wrap .pre-init-mask .app-human-info .human-info-hobis .human-jianjie-content {\n  flex: 1;\n  display: flex;\n  flex-wrap: wrap;\n  color: var(--2, #666A80);\n  font-family: PingFang SC;\n  font-size: 0.36em;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1.33333333em;\n  /* 133.333% */\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list {\n  width: 6em;\n  height: 6em;\n  border-radius: 0.6em;\n  background: rgba(255, 255, 255, 0.9);\n  overflow: hidden;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 0.66em;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .bg-div {\n  width: 100%;\n  height: 100%;\n  background-size: contain;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .wait-header {\n  width: 3em;\n  height: 3em;\n  display: flex;\n  position: relative;\n  justify-content: center;\n  align-items: center;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .wait-header .wait-img {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  background-size: contain;\n  animation: rotate 2s linear infinite;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .wait-header .wait-img-ava {\n  width: 2.4em;\n  height: 2.4em;\n  border-radius: 2.4em;\n  background-color: #fff;\n  overflow: hidden;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .wait-header .wait-img-ava img {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  transform: scale(1.15);\n  transform-origin: top center;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .wait-busy-text {\n  color: var(--1, #35394D);\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.48em;\n  font-style: normal;\n  font-weight: 500;\n  line-height: normal;\n  margin-bottom: 0.5em;\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .wait-busy-list {\n  color: var(--3, #AAABB2);\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.36em;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1.33333333em;\n  /* 133.333% */\n}\n.rtc-container .pre-init-wrap .pre-init-mask .wait-list .wait-busy-list span {\n  color: var(--blue, #5991FF);\n}\n.web {\n  position: relative !important;\n}\n.app-human-chat {\n  position: absolute;\n  width: 1.68em;\n  height: 1.68em;\n  bottom: 1.6em;\n  z-index: 999;\n}\n.app-human-chat img {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n.no-clicking {\n  opacity: 0.3 !important;\n}\n.app-human-chat-text {\n  z-index: 999;\n  position: absolute;\n  bottom: 2.14285714em;\n  color: #FFF;\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.42em;\n  font-style: normal;\n  font-weight: 500;\n  line-height: normal;\n}\n@keyframes rotate {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n.greet-wrap {\n  display: flex;\n  width: 1.82em;\n  height: 1.82em;\n  justify-content: center;\n  align-items: center;\n  z-index: 2;\n}\n.greet-wrap .center {\n  margin: 0 auto;\n}\n.greet-wrap .outer-ring {\n  position: absolute;\n  height: 1.82em;\n  width: 1.82em;\n  background-image: linear-gradient(135deg, #feed07 0%, #538cbd 5%, #264ebb 10%, #22b9b3 40%, #1badc3 100%);\n  border-radius: 50%;\n  /*  Rotate  */\n  animation-duration: 2.8s;\n  animation-name: rotate;\n  animation-iteration-count: infinite;\n}\n.greet-wrap .inner-ring {\n  position: absolute;\n  height: 1.3em;\n  width: 1.3em;\n  background: #fff;\n  border-radius: 50%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n@keyframes rotate {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n.sdk-load {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 999999;\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.sdk-load .greet-wrap {\n  width: 100px;\n  height: 100px;\n  position: relative;\n}\n.sdk-load .greet-wrap .outer-ring {\n  width: 100%;\n  height: 100%;\n}\n.sdk-load .greet-wrap .inner-ring {\n  width: 70%;\n  height: 70%;\n}\n.button-wrap .ant-btn {\n  transition: none;\n}\n.anima-enter,\n.anima-appear {\n  opacity: 0 !important;\n}\n.anima-enter-active {\n  transition: opacity 300ms ease !important;\n}\n.anima-enter-done {\n  opacity: 1;\n}\n.anima-exit-active {\n  opacity: 0 !important;\n  transition: opacity 300ms ease !important;\n}\n.anima-exit-done {\n  opacity: 0 !important;\n}\n.mode-option {\n  position: absolute;\n  left: 0;\n  top: 50%;\n  z-index: 10000;\n}\n.mode-option .mode-option-item {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  aspect-ratio: 1.33333333;\n  border-radius: 0px 2.66666667em 2.66666667em 0px;\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0.6) 0%, rgba(255, 255, 255, 0.2) 100%);\n  box-shadow: 0px 2.29166627px 5.49999857px 0px rgba(0, 0, 0, 0.06);\n  margin-bottom: 1.25em;\n  color: var(--2, #666A80);\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.24em;\n  font-style: normal;\n  font-weight: 500;\n  line-height: normal;\n  padding-right: 0.41666667em;\n}\n.mode-option .mode-option-item .select-option-icon {\n  transform: scale(1.5);\n  transform-origin: bottom;\n  margin-bottom: 0.20833333em;\n}\n.mode-option .selected {\n  background: linear-gradient(180deg, rgba(98, 198, 255, 0.9) 0%, rgba(67, 128, 248, 0.9) 100%);\n  color: #fff;\n}\n.think-img {\n  position: absolute;\n  top: 0.9em;\n  left: 0.9em;\n  width: 30%;\n  height: 30%;\n}\n.think-img img {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n.global-video {\n  position: absolute;\n}\n.display-video {\n  position: absolute;\n}\n.anima {\n  position: absolute;\n}\n.anima img {\n  width: 100%;\n  height: 100%;\n}\n.anima .global-image,\n.anima .display-image {\n  width: 100%;\n  height: 100%;\n}\n.anima .global-image img,\n.anima .display-image img {\n  vertical-align: top;\n  width: 100%;\n  height: 100%;\n}\n.anima video {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n.anima .log-video-play {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 40%;\n  height: 40%;\n  cursor: pointer;\n  background-size: contain;\n  z-index: 2;\n}\n#emoteStreamContainer {\n  position: relative;\n}\n#emoteStreamContainer video {\n  position: absolute;\n  top: 0;\n  height: 200% !important;\n  object-fit: contain;\n}\n.test-button {\n  position: fixed;\n  left: 0;\n  top: 10%;\n  width: 2em;\n  height: 2em;\n  z-index: 99999999;\n  opacity: 0.1;\n}\n.get-mircorphone-modal {\n  width: 8.4em !important;\n  height: 5.7em !important;\n  border-radius: 0.36em;\n  overflow: hidden;\n  padding: 0 !important;\n}\n.get-mircorphone-modal .ant-modal-content {\n  width: 100%;\n  height: 100%;\n  border-radius: 0;\n  display: flex;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-close {\n  display: none;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body {\n  padding: 0;\n  flex: 1;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body .ant-modal-confirm-body-wrapper {\n  width: 100%;\n  height: 100%;\n  display: flex;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body .ant-modal-confirm-body-wrapper .anticon-exclamation-circle {\n  display: none;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body .ant-modal-confirm-body-wrapper .ant-modal-confirm-body {\n  padding: 28px 20px 20px 20px;\n  flex: 1;\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body .ant-modal-confirm-body-wrapper .ant-modal-confirm-body .ant-modal-confirm-title {\n  color: var(--1, #35394D);\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.48em;\n  font-style: normal;\n  font-weight: 500;\n  line-height: normal;\n  padding-bottom: 0.75em;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body .ant-modal-confirm-body-wrapper .ant-modal-confirm-body .ant-modal-confirm-content {\n  margin: 0;\n  flex: 1;\n  color: var(--2, #666A80);\n  text-align: center;\n  font-family: PingFang SC;\n  font-size: 0.42em;\n  font-style: normal;\n  font-weight: 400;\n  line-height: normal;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body .ant-modal-confirm-body-wrapper .ant-modal-confirm-body .ant-modal-confirm-content .I-know {\n  border-radius: 1.42857143em;\n  background: var(--blue, #5991FF);\n  height: 2.85714286em;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: var(--white, #FFF);\n  text-align: center;\n  /* 14 */\n  font-family: PingFang SC;\n  font-size: 0.42em;\n  font-style: normal;\n  font-weight: 400;\n  line-height: normal;\n  cursor: pointer;\n  user-select: none;\n}\n.get-mircorphone-modal .ant-modal-content .ant-modal-body .ant-modal-confirm-body-wrapper .ant-modal-confirm-btns {\n  display: none;\n}\n.animation-wrap div {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n#remoteStreamContainer {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n.matt video {\n  position: absolute;\n  top: 0;\n}\n",""]);const s=a},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(i)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&a[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},81:e=>{"use strict";e.exports=function(e){return e[1]}},964:e=>{e.exports={nested:{WsMessage:{oneofs:{_id:{oneof:["id"]},_type:{oneof:["type"]},_text:{oneof:["text"]},_ttsFileUrl:{oneof:["ttsFileUrl"]},_wait:{oneof:["wait"]},_ttsBuffer:{oneof:["ttsBuffer"]},_sampleRate:{oneof:["sampleRate"]}},fields:{id:{type:"string",id:1,options:{proto3_optional:!0}},type:{type:"string",id:2,options:{proto3_optional:!0}},text:{type:"string",id:3,options:{proto3_optional:!0}},ttsFileUrl:{type:"string",id:4,options:{proto3_optional:!0}},wait:{type:"bool",id:5,options:{proto3_optional:!0}},ttsBuffer:{type:"bytes",id:6,options:{proto3_optional:!0}},sampleRate:{type:"int64",id:7,options:{proto3_optional:!0}}}}}}},448:(e,t,n)=>{"use strict";var i=n(294),r=n(840);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,i,r,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function y(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,v);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var E=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),I=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),N=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function P(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=O&&e[O]||e["@@iterator"])?e:null}var L,U=Object.assign;function V(e){if(void 0===L)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var F=!1;function B(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var i=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){i=e}e.call(t.prototype)}else{try{throw Error()}catch(e){i=e}e()}}catch(t){if(t&&i&&"string"==typeof t.stack){for(var r=t.stack.split("\n"),o=i.stack.split("\n"),a=r.length-1,s=o.length-1;1<=a&&0<=s&&r[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(r[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||r[a]!==o[s]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?V(e):""}function H(e){switch(e.tag){case 5:return V(e.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return B(e.type,!1);case 11:return B(e.type.render,!1);case 1:return B(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case A:return"Profiler";case x:return"StrictMode";case C:return"Suspense";case M:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case w:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:z(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return z(e(t))}catch(e){}}return null}function j(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z(t);case 8:return t===x?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function $(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=$(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=$(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function X(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function Q(e,t){K(e,t);var n=G(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function oe(e,t){var n=G(t.value),i=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var _e=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(o(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Te=null,xe=null;function Ae(e){if(e=yr(e)){if("function"!=typeof Se)throw Error(o(280));var t=e.stateNode;t&&(t=br(t),Se(e.stateNode,e.type,t))}}function we(e){Te?xe?xe.push(e):xe=[e]:Te=e}function Ie(){if(Te){var e=Te,t=xe;if(xe=Te=null,Ae(e),t)for(e=0;e<t.length;e++)Ae(t[e])}}function Re(e,t){return e(t)}function Ce(){}var Me=!1;function ke(e,t,n){if(Me)return e(t,n);Me=!0;try{return Re(e,t,n)}finally{Me=!1,(null!==Te||null!==xe)&&(Ce(),Ie())}}function Ne(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(o(231,t,typeof n));return n}var De=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){De=!1}function Pe(e,t,n,i,r,o,a,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Le=!1,Ue=null,Ve=!1,Fe=null,Be={onError:function(e){Le=!0,Ue=e}};function He(e,t,n,i,r,o,a,s,l){Le=!1,Ue=null,Pe.apply(Be,arguments)}function ze(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Ge(e){if(ze(e)!==e)throw Error(o(188))}function $e(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=ze(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return Ge(r),e;if(a===i)return Ge(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=a;break}if(l===i){s=!0,i=r,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,i=r;break}if(l===i){s=!0,i=a,n=r;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var qe=r.unstable_scheduleCallback,Xe=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Je=r.unstable_requestPaint,Ke=r.unstable_now,Qe=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null,at=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2,ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~r;0!==s?i=dt(s):0!=(o&=a)&&(i=dt(o))}else 0!=(a=n&~r)?i=dt(a):0!==o&&(i=dt(o));if(0===i)return 0;if(0!==t&&t!==i&&0==(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!=(4194240&o)))return t;if(0!=(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0==(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var yt=0;function Et(e){return 1<(e&=-e)?4<e?0!=(268435455&e)?16:536870912:4:1}var bt,St,Tt,xt,At,wt=!1,It=[],Rt=null,Ct=null,Mt=null,kt=new Map,Nt=new Map,Dt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":Ct=null;break;case"mouseover":case"mouseout":Mt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nt.delete(t.pointerId)}}function Lt(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&null!==(t=yr(t))&&St(t),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ut(e){var t=vr(e.target);if(null!==t){var n=ze(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=je(n)))return e.blockedOn=t,void At(e.priority,(function(){Tt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Vt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yr(n))&&St(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);Ee=i,n.target.dispatchEvent(i),Ee=null,t.shift()}return!0}function Ft(e,t,n){Vt(e)&&n.delete(t)}function Bt(){wt=!1,null!==Rt&&Vt(Rt)&&(Rt=null),null!==Ct&&Vt(Ct)&&(Ct=null),null!==Mt&&Vt(Mt)&&(Mt=null),kt.forEach(Ft),Nt.forEach(Ft)}function Ht(e,t){e.blockedOn===t&&(e.blockedOn=null,wt||(wt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Bt)))}function zt(e){function t(t){return Ht(t,e)}if(0<It.length){Ht(It[0],e);for(var n=1;n<It.length;n++){var i=It[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Rt&&Ht(Rt,e),null!==Ct&&Ht(Ct,e),null!==Mt&&Ht(Mt,e),kt.forEach(t),Nt.forEach(t),n=0;n<Dt.length;n++)(i=Dt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ut(n),null===n.blockedOn&&Dt.shift()}var jt=E.ReactCurrentBatchConfig,Gt=!0;function $t(e,t,n,i){var r=yt,o=jt.transition;jt.transition=null;try{yt=1,qt(e,t,n,i)}finally{yt=r,jt.transition=o}}function Wt(e,t,n,i){var r=yt,o=jt.transition;jt.transition=null;try{yt=4,qt(e,t,n,i)}finally{yt=r,jt.transition=o}}function qt(e,t,n,i){if(Gt){var r=Yt(e,t,n,i);if(null===r)Gi(e,t,i,Xt,n),Pt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Rt=Lt(Rt,e,t,n,i,r),!0;case"dragenter":return Ct=Lt(Ct,e,t,n,i,r),!0;case"mouseover":return Mt=Lt(Mt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return kt.set(o,Lt(kt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Nt.set(o,Lt(Nt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Pt(e,i),4&t&&-1<Ot.indexOf(e)){for(;null!==r;){var o=yr(r);if(null!==o&&bt(o),null===(o=Yt(e,t,n,i))&&Gi(e,t,i,Xt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Gi(e,t,i,null,n)}}var Xt=null;function Yt(e,t,n,i){if(Xt=null,null!==(e=vr(e=be(i))))if(null===(t=ze(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=je(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Kt=null,Qt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Qt,i=n.length,r="value"in Kt?Kt.value:Kt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[o-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),dn=U({},cn,{view:0,detail:0}),hn=on(dn),pn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),fn=on(pn),mn=on(U({},pn,{dataTransfer:0})),gn=on(U({},dn,{relatedTarget:0})),_n=on(U({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=U({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=on(vn),En=on(U({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function An(){return xn}var wn=U({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=on(wn),Rn=on(U({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=on(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),Mn=on(U({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=U({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nn=on(kn),Dn=[9,13,27,32],On=u&&"CompositionEvent"in window,Pn=null;u&&"documentMode"in document&&(Pn=document.documentMode);var Ln=u&&"TextEvent"in window&&!Pn,Un=u&&(!On||Pn&&8<Pn&&11>=Pn),Vn=String.fromCharCode(32),Fn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var zn=!1,jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!jn[e.type]:"textarea"===t}function $n(e,t,n,i){we(i),0<(t=Wi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Wn=null,qn=null;function Xn(e){Vi(e,0)}function Yn(e){if(q(Er(e)))return e}function Jn(e,t){if("change"===e)return t}var Kn=!1;if(u){var Qn;if(u){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"==typeof ei.oninput}Qn=Zn}else Qn=!1;Kn=Qn&&(!document.documentMode||9<document.documentMode)}function ti(){Wn&&(Wn.detachEvent("onpropertychange",ni),qn=Wn=null)}function ni(e){if("value"===e.propertyName&&Yn(qn)){var t=[];$n(t,qn,e,be(e)),ke(Xn,t)}}function ii(e,t,n){"focusin"===e?(ti(),qn=n,(Wn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(qn)}function oi(e,t){if("click"===e)return Yn(t)}function ai(e,t){if("input"===e||"change"===e)return Yn(t)}var si="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function li(e,t){if(si(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!d.call(t,r)||!si(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=ui(n,o);var a=ui(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,_i=null,vi=null,yi=!1;function Ei(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yi||null==gi||gi!==X(i)||(i="selectionStart"in(i=gi)&&pi(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&li(vi,i)||(vi=i,0<(i=Wi(_i,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Si={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Ti={},xi={};function Ai(e){if(Ti[e])return Ti[e];if(!Si[e])return e;var t,n=Si[e];for(t in n)if(n.hasOwnProperty(t)&&t in xi)return Ti[e]=n[t];return e}u&&(xi=document.createElement("div").style,"AnimationEvent"in window||(delete Si.animationend.animation,delete Si.animationiteration.animation,delete Si.animationstart.animation),"TransitionEvent"in window||delete Si.transitionend.transition);var wi=Ai("animationend"),Ii=Ai("animationiteration"),Ri=Ai("animationstart"),Ci=Ai("transitionend"),Mi=new Map,ki="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ni(e,t){Mi.set(e,t),l(t,[e])}for(var Di=0;Di<ki.length;Di++){var Oi=ki[Di];Ni(Oi.toLowerCase(),"on"+(Oi[0].toUpperCase()+Oi.slice(1)))}Ni(wi,"onAnimationEnd"),Ni(Ii,"onAnimationIteration"),Ni(Ri,"onAnimationStart"),Ni("dblclick","onDoubleClick"),Ni("focusin","onFocus"),Ni("focusout","onBlur"),Ni(Ci,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Li=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pi));function Ui(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,s,l,c){if(He.apply(this,arguments),Le){if(!Le)throw Error(o(198));var u=Ue;Le=!1,Ue=null,Ve||(Ve=!0,Fe=u)}}(i,t,void 0,e),e.currentTarget=null}function Vi(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==o&&r.isPropagationStopped())break e;Ui(r,s,c),o=l}else for(a=0;a<i.length;a++){if(l=(s=i[a]).instance,c=s.currentTarget,s=s.listener,l!==o&&r.isPropagationStopped())break e;Ui(r,s,c),o=l}}}if(Ve)throw e=Fe,Ve=!1,Fe=null,e}function Fi(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(ji(t,e,2,!1),n.add(i))}function Bi(e,t,n){var i=0;t&&(i|=4),ji(n,e,i,t)}var Hi="_reactListening"+Math.random().toString(36).slice(2);function zi(e){if(!e[Hi]){e[Hi]=!0,a.forEach((function(t){"selectionchange"!==t&&(Li.has(t)||Bi(t,!1,e),Bi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hi]||(t[Hi]=!0,Bi("selectionchange",!1,t))}}function ji(e,t,n,i){switch(Jt(t)){case 1:var r=$t;break;case 4:r=Wt;break;default:r=qt}n=r.bind(null,t,n,e),r=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Gi(e,t,n,i,r){var o=i;if(0==(1&t)&&0==(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==s;){if(null===(a=vr(s)))return;if(5===(l=a.tag)||6===l){i=o=a;continue e}s=s.parentNode}}i=i.return}ke((function(){var i=o,r=be(n),a=[];e:{var s=Mi.get(e);if(void 0!==s){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=In;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Cn;break;case wi:case Ii:case Ri:l=_n;break;case Ci:l=Mn;break;case"scroll":l=hn;break;case"wheel":l=Nn;break;case"copy":case"cut":case"paste":l=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var u=0!=(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&null!=(m=Ne(f,h))&&u.push($i(f,m,p))),d)break;f=f.return}0<u.length&&(s=new l(s,c,null,n,r),a.push({event:s,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Ee||!(c=n.relatedTarget||n.fromElement)||!vr(c)&&!c[fr])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?vr(c):null)&&(c!==(d=ze(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rn,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?s:Er(l),p=null==c?s:Er(c),(s=new u(m,f+"leave",l,n,r)).target=d,s.relatedTarget=p,m=null,vr(r)===i&&((u=new u(h,f+"enter",c,n,r)).target=p,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,f=0,p=u=l;p;p=qi(p))f++;for(p=0,m=h;m;m=qi(m))p++;for(;0<f-p;)u=qi(u),f--;for(;0<p-f;)h=qi(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=qi(u),h=qi(h)}u=null}else u=null;null!==l&&Xi(a,s,l,u,!1),null!==c&&null!==d&&Xi(a,d,c,u,!0)}if("select"===(l=(s=i?Er(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Jn;else if(Gn(s))if(Kn)g=ai;else{g=ri;var _=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=oi);switch(g&&(g=g(e,i))?$n(a,g,n,r):(_&&_(e,s,i),"focusout"===e&&(_=s._wrapperState)&&_.controlled&&"number"===s.type&&ee(s,"number",s.value)),_=i?Er(i):window,e){case"focusin":(Gn(_)||"true"===_.contentEditable)&&(gi=_,_i=i,vi=null);break;case"focusout":vi=_i=gi=null;break;case"mousedown":yi=!0;break;case"contextmenu":case"mouseup":case"dragend":yi=!1,Ei(a,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":Ei(a,n,r)}var v;if(On)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else zn?Bn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Un&&"ko"!==n.locale&&(zn||"onCompositionStart"!==y?"onCompositionEnd"===y&&zn&&(v=en()):(Qt="value"in(Kt=r)?Kt.value:Kt.textContent,zn=!0)),0<(_=Wi(i,y)).length&&(y=new En(y,e,null,n,r),a.push({event:y,listeners:_}),(v||null!==(v=Hn(n)))&&(y.data=v))),(v=Ln?function(e,t){switch(e){case"compositionend":return Hn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Vn);case"textInput":return(e=t.data)===Vn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(zn)return"compositionend"===e||!On&&Bn(e,t)?(e=en(),Zt=Qt=Kt=null,zn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(i=Wi(i,"onBeforeInput")).length&&(r=new En("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=v)}Vi(a,t)}))}function $i(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Ne(e,n))&&i.unshift($i(e,o,r)),null!=(o=Ne(e,t))&&i.push($i(e,o,r))),e=e.return}return i}function qi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xi(e,t,n,i,r){for(var o=t._reactName,a=[];null!==n&&n!==i;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,r?null!=(l=Ne(n,o))&&a.unshift($i(n,l,s)):r||null!=(l=Ne(n,o))&&a.push($i(n,l,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Yi=/\r\n?/g,Ji=/\u0000|\uFFFD/g;function Ki(e){return("string"==typeof e?e:""+e).replace(Yi,"\n").replace(Ji,"")}function Qi(e,t,n){if(t=Ki(t),Ki(e)!==t&&n)throw Error(o(425))}function Zi(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"==typeof setTimeout?setTimeout:void 0,rr="function"==typeof clearTimeout?clearTimeout:void 0,or="function"==typeof Promise?Promise:void 0,ar="function"==typeof queueMicrotask?queueMicrotask:void 0!==or?function(e){return or.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void zt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);zt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,pr="__reactProps$"+dr,fr="__reactContainer$"+dr,mr="__reactEvents$"+dr,gr="__reactListeners$"+dr,_r="__reactHandles$"+dr;function vr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[hr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function yr(e){return!(e=e[hr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Er(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function br(e){return e[pr]||null}var Sr=[],Tr=-1;function xr(e){return{current:e}}function Ar(e){0>Tr||(e.current=Sr[Tr],Sr[Tr]=null,Tr--)}function wr(e,t){Tr++,Sr[Tr]=e.current,e.current=t}var Ir={},Rr=xr(Ir),Cr=xr(!1),Mr=Ir;function kr(e,t){var n=e.type.contextTypes;if(!n)return Ir;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Nr(e){return null!=e.childContextTypes}function Dr(){Ar(Cr),Ar(Rr)}function Or(e,t,n){if(Rr.current!==Ir)throw Error(o(168));wr(Rr,t),wr(Cr,n)}function Pr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,j(e)||"Unknown",r));return U({},n,i)}function Lr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ir,Mr=Rr.current,wr(Rr,e),wr(Cr,Cr.current),!0}function Ur(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=Pr(e,t,Mr),i.__reactInternalMemoizedMergedChildContext=e,Ar(Cr),Ar(Rr),wr(Rr,e)):Ar(Cr),wr(Cr,n)}var Vr=null,Fr=!1,Br=!1;function Hr(e){null===Vr?Vr=[e]:Vr.push(e)}function zr(){if(!Br&&null!==Vr){Br=!0;var e=0,t=yt;try{var n=Vr;for(yt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Vr=null,Fr=!1}catch(t){throw null!==Vr&&(Vr=Vr.slice(e+1)),qe(Ze,zr),t}finally{yt=t,Br=!1}}return null}var jr=[],Gr=0,$r=null,Wr=0,qr=[],Xr=0,Yr=null,Jr=1,Kr="";function Qr(e,t){jr[Gr++]=Wr,jr[Gr++]=$r,$r=e,Wr=t}function Zr(e,t,n){qr[Xr++]=Jr,qr[Xr++]=Kr,qr[Xr++]=Yr,Yr=e;var i=Jr;e=Kr;var r=32-at(i)-1;i&=~(1<<r),n+=1;var o=32-at(t)+r;if(30<o){var a=r-r%5;o=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Jr=1<<32-at(t)+r|n<<r|i,Kr=o+e}else Jr=1<<o|n<<r|i,Kr=e}function eo(e){null!==e.return&&(Qr(e,1),Zr(e,1,0))}function to(e){for(;e===$r;)$r=jr[--Gr],jr[Gr]=null,Wr=jr[--Gr],jr[Gr]=null;for(;e===Yr;)Yr=qr[--Xr],qr[Xr]=null,Kr=qr[--Xr],qr[Xr]=null,Jr=qr[--Xr],qr[Xr]=null}var no=null,io=null,ro=!1,oo=null;function ao(e,t){var n=Nc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function so(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Jr,overflow:Kr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function lo(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function co(e){if(ro){var t=io;if(t){var n=t;if(!so(e,t)){if(lo(e))throw Error(o(418));t=cr(n.nextSibling);var i=no;t&&so(e,t)?ao(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(lo(e))throw po(),Error(o(418));for(;t;)ao(e,t),t=cr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?cr(e.stateNode.nextSibling):null;return!0}function po(){for(var e=io;e;)e=cr(e.nextSibling)}function fo(){io=no=null,ro=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=E.ReactCurrentBatchConfig;function _o(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var vo=xr(null),yo=null,Eo=null,bo=null;function So(){bo=Eo=yo=null}function To(e){var t=vo.current;Ar(vo),e._currentValue=t}function xo(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ao(e,t){yo=e,bo=Eo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(Es=!0),e.firstContext=null)}function wo(e){var t=e._currentValue;if(bo!==e)if(e={context:e,memoizedValue:t,next:null},null===Eo){if(null===yo)throw Error(o(308));Eo=e,yo.dependencies={lanes:0,firstContext:e}}else Eo=Eo.next=e;return t}var Io=null;function Ro(e){null===Io?Io=[e]:Io.push(e)}function Co(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ro(t)):(n.next=r.next,r.next=n),t.interleaved=n,Mo(e,i)}function Mo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ko=!1;function No(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Do(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Oo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Po(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!=(2&Cl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Mo(e,n)}return null===(r=i.interleaved)?(t.next=t,Ro(i)):(t.next=r.next,r.next=t),i.interleaved=t,Mo(e,n)}function Lo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Uo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Vo(e,t,n,i){var r=e.updateQueue;ko=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===a?o=c:a.next=c,a=l;var u=e.alternate;null!==u&&(s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l)}if(null!==o){var d=r.baseState;for(a=0,u=c=l=null,s=o;;){var h=s.lane,p=s.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=m.payload)?f.call(p,d,h):f))break e;d=U({},d,h);break e;case 2:ko=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,a|=h;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(h=s).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Ul|=a,e.lanes=a,e.memoizedState=d}}function Fo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error(o(191,r));r.call(i)}}}var Bo=(new i.Component).refs;function Ho(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var zo={isMounted:function(e){return!!(e=e._reactInternals)&&ze(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=Oo(i,r);o.payload=t,null!=n&&(o.callback=n),null!==(t=Po(e,o,r))&&(ic(t,e,r,i),Lo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=Oo(i,r);o.tag=1,o.payload=t,null!=n&&(o.callback=n),null!==(t=Po(e,o,r))&&(ic(t,e,r,i),Lo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),i=nc(e),r=Oo(n,i);r.tag=2,null!=t&&(r.callback=t),null!==(t=Po(e,r,i))&&(ic(t,e,i,n),Lo(t,e,i))}};function jo(e,t,n,i,r,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,a):!(t.prototype&&t.prototype.isPureReactComponent&&li(n,i)&&li(r,o))}function Go(e,t,n){var i=!1,r=Ir,o=t.contextType;return"object"==typeof o&&null!==o?o=wo(o):(r=Nr(t)?Mr:Rr.current,o=(i=null!=(i=t.contextTypes))?kr(e,r):Ir),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=zo,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function $o(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&zo.enqueueReplaceState(t,t.state,null)}function Wo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Bo,No(e);var o=t.contextType;"object"==typeof o&&null!==o?r.context=wo(o):(o=Nr(t)?Mr:Rr.current,r.context=kr(e,o)),r.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(Ho(e,t,o,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&zo.enqueueReplaceState(r,r.state,null),Vo(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function qo(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===Bo&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!=typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Xo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yo(e){return(0,e._init)(e._payload)}function Jo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Oc(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Vc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===T?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===N&&Yo(o)===t.type)?((i=r(t,n.props)).ref=qo(e,t,n),i.return=e,i):((i=Pc(n.type,n.key,n.props,null,e.mode,i)).ref=qo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,o){return null===t||7!==t.tag?((t=Lc(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Vc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Pc(t.type,t.key,t.props,null,e.mode,n)).ref=qo(e,null,t),n.return=e,n;case S:return(t=Fc(t,e.mode,n)).return=e,t;case N:return h(e,(0,t._init)(t._payload),n)}if(te(t)||P(t))return(t=Lc(t,e.mode,n,null)).return=e,t;Xo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:l(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?c(e,t,n,i):null;case S:return n.key===r?u(e,t,n,i):null;case N:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||P(n))return null!==r?null:d(e,t,n,i,null);Xo(e,n)}return null}function f(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case b:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case S:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case N:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||P(i))return d(t,e=e.get(n)||null,i,r,null);Xo(t,i)}return null}function m(r,o,s,l){for(var c=null,u=null,d=o,m=o=0,g=null;null!==d&&m<s.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var _=p(r,d,s[m],l);if(null===_){null===d&&(d=g);break}e&&d&&null===_.alternate&&t(r,d),o=a(_,o,m),null===u?c=_:u.sibling=_,u=_,d=g}if(m===s.length)return n(r,d),ro&&Qr(r,m),c;if(null===d){for(;m<s.length;m++)null!==(d=h(r,s[m],l))&&(o=a(d,o,m),null===u?c=d:u.sibling=d,u=d);return ro&&Qr(r,m),c}for(d=i(r,d);m<s.length;m++)null!==(g=f(d,r,m,s[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=a(g,o,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(r,e)})),ro&&Qr(r,m),c}function g(r,s,l,c){var u=P(l);if("function"!=typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var d=u=null,m=s,g=s=0,_=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var y=p(r,m,v.value,c);if(null===y){null===m&&(m=_);break}e&&m&&null===y.alternate&&t(r,m),s=a(y,s,g),null===d?u=y:d.sibling=y,d=y,m=_}if(v.done)return n(r,m),ro&&Qr(r,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=h(r,v.value,c))&&(s=a(v,s,g),null===d?u=v:d.sibling=v,d=v);return ro&&Qr(r,g),u}for(m=i(r,m);!v.done;g++,v=l.next())null!==(v=f(m,r,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),s=a(v,s,g),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach((function(e){return t(r,e)})),ro&&Qr(r,g),u}return function e(i,o,a,l){if("object"==typeof a&&null!==a&&a.type===T&&null===a.key&&(a=a.props.children),"object"==typeof a&&null!==a){switch(a.$$typeof){case b:e:{for(var c=a.key,u=o;null!==u;){if(u.key===c){if((c=a.type)===T){if(7===u.tag){n(i,u.sibling),(o=r(u,a.props.children)).return=i,i=o;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===N&&Yo(c)===u.type){n(i,u.sibling),(o=r(u,a.props)).ref=qo(i,u,a),o.return=i,i=o;break e}n(i,u);break}t(i,u),u=u.sibling}a.type===T?((o=Lc(a.props.children,i.mode,l,a.key)).return=i,i=o):((l=Pc(a.type,a.key,a.props,null,i.mode,l)).ref=qo(i,o,a),l.return=i,i=l)}return s(i);case S:e:{for(u=a.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){n(i,o.sibling),(o=r(o,a.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=Fc(a,i.mode,l)).return=i,i=o}return s(i);case N:return e(i,o,(u=a._init)(a._payload),l)}if(te(a))return m(i,o,a,l);if(P(a))return g(i,o,a,l);Xo(i,a)}return"string"==typeof a&&""!==a||"number"==typeof a?(a=""+a,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,a)).return=i,i=o):(n(i,o),(o=Vc(a,i.mode,l)).return=i,i=o),s(i)):n(i,o)}}var Ko=Jo(!0),Qo=Jo(!1),Zo={},ea=xr(Zo),ta=xr(Zo),na=xr(Zo);function ia(e){if(e===Zo)throw Error(o(174));return e}function ra(e,t){switch(wr(na,t),wr(ta,e),wr(ea,Zo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ar(ea),wr(ea,t)}function oa(){Ar(ea),Ar(ta),Ar(na)}function aa(e){ia(na.current);var t=ia(ea.current),n=le(t,e.type);t!==n&&(wr(ta,e),wr(ea,n))}function sa(e){ta.current===e&&(Ar(ea),Ar(ta))}var la=xr(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ua=[];function da(){for(var e=0;e<ua.length;e++)ua[e]._workInProgressVersionPrimary=null;ua.length=0}var ha=E.ReactCurrentDispatcher,pa=E.ReactCurrentBatchConfig,fa=0,ma=null,ga=null,_a=null,va=!1,ya=!1,Ea=0,ba=0;function Sa(){throw Error(o(321))}function Ta(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function xa(e,t,n,i,r,a){if(fa=a,ma=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ha.current=null===e||null===e.memoizedState?ss:ls,e=n(i,r),ya){a=0;do{if(ya=!1,Ea=0,25<=a)throw Error(o(301));a+=1,_a=ga=null,t.updateQueue=null,ha.current=cs,e=n(i,r)}while(ya)}if(ha.current=as,t=null!==ga&&null!==ga.next,fa=0,_a=ga=ma=null,va=!1,t)throw Error(o(300));return e}function Aa(){var e=0!==Ea;return Ea=0,e}function wa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===_a?ma.memoizedState=_a=e:_a=_a.next=e,_a}function Ia(){if(null===ga){var e=ma.alternate;e=null!==e?e.memoizedState:null}else e=ga.next;var t=null===_a?ma.memoizedState:_a.next;if(null!==t)_a=t,ga=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ga=e).memoizedState,baseState:ga.baseState,baseQueue:ga.baseQueue,queue:ga.queue,next:null},null===_a?ma.memoizedState=_a=e:_a=_a.next=e}return _a}function Ra(e,t){return"function"==typeof t?t(e):t}function Ca(e){var t=Ia(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=ga,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=s=null,c=null,u=a;do{var d=u.lane;if((fa&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,s=i):c=c.next=h,ma.lanes|=d,Ul|=d}u=u.next}while(null!==u&&u!==a);null===c?s=i:c.next=l,si(i,t.memoizedState)||(Es=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,ma.lanes|=a,Ul|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ma(e){var t=Ia(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);si(a,t.memoizedState)||(Es=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function ka(){}function Na(e,t){var n=ma,i=Ia(),r=t(),a=!si(i.memoizedState,r);if(a&&(i.memoizedState=r,Es=!0),i=i.queue,Ga(Pa.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==_a&&1&_a.memoizedState.tag){if(n.flags|=2048,Fa(9,Oa.bind(null,n,i,r,t),void 0,null),null===Ml)throw Error(o(349));0!=(30&fa)||Da(n,t,r)}return r}function Da(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Oa(e,t,n,i){t.value=n,t.getSnapshot=i,La(t)&&Ua(e)}function Pa(e,t,n){return n((function(){La(t)&&Ua(e)}))}function La(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(e){return!0}}function Ua(e){var t=Mo(e,1);null!==t&&ic(t,e,1,-1)}function Va(e){var t=wa();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,ma,e),[t.memoizedState,e]}function Fa(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ma.updateQueue)?(t={lastEffect:null,stores:null},ma.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ba(){return Ia().memoizedState}function Ha(e,t,n,i){var r=wa();ma.flags|=e,r.memoizedState=Fa(1|t,n,void 0,void 0===i?null:i)}function za(e,t,n,i){var r=Ia();i=void 0===i?null:i;var o=void 0;if(null!==ga){var a=ga.memoizedState;if(o=a.destroy,null!==i&&Ta(i,a.deps))return void(r.memoizedState=Fa(t,n,o,i))}ma.flags|=e,r.memoizedState=Fa(1|t,n,o,i)}function ja(e,t){return Ha(8390656,8,e,t)}function Ga(e,t){return za(2048,8,e,t)}function $a(e,t){return za(4,2,e,t)}function Wa(e,t){return za(4,4,e,t)}function qa(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xa(e,t,n){return n=null!=n?n.concat([e]):null,za(4,4,qa.bind(null,t,e),n)}function Ya(){}function Ja(e,t){var n=Ia();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ta(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ka(e,t){var n=Ia();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ta(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Qa(e,t,n){return 0==(21&fa)?(e.baseState&&(e.baseState=!1,Es=!0),e.memoizedState=n):(si(n,t)||(n=mt(),ma.lanes|=n,Ul|=n,e.baseState=!0),t)}function Za(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var i=pa.transition;pa.transition={};try{e(!1),t()}finally{yt=n,pa.transition=i}}function es(){return Ia().memoizedState}function ts(e,t,n){var i=nc(e);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},is(e)?rs(t,n):null!==(n=Co(e,t,n,i))&&(ic(n,e,i,tc()),os(n,t,i))}function ns(e,t,n){var i=nc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(is(e))rs(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,a)){var l=t.interleaved;return null===l?(r.next=r,Ro(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(e){}null!==(n=Co(e,t,r,i))&&(ic(n,e,i,r=tc()),os(n,t,i))}}function is(e){var t=e.alternate;return e===ma||null!==t&&t===ma}function rs(e,t){ya=va=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function os(e,t,n){if(0!=(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}var as={readContext:wo,useCallback:Sa,useContext:Sa,useEffect:Sa,useImperativeHandle:Sa,useInsertionEffect:Sa,useLayoutEffect:Sa,useMemo:Sa,useReducer:Sa,useRef:Sa,useState:Sa,useDebugValue:Sa,useDeferredValue:Sa,useTransition:Sa,useMutableSource:Sa,useSyncExternalStore:Sa,useId:Sa,unstable_isNewReconciler:!1},ss={readContext:wo,useCallback:function(e,t){return wa().memoizedState=[e,void 0===t?null:t],e},useContext:wo,useEffect:ja,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Ha(4194308,4,qa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ha(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ha(4,2,e,t)},useMemo:function(e,t){var n=wa();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=wa();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ts.bind(null,ma,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},wa().memoizedState=e},useState:Va,useDebugValue:Ya,useDeferredValue:function(e){return wa().memoizedState=e},useTransition:function(){var e=Va(!1),t=e[0];return e=Za.bind(null,e[1]),wa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ma,r=wa();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Ml)throw Error(o(349));0!=(30&fa)||Da(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,ja(Pa.bind(null,i,a,e),[e]),i.flags|=2048,Fa(9,Oa.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=wa(),t=Ml.identifierPrefix;if(ro){var n=Kr;t=":"+t+"R"+(n=(Jr&~(1<<32-at(Jr)-1)).toString(32)+n),0<(n=Ea++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ba++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ls={readContext:wo,useCallback:Ja,useContext:wo,useEffect:Ga,useImperativeHandle:Xa,useInsertionEffect:$a,useLayoutEffect:Wa,useMemo:Ka,useReducer:Ca,useRef:Ba,useState:function(){return Ca(Ra)},useDebugValue:Ya,useDeferredValue:function(e){return Qa(Ia(),ga.memoizedState,e)},useTransition:function(){return[Ca(Ra)[0],Ia().memoizedState]},useMutableSource:ka,useSyncExternalStore:Na,useId:es,unstable_isNewReconciler:!1},cs={readContext:wo,useCallback:Ja,useContext:wo,useEffect:Ga,useImperativeHandle:Xa,useInsertionEffect:$a,useLayoutEffect:Wa,useMemo:Ka,useReducer:Ma,useRef:Ba,useState:function(){return Ma(Ra)},useDebugValue:Ya,useDeferredValue:function(e){var t=Ia();return null===ga?t.memoizedState=e:Qa(t,ga.memoizedState,e)},useTransition:function(){return[Ma(Ra)[0],Ia().memoizedState]},useMutableSource:ka,useSyncExternalStore:Na,useId:es,unstable_isNewReconciler:!1};function us(e,t){try{var n="",i=t;do{n+=H(i),i=i.return}while(i);var r=n}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:r,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var ps="function"==typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Oo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){$l||($l=!0,Wl=i),hs(0,t)},n}function ms(e,t,n){(n=Oo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){hs(0,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!=typeof i&&(null===ql?ql=new Set([this]):ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function gs(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ps;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=wc.bind(null,e,t,n),t.then(e,e))}function _s(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,i,r){return 0==(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Oo(-1,1)).tag=2,Po(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ys=E.ReactCurrentOwner,Es=!1;function bs(e,t,n,i){t.child=null===e?Qo(t,null,n,i):Ko(t,e.child,n,i)}function Ss(e,t,n,i,r){n=n.render;var o=t.ref;return Ao(t,r),i=xa(e,t,n,i,o,r),n=Aa(),null===e||Es?(ro&&n&&eo(t),t.flags|=1,bs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,$s(e,t,r))}function Ts(e,t,n,i,r){if(null===e){var o=n.type;return"function"!=typeof o||Dc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Pc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,xs(e,t,o,i,r))}if(o=e.child,0==(e.lanes&r)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&e.ref===t.ref)return $s(e,t,r)}return t.flags|=1,(e=Oc(o,i)).ref=t.ref,e.return=t,t.child=e}function xs(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(li(o,i)&&e.ref===t.ref){if(Es=!1,t.pendingProps=i=o,0==(e.lanes&r))return t.lanes=e.lanes,$s(e,t,r);0!=(131072&e.flags)&&(Es=!0)}}return Is(e,t,n,i,r)}function As(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wr(Ol,Dl),Dl|=n;else{if(0==(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wr(Ol,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,wr(Ol,Dl),Dl|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,wr(Ol,Dl),Dl|=i;return bs(e,t,r,n),t.child}function ws(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Is(e,t,n,i,r){var o=Nr(n)?Mr:Rr.current;return o=kr(t,o),Ao(t,r),n=xa(e,t,n,i,o,r),i=Aa(),null===e||Es?(ro&&i&&eo(t),t.flags|=1,bs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,$s(e,t,r))}function Rs(e,t,n,i,r){if(Nr(n)){var o=!0;Lr(t)}else o=!1;if(Ao(t,r),null===t.stateNode)Gs(e,t),Go(t,n,i),Wo(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,c=n.contextType;c="object"==typeof c&&null!==c?wo(c):kr(t,c=Nr(n)?Mr:Rr.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate;d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==i||l!==c)&&$o(t,a,i,c),ko=!1;var h=t.memoizedState;a.state=h,Vo(t,i,a,r),l=t.memoizedState,s!==i||h!==l||Cr.current||ko?("function"==typeof u&&(Ho(t,n,u,i),l=t.memoizedState),(s=ko||jo(t,n,s,i,h,l,c))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=s):("function"==typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Do(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:_o(t.type,s),a.props=c,d=t.pendingProps,h=a.context,l="object"==typeof(l=n.contextType)&&null!==l?wo(l):kr(t,l=Nr(n)?Mr:Rr.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==d||h!==l)&&$o(t,a,i,l),ko=!1,h=t.memoizedState,a.state=h,Vo(t,i,a,r);var f=t.memoizedState;s!==d||h!==f||Cr.current||ko?("function"==typeof p&&(Ho(t,n,p,i),f=t.memoizedState),(c=ko||jo(t,n,c,i,h,f,l)||!1)?(u||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(i,f,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=l,i=c):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Cs(e,t,n,i,o,r)}function Cs(e,t,n,i,r,o){ws(e,t);var a=0!=(128&t.flags);if(!i&&!a)return r&&Ur(t,n,!1),$s(e,t,o);i=t.stateNode,ys.current=t;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=Ko(t,e.child,null,o),t.child=Ko(t,null,s,o)):bs(e,t,s,o),t.memoizedState=i.state,r&&Ur(t,n,!0),t.child}function Ms(e){var t=e.stateNode;t.pendingContext?Or(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Or(0,t.context,!1),ra(e,t.containerInfo)}function ks(e,t,n,i,r){return fo(),mo(r),t.flags|=256,bs(e,t,n,i),t.child}var Ns,Ds,Os,Ps,Ls={dehydrated:null,treeContext:null,retryLane:0};function Us(e){return{baseLanes:e,cachePool:null,transitions:null}}function Vs(e,t,n){var i,r=t.pendingProps,a=la.current,s=!1,l=0!=(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!=(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),wr(la,1&a),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,s?(r=t.mode,s=t.child,l={mode:"hidden",children:l},0==(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Uc(l,r,0,null),e=Lc(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Us(n),t.memoizedState=Ls,e):Fs(t,l));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,i=ds(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Uc({mode:"visible",children:i.children},r,0,null),(a=Lc(a,r,s,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!=(1&t.mode)&&Ko(t,e.child,null,s),t.child.memoizedState=Us(s),t.memoizedState=Ls,a);if(0==(1&t.mode))return Bs(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Bs(e,t,s,i=ds(a=Error(o(419)),i,void 0))}if(l=0!=(s&e.childLanes),Es||l){if(null!==(i=Ml)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!=(r&(i.suspendedLanes|s))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Mo(e,r),ic(i,e,r,-1))}return gc(),Bs(e,t,s,i=ds(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Rc.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,io=cr(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(qr[Xr++]=Jr,qr[Xr++]=Kr,qr[Xr++]=Yr,Jr=e.id,Kr=e.overflow,Yr=t),(t=Fs(t,i.children)).flags|=4096,t)}(e,t,l,r,i,a,n);if(s){s=r.fallback,l=t.mode,i=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0==(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Oc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==i?s=Oc(i,s):(s=Lc(s,l,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,l=null===(l=e.child.memoizedState)?Us(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Ls,r}return e=(s=e.child).sibling,r=Oc(s,{mode:"visible",children:r.children}),0==(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Fs(e,t){return(t=Uc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,i){return null!==i&&mo(i),Ko(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Hs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),xo(e.return,t,n)}function zs(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function js(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(bs(e,t,i.children,n),0!=(2&(i=la.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Hs(e,n,t);else if(19===e.tag)Hs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(wr(la,i),0==(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),zs(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ca(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}zs(t,!0,n,null,o);break;case"together":zs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $s(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ul|=t.lanes,0==(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Oc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Oc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ws(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function qs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xs(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(t),null;case 1:case 17:return Nr(t.type)&&Dr(),qs(t),null;case 3:return i=t.stateNode,oa(),Ar(Cr),Ar(Rr),da(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==oo&&(sc(oo),oo=null))),Ds(e,t),qs(t),null;case 5:sa(t);var r=ia(na.current);if(n=t.type,null!==e&&null!=t.stateNode)Os(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return qs(t),null}if(e=ia(ea.current),ho(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[hr]=t,i[pr]=a,e=0!=(1&t.mode),n){case"dialog":Fi("cancel",i),Fi("close",i);break;case"iframe":case"object":case"embed":Fi("load",i);break;case"video":case"audio":for(r=0;r<Pi.length;r++)Fi(Pi[r],i);break;case"source":Fi("error",i);break;case"img":case"image":case"link":Fi("error",i),Fi("load",i);break;case"details":Fi("toggle",i);break;case"input":J(i,a),Fi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Fi("invalid",i);break;case"textarea":re(i,a),Fi("invalid",i)}for(var l in ve(n,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"==typeof c?i.textContent!==c&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",c]):"number"==typeof c&&i.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fi("scroll",i)}switch(n){case"input":W(i),Z(i,a,!0);break;case"textarea":W(i),ae(i);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(i.onclick=Zi)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[hr]=t,e[pr]=i,Ns(e,t,!1,!1),t.stateNode=e;e:{switch(l=ye(n,i),n){case"dialog":Fi("cancel",e),Fi("close",e),r=i;break;case"iframe":case"object":case"embed":Fi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Pi.length;r++)Fi(Pi[r],e);r=i;break;case"source":Fi("error",e),r=i;break;case"img":case"image":case"link":Fi("error",e),Fi("load",e),r=i;break;case"details":Fi("toggle",e),r=i;break;case"input":J(e,i),r=Y(e,i),Fi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=U({},i,{value:void 0}),Fi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Fi("invalid",e)}for(a in ve(n,r),c=r)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"==typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"==typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Fi("scroll",e):null!=u&&y(e,a,u,l))}switch(n){case"input":W(e),Z(e,i,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+G(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof r.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qs(t),null;case 6:if(e&&null!=t.stateNode)Ps(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(o(166));if(n=ia(na.current),ia(ea.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(a=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Qi(i.nodeValue,n,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qi(i.nodeValue,n,0!=(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return qs(t),null;case 13:if(Ar(la),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!=(1&t.mode)&&0==(128&t.flags))po(),fo(),t.flags|=98560,a=!1;else if(a=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[hr]=t}else fo(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qs(t),a=!1}else null!==oo&&(sc(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!=(128&t.flags)?(t.lanes=n,t):((i=null!==i)!=(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!=(1&t.mode)&&(null===e||0!=(1&la.current)?0===Pl&&(Pl=3):gc())),null!==t.updateQueue&&(t.flags|=4),qs(t),null);case 4:return oa(),Ds(e,t),null===e&&zi(t.stateNode.containerInfo),qs(t),null;case 10:return To(t.type._context),qs(t),null;case 19:if(Ar(la),null===(a=t.memoizedState))return qs(t),null;if(i=0!=(128&t.flags),null===(l=a.rendering))if(i)Ws(a,!1);else{if(0!==Pl||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ca(e))){for(t.flags|=128,Ws(a,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return wr(la,1&la.current|2),t.child}e=e.sibling}null!==a.tail&&Ke()>jl&&(t.flags|=128,i=!0,Ws(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ca(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ws(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!ro)return qs(t),null}else 2*Ke()-a.renderingStartTime>jl&&1073741824!==n&&(t.flags|=128,i=!0,Ws(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ke(),t.sibling=null,n=la.current,wr(la,i?1&n|2:1&n),t):(qs(t),null);case 22:case 23:return hc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!=(1&t.mode)?0!=(1073741824&Dl)&&(qs(t),6&t.subtreeFlags&&(t.flags|=8192)):qs(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ys(e,t){switch(to(t),t.tag){case 1:return Nr(t.type)&&Dr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return oa(),Ar(Cr),Ar(Rr),da(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return sa(t),null;case 13:if(Ar(la),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ar(la),null;case 4:return oa(),null;case 10:return To(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Ns=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Os=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,ia(ea.current);var o,a=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),a=[];break;case"select":r=U({},r,{value:void 0}),i=U({},i,{value:void 0}),a=[];break;case"textarea":r=ie(e,r),i=ie(e,i),a=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(e.onclick=Zi)}for(u in ve(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fi("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Ps=function(e,t,n,i){n!==i&&(t.flags|=4)};var Js=!1,Ks=!1,Qs="function"==typeof WeakSet?WeakSet:Set,Zs=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Ac(e,t,n)}else n.current=null}function tl(e,t,n){try{n()}catch(n){Ac(e,t,n)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tl(t,n,o)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[mr],delete t[gr],delete t[_r]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var dl=null,hl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(ot&&"function"==typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(e){}switch(n.tag){case 5:Ks||el(n,t);case 6:var i=dl,r=hl;dl=null,pl(e,t,n),hl=r,null!==(dl=i)&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(hl?(e=dl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),zt(e)):lr(dl,n.stateNode));break;case 4:i=dl,r=hl,dl=n.stateNode.containerInfo,hl=!0,pl(e,t,n),dl=i,hl=r;break;case 0:case 11:case 14:case 15:if(!Ks&&null!==(i=n.updateQueue)&&null!==(i=i.lastEffect)){r=i=i.next;do{var o=r,a=o.destroy;o=o.tag,void 0!==a&&(0!=(2&o)||0!=(4&o))&&tl(n,t,a),r=r.next}while(r!==i)}pl(e,t,n);break;case 1:if(!Ks&&(el(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(e){Ac(n,t,e)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Ks=(i=Ks)||null!==n.memoizedState,pl(e,t,n),Ks=i):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qs),t.forEach((function(t){var i=Cc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,hl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,hl=!0;break e}l=l.return}if(null===dl)throw Error(o(160));fl(a,s,r),dl=null,hl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(e){Ac(r,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)_l(t,e),t=t.sibling}function _l(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),vl(e),4&i){try{il(3,e,e.return),rl(3,e)}catch(t){Ac(e,e.return,t)}try{il(5,e,e.return)}catch(t){Ac(e,e.return,t)}}break;case 1:gl(t,e),vl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(gl(t,e),vl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(t){Ac(e,e.return,t)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&K(r,a),ye(l,s);var u=ye(l,a);for(s=0;s<c.length;s+=2){var d=c[s],h=c[s+1];"style"===d?ge(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):y(r,d,h,u)}switch(l){case"input":Q(r,a);break;case"textarea":oe(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ne(r,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(t){Ac(e,e.return,t)}}break;case 6:if(gl(t,e),vl(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(t){Ac(e,e.return,t)}}break;case 3:if(gl(t,e),vl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{zt(t.containerInfo)}catch(t){Ac(e,e.return,t)}break;case 4:default:gl(t,e),vl(e);break;case 13:gl(t,e),vl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(zl=Ke())),4&i&&ml(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ks=(u=Ks)||d,gl(t,e),Ks=u):gl(t,e),vl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!=(1&e.mode))for(Zs=e,d=e.child;null!==d;){for(h=Zs=d;null!==Zs;){switch(f=(p=Zs).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){i=p,n=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){Ac(i,n,e)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(h);continue}}null!==f?(f.return=p,Zs=f):Sl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,u?"function"==typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,s=null!=(c=h.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",s))}catch(t){Ac(e,e.return,t)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(t){Ac(e,e.return,t)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gl(t,e),vl(e),4&i&&ml(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),ul(e,ll(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;cl(e,ll(e),a);break;default:throw Error(o(161))}}catch(t){Ac(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Zs=e,El(e,t,n)}function El(e,t,n){for(var i=0!=(1&e.mode);null!==Zs;){var r=Zs,o=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Js;if(!a){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Ks;s=Js;var c=Ks;if(Js=a,(Ks=l)&&!c)for(Zs=r;null!==Zs;)l=(a=Zs).child,22===a.tag&&null!==a.memoizedState?Tl(r):null!==l?(l.return=a,Zs=l):Tl(r);for(;null!==o;)Zs=o,El(o,t,n),o=o.sibling;Zs=r,Js=s,Ks=c}bl(e)}else 0!=(8772&r.subtreeFlags)&&null!==o?(o.return=r,Zs=o):bl(e)}}function bl(e){for(;null!==Zs;){var t=Zs;if(0!=(8772&t.flags)){var n=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ks||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ks)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:_o(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Fo(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Fo(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&zt(h)}}}break;default:throw Error(o(163))}Ks||512&t.flags&&ol(t)}catch(e){Ac(t,t.return,e)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function Sl(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function Tl(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(e){Ac(t,n,e)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(e){Ac(t,r,e)}}var o=t.return;try{ol(t)}catch(e){Ac(t,o,e)}break;case 5:var a=t.return;try{ol(t)}catch(e){Ac(t,a,e)}}}catch(e){Ac(t,t.return,e)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var xl,Al=Math.ceil,wl=E.ReactCurrentDispatcher,Il=E.ReactCurrentOwner,Rl=E.ReactCurrentBatchConfig,Cl=0,Ml=null,kl=null,Nl=0,Dl=0,Ol=xr(0),Pl=0,Ll=null,Ul=0,Vl=0,Fl=0,Bl=null,Hl=null,zl=0,jl=1/0,Gl=null,$l=!1,Wl=null,ql=null,Xl=!1,Yl=null,Jl=0,Kl=0,Ql=null,Zl=-1,ec=0;function tc(){return 0!=(6&Cl)?Ke():-1!==Zl?Zl:Zl=Ke()}function nc(e){return 0==(1&e.mode)?1:0!=(2&Cl)&&0!==Nl?Nl&-Nl:null!==go.transition?(0===ec&&(ec=mt()),ec):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function ic(e,t,n,i){if(50<Kl)throw Kl=0,Ql=null,Error(o(185));_t(e,n,i),0!=(2&Cl)&&e===Ml||(e===Ml&&(0==(2&Cl)&&(Vl|=n),4===Pl&&lc(e,Nl)),rc(e,i),1===n&&0===Cl&&0==(1&t.mode)&&(jl=Ke()+500,Fr&&zr()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,l=r[a];-1===l?0!=(s&n)&&0==(s&i)||(r[a]=pt(s,t)):l<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var i=ht(e,e===Ml?Nl:0);if(0===i)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Fr=!0,Hr(e)}(cc.bind(null,e)):Hr(cc.bind(null,e)),ar((function(){0==(6&Cl)&&zr()})),n=null;else{switch(Et(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Mc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Zl=-1,ec=0,0!=(6&Cl))throw Error(o(327));var n=e.callbackNode;if(Tc()&&e.callbackNode!==n)return null;var i=ht(e,e===Ml?Nl:0);if(0===i)return null;if(0!=(30&i)||0!=(i&e.expiredLanes)||t)t=_c(e,i);else{t=i;var r=Cl;Cl|=2;var a=mc();for(Ml===e&&Nl===t||(Gl=null,jl=Ke()+500,pc(e,t));;)try{yc();break}catch(t){fc(e,t)}So(),wl.current=a,Cl=r,null!==kl?t=0:(Ml=null,Nl=0,t=Pl)}if(0!==t){if(2===t&&0!==(r=ft(e))&&(i=r,t=ac(e,r)),1===t)throw n=Ll,pc(e,0),lc(e,i),rc(e,Ke()),n;if(6===t)lc(e,i);else{if(r=e.current.alternate,0==(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!si(o(),r))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=_c(e,i))&&0!==(a=ft(e))&&(i=a,t=ac(e,a)),1===t))throw n=Ll,pc(e,0),lc(e,i),rc(e,Ke()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:Sc(e,Hl,Gl);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=zl+500-Ke())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(Sc.bind(null,e,Hl,Gl),t);break}Sc(e,Hl,Gl);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-at(i);a=1<<s,(s=t[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Ke()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Al(i/1960))-i)){e.timeoutHandle=ir(Sc.bind(null,e,Hl,Gl),i);break}Sc(e,Hl,Gl);break;default:throw Error(o(329))}}}return rc(e,Ke()),e.callbackNode===n?oc.bind(null,e):null}function ac(e,t){var n=Bl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=_c(e,t))&&(t=Hl,Hl=n,null!==t&&sc(t)),e}function sc(e){null===Hl?Hl=e:Hl.push.apply(Hl,e)}function lc(e,t){for(t&=~Fl,t&=~Vl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function cc(e){if(0!=(6&Cl))throw Error(o(327));Tc();var t=ht(e,0);if(0==(1&t))return rc(e,Ke()),null;var n=_c(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=ac(e,i))}if(1===n)throw n=Ll,pc(e,0),lc(e,t),rc(e,Ke()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,Hl,Gl),rc(e,Ke()),null}function uc(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&(jl=Ke()+500,Fr&&zr())}}function dc(e){null!==Yl&&0===Yl.tag&&0==(6&Cl)&&Tc();var t=Cl;Cl|=1;var n=Rl.transition,i=yt;try{if(Rl.transition=null,yt=1,e)return e()}finally{yt=i,Rl.transition=n,0==(6&(Cl=t))&&zr()}}function hc(){Dl=Ol.current,Ar(Ol)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==kl)for(n=kl.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Dr();break;case 3:oa(),Ar(Cr),Ar(Rr),da();break;case 5:sa(i);break;case 4:oa();break;case 13:case 19:Ar(la);break;case 10:To(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Ml=e,kl=e=Oc(e.current,null),Nl=Dl=t,Pl=0,Ll=null,Fl=Vl=Ul=0,Hl=Bl=null,null!==Io){for(t=0;t<Io.length;t++)if(null!==(i=(n=Io[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var a=o.next;o.next=r,i.next=a}n.pending=i}Io=null}return e}function fc(e,t){for(;;){var n=kl;try{if(So(),ha.current=as,va){for(var i=ma.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}va=!1}if(fa=0,_a=ga=ma=null,ya=!1,Ea=0,Il.current=null,null===n||null===n.return){Pl=1,Ll=t,kl=null;break}e:{var a=e,s=n.return,l=n,c=t;if(t=Nl,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,h=d.tag;if(0==(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=_s(s);if(null!==f){f.flags&=-257,vs(f,s,l,0,t),1&f.mode&&gs(a,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0==(1&t)){gs(a,u,t),gc();break e}c=Error(o(426))}else if(ro&&1&l.mode){var _=_s(s);if(null!==_){0==(65536&_.flags)&&(_.flags|=256),vs(_,s,l,0,t),mo(us(c,l));break e}}a=c=us(c,l),4!==Pl&&(Pl=2),null===Bl?Bl=[a]:Bl.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Uo(a,fs(0,c,t));break e;case 1:l=c;var v=a.type,y=a.stateNode;if(0==(128&a.flags)&&("function"==typeof v.getDerivedStateFromError||null!==y&&"function"==typeof y.componentDidCatch&&(null===ql||!ql.has(y)))){a.flags|=65536,t&=-t,a.lanes|=t,Uo(a,ms(a,l,t));break e}}a=a.return}while(null!==a)}bc(n)}catch(e){t=e,kl===n&&null!==n&&(kl=n=n.return);continue}break}}function mc(){var e=wl.current;return wl.current=as,null===e?as:e}function gc(){0!==Pl&&3!==Pl&&2!==Pl||(Pl=4),null===Ml||0==(268435455&Ul)&&0==(268435455&Vl)||lc(Ml,Nl)}function _c(e,t){var n=Cl;Cl|=2;var i=mc();for(Ml===e&&Nl===t||(Gl=null,pc(e,t));;)try{vc();break}catch(t){fc(e,t)}if(So(),Cl=n,wl.current=i,null!==kl)throw Error(o(261));return Ml=null,Nl=0,Pl}function vc(){for(;null!==kl;)Ec(kl)}function yc(){for(;null!==kl&&!Ye();)Ec(kl)}function Ec(e){var t=xl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?bc(e):kl=t,Il.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(n=Xs(n,t,Dl)))return void(kl=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(kl=n);if(null===e)return Pl=6,void(kl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(kl=t);kl=t=e}while(null!==t);0===Pl&&(Pl=5)}function Sc(e,t,n){var i=yt,r=Rl.transition;try{Rl.transition=null,yt=1,function(e,t,n,i){do{Tc()}while(null!==Yl);if(0!=(6&Cl))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,a),e===Ml&&(kl=Ml=null,Nl=0),0==(2064&n.subtreeFlags)&&0==(2064&n.flags)||Xl||(Xl=!0,Mc(tt,(function(){return Tc(),null}))),a=0!=(15990&n.flags),0!=(15990&n.subtreeFlags)||a){a=Rl.transition,Rl.transition=null;var s=yt;yt=1;var l=Cl;Cl|=4,Il.current=null,function(e,t){if(er=Gt,pi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(e){n=null;break e}var s=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==r&&3!==h.nodeType||(l=s+r),h!==a||0!==i&&3!==h.nodeType||(c=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===r&&(l=s),p===a&&++d===i&&(c=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Gt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var m=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:_o(t.type,g),_);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(o(163))}}catch(e){Ac(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}m=nl,nl=!1}(e,n),_l(n,e),fi(tr),Gt=!!er,tr=er=null,e.current=n,yl(n,e,r),Je(),Cl=l,yt=s,Rl.transition=a}else e.current=n;if(Xl&&(Xl=!1,Yl=e,Jl=r),0===(a=e.pendingLanes)&&(ql=null),function(e){if(ot&&"function"==typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128==(128&e.current.flags))}catch(e){}}(n.stateNode),rc(e,Ke()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)i((r=t[n]).value,{componentStack:r.stack,digest:r.digest});if($l)throw $l=!1,e=Wl,Wl=null,e;0!=(1&Jl)&&0!==e.tag&&Tc(),0!=(1&(a=e.pendingLanes))?e===Ql?Kl++:(Kl=0,Ql=e):Kl=0,zr()}(e,t,n,i)}finally{Rl.transition=r,yt=i}return null}function Tc(){if(null!==Yl){var e=Et(Jl),t=Rl.transition,n=yt;try{if(Rl.transition=null,yt=16>e?16:e,null===Yl)var i=!1;else{if(e=Yl,Yl=null,Jl=0,0!=(6&Cl))throw Error(o(331));var r=Cl;for(Cl|=4,Zs=e.current;null!==Zs;){var a=Zs,s=a.child;if(0!=(16&Zs.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zs=u;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:il(8,d,a)}var h=d.child;if(null!==h)h.return=d,Zs=h;else for(;null!==Zs;){var p=(d=Zs).sibling,f=d.return;if(al(d),d===u){Zs=null;break}if(null!==p){p.return=f,Zs=p;break}Zs=f}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}Zs=a}}if(0!=(2064&a.subtreeFlags)&&null!==s)s.return=a,Zs=s;else e:for(;null!==Zs;){if(0!=(2048&(a=Zs).flags))switch(a.tag){case 0:case 11:case 15:il(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,Zs=v;break e}Zs=a.return}}var y=e.current;for(Zs=y;null!==Zs;){var E=(s=Zs).child;if(0!=(2064&s.subtreeFlags)&&null!==E)E.return=s,Zs=E;else e:for(s=y;null!==Zs;){if(0!=(2048&(l=Zs).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(e){Ac(l,l.return,e)}if(l===s){Zs=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Zs=b;break e}Zs=l.return}}if(Cl=r,zr(),ot&&"function"==typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(e){}i=!0}return i}finally{yt=n,Rl.transition=t}}return!1}function xc(e,t,n){e=Po(e,t=fs(0,t=us(n,t),1),1),t=tc(),null!==e&&(_t(e,1,t),rc(e,t))}function Ac(e,t,n){if(3===e.tag)xc(e,e,n);else for(;null!==t;){if(3===t.tag){xc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===ql||!ql.has(i))){t=Po(t,e=ms(t,e=us(n,e),1),1),e=tc(),null!==t&&(_t(t,1,e),rc(t,e));break}}t=t.return}}function wc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Ml===e&&(Nl&n)===n&&(4===Pl||3===Pl&&(130023424&Nl)===Nl&&500>Ke()-zl?pc(e,0):Fl|=n),rc(e,t)}function Ic(e,t){0===t&&(0==(1&e.mode)?t=1:(t=ut,0==(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=Mo(e,t))&&(_t(e,t,n),rc(e,n))}function Rc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ic(e,n)}function Cc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Ic(e,n)}function Mc(e,t){return qe(e,t)}function kc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,n,i){return new kc(e,t,n,i)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,t){var n=e.alternate;return null===n?((n=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Pc(e,t,n,i,r,a){var s=2;if(i=e,"function"==typeof e)Dc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case T:return Lc(n.children,r,a,t);case x:s=8,r|=8;break;case A:return(e=Nc(12,n,t,2|r)).elementType=A,e.lanes=a,e;case C:return(e=Nc(13,n,t,r)).elementType=C,e.lanes=a,e;case M:return(e=Nc(19,n,t,r)).elementType=M,e.lanes=a,e;case D:return Uc(n,r,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case w:s=10;break e;case I:s=9;break e;case R:s=11;break e;case k:s=14;break e;case N:s=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Nc(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Lc(e,t,n,i){return(e=Nc(7,e,i,t)).lanes=n,e}function Uc(e,t,n,i){return(e=Nc(22,e,i,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Vc(e,t,n){return(e=Nc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Hc(e,t,n,i,r,o,a,s,l){return e=new Bc(e,t,n,s,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Nc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},No(o),e}function zc(e){if(!e)return Ir;e:{if(ze(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Nr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Nr(n))return Pr(e,n,t)}return t}function jc(e,t,n,i,r,o,a,s,l){return(e=Hc(n,i,!0,e,0,o,0,s,l)).context=zc(null),n=e.current,(o=Oo(i=tc(),r=nc(n))).callback=null!=t?t:null,Po(n,o,r),e.current.lanes=r,_t(e,r,i),rc(e,i),e}function Gc(e,t,n,i){var r=t.current,o=tc(),a=nc(r);return n=zc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Oo(o,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Po(r,t,a))&&(ic(e,r,a,o),Lo(e,r,a)),a}function $c(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}xl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Cr.current)Es=!0;else{if(0==(e.lanes&n)&&0==(128&t.flags))return Es=!1,function(e,t,n){switch(t.tag){case 3:Ms(t),fo();break;case 5:aa(t);break;case 1:Nr(t.type)&&Lr(t);break;case 4:ra(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;wr(vo,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(wr(la,1&la.current),t.flags|=128,null):0!=(n&t.child.childLanes)?Vs(e,t,n):(wr(la,1&la.current),null!==(e=$s(e,t,n))?e.sibling:null);wr(la,1&la.current);break;case 19:if(i=0!=(n&t.childLanes),0!=(128&e.flags)){if(i)return js(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),wr(la,la.current),i)break;return null;case 22:case 23:return t.lanes=0,As(e,t,n)}return $s(e,t,n)}(e,t,n);Es=0!=(131072&e.flags)}else Es=!1,ro&&0!=(1048576&t.flags)&&Zr(t,Wr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Gs(e,t),e=t.pendingProps;var r=kr(t,Rr.current);Ao(t,n),r=xa(null,t,i,e,r,n);var a=Aa();return t.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Nr(i)?(a=!0,Lr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,No(t),r.updater=zo,t.stateNode=r,r._reactInternals=t,Wo(t,i,e,n),t=Cs(null,t,i,!0,a,n)):(t.tag=0,ro&&a&&eo(t),bs(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"==typeof e)return Dc(e)?1:0;if(null!=e){if((e=e.$$typeof)===R)return 11;if(e===k)return 14}return 2}(i),e=_o(i,e),r){case 0:t=Is(null,t,i,e,n);break e;case 1:t=Rs(null,t,i,e,n);break e;case 11:t=Ss(null,t,i,e,n);break e;case 14:t=Ts(null,t,i,_o(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Is(e,t,i,r=t.elementType===i?r:_o(i,r),n);case 1:return i=t.type,r=t.pendingProps,Rs(e,t,i,r=t.elementType===i?r:_o(i,r),n);case 3:e:{if(Ms(t),null===e)throw Error(o(387));i=t.pendingProps,r=(a=t.memoizedState).element,Do(e,t),Vo(t,i,null,n);var s=t.memoizedState;if(i=s.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=ks(e,t,i,n,r=us(Error(o(423)),t));break e}if(i!==r){t=ks(e,t,i,n,r=us(Error(o(424)),t));break e}for(io=cr(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=Qo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),i===r){t=$s(e,t,n);break e}bs(e,t,i,n)}t=t.child}return t;case 5:return aa(t),null===e&&co(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==a&&nr(i,a)&&(t.flags|=32),ws(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&co(t),null;case 13:return Vs(e,t,n);case 4:return ra(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ko(t,null,i,n):bs(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ss(e,t,i,r=t.elementType===i?r:_o(i,r),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,s=r.value,wr(vo,i._currentValue),i._currentValue=s,null!==a)if(si(a.value,s)){if(a.children===r.children&&!Cr.current){t=$s(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=Oo(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),xo(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),xo(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}bs(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Ao(t,n),i=i(r=wo(r)),t.flags|=1,bs(e,t,i,n),t.child;case 14:return r=_o(i=t.type,t.pendingProps),Ts(e,t,i,r=_o(i.type,r),n);case 15:return xs(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:_o(i,r),Gs(e,t),t.tag=1,Nr(i)?(e=!0,Lr(t)):e=!1,Ao(t,n),Go(t,i,r),Wo(t,i,r,n),Cs(null,t,i,!0,e,n);case 19:return js(e,t,n);case 22:return As(e,t,n)}throw Error(o(156,t.tag))};var Xc="function"==typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Jc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,n,i,r){var o=n._reactRootContainer;if(o){var a=o;if("function"==typeof r){var s=r;r=function(){var e=$c(a);s.call(e)}}Gc(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"==typeof i){var o=i;i=function(){var e=$c(a);o.call(e)}}var a=jc(t,i,e,0,null,!1,0,"",Zc);return e._reactRootContainer=a,e[fr]=a.current,zi(8===e.nodeType?e.parentNode:e),dc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof i){var s=i;i=function(){var e=$c(l);s.call(e)}}var l=Hc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[fr]=l.current,zi(8===e.nodeType?e.parentNode:e),dc((function(){Gc(t,l,n,i)})),l}(n,t,e,r,i);return $c(a)}Jc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Gc(e,t,null,null)},Jc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Gc(null,e,null,null)})),t[fr]=null}},Jc.prototype.unstable_scheduleHydration=function(e){if(e){var t=xt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ut(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),rc(t,Ke()),0==(6&Cl)&&(jl=Ke()+500,zr()))}break;case 13:dc((function(){var t=Mo(e,1);if(null!==t){var n=tc();ic(t,e,1,n)}})),qc(e,1)}},St=function(e){if(13===e.tag){var t=Mo(e,134217728);null!==t&&ic(t,e,134217728,tc()),qc(e,134217728)}},Tt=function(e){if(13===e.tag){var t=nc(e),n=Mo(e,t);null!==n&&ic(n,e,t,tc()),qc(e,t)}},xt=function(){return yt},At=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},Se=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(o(90));q(i),Q(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=uc,Ce=dc;var tu={usingClientEntryPoint:!1,Events:[yr,Er,br,we,Ie,uc]},nu={findFiberByHostInstance:vr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(iu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(o(299));var n=!1,i="",r=Xc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Hc(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,zi(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return null===(e=$e(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Qc(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",s=Xc;if(null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=jc(t,null,e,1,null!=n?n:null,r,0,a,s),e[fr]=t.current,zi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Jc(t)},t.render=function(e,t,n){if(!Qc(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(o(40));return!!e._reactRootContainer&&(dc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Qc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},745:(e,t,n)=>{"use strict";var i=n(935);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},935:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(448)},921:(e,t)=>{"use strict";var n="function"==typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,a=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=(n&&Symbol.for("react.suspense_list"),n?Symbol.for("react.memo"):60115),m=n?Symbol.for("react.lazy"):60116;n&&Symbol.for("react.block"),n&&Symbol.for("react.fundamental"),n&&Symbol.for("react.responder"),n&&Symbol.for("react.scope");function g(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case d:case o:case s:case a:case p:return e;default:switch(e=e&&e.$$typeof){case c:case h:case m:case f:case l:return e;default:return t}}case r:return t}}}t.isMemo=function(e){return g(e)===f}},864:(e,t,n)=>{"use strict";e.exports=n(921)},408:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator,f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function v(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=_.prototype;var E=y.prototype=new v;E.constructor=y,m(E,_.prototype),E.isPureReactComponent=!0;var b=Array.isArray,S=Object.prototype.hasOwnProperty,T={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,i){var r,o={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)S.call(t,r)&&!x.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:n,type:e,key:a,ref:s,props:o,_owner:T.current}}function w(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,r,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=e),e=""===o?"."+R(l,0):o,b(a)?(r="",null!=e&&(r=e.replace(I,"$&/")+"/"),C(a,t,r,"",(function(e){return e}))):null!=a&&(w(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+e)),t.push(a)),1;if(l=0,o=""===o?".":o+":",b(e))for(var c=0;c<e.length;c++){var u=o+R(s=e[c],c);l+=C(s,t,r,u,a)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=C(s=s.value,t,r,u=o+R(s,c++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function M(e,t,n){if(null==e)return e;var i=[],r=0;return C(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},D={transition:null},O={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:D,ReactCurrentOwner:T};t.Children={map:M,forEach:function(e,t,n){M(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return M(e,(function(){t++})),t},toArray:function(e){return M(e,(function(e){return e}))||[]},only:function(e){if(!w(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=r,t.Profiler=a,t.PureComponent=y,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,i){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=T.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!x.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:o,ref:a,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=w,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return N.current.useCallback(e,t)},t.useContext=function(e){return N.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return N.current.useDeferredValue(e)},t.useEffect=function(e,t){return N.current.useEffect(e,t)},t.useId=function(){return N.current.useId()},t.useImperativeHandle=function(e,t,n){return N.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return N.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return N.current.useMemo(e,t)},t.useReducer=function(e,t,n){return N.current.useReducer(e,t,n)},t.useRef=function(e){return N.current.useRef(e)},t.useState=function(e){return N.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return N.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return N.current.useTransition()},t.version="18.2.0"},294:(e,t,n)=>{"use strict";e.exports=n(408)},666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var o=t&&t.prototype instanceof _?t:_,a=Object.create(o.prototype),s=new M(i||[]);return r(a,"_invoke",{value:w(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function _(){}function v(){}function y(){}var E={};c(E,a,(function(){return this}));var b=Object.getPrototypeOf,S=b&&b(b(k([])));S&&S!==n&&i.call(S,a)&&(E=S);var T=y.prototype=_.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(r,o,a,s){var l=d(e[r],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var o;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return o=o?o.then(r,r):r()}})}function w(e,n,i){var r=h;return function(o,a){if(r===f)throw new Error("Generator is already running");if(r===m){if("throw"===o)throw a;return{value:t,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var l=I(s,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===h)throw r=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=f;var c=d(e,n,i);if("normal"===c.type){if(r=i.done?m:p,c.arg===g)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=m,i.method="throw",i.arg=c.arg)}}}function I(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,I(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var o=d(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function k(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return v.prototype=y,r(T,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:v,configurable:!0}),v.displayName=c(y,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},x(A.prototype),c(A.prototype,s,(function(){return this})),e.AsyncIterator=A,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new A(u(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(T),c(T,l,"Generator"),c(T,a,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=k,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return s.type="throw",s.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:k(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},53:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var s=2*(i+1)-1,l=e[s],c=s+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[s]=n,i=s);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,_="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function E(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function b(e){if(g=!1,E(e),!m)if(null!==i(c))m=!0,D(S);else{var t=i(u);null!==t&&O(b,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,v(w),w=-1),f=!0;var o=p;try{for(E(n),h=i(c);null!==h&&(!(h.expirationTime>n)||e&&!C());){var a=h.callback;if("function"==typeof a){h.callback=null,p=h.priorityLevel;var s=a(h.expirationTime<=n);n=t.unstable_now(),"function"==typeof s?h.callback=s:h===i(c)&&r(c),E(n)}else r(c);h=i(c)}if(null!==h)var l=!0;else{var d=i(u);null!==d&&O(b,d.startTime-n),l=!1}return l}finally{h=null,p=o,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,x=!1,A=null,w=-1,I=5,R=-1;function C(){return!(t.unstable_now()-R<I)}function M(){if(null!==A){var e=t.unstable_now();R=e;var n=!0;try{n=A(!0,e)}finally{n?T():(x=!1,A=null)}}else x=!1}if("function"==typeof y)T=function(){y(M)};else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,N=k.port2;k.port1.onmessage=M,T=function(){N.postMessage(null)}}else T=function(){_(M,0)};function D(e){A=e,x||(x=!0,T())}function O(e,n){w=_((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var a=t.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?a+o:a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(g?(v(w),w=-1):g=!0,O(b,o-a))):(e.sortIndex=s,n(c,e),m||f||(m=!0,D(S))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},840:(e,t,n)=>{"use strict";e.exports=n(53)},539:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let r=3;r<i.length;r++){const o=i[r],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const i=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===s&&(l=c[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&l&&(t.rtx={ssrc:l}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const o=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},379:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},a=[],s=0;s<e.length;s++){var l=e[s],c=i.base?l[0]+i.base:l[0],u=o[c]||0,d="".concat(c," ").concat(u);o[c]=u+1;var h=n(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var f=r(p,i);i.byIndex=s,t.splice(s,0,{identifier:d,updater:f,references:1})}a.push(d)}return a}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=i(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var l=i(e,r),c=0;c<o.length;c++){var u=n(o[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=l}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},854:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;module=__webpack_require__.nmd(module),function(undefined){"use strict";var modules,cache,entries,protobuf;modules={1:[function(e,t,n){t.exports=function(e,t){for(var n=new Array(arguments.length-1),i=0,r=2,o=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,a){n[i]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];r.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,a(e))}}))}},{}],2:[function(e,t,n){var i=n;i.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=new Array(64),o=new Array(123),a=0;a<64;)o[r[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;i.encode=function(e,t,n){for(var i,o=null,a=[],s=0,l=0;t<n;){var c=e[t++];switch(l){case 0:a[s++]=r[c>>2],i=(3&c)<<4,l=1;break;case 1:a[s++]=r[i|c>>4],i=(15&c)<<2,l=2;break;case 2:a[s++]=r[i|c>>6],a[s++]=r[63&c],l=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return l&&(a[s++]=r[i],a[s++]=61,1===l&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var s="invalid encoding";i.decode=function(e,t,n){for(var i,r=n,a=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&a>1)break;if((c=o[c])===undefined)throw Error(s);switch(a){case 0:i=c,a=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[n++]=(3&i)<<6|c,a=0}}if(1===a)throw Error(s);return n-r},i.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{}],3:[function(e,t,n){function i(e,t){"string"==typeof e&&(t=e,e=undefined);var n=[];function r(e){if("string"!=typeof e){var t=o();if(i.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),s=new Array(a.length+1),l=new Array(a.length),c=0;c<a.length;)s[c]=a[c],l[c]=e[a[c++]];return s[c]=t,Function.apply(null,s).apply(null,l)}return Function(t)()}for(var u=new Array(arguments.length-1),d=0;d<u.length;)u[d]=arguments[++d];if(d=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var n=u[d++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"})),d!==u.length)throw Error("parameter count mismatch");return n.push(e),r}function o(i){return"function "+(i||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return r.toString=o,r}t.exports=i,i.verbose=!1},{}],4:[function(e,t,n){function i(){this._listeners={}}t.exports=i,i.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},i.prototype.off=function(e,t){if(e===undefined)this._listeners={};else if(t===undefined)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},i.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}},{}],5:[function(e,t,n){t.exports=o;var i=e(1),r=e(7)("fs");function o(e,t,n){return"function"==typeof t?(n=t,t={}):t||(t={}),n?!t.xhr&&r&&r.readFile?r.readFile(e,(function(i,r){return i&&"undefined"!=typeof XMLHttpRequest?o.xhr(e,t,n):i?n(i):n(null,t.binary?r:r.toString("utf8"))})):o.xhr(e,t,n):i(o,this,e,t)}o.xhr=function(e,t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4!==i.readyState)return undefined;if(0!==i.status&&200!==i.status)return n(Error("status "+i.status));if(t.binary){var e=i.response;if(!e){e=[];for(var r=0;r<i.responseText.length;++r)e.push(255&i.responseText.charCodeAt(r))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,i.responseText)},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}},{1:1,7:7}],6:[function(e,t,n){function i(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=128===n[3];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3]}function o(e,i,r){t[0]=e,i[r]=n[3],i[r+1]=n[2],i[r+2]=n[1],i[r+3]=n[0]}function a(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],t[0]}function s(e,i){return n[3]=e[i],n[2]=e[i+1],n[1]=e[i+2],n[0]=e[i+3],t[0]}e.writeFloatLE=i?r:o,e.writeFloatBE=i?o:r,e.readFloatLE=i?a:s,e.readFloatBE=i?s:a}():function(){function t(e,t,n,i){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,n,i);else if(isNaN(t))e(2143289344,n,i);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,n,i);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,n,i);else{var o=Math.floor(Math.log(t)/Math.LN2);e((r<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,i)}}function n(e,t,n){var i=e(t,n),r=2*(i>>31)+1,o=i>>>23&255,a=8388607&i;return 255===o?a?NaN:r*(1/0):0===o?1401298464324817e-60*r*a:r*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,o),e.readFloatLE=n.bind(null,a),e.readFloatBE=n.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=128===n[7];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3],i[r+4]=n[4],i[r+5]=n[5],i[r+6]=n[6],i[r+7]=n[7]}function o(e,i,r){t[0]=e,i[r]=n[7],i[r+1]=n[6],i[r+2]=n[5],i[r+3]=n[4],i[r+4]=n[3],i[r+5]=n[2],i[r+6]=n[1],i[r+7]=n[0]}function a(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],n[4]=e[i+4],n[5]=e[i+5],n[6]=e[i+6],n[7]=e[i+7],t[0]}function s(e,i){return n[7]=e[i],n[6]=e[i+1],n[5]=e[i+2],n[4]=e[i+3],n[3]=e[i+4],n[2]=e[i+5],n[1]=e[i+6],n[0]=e[i+7],t[0]}e.writeDoubleLE=i?r:o,e.writeDoubleBE=i?o:r,e.readDoubleLE=i?a:s,e.readDoubleBE=i?s:a}():function(){function t(e,t,n,i,r,o){var a=i<0?1:0;if(a&&(i=-i),0===i)e(0,r,o+t),e(1/i>0?0:2147483648,r,o+n);else if(isNaN(i))e(0,r,o+t),e(2146959360,r,o+n);else if(i>17976931348623157e292)e(0,r,o+t),e((a<<31|2146435072)>>>0,r,o+n);else{var s;if(i<22250738585072014e-324)e((s=i/5e-324)>>>0,r,o+t),e((a<<31|s/4294967296)>>>0,r,o+n);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(s=i*Math.pow(2,-l))>>>0,r,o+t),e((a<<31|l+1023<<20|1048576*s&1048575)>>>0,r,o+n)}}}function n(e,t,n,i,r){var o=e(i,r+t),a=e(i,r+n),s=2*(a>>31)+1,l=a>>>20&2047,c=4294967296*(1048575&a)+o;return 2047===l?c?NaN:s*(1/0):0===l?5e-324*s*c:s*Math.pow(2,l-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=n.bind(null,a,0,4),e.readDoubleBE=n.bind(null,s,4,0)}(),e}function r(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function o(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=i(i)},{}],7:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},{}],8:[function(e,t,n){var i=n,r=i.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},o=i.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=r(e),i="";n&&(i=t.shift()+"/");for(var o=0;o<t.length;)".."===t[o]?o>0&&".."!==t[o-1]?t.splice(--o,2):n?t.splice(o,1):++o:"."===t[o]?t.splice(o,1):++o;return i+t.join("/")};i.resolve=function(e,t,n){return n||(t=o(t)),r(t)?t:(n||(e=o(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?o(e+"/"+t):t)}},{}],9:[function(e,t,n){t.exports=function(e,t,n){var i=n||8192,r=i>>>1,o=null,a=i;return function(n){if(n<1||n>r)return e(n);a+n>i&&(o=e(i),a=0);var s=t.call(o,a,a+=n);return 7&a&&(a=1+(7|a)),s}}},{}],10:[function(e,t,n){var i=n;i.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)(n=e.charCodeAt(i))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},i.read=function(e,t,n){if(n-t<1)return"";for(var i,r=null,o=[],a=0;t<n;)(i=e[t++])<128?o[a++]=i:i>191&&i<224?o[a++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),a=0);return r?(a&&r.push(String.fromCharCode.apply(String,o.slice(0,a))),r.join("")):String.fromCharCode.apply(String,o.slice(0,a))},i.write=function(e,t,n){for(var i,r,o=n,a=0;a<e.length;++a)(i=e.charCodeAt(a))<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(r=e.charCodeAt(a+1)))?(i=65536+((1023&i)<<10)+(1023&r),++a,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-o}},{}],11:[function(e,t,n){t.exports=o;var i,r=/\/|\./;function o(e,t){r.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),o[e]=t}o("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),o("duration",{Duration:i={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),o("timestamp",{Timestamp:i}),o("empty",{Empty:{fields:{}}}),o("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),o("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),o("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),o.get=function(e){return o[e]||null}},{}],12:[function(e,t,n){var i=n,r=e(15),o=e(37);function a(e,t,n,i){var o=!1;if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(d%s){",i);for(var a=t.resolvedType.values,s=Object.keys(a),l=0;l<s.length;++l)a[s[l]]!==t.typeDefault||o||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',i,i,i),t.repeated||e("break"),o=!0),e("case%j:",s[l])("case %i:",a[s[l]])("m%s=%j",i,a[s[l]])("break");e("}")}else e('if(typeof d%s!=="object")',i)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,n,i);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",i,i);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,c)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length >= 0)",i)("m%s=d%s",i,i);break;case"string":e("m%s=String(d%s)",i,i);break;case"bool":e("m%s=Boolean(d%s)",i,i)}}return e}function s(e,t,n,i){if(t.resolvedType)t.resolvedType instanceof r?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",i,n,i,i,n,i,i):e("d%s=types[%i].toObject(m%s,o)",i,n,i);else{var o=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,o?"true":"",i);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:e("d%s=m%s",i,i)}}return e}i.fromObject=function(e){var t=e.fieldsArray,n=o.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),l=o.safeProp(s.name);s.map?(n("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(n,s,i,l+"[ks[i]]")("}")("}")):s.repeated?(n("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(n,s,i,l+"[i]")("}")("}")):(s.resolvedType instanceof r||n("if(d%s!=null){",l),a(n,s,i,l),s.resolvedType instanceof r||n("}"))}return n("return m")},i.toObject=function(e){var t=e.fieldsArray.slice().sort(o.compareFieldsById);if(!t.length)return o.codegen()("return {}");for(var n=o.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],a=[],l=[],c=0;c<t.length;++c)t[c].partOf||(t[c].resolve().repeated?i:t[c].map?a:l).push(t[c]);if(i.length){for(n("if(o.arrays||o.defaults){"),c=0;c<i.length;++c)n("d%s=[]",o.safeProp(i[c].name));n("}")}if(a.length){for(n("if(o.objects||o.defaults){"),c=0;c<a.length;++c)n("d%s={}",o.safeProp(a[c].name));n("}")}if(l.length){for(n("if(o.defaults){"),c=0;c<l.length;++c){var u=l[c],d=o.safeProp(u.name);if(u.resolvedType instanceof r)n("d%s=o.enums===String?%j:%j",d,u.resolvedType.valuesById[u.typeDefault],u.typeDefault);else if(u.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",u.typeDefault.low,u.typeDefault.high,u.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,u.typeDefault.toString(),u.typeDefault.toNumber());else if(u.bytes){var h="["+Array.prototype.slice.call(u.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,u.typeDefault))("else{")("d%s=%s",d,h)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else n("d%s=%j",d,u.typeDefault)}n("}")}var p=!1;for(c=0;c<t.length;++c){u=t[c];var f=e._fieldsArray.indexOf(u);d=o.safeProp(u.name),u.map?(p||(p=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),s(n,u,f,d+"[ks2[j]]")("}")):u.repeated?(n("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),s(n,u,f,d+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",d,u.name),s(n,u,f,d),u.partOf&&n("if(o.oneofs)")("d%s=%j",o.safeProp(u.partOf.name),u.name)),n("}")}return n("return d")}},{15:15,37:37}],13:[function(e,t,n){t.exports=function(e){var t=o.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var s=e._fieldsArray[n].resolve(),l=s.resolvedType instanceof i?"int32":s.type,c="m"+o.safeProp(s.name);t("case %i: {",s.id),s.map?(t("if(%s===util.emptyObject)",c)("%s={}",c)("var c2 = r.uint32()+r.pos"),r.defaults[s.keyType]!==undefined?t("k=%j",r.defaults[s.keyType]):t("k=null"),r.defaults[l]!==undefined?t("value=%j",r.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",s.keyType)("case 2:"),r.basic[l]===undefined?t("value=types[%i].decode(r,r.uint32())",n):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),r.long[s.keyType]!==undefined?t('%s[typeof k==="object"?util.longToHash(k):k]=value',c):t("%s[k]=value",c)):s.repeated?(t("if(!(%s&&%s.length))",c,c)("%s=[]",c),r.packed[l]!==undefined&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",c,l)("}else"),r.basic[l]===undefined?t(s.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",c,n):t("%s.push(r.%s())",c,l)):r.basic[l]===undefined?t(s.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",c,n):t("%s=r.%s()",c,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var u=e._fieldsArray[n];u.required&&t("if(!m.hasOwnProperty(%j))",u.name)("throw util.ProtocolError(%j,{instance:m})",a(u))}return t("return m")};var i=e(15),r=e(36),o=e(37);function a(e){return"missing required '"+e.name+"'"}},{15:15,36:36,37:37}],14:[function(e,t,n){t.exports=function(e){for(var t,n=o.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),s=e.fieldsArray.slice().sort(o.compareFieldsById),l=0;l<s.length;++l){var c=s[l].resolve(),u=e._fieldsArray.indexOf(c),d=c.resolvedType instanceof i?"int32":c.type,h=r.basic[d];t="m"+o.safeProp(c.name),c.map?(n("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,c.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(c.id<<3|2)>>>0,8|r.mapKey[c.keyType],c.keyType),h===undefined?n("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",u,t):n(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|h,d,t),n("}")("}")):c.repeated?(n("if(%s!=null&&%s.length){",t,t),c.packed&&r.packed[d]!==undefined?n("w.uint32(%i).fork()",(c.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",d,t)("w.ldelim()"):(n("for(var i=0;i<%s.length;++i)",t),h===undefined?a(n,c,u,t+"[i]"):n("w.uint32(%i).%s(%s[i])",(c.id<<3|h)>>>0,d,t)),n("}")):(c.optional&&n("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,c.name),h===undefined?a(n,c,u,t):n("w.uint32(%i).%s(%s)",(c.id<<3|h)>>>0,d,t))}return n("return w")};var i=e(15),r=e(36),o=e(37);function a(e,t,n,i){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,i,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,i,(t.id<<3|2)>>>0)}},{15:15,36:36,37:37}],15:[function(e,t,n){t.exports=a;var i=e(24);((a.prototype=Object.create(i.prototype)).constructor=a).className="Enum";var r=e(23),o=e(37);function a(e,t,n,r,o,a){if(i.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=o||{},this.valuesOptions=a,this.reserved=undefined,t)for(var s=Object.keys(t),l=0;l<s.length;++l)"number"==typeof t[s[l]]&&(this.valuesById[this.values[s[l]]=t[s[l]]]=s[l])}a.fromJSON=function(e,t){var n=new a(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"comment",t?this.comment:undefined,"comments",t?this.comments:undefined])},a.prototype.add=function(e,t,n,i){if(!o.isString(e))throw TypeError("name must be a string");if(!o.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==undefined)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==undefined){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===undefined&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=n||null,this},a.prototype.remove=function(e){if(!o.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)}},{23:23,24:24,37:37}],16:[function(e,t,n){t.exports=c;var i=e(24);((c.prototype=Object.create(i.prototype)).constructor=c).className="Field";var r,o=e(15),a=e(36),s=e(37),l=/^required|optional|repeated$/;function c(e,t,n,r,o,c,u){if(s.isObject(r)?(u=o,c=r,r=o=undefined):s.isObject(o)&&(u=c,c=o,o=undefined),i.call(this,e,c),!s.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!s.isString(n))throw TypeError("type must be a string");if(r!==undefined&&!l.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(o!==undefined&&!s.isString(o))throw TypeError("extend must be a string");"proto3_optional"===r&&(r="optional"),this.rule=r&&"optional"!==r?r:undefined,this.type=n,this.id=t,this.extend=o||undefined,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!s.Long&&a.long[n]!==undefined,this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=u}c.fromJSON=function(e,t){return new c(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(c.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),c.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),i.prototype.setOption.call(this,e,t,n)},c.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return s.toObject(["rule","optional"!==this.rule&&this.rule||undefined,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:undefined])},c.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=a.defaults[this.type])===undefined?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(this.options.packed===undefined||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=undefined)),this.long)this.typeDefault=s.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;s.base64.test(this.typeDefault)?s.base64.decode(this.typeDefault,e=s.newBuffer(s.base64.length(this.typeDefault)),0):s.utf8.write(this.typeDefault,e=s.newBuffer(s.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=s.emptyObject:this.repeated?this.defaultValue=s.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},c.d=function(e,t,n,i){return"function"==typeof t?t=s.decorateType(t).name:t&&"object"==typeof t&&(t=s.decorateEnum(t).name),function(r,o){s.decorateType(r.constructor).add(new c(o,e,t,n,{default:i}))}},c._configure=function(e){r=e}},{15:15,24:24,36:36,37:37}],17:[function(e,t,n){var i=t.exports=e(18);i.build="light",i.load=function(e,t,n){return"function"==typeof t?(n=t,t=new i.Root):t||(t=new i.Root),t.load(e,n)},i.loadSync=function(e,t){return t||(t=new i.Root),t.loadSync(e)},i.encoder=e(14),i.decoder=e(13),i.verifier=e(40),i.converter=e(12),i.ReflectionObject=e(24),i.Namespace=e(23),i.Root=e(29),i.Enum=e(15),i.Type=e(35),i.Field=e(16),i.OneOf=e(25),i.MapField=e(20),i.Service=e(33),i.Method=e(22),i.Message=e(21),i.wrappers=e(41),i.types=e(36),i.util=e(37),i.ReflectionObject._configure(i.Root),i.Namespace._configure(i.Type,i.Service,i.Enum),i.Root._configure(i.Type),i.Field._configure(i.Type)},{12:12,13:13,14:14,15:15,16:16,18:18,20:20,21:21,22:22,23:23,24:24,25:25,29:29,33:33,35:35,36:36,37:37,40:40,41:41}],18:[function(e,t,n){var i=n;function r(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}i.build="minimal",i.Writer=e(42),i.BufferWriter=e(43),i.Reader=e(27),i.BufferReader=e(28),i.util=e(39),i.rpc=e(31),i.roots=e(30),i.configure=r,r()},{27:27,28:28,30:30,31:31,39:39,42:42,43:43}],19:[function(e,t,n){var i=t.exports=e(17);i.build="full",i.tokenize=e(34),i.parse=e(26),i.common=e(11),i.Root._configure(i.Type,i.parse,i.common)},{11:11,17:17,26:26,34:34}],20:[function(e,t,n){t.exports=a;var i=e(16);((a.prototype=Object.create(i.prototype)).constructor=a).className="MapField";var r=e(36),o=e(37);function a(e,t,n,r,a,s){if(i.call(this,e,t,r,undefined,undefined,a,s),!o.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:undefined])},a.prototype.resolve=function(){if(this.resolved)return this;if(r.mapKey[this.keyType]===undefined)throw Error("invalid key type: "+this.keyType);return i.prototype.resolve.call(this)},a.d=function(e,t,n){return"function"==typeof n?n=o.decorateType(n).name:n&&"object"==typeof n&&(n=o.decorateEnum(n).name),function(i,r){o.decorateType(i.constructor).add(new a(r,e,t,n))}}},{16:16,36:36,37:37}],21:[function(e,t,n){t.exports=r;var i=e(39);function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}r.create=function(e){return this.$type.create(e)},r.encode=function(e,t){return this.$type.encode(e,t)},r.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},r.decode=function(e){return this.$type.decode(e)},r.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},r.verify=function(e){return this.$type.verify(e)},r.fromObject=function(e){return this.$type.fromObject(e)},r.toObject=function(e,t){return this.$type.toObject(e,t)},r.prototype.toJSON=function(){return this.$type.toObject(this,i.toJSONOptions)}},{39:39}],22:[function(e,t,n){t.exports=o;var i=e(24);((o.prototype=Object.create(i.prototype)).constructor=o).className="Method";var r=e(37);function o(e,t,n,o,a,s,l,c,u){if(r.isObject(a)?(l=a,a=s=undefined):r.isObject(s)&&(l=s,s=undefined),t!==undefined&&!r.isString(t))throw TypeError("type must be a string");if(!r.isString(n))throw TypeError("requestType must be a string");if(!r.isString(o))throw TypeError("responseType must be a string");i.call(this,e,l),this.type=t||"rpc",this.requestType=n,this.requestStream=!!a||undefined,this.responseType=o,this.responseStream=!!s||undefined,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=c,this.parsedOptions=u}o.fromJSON=function(e,t){return new o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return r.toObject(["type","rpc"!==this.type&&this.type||undefined,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:undefined,"parsedOptions",this.parsedOptions])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),i.prototype.resolve.call(this))}},{24:24,37:37}],23:[function(e,t,n){t.exports=d;var i=e(24);((d.prototype=Object.create(i.prototype)).constructor=d).className="Namespace";var r,o,a,s=e(16),l=e(37),c=e(25);function u(e,t){if(!e||!e.length)return undefined;for(var n={},i=0;i<e.length;++i)n[e[i].name]=e[i].toJSON(t);return n}function d(e,t){i.call(this,e,t),this.nested=undefined,this._nestedArray=null}function h(e){return e._nestedArray=null,e}d.fromJSON=function(e,t){return new d(e,t.options).addJSON(t.nested)},d.arrayToJSON=u,d.isReservedId=function(e,t){if(e)for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0;return!1},d.isReservedName=function(e,t){if(e)for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1},Object.defineProperty(d.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),d.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},d.prototype.addJSON=function(e){if(e)for(var t,n=Object.keys(e),i=0;i<n.length;++i)t=e[n[i]],this.add((t.fields!==undefined?r.fromJSON:t.values!==undefined?a.fromJSON:t.methods!==undefined?o.fromJSON:t.id!==undefined?s.fromJSON:d.fromJSON)(n[i],t));return this},d.prototype.get=function(e){return this.nested&&this.nested[e]||null},d.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof a)return this.nested[e].values;throw Error("no such enum: "+e)},d.prototype.add=function(e){if(!(e instanceof s&&e.extend!==undefined||e instanceof r||e instanceof c||e instanceof a||e instanceof o||e instanceof d))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof d&&e instanceof d)||t instanceof r||t instanceof o)throw Error("duplicate name '"+e.name+"' in "+this);for(var n=t.nestedArray,i=0;i<n.length;++i)e.add(n[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),h(this)},d.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=undefined),e.onRemove(this),h(this)},d.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var i=e.shift();if(n.nested&&n.nested[i]){if(!((n=n.nested[i])instanceof d))throw Error("path conflicts with non-namespace objects")}else n.add(n=new d(i))}return t&&n.addJSON(t),n},d.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof d?e[t++].resolveAll():e[t++].resolve();return this.resolve()},d.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=undefined):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(1===e.length){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof d&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var r=0;r<this.nestedArray.length;++r)if(this._nestedArray[r]instanceof d&&(i=this._nestedArray[r].lookup(e,t,!0)))return i;return null===this.parent||n?null:this.parent.lookup(e,t)},d.prototype.lookupType=function(e){var t=this.lookup(e,[r]);if(!t)throw Error("no such type: "+e);return t},d.prototype.lookupEnum=function(e){var t=this.lookup(e,[a]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},d.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[r,a]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},d.prototype.lookupService=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},d._configure=function(e,t,n){r=e,o=t,a=n}},{16:16,24:24,25:25,37:37}],24:[function(e,t,n){t.exports=o,o.className="ReflectionObject";var i,r=e(37);function o(e,t){if(!r.isString(e))throw TypeError("name must be a string");if(t&&!r.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},o.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},o.prototype.getOption=function(e){return this.options?this.options[e]:undefined},o.prototype.setOption=function(e,t,n){return n&&this.options&&this.options[e]!==undefined||((this.options||(this.options={}))[e]=t),this},o.prototype.setParsedOption=function(e,t,n){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(n){var o=i.find((function(t){return Object.prototype.hasOwnProperty.call(t,e)}));if(o){var a=o[e];r.setProperty(a,n,t)}else(o={})[e]=r.setProperty({},n,t),i.push(o)}else{var s={};s[e]=t,i.push(s)}return this},o.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),i=0;i<n.length;++i)this.setOption(n[i],e[n[i]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o._configure=function(e){i=e}},{37:37}],25:[function(e,t,n){t.exports=a;var i=e(24);((a.prototype=Object.create(i.prototype)).constructor=a).className="OneOf";var r=e(16),o=e(37);function a(e,t,n,r){if(Array.isArray(t)||(n=t,t=undefined),i.call(this,e,n),t!==undefined&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=r}function s(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:undefined])},a.prototype.add=function(e){if(!(e instanceof r))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,s(this),this},a.prototype.remove=function(e){if(!(e instanceof r))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){i.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var n=e.get(this.oneof[t]);n&&!n.partOf&&(n.partOf=this,this.fieldsArray.push(n))}s(this)},a.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);i.prototype.onRemove.call(this,e)},a.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){o.decorateType(t.constructor).add(new a(n,e)),Object.defineProperty(t,n,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},{16:16,24:24,37:37}],26:[function(e,t,n){t.exports=x,x.filename=null,x.defaults={keepCase:!1};var i=e(34),r=e(29),o=e(35),a=e(16),s=e(20),l=e(25),c=e(15),u=e(33),d=e(22),h=e(36),p=e(37),f=/^[1-9][0-9]*$/,m=/^-?[1-9][0-9]*$/,g=/^0[x][0-9a-fA-F]+$/,_=/^-?0[x][0-9a-fA-F]+$/,v=/^0[0-7]+$/,y=/^-?0[0-7]+$/,E=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,b=/^[a-zA-Z_][a-zA-Z_0-9]*$/,S=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,T=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function x(e,t,n){t instanceof r||(n=t,t=new r),n||(n=x.defaults);var A,w,I,R,C,M=n.preferTrailingComment||!1,k=i(e,n.alternateCommentMode||!1),N=k.next,D=k.push,O=k.peek,P=k.skip,L=k.cmnt,U=!0,V=!1,F=t,B=n.keepCase?function(e){return e}:p.camelCase;function H(e,t,n){var i=x.filename;return n||(x.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(i?i+", ":"")+"line "+k.line+")")}function z(){var e,t=[];do{if('"'!==(e=N())&&"'"!==e)throw H(e);t.push(N()),P(e),e=O()}while('"'===e||"'"===e);return t.join("")}function j(e){var t=N();switch(t){case"'":case'"':return D(t),z();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(e,t){var n=1;switch("-"===e.charAt(0)&&(n=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return n*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(f.test(e))return n*parseInt(e,10);if(g.test(e))return n*parseInt(e,16);if(v.test(e))return n*parseInt(e,8);if(E.test(e))return n*parseFloat(e);throw H(e,"number",!0)}(t)}catch(n){if(e&&S.test(t))return t;throw H(t,"value")}}function G(e,t){var n,i;do{!t||'"'!==(n=O())&&"'"!==n?e.push([i=$(N()),P("to",!0)?$(N()):i]):e.push(z())}while(P(",",!0));P(";")}function $(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw H(e,"id");if(m.test(e))return parseInt(e,10);if(_.test(e))return parseInt(e,16);if(y.test(e))return parseInt(e,8);throw H(e,"id")}function W(){if(A!==undefined)throw H("package");if(A=N(),!S.test(A))throw H(A,"name");F=F.define(A),P(";")}function q(){var e,t=O();switch(t){case"weak":e=I||(I=[]),N();break;case"public":N();default:e=w||(w=[])}t=z(),P(";"),e.push(t)}function X(){if(P("="),R=z(),!(V="proto3"===R)&&"proto2"!==R)throw H(R,"syntax");P(";")}function Y(e,t){switch(t){case"option":return ee(e,t),P(";"),!0;case"message":return K(e,t),!0;case"enum":return Z(e,t),!0;case"service":return function(e,t){if(!b.test(t=N()))throw H(t,"service name");var n=new u(t);J(n,(function(e){if(!Y(n,e)){if("rpc"!==e)throw H(e);!function(e,t){var n=L(),i=t;if(!b.test(t=N()))throw H(t,"name");var r,o,a,s,l=t;if(P("("),P("stream",!0)&&(o=!0),!S.test(t=N()))throw H(t);if(r=t,P(")"),P("returns"),P("("),P("stream",!0)&&(s=!0),!S.test(t=N()))throw H(t);a=t,P(")");var c=new d(l,i,r,a,o,s);c.comment=n,J(c,(function(e){if("option"!==e)throw H(e);ee(c,e),P(";")})),e.add(c)}(n,e)}})),e.add(n)}(e,t),!0;case"extend":return function(e,t){if(!S.test(t=N()))throw H(t,"reference");var n=t;J(null,(function(t){switch(t){case"required":case"repeated":Q(e,t,n);break;case"optional":Q(e,V?"proto3_optional":"optional",n);break;default:if(!V||!S.test(t))throw H(t);D(t),Q(e,"optional",n)}}))}(e,t),!0}return!1}function J(e,t,n){var i=k.line;if(e&&("string"!=typeof e.comment&&(e.comment=L()),e.filename=x.filename),P("{",!0)){for(var r;"}"!==(r=N());)t(r);P(";",!0)}else n&&n(),P(";"),e&&("string"!=typeof e.comment||M)&&(e.comment=L(i)||e.comment)}function K(e,t){if(!b.test(t=N()))throw H(t,"type name");var n=new o(t);J(n,(function(e){if(!Y(n,e))switch(e){case"map":!function(e){P("<");var t=N();if(h.mapKey[t]===undefined)throw H(t,"type");P(",");var n=N();if(!S.test(n))throw H(n,"type");P(">");var i=N();if(!b.test(i))throw H(i,"name");P("=");var r=new s(B(i),$(N()),t,n);J(r,(function(e){if("option"!==e)throw H(e);ee(r,e),P(";")}),(function(){ie(r)})),e.add(r)}(n);break;case"required":case"repeated":Q(n,e);break;case"optional":Q(n,V?"proto3_optional":"optional");break;case"oneof":!function(e,t){if(!b.test(t=N()))throw H(t,"name");var n=new l(B(t));J(n,(function(e){"option"===e?(ee(n,e),P(";")):(D(e),Q(n,"optional"))})),e.add(n)}(n,e);break;case"extensions":G(n.extensions||(n.extensions=[]));break;case"reserved":G(n.reserved||(n.reserved=[]),!0);break;default:if(!V||!S.test(e))throw H(e);D(e),Q(n,"optional")}})),e.add(n)}function Q(e,t,n){var i=N();if("group"!==i){for(;i.endsWith(".")||O().startsWith(".");)i+=N();if(!S.test(i))throw H(i,"type");var r=N();if(!b.test(r))throw H(r,"name");r=B(r),P("=");var s=new a(r,$(N()),i,t,n);if(J(s,(function(e){if("option"!==e)throw H(e);ee(s,e),P(";")}),(function(){ie(s)})),"proto3_optional"===t){var c=new l("_"+r);s.setOption("proto3_optional",!0),c.add(s),e.add(c)}else e.add(s);V||!s.repeated||h.packed[i]===undefined&&h.basic[i]!==undefined||s.setOption("packed",!1,!0)}else!function(e,t){var n=N();if(!b.test(n))throw H(n,"name");var i=p.lcFirst(n);n===i&&(n=p.ucFirst(n)),P("=");var r=$(N()),s=new o(n);s.group=!0;var l=new a(i,r,n,t);l.filename=x.filename,J(s,(function(e){switch(e){case"option":ee(s,e),P(";");break;case"required":case"repeated":Q(s,e);break;case"optional":Q(s,V?"proto3_optional":"optional");break;case"message":K(s,e);break;case"enum":Z(s,e);break;default:throw H(e)}})),e.add(s).add(l)}(e,t)}function Z(e,t){if(!b.test(t=N()))throw H(t,"name");var n=new c(t);J(n,(function(e){switch(e){case"option":ee(n,e),P(";");break;case"reserved":G(n.reserved||(n.reserved=[]),!0);break;default:!function(e,t){if(!b.test(t))throw H(t,"name");P("=");var n=$(N(),!0),i={options:undefined,setOption:function(e,t){this.options===undefined&&(this.options={}),this.options[e]=t}};J(i,(function(e){if("option"!==e)throw H(e);ee(i,e),P(";")}),(function(){ie(i)})),e.add(t,n,i.comment,i.options)}(n,e)}})),e.add(n)}function ee(e,t){var n=P("(",!0);if(!S.test(t=N()))throw H(t,"name");var i,r=t,o=r;n&&(P(")"),o=r="("+r+")",t=O(),T.test(t)&&(i=t.slice(1),r+=t,N())),P("="),function(e,t,n,i){e.setParsedOption&&e.setParsedOption(t,n,i)}(e,o,te(e,r),i)}function te(e,t){if(P("{",!0)){for(var n={};!P("}",!0);){if(!b.test(C=N()))throw H(C,"name");if(null===C)throw H(C,"end of input");var i,r=C;if(P(":",!0),"{"===O())i=te(e,t+"."+C);else if("["===O()){var o;if(i=[],P("[",!0)){do{o=j(!0),i.push(o)}while(P(",",!0));P("]"),void 0!==o&&ne(e,t+"."+C,o)}}else i=j(!0),ne(e,t+"."+C,i);var a=n[r];a&&(i=[].concat(a).concat(i)),n[r]=i,P(",",!0),P(";",!0)}return n}var s=j(!0);return ne(e,t,s),s}function ne(e,t,n){e.setOption&&e.setOption(t,n)}function ie(e){if(P("[",!0)){do{ee(e,"option")}while(P(",",!0));P("]")}return e}for(;null!==(C=N());)switch(C){case"package":if(!U)throw H(C);W();break;case"import":if(!U)throw H(C);q();break;case"syntax":if(!U)throw H(C);X();break;case"option":ee(F,C),P(";");break;default:if(Y(F,C)){U=!1;continue}throw H(C)}return x.filename=null,{package:A,imports:w,weakImports:I,syntax:R,root:t}}},{15:15,16:16,20:20,22:22,25:25,29:29,33:33,34:34,35:35,36:36,37:37}],27:[function(e,t,n){t.exports=l;var i,r=e(39),o=r.LongBits,a=r.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c,u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},d=function(){return r.Buffer?function(e){return(l.create=function(e){return r.Buffer.isBuffer(e)?new i(e):u(e)})(e)}:u};function h(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw s(this,8);return new o(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}l.create=d(),l.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,l.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return c}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return p(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|p(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,n);if(t===n){var i=r.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){i=e,l.create=d(),i._configure();var t=r.Long?"toLong":"toNumber";r.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},{39:39}],28:[function(e,t,n){t.exports=o;var i=e(27);(o.prototype=Object.create(i.prototype)).constructor=o;var r=e(39);function o(e){i.call(this,e)}o._configure=function(){r.Buffer&&(o.prototype._slice=r.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},{27:27,39:39}],29:[function(e,t,n){t.exports=d;var i=e(23);((d.prototype=Object.create(i.prototype)).constructor=d).className="Root";var r,o,a,s=e(16),l=e(15),c=e(25),u=e(37);function d(e){i.call(this,"",e),this.deferred=[],this.files=[]}function h(){}d.fromJSON=function(e,t){return t||(t=new d),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},d.prototype.resolvePath=u.path.resolve,d.prototype.fetch=u.fetch,d.prototype.load=function e(t,n,i){"function"==typeof n&&(i=n,n=undefined);var r=this;if(!i)return u.asPromise(e,r,t,n);var s=i===h;function l(e,t){if(i){if(s)throw e;var n=i;i=null,n(e,t)}}function c(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in a)return n}return null}function d(e,t){try{if(u.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),u.isString(t)){o.filename=e;var i,a=o(t,r,n),d=0;if(a.imports)for(;d<a.imports.length;++d)(i=c(a.imports[d])||r.resolvePath(e,a.imports[d]))&&p(i);if(a.weakImports)for(d=0;d<a.weakImports.length;++d)(i=c(a.weakImports[d])||r.resolvePath(e,a.weakImports[d]))&&p(i,!0)}else r.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}s||f||l(null,r)}function p(e,t){if(e=c(e)||e,!(r.files.indexOf(e)>-1))if(r.files.push(e),e in a)s?d(e,a[e]):(++f,setTimeout((function(){--f,d(e,a[e])})));else if(s){var n;try{n=u.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||l(e))}d(e,n)}else++f,r.fetch(e,(function(n,o){--f,i&&(n?t?f||l(null,r):l(n):d(e,o))}))}var f=0;u.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=r.resolvePath("",t[g]))&&p(m);return s?r:(f||l(null,r),undefined)},d.prototype.loadSync=function(e,t){if(!u.isNode)throw Error("not supported");return this.load(e,t,h)},d.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return i.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function f(e,t){var n=t.parent.lookup(t.extend);if(n){var i=new s(t.fullName,t.id,t.type,t.rule,undefined,t.options);return n.get(i.name)||(i.declaringField=t,t.extensionField=i,n.add(i)),!0}return!1}d.prototype._handleAdd=function(e){if(e instanceof s)e.extend===undefined||e.extensionField||f(0,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof c)){if(e instanceof r)for(var t=0;t<this.deferred.length;)f(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);p.test(e.name)&&(e.parent[e.name]=e)}},d.prototype._handleRemove=function(e){if(e instanceof s){if(e.extend!==undefined)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof i){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);p.test(e.name)&&delete e.parent[e.name]}},d._configure=function(e,t,n){r=e,o=t,a=n}},{15:15,16:16,23:23,25:25,37:37}],30:[function(e,t,n){t.exports={}},{}],31:[function(e,t,n){n.Service=e(32)},{32:32}],32:[function(e,t,n){t.exports=r;var i=e(39);function r(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(r.prototype=Object.create(i.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function e(t,n,r,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return i.asPromise(e,s,t,n,r,o);if(!s.rpcImpl)return setTimeout((function(){a(Error("already ended"))}),0),undefined;try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,n){if(e)return s.emit("error",e,t),a(e);if(null===n)return s.end(!0),undefined;if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",n,t),a(null,n)}))}catch(e){return s.emit("error",e,t),setTimeout((function(){a(e)}),0),undefined}},r.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{39:39}],33:[function(e,t,n){t.exports=s;var i=e(23);((s.prototype=Object.create(i.prototype)).constructor=s).className="Service";var r=e(22),o=e(37),a=e(31);function s(e,t){i.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}s.fromJSON=function(e,t){var n=new s(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),o=0;o<i.length;++o)n.add(r.fromJSON(i[o],t.methods[i[o]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},s.prototype.toJSON=function(e){var t=i.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return o.toObject(["options",t&&t.options||undefined,"methods",i.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||undefined,"comment",n?this.comment:undefined])},Object.defineProperty(s.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=o.toArray(this.methods))}}),s.prototype.get=function(e){return this.methods[e]||i.prototype.get.call(this,e)},s.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return i.prototype.resolve.call(this)},s.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof r?(this.methods[e.name]=e,e.parent=this,l(this)):i.prototype.add.call(this,e)},s.prototype.remove=function(e){if(e instanceof r){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return i.prototype.remove.call(this,e)},s.prototype.create=function(e,t,n){for(var i,r=new a.Service(e,t,n),s=0;s<this.methodsArray.length;++s){var l=o.lcFirst((i=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");r[l]=o.codegen(["r","c"],o.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:i,q:i.resolvedRequestType.ctor,s:i.resolvedResponseType.ctor})}return r}},{22:22,23:23,31:31,37:37}],34:[function(e,t,n){t.exports=p;var i=/[\s{}=;:[\],'"()<>]/g,r=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,o=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,s=/^\s*\*?\/*/,l=/\n/g,c=/\s/,u=/\\(.?)/g,d={0:"\0",r:"\r",n:"\n",t:"\t"};function h(e){return e.replace(u,(function(e,t){switch(t){case"\\":case"":return t;default:return d[t]||""}}))}function p(e,t){e=e.toString();var n=0,u=e.length,d=1,p=0,f={},m=[],g=null;function _(e){return Error("illegal "+e+" (line "+d+")")}function v(t){return e.charAt(t)}function y(n,i,r){var o,c={type:e.charAt(n++),lineEmpty:!1,leading:r},u=n-(t?2:3);do{if(--u<0||"\n"===(o=e.charAt(u))){c.lineEmpty=!0;break}}while(" "===o||"\t"===o);for(var h=e.substring(n,i).split(l),m=0;m<h.length;++m)h[m]=h[m].replace(t?s:a,"").trim();c.text=h.join("\n").trim(),f[d]=c,p=d}function E(t){var n=b(t),i=e.substring(t,n);return/^\s*\/\//.test(i)}function b(e){for(var t=e;t<u&&"\n"!==v(t);)t++;return t}function S(){if(m.length>0)return m.shift();if(g)return function(){var t="'"===g?o:r;t.lastIndex=n-1;var i=t.exec(e);if(!i)throw _("string");return n=t.lastIndex,T(g),g=null,h(i[1])}();var a,s,l,p,f,S=0===n;do{if(n===u)return null;for(a=!1;c.test(l=v(n));)if("\n"===l&&(S=!0,++d),++n===u)return null;if("/"===v(n)){if(++n===u)throw _("comment");if("/"===v(n))if(t){if(p=n,f=!1,E(n-1)){f=!0;do{if((n=b(n))===u)break;if(n++,!S)break}while(E(n))}else n=Math.min(u,b(n)+1);f&&(y(p,n,S),S=!0),d++,a=!0}else{for(f="/"===v(p=n+1);"\n"!==v(++n);)if(n===u)return null;++n,f&&(y(p,n-1,S),S=!0),++d,a=!0}else{if("*"!==(l=v(n)))return"/";p=n+1,f=t||"*"===v(p);do{if("\n"===l&&++d,++n===u)throw _("comment");s=l,l=v(n)}while("*"!==s||"/"!==l);++n,f&&(y(p,n-2,S),S=!0),a=!0}}}while(a);var x=n;if(i.lastIndex=0,!i.test(v(x++)))for(;x<u&&!i.test(v(x));)++x;var A=e.substring(n,n=x);return'"'!==A&&"'"!==A||(g=A),A}function T(e){m.push(e)}function x(){if(!m.length){var e=S();if(null===e)return null;T(e)}return m[0]}return Object.defineProperty({next:S,peek:x,push:T,skip:function(e,t){var n=x();if(n===e)return S(),!0;if(!t)throw _("token '"+n+"', '"+e+"' expected");return!1},cmnt:function(e){var n,i=null;return e===undefined?(n=f[d-1],delete f[d-1],n&&(t||"*"===n.type||n.lineEmpty)&&(i=n.leading?n.text:null)):(p<e&&x(),n=f[e],delete f[e],!n||n.lineEmpty||!t&&"/"!==n.type||(i=n.leading?null:n.text)),i}},"line",{get:function(){return d}})}p.unescape=h},{}],35:[function(e,t,n){t.exports=v;var i=e(23);((v.prototype=Object.create(i.prototype)).constructor=v).className="Type";var r=e(15),o=e(25),a=e(16),s=e(20),l=e(33),c=e(21),u=e(27),d=e(42),h=e(37),p=e(14),f=e(13),m=e(40),g=e(12),_=e(41);function v(e,t){i.call(this,e,t),this.fields={},this.oneofs=undefined,this.extensions=undefined,this.reserved=undefined,this.group=undefined,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function y(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],i=n.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=h.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=h.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof c||((e.prototype=new c).constructor=e,h.merge(e.prototype,t)),e.$type=e.prototype.$type=this,h.merge(e,c,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var i={};for(n=0;n<this.oneofsArray.length;++n)i[this._oneofsArray[n].resolve().name]={get:h.oneOfGetter(this._oneofsArray[n].oneof),set:h.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,i)}}}),v.generateConstructor=function(e){for(var t,n=h.codegen(["p"],e.name),i=0;i<e.fieldsArray.length;++i)(t=e._fieldsArray[i]).map?n("this%s={}",h.safeProp(t.name)):t.repeated&&n("this%s=[]",h.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var n=new v(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var c=Object.keys(t.fields),u=0;u<c.length;++u)n.add((void 0!==t.fields[c[u]].keyType?s.fromJSON:a.fromJSON)(c[u],t.fields[c[u]]));if(t.oneofs)for(c=Object.keys(t.oneofs),u=0;u<c.length;++u)n.add(o.fromJSON(c[u],t.oneofs[c[u]]));if(t.nested)for(c=Object.keys(t.nested),u=0;u<c.length;++u){var d=t.nested[c[u]];n.add((d.id!==undefined?a.fromJSON:d.fields!==undefined?v.fromJSON:d.values!==undefined?r.fromJSON:d.methods!==undefined?l.fromJSON:i.fromJSON)(c[u],d))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},v.prototype.toJSON=function(e){var t=i.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return h.toObject(["options",t&&t.options||undefined,"oneofs",i.arrayToJSON(this.oneofsArray,e),"fields",i.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:undefined,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"group",this.group||undefined,"nested",t&&t.nested||undefined,"comment",n?this.comment:undefined])},v.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return i.prototype.resolveAll.call(this)},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&e.extend===undefined){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),y(this)}return e instanceof o?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),y(this)):i.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&e.extend===undefined){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),y(this)}if(e instanceof o){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),y(this)}return i.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=p(this)({Writer:d,types:t,util:h}),this.decode=f(this)({Reader:u,types:t,util:h}),this.verify=m(this)({types:t,util:h}),this.fromObject=g.fromObject(this)({types:t,util:h}),this.toObject=g.toObject(this)({types:t,util:h});var i=_[e];if(i){var r=Object.create(this);r.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(r),r.toObject=this.toObject,this.toObject=i.toObject.bind(r)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof u||(e=u.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){h.decorateType(t,e)}}},{12:12,13:13,14:14,15:15,16:16,20:20,21:21,23:23,25:25,27:27,33:33,37:37,40:40,41:41,42:42}],36:[function(e,t,n){var i=n,r=e(37),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var n=0,i={};for(t|=0;n<e.length;)i[o[n+t]]=e[n++];return i}i.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),i.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",r.emptyArray,null]),i.long=a([0,0,0,1,1],7),i.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),i.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},{37:37}],37:[function(e,t,n){var i,r,o=t.exports=e(39),a=e(30);o.codegen=e(3),o.fetch=e(5),o.path=e(8),o.fs=o.inquire("fs"),o.toArray=function(e){if(e){for(var t=Object.keys(e),n=new Array(t.length),i=0;i<t.length;)n[i]=e[t[i++]];return n}return[]},o.toObject=function(e){for(var t={},n=0;n<e.length;){var i=e[n++],r=e[n++];r!==undefined&&(t[i]=r)}return t};var s=/\\/g,l=/"/g;o.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},o.safeProp=function(e){return!/^[$\w_]+$/.test(e)||o.isReserved(e)?'["'+e.replace(s,"\\\\").replace(l,'\\"')+'"]':"."+e},o.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var c=/_([a-z])/g;o.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(c,(function(e,t){return t.toUpperCase()}))},o.compareFieldsById=function(e,t){return e.id-t.id},o.decorateType=function(t,n){if(t.$type)return n&&t.$type.name!==n&&(o.decorateRoot.remove(t.$type),t.$type.name=n,o.decorateRoot.add(t.$type)),t.$type;i||(i=e(35));var r=new i(n||t.name);return o.decorateRoot.add(r),r.ctor=t,Object.defineProperty(t,"$type",{value:r,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:r,enumerable:!1}),r};var u=0;o.decorateEnum=function(t){if(t.$type)return t.$type;r||(r=e(15));var n=new r("Enum"+u++,t);return o.decorateRoot.add(n),Object.defineProperty(t,"$type",{value:n,enumerable:!1}),n},o.setProperty=function(e,t,n){if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,n,i){var r=n.shift();if("__proto__"===r||"prototype"===r)return t;if(n.length>0)t[r]=e(t[r]||{},n,i);else{var o=t[r];o&&(i=[].concat(o).concat(i)),t[r]=i}return t}(e,t=t.split("."),n)},Object.defineProperty(o,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e(29)))}})},{15:15,29:29,3:3,30:30,35:35,39:39,5:5,8:8}],38:[function(e,t,n){t.exports=r;var i=e(39);function r(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=r.zero=new r(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new r(n,i)},r.from=function(e){if("number"==typeof e)return r.fromNumber(e);if(i.isString(e)){if(!i.Long)return r.fromNumber(parseInt(e,10));e=i.Long.fromString(e)}return e.low||e.high?new r(e.low>>>0,e.high>>>0):o},r.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(e){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;r.fromHash=function(e){return e===a?o:new r((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},r.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},r.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},{39:39}],39:[function(e,t,n){var i=n;function r(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;++r)e[i[r]]!==undefined&&n||(e[i[r]]=t[i[r]]);return e}function o(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:undefined,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}i.asPromise=e(1),i.base64=e(2),i.EventEmitter=e(4),i.float=e(6),i.inquire=e(7),i.utf8=e(10),i.pool=e(9),i.LongBits=e(38),i.isNode=Boolean(void 0!==__webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.process&&__webpack_require__.g.process.versions&&__webpack_require__.g.process.versions.node),i.global=i.isNode&&__webpack_require__.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString=function(e){return"string"==typeof e||e instanceof String},i.isObject=function(e){return e&&"object"==typeof e},i.isset=i.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},i.Buffer=function(){try{var e=i.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(e){return"number"==typeof e?i.Buffer?i._Buffer_allocUnsafe(e):new i.Array(e):i.Buffer?i._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(e){return e?i.LongBits.from(e).toHash():i.LongBits.zeroHash},i.longFromHash=function(e,t){var n=i.LongBits.fromHash(e);return i.Long?i.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},i.merge=r,i.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},i.newError=o,i.ProtocolError=o("ProtocolError"),i.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&this[e[n]]!==undefined&&null!==this[e[n]])return e[n]}},i.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var e=i.Buffer;e?(i._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},i._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}},{1:1,10:10,2:2,38:38,4:4,6:6,7:7,9:9}],40:[function(e,t,n){t.exports=function(e){var t=r.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n={};e.oneofsArray.length&&t("var p={}");for(var i=0;i<e.fieldsArray.length;++i){var l=e._fieldsArray[i].resolve(),c="m"+r.safeProp(l.name);if(l.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,l.name),l.map)t("if(!util.isObject(%s))",c)("return%j",o(l,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),s(t,l,"k[i]"),a(t,l,i,c+"[k[i]]")("}");else if(l.repeated)t("if(!Array.isArray(%s))",c)("return%j",o(l,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,l,i,c+"[i]")("}");else{if(l.partOf){var u=r.safeProp(l.partOf.name);1===n[l.partOf.name]&&t("if(p%s===1)",u)("return%j",l.partOf.name+": multiple values"),n[l.partOf.name]=1,t("p%s=1",u)}a(t,l,i,c)}l.optional&&t("}")}return t("return null")};var i=e(15),r=e(37);function o(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,n,r){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(%s){",r)("default:")("return%j",o(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),s=0;s<a.length;++s)e("case %i:",t.resolvedType.values[a[s]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,r)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",r)("return%j",o(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",o(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',r)("return%j",o(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',r)("return%j",o(t,"boolean"));break;case"string":e("if(!util.isString(%s))",r)("return%j",o(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",o(t,"buffer"))}return e}function s(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",o(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",o(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",o(t,"boolean key"))}return e}},{15:15,37:37}],41:[function(e,t,n){var i=n,r=e(21);i[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),n=this.lookup(t);if(n){var i="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return-1===i.indexOf("/")&&(i="/"+i),this.create({type_url:i,value:n.encode(n.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var n="",i="";if(t&&t.json&&e.type_url&&e.value){i=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var o=this.lookup(i);o&&(e=o.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof r){var a=e.$type.toObject(e,t);return""===n&&(n="type.googleapis.com/"),i=n+("."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName),a["@type"]=i,a}return this.toObject(e,t)}}},{21:21}],42:[function(e,t,n){t.exports=d;var i,r=e(39),o=r.LongBits,a=r.base64,s=r.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=undefined,this.val=n}function c(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var h=function(){return r.Buffer?function(){return(d.create=function(){return new i})()}:function(){return new d}};function p(e,t,n){t[n]=255&e}function f(e,t){this.len=e,this.next=undefined,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}d.create=h(),d.alloc=function(e){return new r.Array(e)},r.Array!==Array&&(d.alloc=r.pool(d.alloc,r.Array.prototype.subarray)),d.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},f.prototype=Object.create(l.prototype),f.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(m,10,o.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=o.from(e);return this._push(m,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(m,t.length(),t)},d.prototype.bool=function(e){return this._push(p,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=o.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(r.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(r.float.writeDoubleLE,8,e)};var _=r.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(r.isString(e)){var n=d.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(_,t,e)},d.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(p,1,0)},d.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new l(c,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},d._configure=function(e){i=e,d.create=h(),i._configure()}},{39:39}],43:[function(e,t,n){t.exports=o;var i=e(42);(o.prototype=Object.create(i.prototype)).constructor=o;var r=e(39);function o(){i.call(this)}function a(e,t,n){e.length<40?r.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}o._configure=function(){o.alloc=r._Buffer_allocUnsafe,o.writeBytesBuffer=r.Buffer&&r.Buffer.prototype instanceof Uint8Array&&"set"===r.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}},o.prototype.bytes=function(e){r.isString(e)&&(e=r._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=r.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},o._configure()},{39:39,42:42}]},cache={},entries=[19],protobuf=function e(t){var n=cache[t];return n||modules[t][0].call(n=cache[t]={exports:{}},e,n,n.exports),n.exports}(entries[0]),protobuf.util.global.protobuf=protobuf,__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(583)],(__WEBPACK_AMD_DEFINE_RESULT__=function(e){return e&&e.isLong&&(protobuf.util.Long=e,protobuf.configure()),protobuf}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))===undefined||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),module&&module.exports&&(module.exports=protobuf)}()},583:(e,t)=>{var n,i=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function i(e){return!0===(e&&e.__isLong__)}function r(e){var t=Math.clz32(e&-e);return e?31-t:t}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=i;var o={},a={};function s(e,t){var n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=a[e])?i:(n=c(e,0,!0),r&&(a[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=o[e])?i:(n=c(e,e<0?-1:0,!1),r&&(o[e]=n),n)}function l(e,t){if(isNaN(e))return t?v:_;if(t){if(e<0)return v;if(e>=f)return T}else{if(e<=-m)return x;if(e+1>=m)return S}return e<0?l(-e,t).neg():c(e%p|0,e/p|0,t)}function c(e,t,i){return new n(e,t,i)}n.fromInt=s,n.fromNumber=l,n.fromBits=c;var u=Math.pow;function d(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:_;if((n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return d(e.substring(1),t,n).neg();for(var r=l(u(n,8)),o=_,a=0;a<e.length;a+=8){var s=Math.min(8,e.length-a),c=parseInt(e.substring(a,a+s),n);if(s<8){var h=l(u(n,s));o=o.mul(h).add(l(c))}else o=(o=o.mul(r)).add(l(c))}return o.unsigned=t,o}function h(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?d(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=d,n.fromValue=h;var p=4294967296,f=p*p,m=f/2,g=s(1<<24),_=s(0);n.ZERO=_;var v=s(0,!0);n.UZERO=v;var y=s(1);n.ONE=y;var E=s(1,!0);n.UONE=E;var b=s(-1);n.NEG_ONE=b;var S=c(-1,2147483647,!1);n.MAX_VALUE=S;var T=c(-1,-1,!0);n.MAX_UNSIGNED_VALUE=T;var x=c(0,-2147483648,!1);n.MIN_VALUE=x;var A=n.prototype;A.toInt=function(){return this.unsigned?this.low>>>0:this.low},A.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},A.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var t=l(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=l(u(e,6),this.unsigned),o=this,a="";;){var s=o.div(r),c=(o.sub(s.mul(r)).toInt()>>>0).toString(e);if((o=s).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},A.getHighBits=function(){return this.high},A.getHighBitsUnsigned=function(){return this.high>>>0},A.getLowBits=function(){return this.low},A.getLowBitsUnsigned=function(){return this.low>>>0},A.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},A.isZero=function(){return 0===this.high&&0===this.low},A.eqz=A.isZero,A.isNegative=function(){return!this.unsigned&&this.high<0},A.isPositive=function(){return this.unsigned||this.high>=0},A.isOdd=function(){return 1==(1&this.low)},A.isEven=function(){return 0==(1&this.low)},A.equals=function(e){return i(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},A.eq=A.equals,A.notEquals=function(e){return!this.eq(e)},A.neq=A.notEquals,A.ne=A.notEquals,A.lessThan=function(e){return this.comp(e)<0},A.lt=A.lessThan,A.lessThanOrEqual=function(e){return this.comp(e)<=0},A.lte=A.lessThanOrEqual,A.le=A.lessThanOrEqual,A.greaterThan=function(e){return this.comp(e)>0},A.gt=A.greaterThan,A.greaterThanOrEqual=function(e){return this.comp(e)>=0},A.gte=A.greaterThanOrEqual,A.ge=A.greaterThanOrEqual,A.compare=function(e){if(i(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},A.comp=A.compare,A.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(y)},A.neg=A.negate,A.add=function(e){i(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,a=e.high>>>16,s=65535&e.high,l=e.low>>>16,u=0,d=0,p=0,f=0;return p+=(f+=o+(65535&e.low))>>>16,d+=(p+=r+l)>>>16,u+=(d+=n+s)>>>16,u+=t+a,c((p&=65535)<<16|(f&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},A.subtract=function(e){return i(e)||(e=h(e)),this.add(e.neg())},A.sub=A.subtract,A.multiply=function(e){if(this.isZero())return this;if(i(e)||(e=h(e)),t)return c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:_;if(this.eq(x))return e.isOdd()?x:_;if(e.eq(x))return this.isOdd()?x:_;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,o=this.low>>>16,a=65535&this.low,s=e.high>>>16,u=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,m=0,y=0,E=0;return y+=(E+=a*p)>>>16,m+=(y+=o*p)>>>16,y&=65535,m+=(y+=a*d)>>>16,f+=(m+=r*p)>>>16,m&=65535,f+=(m+=o*d)>>>16,m&=65535,f+=(m+=a*u)>>>16,f+=n*p+r*d+o*u+a*s,c((y&=65535)<<16|(E&=65535),(f&=65535)<<16|(m&=65535),this.unsigned)},A.mul=A.multiply,A.divide=function(e){if(i(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,r,o;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:_;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return E;o=v}else{if(this.eq(x))return e.eq(y)||e.eq(b)?x:e.eq(x)?y:(n=this.shr(1).div(e).shl(1)).eq(_)?e.isNegative()?y:b:(r=this.sub(e.mul(n)),o=n.add(r.div(e)));if(e.eq(x))return this.unsigned?v:_;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=_}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),s=a<=48?1:u(2,a-48),d=l(n),p=d.mul(e);p.isNegative()||p.gt(r);)p=(d=l(n-=s,this.unsigned)).mul(e);d.isZero()&&(d=y),o=o.add(d),r=r.sub(p)}return o},A.div=A.divide,A.modulo=function(e){return i(e)||(e=h(e)),t?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},A.mod=A.modulo,A.rem=A.modulo,A.not=function(){return c(~this.low,~this.high,this.unsigned)},A.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},A.clz=A.countLeadingZeros,A.countTrailingZeros=function(){return this.low?r(this.low):r(this.high)+32},A.ctz=A.countTrailingZeros,A.and=function(e){return i(e)||(e=h(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},A.or=function(e){return i(e)||(e=h(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},A.xor=function(e){return i(e)||(e=h(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},A.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},A.shl=A.shiftLeft,A.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},A.shr=A.shiftRight,A.shiftRightUnsigned=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):c(32===e?this.high:this.high>>>e-32,0,this.unsigned)},A.shru=A.shiftRightUnsigned,A.shr_u=A.shiftRightUnsigned,A.rotateLeft=function(e){var t;return i(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(t=32-(e-=32),c(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},A.rotl=A.rotateLeft,A.rotateRight=function(e){var t;return i(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(t=32-(e-=32),c(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},A.rotr=A.rotateRight,A.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},A.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},A.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},A.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},A.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,i){return i?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var w=n;return e.default=w,"default"in e?e.default:e}({});void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}},__webpack_module_cache__={},leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);__webpack_require__.r(n);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var r=2&t&&e;"object"==typeof r&&!~leafPrototypes.indexOf(r);r=getProto(r))Object.getOwnPropertyNames(r).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,__webpack_require__.d(n,i),n},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),__webpack_require__.nc=void 0;var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.d(__webpack_exports__,{d:()=>CM});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{fixNegotiationNeeded:()=>dc,shimAddTrackRemoveTrack:()=>cc,shimAddTrackRemoveTrackWithNative:()=>lc,shimGetDisplayMedia:()=>nc,shimGetSendersWithDtmf:()=>oc,shimGetStats:()=>ac,shimGetUserMedia:()=>tc,shimMediaStream:()=>ic,shimOnTrack:()=>rc,shimPeerConnection:()=>uc,shimSenderReceiverGetStats:()=>sc});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{shimAddTransceiver:()=>Ec,shimCreateAnswer:()=>Tc,shimCreateOffer:()=>Sc,shimGetDisplayMedia:()=>pc,shimGetParameters:()=>bc,shimGetUserMedia:()=>hc,shimOnTrack:()=>fc,shimPeerConnection:()=>mc,shimRTCDataChannel:()=>yc,shimReceiverGetStats:()=>_c,shimRemoveStream:()=>vc,shimSenderGetStats:()=>gc});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{shimAudioContext:()=>Nc,shimCallbacksAPI:()=>wc,shimConstraints:()=>Rc,shimCreateOfferLegacy:()=>kc,shimGetUserMedia:()=>Ic,shimLocalStreamsAPI:()=>xc,shimRTCIceServerUrls:()=>Cc,shimRemoteStreamsAPI:()=>Ac,shimTrackEventTransceiver:()=>Mc});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{removeExtmapAllowMixed:()=>Bc,shimAddIceCandidateNullOrEmpty:()=>Hc,shimConnectionState:()=>Fc,shimMaxMessageSize:()=>Uc,shimParameterlessSetLocalDescription:()=>zc,shimRTCIceCandidate:()=>Pc,shimRTCIceCandidateRelayProtocol:()=>Lc,shimSendThrowTypeError:()=>Vc});var r=__webpack_require__(745),o=__webpack_require__(294),a=__webpack_require__.t(o,2),s=(__webpack_require__(666),__webpack_require__(379)),l=__webpack_require__.n(s),c=__webpack_require__(795),u=__webpack_require__.n(c),d=__webpack_require__(569),h=__webpack_require__.n(d),p=__webpack_require__(565),f=__webpack_require__.n(p),m=__webpack_require__(216),g=__webpack_require__.n(m),_=__webpack_require__(589),v=__webpack_require__.n(_),y=__webpack_require__(707),E={};E.styleTagTransform=v(),E.setAttributes=f(),E.insert=h().bind(null,"head"),E.domAPI=u(),E.insertStyleElement=g(),l()(y.Z,E),y.Z&&y.Z.locals&&y.Z.locals;var b={attributes:{mediaUrl:"",webIndex:0,Width:0,Height:0,X:0,Y:0,Rotation:0,Opacity:0,zIndex:0},mediaUrl:""},S=".rtc-interaction",T={code:10,message:""},x={code:8,message:""},A={code:8,message:"IDID"},w={code:601,message:""},I={code:631,message:"ID"},R={code:650,message:"SDK"},C={code:651,message:"ID"},M={code:652,message:"sdk"},k={code:701,message:""},N={code:702,message:""},D={code:703,message:""},O={code:704,message:""},P={code:607,message:""},L={code:801,message:"sampleRate"},U={code:802,message:""},V={code:803,message:"2M"},F={code:16451,message:"startRTC"},B={code:887,message:""},H={code:888,message:""},z={code:999,message:""};function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},j.apply(this,arguments)}function G(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function W(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,$(e,t)}function q(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}var X=__webpack_require__(935),Y=__webpack_require__.t(X,2);const J=o.createContext(null);var K=function(e){return e.scrollTop},Q="unmounted",Z="exited",ee="entering",te="entered",ne="exiting",ie=function(e){function t(t,n){var i;i=e.call(this,t,n)||this;var r,o=n&&!n.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?o?(r=Z,i.appearStatus=ee):r=te:r=t.unmountOnExit||t.mountOnEnter?Q:Z,i.state={status:r},i.nextCallback=null,i}W(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Q?{status:Z}:null};var n=t.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==ee&&n!==te&&(t=ee):n!==ee&&n!==te||(t=ne)}this.updateStatus(!1,t)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var e,t,n,i=this.props.timeout;return e=t=n=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,n=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:n}},n.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===ee){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:X.findDOMNode(this);n&&K(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Z&&this.setState({status:Q})},n.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[X.findDOMNode(this),i],o=r[0],a=r[1],s=this.getTimeouts(),l=i?s.appear:s.enter;e||n?(this.props.onEnter(o,a),this.safeSetState({status:ee},(function(){t.props.onEntering(o,a),t.onTransitionEnd(l,(function(){t.safeSetState({status:te},(function(){t.props.onEntered(o,a)}))}))}))):this.safeSetState({status:te},(function(){t.props.onEntered(o)}))},n.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:X.findDOMNode(this);t?(this.props.onExit(i),this.safeSetState({status:ne},(function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:Z},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:Z},(function(){e.props.onExited(i)}))},n.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},n.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(i){n&&(n=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},n.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:X.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(n&&!i){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=r[0],a=r[1];this.props.addEndListener(o,a)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},n.render=function(){var e=this.state.status;if(e===Q)return null;var t=this.props,n=t.children,i=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,G(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return o.createElement(J.Provider,{value:null},"function"==typeof n?n(e,i):o.cloneElement(o.Children.only(n),i))},t}(o.Component);function re(){}ie.contextType=J,ie.propTypes={},ie.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:re,onEntering:re,onEntered:re,onExit:re,onExiting:re,onExited:re},ie.UNMOUNTED=Q,ie.EXITED=Z,ie.ENTERING=ee,ie.ENTERED=te,ie.EXITING=ne;const oe=ie;var ae=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return i=t,void((n=e).classList?n.classList.remove(i):"string"==typeof n.className?n.className=q(n.className,i):n.setAttribute("class",q(n.className&&n.className.baseVal||"",i)));var n,i}))},se=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,n){var i=t.resolveArguments(e,n),r=i[0],o=i[1];t.removeClasses(r,"exit"),t.addClass(r,o?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,n)},t.onEntering=function(e,n){var i=t.resolveArguments(e,n),r=i[0],o=i[1]?"appear":"enter";t.addClass(r,o,"active"),t.props.onEntering&&t.props.onEntering(e,n)},t.onEntered=function(e,n){var i=t.resolveArguments(e,n),r=i[0],o=i[1]?"appear":"enter";t.removeClasses(r,o),t.addClass(r,o,"done"),t.props.onEntered&&t.props.onEntered(e,n)},t.onExit=function(e){var n=t.resolveArguments(e)[0];t.removeClasses(n,"appear"),t.removeClasses(n,"enter"),t.addClass(n,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var n=t.resolveArguments(e)[0];t.addClass(n,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var n=t.resolveArguments(e)[0];t.removeClasses(n,"exit"),t.addClass(n,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,n){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,n]},t.getClassNames=function(e){var n=t.props.classNames,i="string"==typeof n,r=i?(i&&n?n+"-":"")+e:n[e];return{baseClassName:r,activeClassName:i?r+"-active":n[e+"Active"],doneClassName:i?r+"-done":n[e+"Done"]}},t}W(t,e);var n=t.prototype;return n.addClass=function(e,t,n){var i=this.getClassNames(t)[n+"ClassName"],r=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===n&&r&&(i+=" "+r),"active"===n&&e&&K(e),i&&(this.appliedClasses[t][n]=i,function(e,t){e&&t&&t.split(" ").forEach((function(t){return i=t,void((n=e).classList?n.classList.add(i):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(n,i)||("string"==typeof n.className?n.className=n.className+" "+i:n.setAttribute("class",(n.className&&n.className.baseVal||"")+" "+i)));var n,i}))}(e,i))},n.removeClasses=function(e,t){var n=this.appliedClasses[t],i=n.base,r=n.active,o=n.done;this.appliedClasses[t]={},i&&ae(e,i),r&&ae(e,r),o&&ae(e,o)},n.render=function(){var e=this.props,t=(e.classNames,G(e,["classNames"]));return o.createElement(oe,j({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(o.Component);se.defaultProps={classNames:""},se.propTypes={};const le=se;function ce(e,t){return function(){return e.apply(t,arguments)}}const{toString:ue}=Object.prototype,{getPrototypeOf:de}=Object,he=(pe=Object.create(null),e=>{const t=ue.call(e);return pe[t]||(pe[t]=t.slice(8,-1).toLowerCase())});var pe;const fe=e=>(e=e.toLowerCase(),t=>he(t)===e),me=e=>t=>typeof t===e,{isArray:ge}=Array,_e=me("undefined"),ve=fe("ArrayBuffer"),ye=me("string"),Ee=me("function"),be=me("number"),Se=e=>null!==e&&"object"==typeof e,Te=e=>{if("object"!==he(e))return!1;const t=de(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},xe=fe("Date"),Ae=fe("File"),we=fe("Blob"),Ie=fe("FileList"),Re=fe("URLSearchParams");function Ce(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let i,r;if("object"!=typeof e&&(e=[e]),ge(e))for(i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else{const r=n?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let a;for(i=0;i<o;i++)a=r[i],t.call(null,e[a],a,e)}}function Me(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const ke="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Ne=e=>!_e(e)&&e!==ke,De=(Oe="undefined"!=typeof Uint8Array&&de(Uint8Array),e=>Oe&&e instanceof Oe);var Oe;const Pe=fe("HTMLFormElement"),Le=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Ue=fe("RegExp"),Ve=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};Ce(n,((n,r)=>{!1!==t(n,r,e)&&(i[r]=n)})),Object.defineProperties(e,i)},Fe="abcdefghijklmnopqrstuvwxyz",Be="0123456789",He={DIGIT:Be,ALPHA:Fe,ALPHA_DIGIT:Fe+Fe.toUpperCase()+Be},ze={isArray:ge,isArrayBuffer:ve,isBuffer:function(e){return null!==e&&!_e(e)&&null!==e.constructor&&!_e(e.constructor)&&Ee(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{const t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||ue.call(e)===t||Ee(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ve(e.buffer),t},isString:ye,isNumber:be,isBoolean:e=>!0===e||!1===e,isObject:Se,isPlainObject:Te,isUndefined:_e,isDate:xe,isFile:Ae,isBlob:we,isRegExp:Ue,isFunction:Ee,isStream:e=>Se(e)&&Ee(e.pipe),isURLSearchParams:Re,isTypedArray:De,isFileList:Ie,forEach:Ce,merge:function e(){const{caseless:t}=Ne(this)&&this||{},n={},i=(i,r)=>{const o=t&&Me(n,r)||r;Te(n[o])&&Te(i)?n[o]=e(n[o],i):Te(i)?n[o]=e({},i):ge(i)?n[o]=i.slice():n[o]=i};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Ce(arguments[e],i);return n},extend:(e,t,n,{allOwnKeys:i}={})=>(Ce(t,((t,i)=>{n&&Ee(t)?e[i]=ce(t,n):e[i]=t}),{allOwnKeys:i}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,o,a;const s={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),o=r.length;o-- >0;)a=r[o],i&&!i(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&de(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:he,kindOfTest:fe,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return-1!==i&&i===n},toArray:e=>{if(!e)return null;if(ge(e))return e;let t=e.length;if(!be(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=n.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const i=[];for(;null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:Pe,hasOwnProperty:Le,hasOwnProp:Le,reduceDescriptors:Ve,freezeMethods:e=>{Ve(e,((t,n)=>{if(Ee(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const i=e[n];Ee(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},i=e=>{e.forEach((e=>{n[e]=!0}))};return ge(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Me,global:ke,isContextDefined:Ne,ALPHABET:He,generateString:(e=16,t=He.ALPHA_DIGIT)=>{let n="";const{length:i}=t;for(;e--;)n+=t[Math.random()*i|0];return n},isSpecCompliantForm:function(e){return!!(e&&Ee(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,i)=>{if(Se(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[i]=e;const r=ge(e)?[]:{};return Ce(e,((e,t)=>{const o=n(e,i+1);!_e(o)&&(r[t]=o)})),t[i]=void 0,r}}return e};return n(e,0)}};function je(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r)}ze.inherits(je,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ze.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Ge=je.prototype,$e={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{$e[e]={value:e}})),Object.defineProperties(je,$e),Object.defineProperty(Ge,"isAxiosError",{value:!0}),je.from=(e,t,n,i,r,o)=>{const a=Object.create(Ge);return ze.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),je.call(a,e.message,t,n,i,r),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};const We=je;function qe(e){return ze.isPlainObject(e)||ze.isArray(e)}function Xe(e){return ze.endsWith(e,"[]")?e.slice(0,-2):e}function Ye(e,t,n){return e?e.concat(t).map((function(e,t){return e=Xe(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const Je=ze.toFlatObject(ze,{},null,(function(e){return/^is[A-Z]/.test(e)})),Ke=function(e,t,n){if(!ze.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=ze.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!ze.isUndefined(t[e])}))).metaTokens,r=n.visitor||c,o=n.dots,a=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&ze.isSpecCompliantForm(t);if(!ze.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(ze.isDate(e))return e.toISOString();if(!s&&ze.isBlob(e))throw new We("Blob is not supported. Use a Buffer instead.");return ze.isArrayBuffer(e)||ze.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,r){let s=e;if(e&&!r&&"object"==typeof e)if(ze.endsWith(n,"{}"))n=i?n:n.slice(0,-2),e=JSON.stringify(e);else if(ze.isArray(e)&&function(e){return ze.isArray(e)&&!e.some(qe)}(e)||(ze.isFileList(e)||ze.endsWith(n,"[]"))&&(s=ze.toArray(e)))return n=Xe(n),s.forEach((function(e,i){!ze.isUndefined(e)&&null!==e&&t.append(!0===a?Ye([n],i,o):null===a?n:n+"[]",l(e))})),!1;return!!qe(e)||(t.append(Ye(r,n,o),l(e)),!1)}const u=[],d=Object.assign(Je,{defaultVisitor:c,convertValue:l,isVisitable:qe});if(!ze.isObject(e))throw new TypeError("data must be an object");return function e(n,i){if(!ze.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+i.join("."));u.push(n),ze.forEach(n,(function(n,o){!0===(!(ze.isUndefined(n)||null===n)&&r.call(t,n,ze.isString(o)?o.trim():o,i,d))&&e(n,i?i.concat(o):[o])})),u.pop()}}(e),t};function Qe(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Ze(e,t){this._pairs=[],e&&Ke(e,this,t)}const et=Ze.prototype;et.append=function(e,t){this._pairs.push([e,t])},et.toString=function(e){const t=e?function(t){return e.call(this,t,Qe)}:Qe;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const tt=Ze;function nt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function it(e,t,n){if(!t)return e;const i=n&&n.encode||nt,r=n&&n.serialize;let o;if(o=r?r(t,n):ze.isURLSearchParams(t)?t.toString():new tt(t,n).toString(i),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const rt=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ze.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},ot={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},at={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:tt,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&"undefined"!=typeof window&&"undefined"!=typeof document})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]},st=function(e){function t(e,n,i,r){let o=e[r++];const a=Number.isFinite(+o),s=r>=e.length;return o=!o&&ze.isArray(i)?i.length:o,s?(ze.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):(i[o]&&ze.isObject(i[o])||(i[o]=[]),t(e,n,i[o],r)&&ze.isArray(i[o])&&(i[o]=function(e){const t={},n=Object.keys(e);let i;const r=n.length;let o;for(i=0;i<r;i++)o=n[i],t[o]=e[o];return t}(i[o])),!a)}if(ze.isFormData(e)&&ze.isFunction(e.entries)){const n={};return ze.forEachEntry(e,((e,i)=>{t(function(e){return ze.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),i,n,0)})),n}return null},lt={"Content-Type":void 0},ct={transitional:ot,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=ze.isObject(e);if(r&&ze.isHTMLForm(e)&&(e=new FormData(e)),ze.isFormData(e))return i&&i?JSON.stringify(st(e)):e;if(ze.isArrayBuffer(e)||ze.isBuffer(e)||ze.isStream(e)||ze.isFile(e)||ze.isBlob(e))return e;if(ze.isArrayBufferView(e))return e.buffer;if(ze.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Ke(e,new at.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,i){return at.isNode&&ze.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=ze.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Ke(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),function(e,t,n){if(ze.isString(e))try{return(0,JSON.parse)(e),ze.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ct.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(e&&ze.isString(e)&&(n&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw We.from(e,We.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:at.classes.FormData,Blob:at.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ze.forEach(["delete","get","head"],(function(e){ct.headers[e]={}})),ze.forEach(["post","put","patch"],(function(e){ct.headers[e]=ze.merge(lt)}));const ut=ct,dt=ze.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ht=Symbol("internals");function pt(e){return e&&String(e).trim().toLowerCase()}function ft(e){return!1===e||null==e?e:ze.isArray(e)?e.map(ft):String(e)}function mt(e,t,n,i,r){return ze.isFunction(i)?i.call(this,t,n):(r&&(t=n),ze.isString(t)?ze.isString(i)?-1!==t.indexOf(i):ze.isRegExp(i)?i.test(t):void 0:void 0)}class gt{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function r(e,t,n){const r=pt(t);if(!r)throw new Error("header name must be a non-empty string");const o=ze.findKey(i,r);(!o||void 0===i[o]||!0===n||void 0===n&&!1!==i[o])&&(i[o||t]=ft(e))}const o=(e,t)=>ze.forEach(e,((e,n)=>r(e,n,t)));return ze.isPlainObject(e)||e instanceof this.constructor?o(e,t):ze.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z]+$/.test(e.trim())?o((e=>{const t={};let n,i,r;return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),i=e.substring(r+1).trim(),!n||t[n]&&dt[n]||("set-cookie"===n?t[n]?t[n].push(i):t[n]=[i]:t[n]=t[n]?t[n]+", "+i:i)})),t})(e),t):null!=e&&r(t,e,n),this}get(e,t){if(e=pt(e)){const n=ze.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(e);)t[i[1]]=i[2];return t}(e);if(ze.isFunction(t))return t.call(this,e,n);if(ze.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=pt(e)){const n=ze.findKey(this,e);return!(!n||void 0===this[n]||t&&!mt(0,this[n],n,t))}return!1}delete(e,t){const n=this;let i=!1;function r(e){if(e=pt(e)){const r=ze.findKey(n,e);!r||t&&!mt(0,n[r],r,t)||(delete n[r],i=!0)}}return ze.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const r=t[n];e&&!mt(0,this[r],r,e,!0)||(delete this[r],i=!0)}return i}normalize(e){const t=this,n={};return ze.forEach(this,((i,r)=>{const o=ze.findKey(n,r);if(o)return t[o]=ft(i),void delete t[r];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(r):String(r).trim();a!==r&&delete t[r],t[a]=ft(i),n[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ze.forEach(this,((n,i)=>{null!=n&&!1!==n&&(t[i]=e&&ze.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[ht]=this[ht]={accessors:{}}).accessors,n=this.prototype;function i(e){const i=pt(e);t[i]||(function(e,t){const n=ze.toCamelCase(" "+t);["get","set","has"].forEach((i=>{Object.defineProperty(e,i+n,{value:function(e,n,r){return this[i].call(this,t,e,n,r)},configurable:!0})}))}(n,e),t[i]=!0)}return ze.isArray(e)?e.forEach(i):i(e),this}}gt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ze.freezeMethods(gt.prototype),ze.freezeMethods(gt);const _t=gt;function vt(e,t){const n=this||ut,i=t||n,r=_t.from(i.headers);let o=i.data;return ze.forEach(e,(function(e){o=e.call(n,o,r.normalize(),t?t.status:void 0)})),r.normalize(),o}function yt(e){return!(!e||!e.__CANCEL__)}function Et(e,t,n){We.call(this,null==e?"canceled":e,We.ERR_CANCELED,t,n),this.name="CanceledError"}ze.inherits(Et,We,{__CANCEL__:!0});const bt=Et,St=at.isStandardBrowserEnv?{write:function(e,t,n,i,r,o){const a=[];a.push(e+"="+encodeURIComponent(t)),ze.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),ze.isString(i)&&a.push("path="+i),ze.isString(r)&&a.push("domain="+r),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function Tt(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const xt=at.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(n){let i=n;return e&&(t.setAttribute("href",i),i=t.href),t.setAttribute("href",i),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(e){const t=ze.isString(e)?i(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function At(e,t){let n=0;const i=function(e,t){e=e||10;const n=new Array(e),i=new Array(e);let r,o=0,a=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=i[a];r||(r=l),n[o]=s,i[o]=l;let u=a,d=0;for(;u!==o;)d+=n[u++],u%=e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),l-r<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}}(50,250);return r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,s=o-n,l=i(s);n=o;const c={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:l||void 0,estimated:l&&a&&o<=a?(a-o)/l:void 0,event:r};c[t?"download":"upload"]=!0,e(c)}}const wt={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let i=e.data;const r=_t.from(e.headers).normalize(),o=e.responseType;let a;function s(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}ze.isFormData(i)&&(at.isStandardBrowserEnv||at.isStandardBrowserWebWorkerEnv)&&r.setContentType(!1);let l=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";r.set("Authorization","Basic "+btoa(t+":"+n))}const c=Tt(e.baseURL,e.url);function u(){if(!l)return;const i=_t.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());!function(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new We("Request failed with status code "+n.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),s()}),(function(e){n(e),s()}),{data:o&&"text"!==o&&"json"!==o?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:i,config:e,request:l}),l=null}if(l.open(e.method.toUpperCase(),it(c,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,"onloadend"in l?l.onloadend=u:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(u)},l.onabort=function(){l&&(n(new We("Request aborted",We.ECONNABORTED,e,l)),l=null)},l.onerror=function(){n(new We("Network Error",We.ERR_NETWORK,e,l)),l=null},l.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const i=e.transitional||ot;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new We(t,i.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,e,l)),l=null},at.isStandardBrowserEnv){const t=(e.withCredentials||xt(c))&&e.xsrfCookieName&&St.read(e.xsrfCookieName);t&&r.set(e.xsrfHeaderName,t)}void 0===i&&r.setContentType(null),"setRequestHeader"in l&&ze.forEach(r.toJSON(),(function(e,t){l.setRequestHeader(t,e)})),ze.isUndefined(e.withCredentials)||(l.withCredentials=!!e.withCredentials),o&&"json"!==o&&(l.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",At(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",At(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{l&&(n(!t||t.type?new bt(null,e,l):t),l.abort(),l=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const d=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(c);d&&-1===at.protocols.indexOf(d)?n(new We("Unsupported protocol "+d+":",We.ERR_BAD_REQUEST,e)):l.send(i||null)}))}};ze.forEach(wt,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));function It(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new bt(null,e)}function Rt(e){return It(e),e.headers=_t.from(e.headers),e.data=vt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),(e=>{e=ze.isArray(e)?e:[e];const{length:t}=e;let n,i;for(let r=0;r<t&&(n=e[r],!(i=ze.isString(n)?wt[n.toLowerCase()]:n));r++);if(!i){if(!1===i)throw new We(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(ze.hasOwnProp(wt,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`)}if(!ze.isFunction(i))throw new TypeError("adapter is not a function");return i})(e.adapter||ut.adapter)(e).then((function(t){return It(e),t.data=vt.call(e,e.transformResponse,t),t.headers=_t.from(t.headers),t}),(function(t){return yt(t)||(It(e),t&&t.response&&(t.response.data=vt.call(e,e.transformResponse,t.response),t.response.headers=_t.from(t.response.headers))),Promise.reject(t)}))}const Ct=e=>e instanceof _t?e.toJSON():e;function Mt(e,t){t=t||{};const n={};function i(e,t,n){return ze.isPlainObject(e)&&ze.isPlainObject(t)?ze.merge.call({caseless:n},e,t):ze.isPlainObject(t)?ze.merge({},t):ze.isArray(t)?t.slice():t}function r(e,t,n){return ze.isUndefined(t)?ze.isUndefined(e)?void 0:i(void 0,e,n):i(e,t,n)}function o(e,t){if(!ze.isUndefined(t))return i(void 0,t)}function a(e,t){return ze.isUndefined(t)?ze.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function s(n,r,o){return o in t?i(n,r):o in e?i(void 0,n):void 0}const l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t)=>r(Ct(e),Ct(t),!0)};return ze.forEach(Object.keys(e).concat(Object.keys(t)),(function(i){const o=l[i]||r,a=o(e[i],t[i],i);ze.isUndefined(a)&&o!==s||(n[i]=a)})),n}const kt={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{kt[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Nt={};kt.transitional=function(e,t,n){function i(e,t){return"[Axios v1.3.4] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,o)=>{if(!1===e)throw new We(i(r," has been removed"+(t?" in "+t:"")),We.ERR_DEPRECATED);return t&&!Nt[r]&&(Nt[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,o)}};const Dt={assertOptions:function(e,t,n){if("object"!=typeof e)throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const o=i[r],a=t[o];if(a){const t=e[o],n=void 0===t||a(t,o,e);if(!0!==n)throw new We("option "+o+" must be "+n,We.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new We("Unknown option "+o,We.ERR_BAD_OPTION)}},validators:kt},Ot=Dt.validators;class Pt{constructor(e){this.defaults=e,this.interceptors={request:new rt,response:new rt}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Mt(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;let o;void 0!==n&&Dt.assertOptions(n,{silentJSONParsing:Ot.transitional(Ot.boolean),forcedJSONParsing:Ot.transitional(Ot.boolean),clarifyTimeoutError:Ot.transitional(Ot.boolean)},!1),void 0!==i&&Dt.assertOptions(i,{encode:Ot.function,serialize:Ot.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase(),o=r&&ze.merge(r.common,r[t.method]),o&&ze.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete r[e]})),t.headers=_t.concat(o,r);const a=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,d=0;if(!s){const e=[Rt.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=a.length;let h=t;for(d=0;d<u;){const e=a[d++],t=a[d++];try{h=e(h)}catch(e){t.call(this,e);break}}try{c=Rt.call(this,h)}catch(e){return Promise.reject(e)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return it(Tt((e=Mt(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}ze.forEach(["delete","get","head","options"],(function(e){Pt.prototype[e]=function(t,n){return this.request(Mt(n||{},{method:e,url:t,data:(n||{}).data}))}})),ze.forEach(["post","put","patch"],(function(e){function t(t){return function(n,i,r){return this.request(Mt(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}Pt.prototype[e]=t(),Pt.prototype[e+"Form"]=t(!0)}));const Lt=Pt;class Ut{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const i=new Promise((e=>{n.subscribe(e),t=e})).then(e);return i.cancel=function(){n.unsubscribe(t)},i},e((function(e,i,r){n.reason||(n.reason=new bt(e,i,r),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new Ut((function(t){e=t})),cancel:e}}}const Vt=Ut,Ft={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ft).forEach((([e,t])=>{Ft[t]=e}));const Bt=Ft,Ht=function e(t){const n=new Lt(t),i=ce(Lt.prototype.request,n);return ze.extend(i,Lt.prototype,n,{allOwnKeys:!0}),ze.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(Mt(t,n))},i}(ut);Ht.Axios=Lt,Ht.CanceledError=bt,Ht.CancelToken=Vt,Ht.isCancel=yt,Ht.VERSION="1.3.4",Ht.toFormData=Ke,Ht.AxiosError=We,Ht.Cancel=Ht.CanceledError,Ht.all=function(e){return Promise.all(e)},Ht.spread=function(e){return function(t){return e.apply(null,t)}},Ht.isAxiosError=function(e){return ze.isObject(e)&&!0===e.isAxiosError},Ht.mergeConfig=Mt,Ht.AxiosHeaders=_t,Ht.formToJSON=e=>st(ze.isHTMLForm(e)?new FormData(e):e),Ht.HttpStatusCode=Bt,Ht.default=Ht;const zt=Ht;var jt=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},Gt=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},$t=zt.create({baseURL:"",withCredentials:!1});$t.interceptors.request.use((function(e){return(e.url.includes("gen")||e.url.includes("listVhResource"))&&(e.headers["subscription-key"]="7d3dc504464e4c888d4f751d36e157f1"),e}),(function(e){return Promise.reject(e)}));var Wt=!1;$t.interceptors.response.use((function(e){return jt(void 0,void 0,void 0,(function(){return Gt(this,(function(t){return(e.data.hasOwnProperty("message")||e.data.hasOwnProperty("msg"))&&e.data.hasOwnProperty("code")?200===e.data.code||0===e.data.code?[2,e.data.data]:[2,Promise.reject(e.data)]:[2,e.data]}))}))}),(function(e){return jt(void 0,void 0,void 0,(function(){var t,n;return Gt(this,(function(i){return console.log(e),zt.isCancel(e)?[2,Promise.reject(e)]:401===(null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.status)?(Wt||(Wt=!0,localStorage.removeItem("isLogin"),setTimeout((function(){Wt=!1}),2e3)),[2,Promise.reject(e)]):(null===(n=null==e?void 0:e.response)||void 0===n||n.status,[2,Promise.reject(e)])}))}))}));const qt=$t;var Xt=function(){return Xt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Xt.apply(this,arguments)};function Yt(e){return qt({method:"POST",url:"/openapi/talk/task/rtc/stop",data:e})}function Jt(e){return qt({method:"POST",url:"/openapi/cost/report",data:Xt({},e)})}var Kt=function(){return Kt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Kt.apply(this,arguments)};function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Zt(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function en(e,t){if(e){if("string"==typeof e)return Qt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qt(e,t):void 0}}function tn(e){return function(e){if(Array.isArray(e))return Qt(e)}(e)||Zt(e)||en(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nn(e){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nn(e)}function rn(e){var t=function(e,t){if("object"!==nn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==nn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===nn(t)?t:String(t)}function on(e,t,n){return(t=rn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function an(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?an(Object(n),!0).forEach((function(t){on(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):an(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ln,cn=sn({},Y),un=cn.version,dn=cn.render;cn.unmountComponentAtNode;try{Number((un||"").split(".")[0])>=18&&(ln=cn.createRoot)}catch(Ou){}function hn(e){var t=cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;t&&"object"===nn(t)&&(t.usingClientEntryPoint=e)}var pn="__rc_react_root__";const fn=function(e){for(var t,n=0,i=0,r=e.length;r>=4;++i,r-=4)t=1540483477*(65535&(t=255&e.charCodeAt(i)|(255&e.charCodeAt(++i))<<8|(255&e.charCodeAt(++i))<<16|(255&e.charCodeAt(++i))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(r){case 3:n^=(255&e.charCodeAt(i+2))<<16;case 2:n^=(255&e.charCodeAt(i+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(i)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)};function mn(e,t,n){var i=o.useRef({});return"value"in i.current&&!n(i.current.condition,t)||(i.current.value=e(),i.current.condition=t),i.current.value}var gn={},_n=[];function vn(e,t){}function yn(e,t){}function En(e,t,n){t||gn[n]||(e(!1,n),gn[n]=!0)}function bn(e,t){En(vn,e,t)}bn.preMessage=function(e){_n.push(e)},bn.resetWarned=function(){gn={}},bn.noteOnce=function(e,t){En(yn,e,t)};const Sn=bn;function Tn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,rn(i.key),i)}}function An(e,t,n){return t&&xn(e.prototype,t),n&&xn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var wn=function(){function e(t){Tn(this,e),on(this,"instanceId",void 0),on(this,"cache",new Map),this.instanceId=t}return An(e,[{key:"get",value:function(e){return this.cache.get(e.join("%"))||null}},{key:"update",value:function(e,t){var n=e.join("%"),i=t(this.cache.get(n));null===i?this.cache.delete(n):this.cache.set(n,i)}}]),e}();const In=wn;var Rn="data-token-hash",Cn="data-css-hash",Mn="__cssinjs_instance__";var kn=o.createContext({hashPriority:"low",cache:function(){var e=Math.random().toString(12).slice(2);if("undefined"!=typeof document&&document.head&&document.body){var t=document.body.querySelectorAll("style[".concat(Cn,"]"))||[],n=document.head.firstChild;Array.from(t).forEach((function(t){t[Mn]=t[Mn]||e,t[Mn]===e&&document.head.insertBefore(t,n)}));var i={};Array.from(document.querySelectorAll("style[".concat(Cn,"]"))).forEach((function(t){var n,r=t.getAttribute(Cn);i[r]?t[Mn]===e&&(null===(n=t.parentNode)||void 0===n||n.removeChild(t)):i[r]=!0}))}return new In(e)}(),defaultCache:!0});const Nn=kn;function Dn(){return!("undefined"==typeof window||!window.document||!window.document.createElement)}var On="data-rc-order",Pn="data-rc-priority",Ln="rc-util-key",Un=new Map;function Vn(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).mark;return e?e.startsWith("data-")?e:"data-".concat(e):Ln}function Fn(e){return e.attachTo?e.attachTo:document.querySelector("head")||document.body}function Bn(e){return Array.from((Un.get(e)||e).children).filter((function(e){return"STYLE"===e.tagName}))}function Hn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Dn())return null;var n=t.csp,i=t.prepend,r=t.priority,o=void 0===r?0:r,a=function(e){return"queue"===e?"prependQueue":e?"prepend":"append"}(i),s="prependQueue"===a,l=document.createElement("style");l.setAttribute(On,a),s&&o&&l.setAttribute(Pn,"".concat(o)),null!=n&&n.nonce&&(l.nonce=null==n?void 0:n.nonce),l.innerHTML=e;var c=Fn(t),u=c.firstChild;if(i){if(s){var d=Bn(c).filter((function(e){if(!["prepend","prependQueue"].includes(e.getAttribute(On)))return!1;var t=Number(e.getAttribute(Pn)||0);return o>=t}));if(d.length)return c.insertBefore(l,d[d.length-1].nextSibling),l}c.insertBefore(l,u)}else c.appendChild(l);return l}function zn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Bn(Fn(t)).find((function(n){return n.getAttribute(Vn(t))===e}))}function jn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=zn(e,t);n&&Fn(t).removeChild(n)}function Gn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){var n=Un.get(e);if(!n||!function(e,t){if(!e)return!1;if(e.contains)return e.contains(t);for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1}(document,n)){var i=Hn("",t),r=i.parentNode;Un.set(e,r),e.removeChild(i)}}(Fn(n),n);var i,r,o,a=zn(t,n);if(a)return null!==(i=n.csp)&&void 0!==i&&i.nonce&&a.nonce!==(null===(r=n.csp)||void 0===r?void 0:r.nonce)&&(a.nonce=null===(o=n.csp)||void 0===o?void 0:o.nonce),a.innerHTML!==e&&(a.innerHTML=e),a;var s=Hn(e,n);return s.setAttribute(Vn(n),t),s}function $n(e){if(Array.isArray(e))return e}function Wn(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function qn(e,t){return $n(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return s}}(e,t)||en(e,t)||Wn()}var Xn=function(){function e(){Tn(this,e),on(this,"cache",void 0),on(this,"keys",void 0),on(this,"cacheCallTimes",void 0),this.cache=new Map,this.keys=[],this.cacheCallTimes=0}return An(e,[{key:"size",value:function(){return this.keys.length}},{key:"internalGet",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={map:this.cache};return e.forEach((function(e){var t,n;r=r?null===(t=r)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.get(e):void 0})),null!==(t=r)&&void 0!==t&&t.value&&i&&(r.value[1]=this.cacheCallTimes++),null===(n=r)||void 0===n?void 0:n.value}},{key:"get",value:function(e){var t;return null===(t=this.internalGet(e,!0))||void 0===t?void 0:t[0]}},{key:"has",value:function(e){return!!this.internalGet(e)}},{key:"set",value:function(t,n){var i=this;if(!this.has(t)){if(this.size()+1>e.MAX_CACHE_SIZE+e.MAX_CACHE_OFFSET){var r=this.keys.reduce((function(e,t){var n=qn(e,2)[1];return i.internalGet(t)[1]<n?[t,i.internalGet(t)[1]]:e}),[this.keys[0],this.cacheCallTimes]),o=qn(r,1)[0];this.delete(o)}this.keys.push(t)}var a=this.cache;t.forEach((function(e,r){if(r===t.length-1)a.set(e,{value:[n,i.cacheCallTimes++]});else{var o=a.get(e);o?o.map||(o.map=new Map):a.set(e,{map:new Map}),a=a.get(e).map}}))}},{key:"deleteByPath",value:function(e,t){var n,i=e.get(t[0]);if(1===t.length)return i.map?e.set(t[0],{map:i.map}):e.delete(t[0]),null===(n=i.value)||void 0===n?void 0:n[0];var r=this.deleteByPath(i.map,t.slice(1));return i.map&&0!==i.map.size||i.value||e.delete(t[0]),r}},{key:"delete",value:function(e){if(this.has(e))return this.keys=this.keys.filter((function(t){return!function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,e)})),this.deleteByPath(this.cache,e)}}]),e}();on(Xn,"MAX_CACHE_SIZE",20),on(Xn,"MAX_CACHE_OFFSET",5);var Yn=0,Jn=function(){function e(t){Tn(this,e),on(this,"derivatives",void 0),on(this,"id",void 0),this.derivatives=Array.isArray(t)?t:[t],this.id=Yn,0===t.length&&t.length,Yn+=1}return An(e,[{key:"getDerivativeToken",value:function(e){return this.derivatives.reduce((function(t,n){return n(e,t)}),void 0)}}]),e}(),Kn=new Xn;function Qn(e){var t=Array.isArray(e)?e:[e];return Kn.has(t)||Kn.set(t,new Jn(t)),Kn.get(t)}var Zn=new WeakMap;function ei(e){var t=Zn.get(e)||"";return t||(Object.keys(e).forEach((function(n){var i=e[n];t+=n,i instanceof Jn?t+=i.id:i&&"object"===nn(i)?t+=ei(i):t+=i})),Zn.set(e,t)),t}var ti="random-".concat(Date.now(),"-").concat(Math.random()).replace(/\./g,""),ni="_bAmBoO_";var ii=void 0,ri=Dn()?o.useLayoutEffect:o.useEffect;const oi=function(e,t){var n=o.useRef(!0);ri((function(){return e(n.current)}),t),ri((function(){return n.current=!1,function(){n.current=!0}}),[])};var ai=sn({},a).useInsertionEffect;const si=ai?function(e,t,n){return ai((function(){return e(),t()}),n)}:function(e,t,n){o.useMemo(e,n),oi((function(){return t(!0)}),n)};var li=void 0!==sn({},a).useInsertionEffect?function(e){var t=[],n=!1;return o.useEffect((function(){return n=!1,function(){n=!0,t.length&&t.forEach((function(e){return e()}))}}),e),function(e){n||t.push(e)}}:function(){return function(e){e()}};const ci=li,ui=function(){return!1};function di(e,t,n,i,r){var a=o.useContext(Nn).cache,s=[e].concat(tn(t)),l=s.join("_"),c=ci([l]),u=(ui(),function(e){a.update(s,(function(t){var i=qn(t||[],2),r=i[0],o=[void 0===r?0:r,i[1]||n()];return e?e(o):o}))});o.useMemo((function(){u()}),[l]);var d=a.get(s)[1];return si((function(){null==r||r(d)}),(function(e){return u((function(t){var n=qn(t,2),i=n[0],o=n[1];return e&&0===i&&(null==r||r(d)),[i+1,o]})),function(){a.update(s,(function(e){var t=qn(e||[],2),n=t[0],r=void 0===n?0:n,o=t[1];return 0==r-1?(c((function(){return null==i?void 0:i(o,!1)})),null):[r-1,o]}))}}),[l]),d}var hi={},pi="css",fi=new Map,mi=0;var gi=function(e,t,n,i){var r=sn(sn({},n.getDerivativeToken(e)),t);return i&&(r=i(r)),r};function _i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(0,o.useContext)(Nn).cache.instanceId,r=n.salt,a=void 0===r?"":r,s=n.override,l=void 0===s?hi:s,c=n.formatToken,u=n.getComputedToken,d=o.useMemo((function(){return Object.assign.apply(Object,[{}].concat(tn(t)))}),[t]),h=o.useMemo((function(){return ei(d)}),[d]),p=o.useMemo((function(){return ei(l)}),[l]),f=di("token",[a,e.id,h,p],(function(){var t=u?u(d,l,e):gi(d,l,e,c),n=function(e,t){return fn("".concat(t,"_").concat(ei(e)))}(t,a);t._tokenKey=n,function(e){fi.set(e,(fi.get(e)||0)+1)}(n);var i="".concat(pi,"-").concat(fn(n));return t._hashId=i,[t,i]}),(function(e){!function(e,t){fi.set(e,(fi.get(e)||0)-1);var n=Array.from(fi.keys()),i=n.filter((function(e){return(fi.get(e)||0)<=0}));n.length-i.length>mi&&i.forEach((function(e){!function(e,t){"undefined"!=typeof document&&document.querySelectorAll("style[".concat(Rn,'="').concat(e,'"]')).forEach((function(e){var n;e[Mn]===t&&(null===(n=e.parentNode)||void 0===n||n.removeChild(e))}))}(e,t),fi.delete(e)}))}(e[0]._tokenKey,i)}));return f}const vi={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};var yi="comm",Ei="rule",bi="decl",Si="@import",Ti="@keyframes",xi="@layer",Ai=Math.abs,wi=String.fromCharCode;function Ii(e){return e.trim()}function Ri(e,t,n){return e.replace(t,n)}function Ci(e,t){return e.indexOf(t)}function Mi(e,t){return 0|e.charCodeAt(t)}function ki(e,t,n){return e.slice(t,n)}function Ni(e){return e.length}function Di(e,t){return t.push(e),e}function Oi(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function Pi(e,t,n,i){switch(e.type){case xi:if(e.children.length)break;case Si:case bi:return e.return=e.return||e.value;case yi:return"";case Ti:return e.return=e.value+"{"+Oi(e.children,i)+"}";case Ei:if(!Ni(e.value=e.props.join(",")))return""}return Ni(n=Oi(e.children,i))?e.return=e.value+"{"+n+"}":""}Object.assign;var Li=1,Ui=1,Vi=0,Fi=0,Bi=0,Hi="";function zi(e,t,n,i,r,o,a,s){return{value:e,root:t,parent:n,type:i,props:r,children:o,line:Li,column:Ui,length:a,return:"",siblings:s}}function ji(){return Bi=Fi>0?Mi(Hi,--Fi):0,Ui--,10===Bi&&(Ui=1,Li--),Bi}function Gi(){return Bi=Fi<Vi?Mi(Hi,Fi++):0,Ui++,10===Bi&&(Ui=1,Li++),Bi}function $i(){return Mi(Hi,Fi)}function Wi(){return Fi}function qi(e,t){return ki(Hi,e,t)}function Xi(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Yi(e){return Ii(qi(Fi-1,Qi(91===e?e+2:40===e?e+1:e)))}function Ji(e){for(;(Bi=$i())&&Bi<33;)Gi();return Xi(e)>2||Xi(Bi)>3?"":" "}function Ki(e,t){for(;--t&&Gi()&&!(Bi<48||Bi>102||Bi>57&&Bi<65||Bi>70&&Bi<97););return qi(e,Wi()+(t<6&&32==$i()&&32==Gi()))}function Qi(e){for(;Gi();)switch(Bi){case e:return Fi;case 34:case 39:34!==e&&39!==e&&Qi(Bi);break;case 40:41===e&&Qi(e);break;case 92:Gi()}return Fi}function Zi(e,t){for(;Gi()&&e+Bi!==57&&(e+Bi!==84||47!==$i()););return"/*"+qi(t,Fi-1)+"*"+wi(47===e?e:Gi())}function er(e){for(;!Xi($i());)Gi();return qi(e,Fi)}function tr(e){return function(e){return Hi="",e}(nr("",null,null,null,[""],e=function(e){return Li=Ui=1,Vi=Ni(Hi=e),Fi=0,[]}(e),0,[0],e))}function nr(e,t,n,i,r,o,a,s,l){for(var c=0,u=0,d=a,h=0,p=0,f=0,m=1,g=1,_=1,v=0,y="",E=r,b=o,S=i,T=y;g;)switch(f=v,v=Gi()){case 40:if(108!=f&&58==Mi(T,d-1)){-1!=Ci(T+=Ri(Yi(v),"&","&\f"),"&\f")&&(_=-1);break}case 34:case 39:case 91:T+=Yi(v);break;case 9:case 10:case 13:case 32:T+=Ji(f);break;case 92:T+=Ki(Wi()-1,7);continue;case 47:switch($i()){case 42:case 47:Di(rr(Zi(Gi(),Wi()),t,n,l),l);break;default:T+="/"}break;case 123*m:s[c++]=Ni(T)*_;case 125*m:case 59:case 0:switch(v){case 0:case 125:g=0;case 59+u:-1==_&&(T=Ri(T,/\f/g,"")),p>0&&Ni(T)-d&&Di(p>32?or(T+";",i,n,d-1,l):or(Ri(T," ","")+";",i,n,d-2,l),l);break;case 59:T+=";";default:if(Di(S=ir(T,t,n,c,u,r,s,y,E=[],b=[],d,o),o),123===v)if(0===u)nr(T,t,S,S,E,o,d,s,b);else switch(99===h&&110===Mi(T,3)?100:h){case 100:case 108:case 109:case 115:nr(e,S,S,i&&Di(ir(e,S,S,0,0,r,s,y,r,E=[],d,b),b),r,b,d,s,i?E:b);break;default:nr(T,S,S,S,[""],b,0,s,b)}}c=u=p=0,m=_=1,y=T="",d=a;break;case 58:d=1+Ni(T),p=f;default:if(m<1)if(123==v)--m;else if(125==v&&0==m++&&125==ji())continue;switch(T+=wi(v),v*m){case 38:_=u>0?1:(T+="\f",-1);break;case 44:s[c++]=(Ni(T)-1)*_,_=1;break;case 64:45===$i()&&(T+=Yi(Gi())),h=$i(),u=d=Ni(y=T+=er(Wi())),v++;break;case 45:45===f&&2==Ni(T)&&(m=0)}}return o}function ir(e,t,n,i,r,o,a,s,l,c,u,d){for(var h=r-1,p=0===r?o:[""],f=function(e){return e.length}(p),m=0,g=0,_=0;m<i;++m)for(var v=0,y=ki(e,h+1,h=Ai(g=a[m])),E=e;v<f;++v)(E=Ii(g>0?p[v]+" "+y:Ri(y,/&\f/g,p[v])))&&(l[_++]=E);return zi(e,t,n,0===r?Ei:s,l,c,u,d)}function rr(e,t,n,i){return zi(e,t,n,yi,wi(Bi),ki(e,2,-2),0,i)}function or(e,t,n,i,r){return zi(e,t,n,bi,ki(e,0,i),ki(e,i+1,-1),i,r)}var ar,sr="data-ant-cssinjs-cache-path",lr="_FILE_STYLE__",cr=!0;var ur=Dn(),dr="_multi_value_";function hr(e){return Oi(tr(e),Pi).replace(/\{%%%\:[^;];}/g,";")}var pr=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{root:!0,parentSelectors:[]},r=i.root,o=i.injectHash,a=i.parentSelectors,s=n.hashId,l=n.layer,c=(n.path,n.hashPriority),u=n.transformers,d=void 0===u?[]:u,h=(n.linters,""),p={};function f(t){var i=t.getName(s);if(!p[i]){var r=qn(e(t.style,n,{root:!1,parentSelectors:a}),1)[0];p[i]="@keyframes ".concat(t.getName(s)).concat(r)}}var m=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.forEach((function(t){Array.isArray(t)?e(t,n):t&&n.push(t)})),n}(Array.isArray(t)?t:[t]);if(m.forEach((function(t){var i="string"!=typeof t||r?t:{};if("string"==typeof i)h+="".concat(i,"\n");else if(i._keyframe)f(i);else{var l=d.reduce((function(e,t){var n;return(null==t||null===(n=t.visit)||void 0===n?void 0:n.call(t,e))||e}),i);Object.keys(l).forEach((function(t){var i=l[t];if("object"!==nn(i)||!i||"animationName"===t&&i._keyframe||function(e){return"object"===nn(e)&&e&&("_skip_check_"in e||dr in e)}(i)){var u;function b(e,t){var n=e.replace(/[A-Z]/g,(function(e){return"-".concat(e.toLowerCase())})),i=t;vi[e]||"number"!=typeof i||0===i||(i="".concat(i,"px")),"animationName"===e&&null!=t&&t._keyframe&&(f(t),i=t.getName(s)),h+="".concat(n,":").concat(i,";")}var d=null!==(u=null==i?void 0:i.value)&&void 0!==u?u:i;"object"===nn(i)&&null!=i&&i[dr]&&Array.isArray(d)?d.forEach((function(e){b(t,e)})):b(t,d)}else{var m=!1,g=t.trim(),_=!1;(r||o)&&s?g.startsWith("@")?m=!0:g=function(e,t,n){if(!t)return e;var i=".".concat(t),r="low"===n?":where(".concat(i,")"):i,o=e.split(",").map((function(e){var t,n=e.trim().split(/\s+/),i=n[0]||"",o=(null===(t=i.match(/^\w+/))||void 0===t?void 0:t[0])||"";return[i="".concat(o).concat(r).concat(i.slice(o.length))].concat(tn(n.slice(1))).join(" ")}));return o.join(",")}(t,s,c):!r||s||"&"!==g&&""!==g||(g="",_=!0);var v=qn(e(i,n,{root:_,injectHash:m,parentSelectors:[].concat(tn(a),[g])}),2),y=v[0],E=v[1];p=sn(sn({},p),E),h+="".concat(g).concat(y)}}))}})),r){if(l&&(void 0===ii&&(ii=function(e,t,n){if(Dn()){var i,r;Gn(e,ti);var o=document.createElement("div");o.style.position="fixed",o.style.left="0",o.style.top="0",null==t||t(o),document.body.appendChild(o);var a=n?n(o):null===(i=getComputedStyle(o).content)||void 0===i?void 0:i.includes(ni);return null===(r=o.parentNode)||void 0===r||r.removeChild(o),jn(ti),a}return!1}("@layer ".concat(ti," { .").concat(ti,' { content: "').concat(ni,'"!important; } }'),(function(e){e.className=ti}))),ii)){var g=l.split(","),_=g[g.length-1].trim();h="@layer ".concat(_," {").concat(h,"}"),g.length>1&&(h="@layer ".concat(l,"{%%%:%}").concat(h))}}else h="{".concat(h,"}");return[h,p]};function fr(){return null}function mr(e,t){var n=e.token,i=e.path,r=e.hashId,a=e.layer,s=e.nonce,l=e.clientOnly,c=e.order,u=void 0===c?0:c,d=o.useContext(Nn),h=d.autoClear,p=(d.mock,d.defaultCache),f=d.hashPriority,m=d.container,g=d.ssrInline,_=d.transformers,v=d.linters,y=d.cache,E=n._tokenKey,b=[E].concat(tn(i)),S=ur,T=di("style",b,(function(){var e=b.join("|");if(function(e){return function(){if(!ar&&(ar={},Dn())){var e=document.createElement("div");e.className=sr,e.style.position="fixed",e.style.visibility="hidden",e.style.top="-9999px",document.body.appendChild(e);var t=getComputedStyle(e).content||"";(t=t.replace(/^"/,"").replace(/"$/,"")).split(";").forEach((function(e){var t=qn(e.split(":"),2),n=t[0],i=t[1];ar[n]=i}));var n,i=document.querySelector("style[".concat(sr,"]"));i&&(cr=!1,null===(n=i.parentNode)||void 0===n||n.removeChild(i)),document.body.removeChild(e)}}(),!!ar[e]}(e)){var n=function(e){var t=ar[e],n=null;if(t&&Dn())if(cr)n=lr;else{var i=document.querySelector("style[".concat(Cn,'="').concat(ar[e],'"]'));i?n=i.innerHTML:delete ar[e]}return[n,t]}(e),o=qn(n,2),s=o[0],c=o[1];if(s)return[s,E,c,{},l,u]}var d=t(),h=qn(pr(d,{hashId:r,hashPriority:f,layer:a,path:i.join("-"),transformers:_,linters:v}),2),p=h[0],m=h[1],g=hr(p),y=function(e,t){return fn("".concat(e.join("%")).concat(t))}(b,g);return[g,E,y,m,l,u]}),(function(e,t){var n=qn(e,3)[2];(t||h)&&ur&&jn(n,{mark:Cn})}),(function(e){var t=qn(e,4),n=t[0],i=(t[1],t[2]),r=t[3];if(S&&n!==lr){var o={mark:Cn,prepend:"queue",attachTo:m,priority:u},a="function"==typeof s?s():s;a&&(o.csp={nonce:a});var l=Gn(n,i,o);l[Mn]=y.instanceId,l.setAttribute(Rn,E),Object.keys(r).forEach((function(e){Gn(hr(r[e]),"_effect-".concat(e),o)}))}})),x=qn(T,3),A=x[0],w=x[1],I=x[2];return function(e){var t,n;return t=g&&!S&&p?o.createElement("style",j({},(on(n={},Rn,w),on(n,Cn,I),n),{dangerouslySetInnerHTML:{__html:A}})):o.createElement(fr,null),o.createElement(o.Fragment,null,t,e)}}var gr=function(){function e(t,n){Tn(this,e),on(this,"name",void 0),on(this,"style",void 0),on(this,"_keyframe",!0),this.name=t,this.style=n}return An(e,[{key:"getName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e?"".concat(e,"-").concat(this.name):this.name}}]),e}();const _r=gr;function vr(e){return e.notSplit=!0,e}vr(["borderTop","borderBottom"]),vr(["borderTop"]),vr(["borderBottom"]),vr(["borderLeft","borderRight"]),vr(["borderLeft"]),vr(["borderRight"]);const yr=(0,o.createContext)({});function Er(e,t){for(var n=e,i=0;i<t.length;i+=1){if(null==n)return;n=n[t[i]]}return n}function br(e,t,n,i){if(!t.length)return n;var r,o,a=$n(r=t)||Zt(r)||en(r)||Wn(),s=a[0],l=a.slice(1);return o=e||"number"!=typeof s?Array.isArray(e)?tn(e):sn({},e):[],i&&void 0===n&&1===l.length?delete o[s][l[0]]:o[s]=br(o[s],l,n,i),o}function Sr(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.length&&i&&void 0===n&&!Er(e,t.slice(0,-1))?e:br(e,t,n,i)}function Tr(e){return Array.isArray(e)?[]:{}}var xr="undefined"==typeof Reflect?Object.keys:Reflect.ownKeys;const Ar=(0,o.createContext)(void 0),wr={placeholder:"Select time",rangePlaceholder:["Start time","End time"]},Ir={lang:Object.assign({placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeQuarterPlaceholder:["Start quarter","End quarter"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"]},{locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"OK",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",yearFormat:"YYYY",dateFormat:"M/D/YYYY",dayFormat:"D",dateTimeFormat:"M/D/YYYY HH:mm:ss",monthBeforeYear:!0,previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"}),timePickerLocale:Object.assign({},wr)},Rr="${label} is not a valid ${type}",Cr={locale:"en",Pagination:{items_per_page:"/ page",jump_to:"Go to",jump_to_confirm:"confirm",page:"Page",prev_page:"Previous Page",next_page:"Next Page",prev_5:"Previous 5 Pages",next_5:"Next 5 Pages",prev_3:"Previous 3 Pages",next_3:"Next 3 Pages",page_size:"Page Size"},DatePicker:Ir,TimePicker:wr,Calendar:Ir,global:{placeholder:"Please select"},Table:{filterTitle:"Filter menu",filterConfirm:"OK",filterReset:"Reset",filterEmptyText:"No filters",filterCheckall:"Select all items",filterSearchPlaceholder:"Search in filters",emptyText:"No data",selectAll:"Select current page",selectInvert:"Invert current page",selectNone:"Clear all data",selectionAll:"Select all data",sortTitle:"Sort",expand:"Expand row",collapse:"Collapse row",triggerDesc:"Click to sort descending",triggerAsc:"Click to sort ascending",cancelSort:"Click to cancel sorting"},Tour:{Next:"Next",Previous:"Previous",Finish:"Finish"},Modal:{okText:"OK",cancelText:"Cancel",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancel"},Transfer:{titles:["",""],searchPlaceholder:"Search here",itemUnit:"item",itemsUnit:"items",remove:"Remove",selectCurrent:"Select current page",removeCurrent:"Remove current page",selectAll:"Select all data",removeAll:"Remove all data",selectInvert:"Invert current page"},Upload:{uploading:"Uploading...",removeFile:"Remove file",uploadError:"Upload error",previewFile:"Preview file",downloadFile:"Download file"},Empty:{description:"No data"},Icon:{icon:"icon"},Text:{edit:"Edit",copy:"Copy",copied:"Copied",expand:"Expand"},PageHeader:{back:"Back"},Form:{optional:"(optional)",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:Rr,method:Rr,array:Rr,object:Rr,number:Rr,date:Rr,boolean:Rr,integer:Rr,float:Rr,regexp:Rr,email:Rr,url:Rr,hex:Rr},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},Image:{preview:"Preview"},QRCode:{expired:"QR code expired",refresh:"Refresh"},ColorPicker:{presetEmpty:"Empty"}};let Mr=Object.assign({},Cr.Modal),kr=[];const Nr=()=>kr.reduce(((e,t)=>Object.assign(Object.assign({},e),t)),Cr.Modal),Dr=(0,o.createContext)(void 0),Or=e=>{const{locale:t={},children:n,_ANT_MARK__:i}=e;o.useEffect((()=>{const e=function(e){if(e){const t=Object.assign({},e);return kr.push(t),Mr=Nr(),()=>{kr=kr.filter((e=>e!==t)),Mr=Nr()}}Mr=Object.assign({},Cr.Modal)}(t&&t.Modal);return e}),[t]);const r=o.useMemo((()=>Object.assign(Object.assign({},t),{exist:!0})),[t]);return o.createElement(Dr.Provider,{value:r},n)};function Pr(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function Lr(e){return Math.min(1,Math.max(0,e))}function Ur(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function Vr(e){return e<=1?"".concat(100*Number(e),"%"):e}function Fr(e){return 1===e.length?"0"+e:String(e)}function Br(e,t,n){e=Pr(e,255),t=Pr(t,255),n=Pr(n,255);var i=Math.max(e,t,n),r=Math.min(e,t,n),o=0,a=0,s=(i+r)/2;if(i===r)a=0,o=0;else{var l=i-r;switch(a=s>.5?l/(2-i-r):l/(i+r),i){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4}o/=6}return{h:o,s:a,l:s}}function Hr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function zr(e,t,n){e=Pr(e,255),t=Pr(t,255),n=Pr(n,255);var i=Math.max(e,t,n),r=Math.min(e,t,n),o=0,a=i,s=i-r,l=0===i?0:s/i;if(i===r)o=0;else{switch(i){case e:o=(t-n)/s+(t<n?6:0);break;case t:o=(n-e)/s+2;break;case n:o=(e-t)/s+4}o/=6}return{h:o,s:l,v:a}}function jr(e,t,n,i){var r=[Fr(Math.round(e).toString(16)),Fr(Math.round(t).toString(16)),Fr(Math.round(n).toString(16))];return i&&r[0].startsWith(r[0].charAt(1))&&r[1].startsWith(r[1].charAt(1))&&r[2].startsWith(r[2].charAt(1))?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function Gr(e){return Math.round(255*parseFloat(e)).toString(16)}function $r(e){return Wr(e)/255}function Wr(e){return parseInt(e,16)}var qr={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Xr(e){var t={r:0,g:0,b:0},n=1,i=null,r=null,o=null,a=!1,s=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(qr[e])e=qr[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=Qr.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=Qr.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=Qr.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=Qr.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=Qr.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=Qr.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=Qr.hex8.exec(e))?{r:Wr(n[1]),g:Wr(n[2]),b:Wr(n[3]),a:$r(n[4]),format:t?"name":"hex8"}:(n=Qr.hex6.exec(e))?{r:Wr(n[1]),g:Wr(n[2]),b:Wr(n[3]),format:t?"name":"hex"}:(n=Qr.hex4.exec(e))?{r:Wr(n[1]+n[1]),g:Wr(n[2]+n[2]),b:Wr(n[3]+n[3]),a:$r(n[4]+n[4]),format:t?"name":"hex8"}:!!(n=Qr.hex3.exec(e))&&{r:Wr(n[1]+n[1]),g:Wr(n[2]+n[2]),b:Wr(n[3]+n[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(Zr(e.r)&&Zr(e.g)&&Zr(e.b)?(t=function(e,t,n){return{r:255*Pr(e,255),g:255*Pr(t,255),b:255*Pr(n,255)}}(e.r,e.g,e.b),a=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):Zr(e.h)&&Zr(e.s)&&Zr(e.v)?(i=Vr(e.s),r=Vr(e.v),t=function(e,t,n){e=6*Pr(e,360),t=Pr(t,100),n=Pr(n,100);var i=Math.floor(e),r=e-i,o=n*(1-t),a=n*(1-r*t),s=n*(1-(1-r)*t),l=i%6;return{r:255*[n,a,o,o,s,n][l],g:255*[s,n,n,a,o,o][l],b:255*[o,o,s,n,n,a][l]}}(e.h,i,r),a=!0,s="hsv"):Zr(e.h)&&Zr(e.s)&&Zr(e.l)&&(i=Vr(e.s),o=Vr(e.l),t=function(e,t,n){var i,r,o;if(e=Pr(e,360),t=Pr(t,100),n=Pr(n,100),0===t)r=n,o=n,i=n;else{var a=n<.5?n*(1+t):n+t-n*t,s=2*n-a;i=Hr(s,a,e+1/3),r=Hr(s,a,e),o=Hr(s,a,e-1/3)}return{r:255*i,g:255*r,b:255*o}}(e.h,i,o),a=!0,s="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(n=e.a)),n=Ur(n),{ok:a,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}var Yr="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Jr="[\\s|\\(]+(".concat(Yr,")[,|\\s]+(").concat(Yr,")[,|\\s]+(").concat(Yr,")\\s*\\)?"),Kr="[\\s|\\(]+(".concat(Yr,")[,|\\s]+(").concat(Yr,")[,|\\s]+(").concat(Yr,")[,|\\s]+(").concat(Yr,")\\s*\\)?"),Qr={CSS_UNIT:new RegExp(Yr),rgb:new RegExp("rgb"+Jr),rgba:new RegExp("rgba"+Kr),hsl:new RegExp("hsl"+Jr),hsla:new RegExp("hsla"+Kr),hsv:new RegExp("hsv"+Jr),hsva:new RegExp("hsva"+Kr),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Zr(e){return Boolean(Qr.CSS_UNIT.exec(String(e)))}var eo=2,to=.16,no=.05,io=.05,ro=.15,oo=5,ao=4,so=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function lo(e){var t=zr(e.r,e.g,e.b);return{h:360*t.h,s:t.s,v:t.v}}function co(e){var t=e.r,n=e.g,i=e.b;return"#".concat(jr(t,n,i,!1))}function uo(e,t,n){var i;return(i=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-eo*t:Math.round(e.h)+eo*t:n?Math.round(e.h)+eo*t:Math.round(e.h)-eo*t)<0?i+=360:i>=360&&(i-=360),i}function ho(e,t,n){return 0===e.h&&0===e.s?e.s:((i=n?e.s-to*t:t===ao?e.s+to:e.s+no*t)>1&&(i=1),n&&t===oo&&i>.1&&(i=.1),i<.06&&(i=.06),Number(i.toFixed(2)));var i}function po(e,t,n){var i;return(i=n?e.v+io*t:e.v-ro*t)>1&&(i=1),Number(i.toFixed(2))}function fo(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],i=Xr(e),r=oo;r>0;r-=1){var o=lo(i),a=co(Xr({h:uo(o,r,!0),s:ho(o,r,!0),v:po(o,r,!0)}));n.push(a)}n.push(co(i));for(var s=1;s<=ao;s+=1){var l=lo(i),c=co(Xr({h:uo(l,s),s:ho(l,s),v:po(l,s)}));n.push(c)}return"dark"===t.theme?so.map((function(e){var i,r,o,a=e.index,s=e.opacity;return co((i=Xr(t.backgroundColor||"#141414"),o=100*s/100,{r:((r=Xr(n[a])).r-i.r)*o+i.r,g:(r.g-i.g)*o+i.g,b:(r.b-i.b)*o+i.b}))})):n}var mo={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},go={},_o={};Object.keys(mo).forEach((function(e){go[e]=fo(mo[e]),go[e].primary=go[e][5],_o[e]=fo(mo[e],{theme:"dark",backgroundColor:"#141414"}),_o[e].primary=_o[e][5]})),go.red,go.volcano,go.gold,go.orange,go.yellow,go.lime,go.green,go.cyan;var vo=go.blue;go.geekblue,go.purple,go.magenta,go.grey,go.grey;const yo={blue:"#1677ff",purple:"#722ED1",cyan:"#13C2C2",green:"#52C41A",magenta:"#EB2F96",pink:"#eb2f96",red:"#F5222D",orange:"#FA8C16",yellow:"#FADB14",volcano:"#FA541C",geekblue:"#2F54EB",gold:"#FAAD14",lime:"#A0D911"},Eo=Object.assign(Object.assign({},yo),{colorPrimary:"#1677ff",colorSuccess:"#52c41a",colorWarning:"#faad14",colorError:"#ff4d4f",colorInfo:"#1677ff",colorLink:"",colorTextBase:"",colorBgBase:"",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,\n'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',\n'Noto Color Emoji'",fontFamilyCode:"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace",fontSize:14,lineWidth:1,lineType:"solid",motionUnit:.1,motionBase:0,motionEaseOutCirc:"cubic-bezier(0.08, 0.82, 0.17, 1)",motionEaseInOutCirc:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",motionEaseOut:"cubic-bezier(0.215, 0.61, 0.355, 1)",motionEaseInOut:"cubic-bezier(0.645, 0.045, 0.355, 1)",motionEaseOutBack:"cubic-bezier(0.12, 0.4, 0.29, 1.46)",motionEaseInBack:"cubic-bezier(0.71, -0.46, 0.88, 0.6)",motionEaseInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",motionEaseOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",borderRadius:6,sizeUnit:4,sizeStep:4,sizePopupArrow:16,controlHeight:32,zIndexBase:0,zIndexPopupBase:1e3,opacityImage:1,wireframe:!1,motion:!0});var bo=function(){function e(t,n){var i;if(void 0===t&&(t=""),void 0===n&&(n={}),t instanceof e)return t;"number"==typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var r=Xr(t);this.originalInput=t,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(i=n.format)&&void 0!==i?i:r.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,n=e.g/255,i=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=Ur(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var e=zr(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=zr(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),i=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(n,"%, ").concat(i,"%)"):"hsva(".concat(t,", ").concat(n,"%, ").concat(i,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=Br(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=Br(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),i=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(n,"%, ").concat(i,"%)"):"hsla(".concat(t,", ").concat(n,"%, ").concat(i,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),jr(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,n,i,r){var o=[Fr(Math.round(e).toString(16)),Fr(Math.round(t).toString(16)),Fr(Math.round(n).toString(16)),Fr(Gr(i))];return r&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))&&o[3].startsWith(o[3].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toHexShortString=function(e){return void 0===e&&(e=!1),1===this.a?this.toHexString(e):this.toHex8String(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(n,")"):"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*Pr(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*Pr(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+jr(this.r,this.g,this.b,!1),t=0,n=Object.entries(qr);t<n.length;t++){var i=n[t],r=i[0];if(e===i[1])return r}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!=e?e:this.format;var n=!1,i=this.a<1&&this.a>=0;return t||!i||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l+=t/100,n.l=Lr(n.l),new e(n)},e.prototype.brighten=function(t){void 0===t&&(t=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),new e(n)},e.prototype.darken=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l-=t/100,n.l=Lr(n.l),new e(n)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s-=t/100,n.s=Lr(n.s),new e(n)},e.prototype.saturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s+=t/100,n.s=Lr(n.s),new e(n)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var n=this.toHsl(),i=(n.h+t)%360;return n.h=i<0?360+i:i,new e(n)},e.prototype.mix=function(t,n){void 0===n&&(n=50);var i=this.toRgb(),r=new e(t).toRgb(),o=n/100;return new e({r:(r.r-i.r)*o+i.r,g:(r.g-i.g)*o+i.g,b:(r.b-i.b)*o+i.b,a:(r.a-i.a)*o+i.a})},e.prototype.analogous=function(t,n){void 0===t&&(t=6),void 0===n&&(n=30);var i=this.toHsl(),r=360/n,o=[this];for(i.h=(i.h-(r*t>>1)+720)%360;--t;)i.h=(i.h+r)%360,o.push(new e(i));return o},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var n=this.toHsv(),i=n.h,r=n.s,o=n.v,a=[],s=1/t;t--;)a.push(new e({h:i,s:r,v:o})),o=(o+s)%1;return a},e.prototype.splitcomplement=function(){var t=this.toHsl(),n=t.h;return[this,new e({h:(n+72)%360,s:t.s,l:t.l}),new e({h:(n+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var n=this.toRgb(),i=new e(t).toRgb(),r=n.a+i.a*(1-n.a);return new e({r:(n.r*n.a+i.r*i.a*(1-n.a))/r,g:(n.g*n.a+i.g*i.a*(1-n.a))/r,b:(n.b*n.a+i.b*i.a*(1-n.a))/r,a:r})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var n=this.toHsl(),i=n.h,r=[this],o=360/t,a=1;a<t;a++)r.push(new e({h:(i+a*o)%360,s:n.s,l:n.l}));return r},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();const So=(e,t)=>new bo(e).setAlpha(t).toRgbString(),To=(e,t)=>new bo(e).darken(t).toHexString(),xo=e=>{const t=fo(e);return{1:t[0],2:t[1],3:t[2],4:t[3],5:t[4],6:t[5],7:t[6],8:t[4],9:t[5],10:t[6]}},Ao=(e,t)=>{const n=e||"#fff",i=t||"#000";return{colorBgBase:n,colorTextBase:i,colorText:So(i,.88),colorTextSecondary:So(i,.65),colorTextTertiary:So(i,.45),colorTextQuaternary:So(i,.25),colorFill:So(i,.15),colorFillSecondary:So(i,.06),colorFillTertiary:So(i,.04),colorFillQuaternary:So(i,.02),colorBgLayout:To(n,4),colorBgContainer:To(n,0),colorBgElevated:To(n,0),colorBgSpotlight:So(i,.85),colorBorder:To(n,15),colorBorderSecondary:To(n,6)}},wo=Qn((function(e){const t=Object.keys(yo).map((t=>{const n=fo(e[t]);return new Array(10).fill(1).reduce(((e,i,r)=>(e[`${t}-${r+1}`]=n[r],e[`${t}${r+1}`]=n[r],e)),{})})).reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{});return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),t),function(e,t){let{generateColorPalettes:n,generateNeutralColorPalettes:i}=t;const{colorSuccess:r,colorWarning:o,colorError:a,colorInfo:s,colorPrimary:l,colorBgBase:c,colorTextBase:u}=e,d=n(l),h=n(r),p=n(o),f=n(a),m=n(s),g=i(c,u),_=n(e.colorLink||e.colorInfo);return Object.assign(Object.assign({},g),{colorPrimaryBg:d[1],colorPrimaryBgHover:d[2],colorPrimaryBorder:d[3],colorPrimaryBorderHover:d[4],colorPrimaryHover:d[5],colorPrimary:d[6],colorPrimaryActive:d[7],colorPrimaryTextHover:d[8],colorPrimaryText:d[9],colorPrimaryTextActive:d[10],colorSuccessBg:h[1],colorSuccessBgHover:h[2],colorSuccessBorder:h[3],colorSuccessBorderHover:h[4],colorSuccessHover:h[4],colorSuccess:h[6],colorSuccessActive:h[7],colorSuccessTextHover:h[8],colorSuccessText:h[9],colorSuccessTextActive:h[10],colorErrorBg:f[1],colorErrorBgHover:f[2],colorErrorBorder:f[3],colorErrorBorderHover:f[4],colorErrorHover:f[5],colorError:f[6],colorErrorActive:f[7],colorErrorTextHover:f[8],colorErrorText:f[9],colorErrorTextActive:f[10],colorWarningBg:p[1],colorWarningBgHover:p[2],colorWarningBorder:p[3],colorWarningBorderHover:p[4],colorWarningHover:p[4],colorWarning:p[6],colorWarningActive:p[7],colorWarningTextHover:p[8],colorWarningText:p[9],colorWarningTextActive:p[10],colorInfoBg:m[1],colorInfoBgHover:m[2],colorInfoBorder:m[3],colorInfoBorderHover:m[4],colorInfoHover:m[4],colorInfo:m[6],colorInfoActive:m[7],colorInfoTextHover:m[8],colorInfoText:m[9],colorInfoTextActive:m[10],colorLinkHover:_[4],colorLink:_[6],colorLinkActive:_[7],colorBgMask:new bo("#000").setAlpha(.45).toRgbString(),colorWhite:"#fff"})}(e,{generateColorPalettes:xo,generateNeutralColorPalettes:Ao})),(e=>{const t=function(e){const t=new Array(10).fill(null).map(((t,n)=>{const i=n-1,r=e*Math.pow(2.71828,i/5),o=n>1?Math.floor(r):Math.ceil(r);return 2*Math.floor(o/2)}));return t[1]=e,t.map((e=>({size:e,lineHeight:(e+8)/e})))}(e),n=t.map((e=>e.size)),i=t.map((e=>e.lineHeight));return{fontSizeSM:n[0],fontSize:n[1],fontSizeLG:n[2],fontSizeXL:n[3],fontSizeHeading1:n[6],fontSizeHeading2:n[5],fontSizeHeading3:n[4],fontSizeHeading4:n[3],fontSizeHeading5:n[2],lineHeight:i[1],lineHeightLG:i[2],lineHeightSM:i[0],lineHeightHeading1:i[6],lineHeightHeading2:i[5],lineHeightHeading3:i[4],lineHeightHeading4:i[3],lineHeightHeading5:i[2]}})(e.fontSize)),function(e){const{sizeUnit:t,sizeStep:n}=e;return{sizeXXL:t*(n+8),sizeXL:t*(n+4),sizeLG:t*(n+2),sizeMD:t*(n+1),sizeMS:t*n,size:t*n,sizeSM:t*(n-1),sizeXS:t*(n-2),sizeXXS:t*(n-3)}}(e)),(e=>{const{controlHeight:t}=e;return{controlHeightSM:.75*t,controlHeightXS:.5*t,controlHeightLG:1.25*t}})(e)),function(e){const{motionUnit:t,motionBase:n,borderRadius:i,lineWidth:r}=e;return Object.assign({motionDurationFast:`${(n+t).toFixed(1)}s`,motionDurationMid:`${(n+2*t).toFixed(1)}s`,motionDurationSlow:`${(n+3*t).toFixed(1)}s`,lineWidthBold:r+1},(e=>{let t=e,n=e,i=e,r=e;return e<6&&e>=5?t=e+1:e<16&&e>=6?t=e+2:e>=16&&(t=16),e<7&&e>=5?n=4:e<8&&e>=7?n=5:e<14&&e>=8?n=6:e<16&&e>=14?n=7:e>=16&&(n=8),e<6&&e>=2?i=1:e>=6&&(i=2),e>4&&e<8?r=4:e>=8&&(r=6),{borderRadius:e>16?16:e,borderRadiusXS:i,borderRadiusSM:n,borderRadiusLG:t,borderRadiusOuter:r}})(i))}(e))})),Io={token:Eo,hashed:!0},Ro=o.createContext(Io),Co="anticon",Mo=o.createContext({getPrefixCls:(e,t)=>t||(e?`ant-${e}`:"ant"),iconPrefixCls:Co}),{Consumer:ko}=Mo,No=`-ant-${Date.now()}-${Math.random()}`;const Do=o.createContext(!1),Oo=e=>{let{children:t,disabled:n}=e;const i=o.useContext(Do);return o.createElement(Do.Provider,{value:null!=n?n:i},t)},Po=Do,Lo=o.createContext(void 0),Uo=e=>{let{children:t,size:n}=e;const i=o.useContext(Lo);return o.createElement(Lo.Provider,{value:n||i},t)},Vo=Lo;var Fo=__webpack_require__(184),Bo=__webpack_require__.n(Fo);var Ho=__webpack_require__(864);function zo(e,t){if(null==e)return{};var n,i,r=G(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var jo=["children"],Go=o.createContext({});function $o(e){var t=e.children,n=zo(e,jo);return o.createElement(Go.Provider,{value:n},t)}function Wo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}function qo(e){return qo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qo(e)}function Xo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=qo(e);if(t){var r=qo(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===nn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Xo(e)}(this,n)}}const Jo=function(e){Wo(n,e);var t=Yo(n);function n(){return Tn(this,n),t.apply(this,arguments)}return An(n,[{key:"render",value:function(){return this.props.children}}]),n}(o.Component);function Ko(e){var t=o.useRef(!1),n=qn(o.useState(e),2),i=n[0],r=n[1];return o.useEffect((function(){return t.current=!1,function(){t.current=!0}}),[]),[i,function(e,n){n&&t.current||r(e)}]}var Qo="none",Zo="appear",ea="enter",ta="leave",na="none",ia="prepare",ra="start",oa="active",aa="end",sa="prepared";function la(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit".concat(e)]="webkit".concat(t),n["Moz".concat(e)]="moz".concat(t),n["ms".concat(e)]="MS".concat(t),n["O".concat(e)]="o".concat(t.toLowerCase()),n}var ca,ua,da,ha=(ca=Dn(),ua="undefined"!=typeof window?window:{},da={animationend:la("Animation","AnimationEnd"),transitionend:la("Transition","TransitionEnd")},ca&&("AnimationEvent"in ua||delete da.animationend.animation,"TransitionEvent"in ua||delete da.transitionend.transition),da),pa={};if(Dn()){var fa=document.createElement("div");pa=fa.style}var ma={};function ga(e){if(ma[e])return ma[e];var t=ha[e];if(t)for(var n=Object.keys(t),i=n.length,r=0;r<i;r+=1){var o=n[r];if(Object.prototype.hasOwnProperty.call(t,o)&&o in pa)return ma[e]=t[o],ma[e]}return""}var _a=ga("animationend"),va=ga("transitionend"),ya=!(!_a||!va),Ea=_a||"animationend",ba=va||"transitionend";function Sa(e,t){return e?"object"===nn(e)?e[t.replace(/-\w/g,(function(e){return e[1].toUpperCase()}))]:"".concat(e,"-").concat(t):null}const Ta=Dn()?o.useLayoutEffect:o.useEffect;var xa=function(e){return+setTimeout(e,16)},Aa=function(e){return clearTimeout(e)};"undefined"!=typeof window&&"requestAnimationFrame"in window&&(xa=function(e){return window.requestAnimationFrame(e)},Aa=function(e){return window.cancelAnimationFrame(e)});var wa=0,Ia=new Map;function Ra(e){Ia.delete(e)}var Ca=function(e){var t=wa+=1;return function n(i){if(0===i)Ra(t),e();else{var r=xa((function(){n(i-1)}));Ia.set(t,r)}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),t};Ca.cancel=function(e){var t=Ia.get(e);return Ra(t),Aa(t)};const Ma=Ca;var ka=[ia,ra,oa,aa],Na=[ia,sa];function Da(e){return e===oa||e===aa}const Oa=function(e){var t=e;"object"===nn(e)&&(t=e.transitionSupport);var n=o.forwardRef((function(e,n){var i=e.visible,r=void 0===i||i,a=e.removeOnLeave,s=void 0===a||a,l=e.forceRender,c=e.children,u=e.motionName,d=e.leavedClassName,h=e.eventProps,p=function(e,n){return!(!e.motionName||!t||!1===n)}(e,o.useContext(Go).motion),f=(0,o.useRef)(),m=(0,o.useRef)(),g=function(e,t,n,i){var r=i.motionEnter,a=void 0===r||r,s=i.motionAppear,l=void 0===s||s,c=i.motionLeave,u=void 0===c||c,d=i.motionDeadline,h=i.motionLeaveImmediately,p=i.onAppearPrepare,f=i.onEnterPrepare,m=i.onLeavePrepare,g=i.onAppearStart,_=i.onEnterStart,v=i.onLeaveStart,y=i.onAppearActive,E=i.onEnterActive,b=i.onLeaveActive,S=i.onAppearEnd,T=i.onEnterEnd,x=i.onLeaveEnd,A=i.onVisibleChanged,w=qn(Ko(),2),I=w[0],R=w[1],C=qn(Ko(Qo),2),M=C[0],k=C[1],N=qn(Ko(null),2),D=N[0],O=N[1],P=(0,o.useRef)(!1),L=(0,o.useRef)(null);function U(){return n()}var V=(0,o.useRef)(!1);function F(){k(Qo,!0),O(null,!0)}function B(e){var t=U();if(!e||e.deadline||e.target===t){var n,i=V.current;M===Zo&&i?n=null==S?void 0:S(t,e):M===ea&&i?n=null==T?void 0:T(t,e):M===ta&&i&&(n=null==x?void 0:x(t,e)),M!==Qo&&i&&!1!==n&&F()}}var H=qn(function(e){var t=(0,o.useRef)(),n=(0,o.useRef)(e);n.current=e;var i=o.useCallback((function(e){n.current(e)}),[]);function r(e){e&&(e.removeEventListener(ba,i),e.removeEventListener(Ea,i))}return o.useEffect((function(){return function(){r(t.current)}}),[]),[function(e){t.current&&t.current!==e&&r(t.current),e&&e!==t.current&&(e.addEventListener(ba,i),e.addEventListener(Ea,i),t.current=e)},r]}(B),1)[0],z=function(e){var t,n,i;switch(e){case Zo:return on(t={},ia,p),on(t,ra,g),on(t,oa,y),t;case ea:return on(n={},ia,f),on(n,ra,_),on(n,oa,E),n;case ta:return on(i={},ia,m),on(i,ra,v),on(i,oa,b),i;default:return{}}},j=o.useMemo((function(){return z(M)}),[M]),G=qn(function(e,t,n){var i=qn(Ko(na),2),r=i[0],a=i[1],s=function(){var e=o.useRef(null);function t(){Ma.cancel(e.current)}return o.useEffect((function(){return function(){t()}}),[]),[function n(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;t();var o=Ma((function(){r<=1?i({isCanceled:function(){return o!==e.current}}):n(i,r-1)}));e.current=o},t]}(),l=qn(s,2),c=l[0],u=l[1],d=t?Na:ka;return Ta((function(){if(r!==na&&r!==aa){var e=d.indexOf(r),t=d[e+1],i=n(r);!1===i?a(t,!0):t&&c((function(e){function n(){e.isCanceled()||a(t,!0)}!0===i?n():Promise.resolve(i).then(n)}))}}),[e,r]),o.useEffect((function(){return function(){u()}}),[]),[function(){a(ia,!0)},r]}(M,!e,(function(e){if(e===ia){var t=j[ia];return!!t&&t(U())}var n;return W in j&&O((null===(n=j[W])||void 0===n?void 0:n.call(j,U(),null))||null),W===oa&&(H(U()),d>0&&(clearTimeout(L.current),L.current=setTimeout((function(){B({deadline:!0})}),d))),W===sa&&F(),true})),2),$=G[0],W=G[1],q=Da(W);V.current=q,Ta((function(){R(t);var n,i=P.current;P.current=!0,!i&&t&&l&&(n=Zo),i&&t&&a&&(n=ea),(i&&!t&&u||!i&&h&&!t&&u)&&(n=ta);var r=z(n);n&&(e||r[ia])?(k(n),$()):k(Qo)}),[t]),(0,o.useEffect)((function(){(M===Zo&&!l||M===ea&&!a||M===ta&&!u)&&k(Qo)}),[l,a,u]),(0,o.useEffect)((function(){return function(){P.current=!1,clearTimeout(L.current)}}),[]);var X=o.useRef(!1);(0,o.useEffect)((function(){I&&(X.current=!0),void 0!==I&&M===Qo&&((X.current||I)&&(null==A||A(I)),X.current=!0)}),[I,M]);var Y=D;return j[ia]&&W===ra&&(Y=sn({transition:"none"},Y)),[M,W,Y,null!=I?I:t]}(p,r,(function(){try{return f.current instanceof HTMLElement?f.current:function(e){return function(e){return e instanceof HTMLElement||e instanceof SVGElement}(e)?e:e instanceof o.Component?X.findDOMNode(e):null}(m.current)}catch(e){return null}}),e),_=qn(g,4),v=_[0],y=_[1],E=_[2],b=_[3],S=o.useRef(b);b&&(S.current=!0);var T,x,A,w,I,R=o.useCallback((function(e){f.current=e,function(e,t){"function"==typeof e?e(t):"object"===nn(e)&&e&&"current"in e&&(e.current=t)}(n,e)}),[n]),C=sn(sn({},h),{},{visible:r});if(c)if(v===Qo)T=b?c(sn({},C),R):!s&&S.current&&d?c(sn(sn({},C),{},{className:d}),R):l||!s&&!d?c(sn(sn({},C),{},{style:{display:"none"}}),R):null;else{var M,k;y===ia?k="prepare":Da(y)?k="active":y===ra&&(k="start");var N=Sa(u,"".concat(v,"-").concat(k));T=c(sn(sn({},C),{},{className:Bo()(Sa(u,v),(M={},on(M,N,N&&k),on(M,u,"string"==typeof u),M)),style:E}),R)}else T=null;return o.isValidElement(T)&&(x=T,("function"!=typeof(I=(0,Ho.isMemo)(x)?x.type.type:x.type)||null!==(A=I.prototype)&&void 0!==A&&A.render)&&("function"!=typeof x||null!==(w=x.prototype)&&void 0!==w&&w.render))&&(T.ref||(T=o.cloneElement(T,{ref:R}))),o.createElement(Jo,{ref:m},T)}));return n.displayName="CSSMotion",n}(ya);var Pa="add",La="keep",Ua="remove",Va="removed";function Fa(e){var t;return sn(sn({},t=e&&"object"===nn(e)&&"key"in e?e:{key:e}),{},{key:String(t.key)})}function Ba(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(Fa)}var Ha=["component","children","onVisibleChanged","onAllRemoved"],za=["status"],ja=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];const Ga=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oa,n=function(e){Wo(i,e);var n=Yo(i);function i(){var e;Tn(this,i);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return on(Xo(e=n.call.apply(n,[this].concat(r))),"state",{keyEntities:[]}),on(Xo(e),"removeKey",(function(t){var n=e.state.keyEntities.map((function(e){return e.key!==t?e:sn(sn({},e),{},{status:Va})}));return e.setState({keyEntities:n}),n.filter((function(e){return e.status!==Va})).length})),e}return An(i,[{key:"render",value:function(){var e=this,n=this.state.keyEntities,i=this.props,r=i.component,a=i.children,s=i.onVisibleChanged,l=i.onAllRemoved,c=zo(i,Ha),u=r||o.Fragment,d={};return ja.forEach((function(e){d[e]=c[e],delete c[e]})),delete c.keys,o.createElement(u,c,n.map((function(n){var i=n.status,r=zo(n,za),c=i===Pa||i===La;return o.createElement(t,j({},d,{key:r.key,visible:c,eventProps:r,onVisibleChanged:function(t){null==s||s(t,{key:r.key}),t||0===e.removeKey(r.key)&&l&&l()}}),a)})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.keys,i=t.keyEntities,r=Ba(n),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],i=0,r=t.length,o=Ba(e),a=Ba(t);o.forEach((function(e){for(var t=!1,o=i;o<r;o+=1){var s=a[o];if(s.key===e.key){i<o&&(n=n.concat(a.slice(i,o).map((function(e){return sn(sn({},e),{},{status:Pa})}))),i=o),n.push(sn(sn({},s),{},{status:La})),i+=1,t=!0;break}}t||n.push(sn(sn({},e),{},{status:Ua}))})),i<r&&(n=n.concat(a.slice(i).map((function(e){return sn(sn({},e),{},{status:Pa})}))));var s={};return n.forEach((function(e){var t=e.key;s[t]=(s[t]||0)+1})),Object.keys(s).filter((function(e){return s[e]>1})).forEach((function(e){(n=n.filter((function(t){var n=t.key,i=t.status;return n!==e||i!==Ua}))).forEach((function(t){t.key===e&&(t.status=La)}))})),n}(i,r);return{keyEntities:o.filter((function(e){var t=i.find((function(t){var n=t.key;return e.key===n}));return!t||t.status!==Va||e.status!==Ua}))}}}]),i}(o.Component);return on(n,"defaultProps",{component:"div"}),n}(ya),$a="5.8.6";function Wa(e){return e>=0&&e<=255}const qa=function(e,t){const{r:n,g:i,b:r,a:o}=new bo(e).toRgb();if(o<1)return e;const{r:a,g:s,b:l}=new bo(t).toRgb();for(let e=.01;e<=1;e+=.01){const t=Math.round((n-a*(1-e))/e),o=Math.round((i-s*(1-e))/e),c=Math.round((r-l*(1-e))/e);if(Wa(t)&&Wa(o)&&Wa(c))return new bo({r:t,g:o,b:c,a:Math.round(100*e)/100}).toRgbString()}return new bo({r:n,g:i,b:r,a:1}).toRgbString()};var Xa=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function Ya(e){const{override:t}=e,n=Xa(e,["override"]),i=Object.assign({},t);Object.keys(Eo).forEach((e=>{delete i[e]}));const r=Object.assign(Object.assign({},n),i);if(!1===r.motion){const e="0s";r.motionDurationFast=e,r.motionDurationMid=e,r.motionDurationSlow=e}return Object.assign(Object.assign(Object.assign({},r),{colorFillContent:r.colorFillSecondary,colorFillContentHover:r.colorFill,colorFillAlter:r.colorFillQuaternary,colorBgContainerDisabled:r.colorFillTertiary,colorBorderBg:r.colorBgContainer,colorSplit:qa(r.colorBorderSecondary,r.colorBgContainer),colorTextPlaceholder:r.colorTextQuaternary,colorTextDisabled:r.colorTextQuaternary,colorTextHeading:r.colorText,colorTextLabel:r.colorTextSecondary,colorTextDescription:r.colorTextTertiary,colorTextLightSolid:r.colorWhite,colorHighlight:r.colorError,colorBgTextHover:r.colorFillSecondary,colorBgTextActive:r.colorFill,colorIcon:r.colorTextTertiary,colorIconHover:r.colorText,colorErrorOutline:qa(r.colorErrorBg,r.colorBgContainer),colorWarningOutline:qa(r.colorWarningBg,r.colorBgContainer),fontSizeIcon:r.fontSizeSM,lineWidthFocus:4*r.lineWidth,lineWidth:r.lineWidth,controlOutlineWidth:2*r.lineWidth,controlInteractiveSize:r.controlHeight/2,controlItemBgHover:r.colorFillTertiary,controlItemBgActive:r.colorPrimaryBg,controlItemBgActiveHover:r.colorPrimaryBgHover,controlItemBgActiveDisabled:r.colorFill,controlTmpOutline:r.colorFillQuaternary,controlOutline:qa(r.colorPrimaryBg,r.colorBgContainer),lineType:r.lineType,borderRadius:r.borderRadius,borderRadiusXS:r.borderRadiusXS,borderRadiusSM:r.borderRadiusSM,borderRadiusLG:r.borderRadiusLG,fontWeightStrong:600,opacityLoading:.65,linkDecoration:"none",linkHoverDecoration:"none",linkFocusDecoration:"none",controlPaddingHorizontal:12,controlPaddingHorizontalSM:8,paddingXXS:r.sizeXXS,paddingXS:r.sizeXS,paddingSM:r.sizeSM,padding:r.size,paddingMD:r.sizeMD,paddingLG:r.sizeLG,paddingXL:r.sizeXL,paddingContentHorizontalLG:r.sizeLG,paddingContentVerticalLG:r.sizeMS,paddingContentHorizontal:r.sizeMS,paddingContentVertical:r.sizeSM,paddingContentHorizontalSM:r.size,paddingContentVerticalSM:r.sizeXS,marginXXS:r.sizeXXS,marginXS:r.sizeXS,marginSM:r.sizeSM,margin:r.size,marginMD:r.sizeMD,marginLG:r.sizeLG,marginXL:r.sizeXL,marginXXL:r.sizeXXL,boxShadow:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowSecondary:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowTertiary:"\n      0 1px 2px 0 rgba(0, 0, 0, 0.03),\n      0 1px 6px -1px rgba(0, 0, 0, 0.02),\n      0 2px 4px 0 rgba(0, 0, 0, 0.02)\n    ",screenXS:480,screenXSMin:480,screenXSMax:575,screenSM:576,screenSMMin:576,screenSMMax:767,screenMD:768,screenMDMin:768,screenMDMax:991,screenLG:992,screenLGMin:992,screenLGMax:1199,screenXL:1200,screenXLMin:1200,screenXLMax:1599,screenXXL:1600,screenXXLMin:1600,boxShadowPopoverArrow:"2px 2px 5px rgba(0, 0, 0, 0.05)",boxShadowCard:`\n      0 1px 2px -2px ${new bo("rgba(0, 0, 0, 0.16)").toRgbString()},\n      0 3px 6px 0 ${new bo("rgba(0, 0, 0, 0.12)").toRgbString()},\n      0 5px 12px 4px ${new bo("rgba(0, 0, 0, 0.09)").toRgbString()}\n    `,boxShadowDrawerRight:"\n      -6px 0 16px 0 rgba(0, 0, 0, 0.08),\n      -3px 0 6px -4px rgba(0, 0, 0, 0.12),\n      -9px 0 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerLeft:"\n      6px 0 16px 0 rgba(0, 0, 0, 0.08),\n      3px 0 6px -4px rgba(0, 0, 0, 0.12),\n      9px 0 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerUp:"\n      0 6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowDrawerDown:"\n      0 -6px 16px 0 rgba(0, 0, 0, 0.08),\n      0 -3px 6px -4px rgba(0, 0, 0, 0.12),\n      0 -9px 28px 8px rgba(0, 0, 0, 0.05)\n    ",boxShadowTabsOverflowLeft:"inset 10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowRight:"inset -10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowTop:"inset 0 10px 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowBottom:"inset 0 -10px 8px -8px rgba(0, 0, 0, 0.08)"}),i)}var Ja=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};const Ka=(e,t,n)=>{const i=n.getDerivativeToken(e),{override:r}=t,o=Ja(t,["override"]);let a=Object.assign(Object.assign({},i),{override:r});return a=Ya(a),o&&Object.entries(o).forEach((e=>{let[t,n]=e;const{theme:i}=n,r=Ja(n,["theme"]);let o=r;i&&(o=Ka(Object.assign(Object.assign({},a),r),{override:r},i)),a[t]=o})),a};function Qa(){const{token:e,hashed:t,theme:n,components:i}=o.useContext(Ro),r=`${$a}-${t||""}`,a=n||wo,[s,l]=_i(a,[Eo,e],{salt:r,override:Object.assign({override:e},i),getComputedToken:Ka,formatToken:Ya});return[a,s,t?l:""]}function Za(e){const{children:t}=e,[,n]=Qa(),{motion:i}=n,r=o.useRef(!1);return r.current=r.current||!1===i,r.current?o.createElement($o,{motion:i},t):t}const es=e=>({boxSizing:"border-box",margin:0,padding:0,color:e.colorText,fontSize:e.fontSize,lineHeight:e.lineHeight,listStyle:"none",fontFamily:e.fontFamily}),ts=e=>({a:{color:e.colorLink,textDecoration:e.linkDecoration,backgroundColor:"transparent",outline:"none",cursor:"pointer",transition:`color ${e.motionDurationSlow}`,"-webkit-text-decoration-skip":"objects","&:hover":{color:e.colorLinkHover},"&:active":{color:e.colorLinkActive},"&:active,\n  &:hover":{textDecoration:e.linkHoverDecoration,outline:0},"&:focus":{textDecoration:e.linkFocusDecoration,outline:0},"&[disabled]":{color:e.colorTextDisabled,cursor:"not-allowed"}}}),ns=(e,t)=>{const{fontFamily:n,fontSize:i}=e,r=`[class^="${t}"], [class*=" ${t}"]`;return{[r]:{fontFamily:n,fontSize:i,boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"},[r]:{boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"}}}}},is=(e,t)=>{const[n,i]=Qa();return mr({theme:n,token:i,hashId:"",path:["ant-design-icons",e],nonce:()=>null==t?void 0:t.nonce},(()=>[{[`.${e}`]:Object.assign(Object.assign({},{display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),{[`.${e} .${e}-icon`]:{display:"block"}})}]))};const rs=["getTargetContainer","getPopupContainer","renderEmpty","pageHeader","input","pagination","form","select","button"];let os,as,ss;function ls(){return os||"ant"}function cs(){return as||Co}const us=()=>({getPrefixCls:(e,t)=>t||(e?`${ls()}-${e}`:ls()),getIconPrefixCls:cs,getRootPrefixCls:()=>os||ls(),getTheme:()=>ss}),ds=e=>{const{children:t,csp:n,autoInsertSpaceInButton:i,alert:r,anchor:a,form:s,locale:l,componentSize:c,direction:u,space:d,virtual:h,dropdownMatchSelectWidth:p,popupMatchSelectWidth:f,popupOverflow:m,legacyLocale:g,parentContext:_,iconPrefixCls:v,theme:y,componentDisabled:E,segmented:b,statistic:S,spin:T,calendar:x,carousel:A,cascader:w,collapse:I,typography:R,checkbox:C,descriptions:M,divider:k,drawer:N,skeleton:D,steps:O,image:P,layout:L,list:U,mentions:V,modal:F,progress:B,result:H,slider:z,breadcrumb:j,menu:G,pagination:$,input:W,empty:q,badge:X,radio:Y,rate:J,switch:K,transfer:Q,avatar:Z,message:ee,tag:te,table:ne,card:ie,tabs:re,timeline:oe,timePicker:ae,upload:se,notification:le,tree:ce,colorPicker:ue,datePicker:de,wave:he}=e,pe=o.useCallback(((t,n)=>{const{prefixCls:i}=e;if(n)return n;const r=i||_.getPrefixCls("");return t?`${r}-${t}`:r}),[_.getPrefixCls,e.prefixCls]),fe=v||_.iconPrefixCls||Co,me=fe!==_.iconPrefixCls,ge=n||_.csp,_e=is(fe,ge),ve=function(e,t){const n=e||{},i=!1!==n.inherit&&t?t:Io;return mn((()=>{if(!e)return t;const r=Object.assign({},i.components);return Object.keys(e.components||{}).forEach((t=>{r[t]=Object.assign(Object.assign({},r[t]),e.components[t])})),Object.assign(Object.assign(Object.assign({},i),n),{token:Object.assign(Object.assign({},i.token),n.token),components:r})}),[n,i],((e,t)=>e.some(((e,n)=>!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new Set;return function e(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=i.has(t);if(Sn(!a,"Warning: There may be circular references"),a)return!1;if(t===r)return!0;if(n&&o>1)return!1;i.add(t);var s=o+1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var l=0;l<t.length;l++)if(!e(t[l],r[l],s))return!1;return!0}if(t&&r&&"object"===nn(t)&&"object"===nn(r)){var c=Object.keys(t);return c.length===Object.keys(r).length&&c.every((function(n){return e(t[n],r[n],s)}))}return!1}(e,t)}(e,t[n],!0)))))}(y,_.theme),ye={csp:ge,autoInsertSpaceInButton:i,alert:r,anchor:a,locale:l||g,direction:u,space:d,virtual:h,popupMatchSelectWidth:null!=f?f:p,popupOverflow:m,getPrefixCls:pe,iconPrefixCls:fe,theme:ve,segmented:b,statistic:S,spin:T,calendar:x,carousel:A,cascader:w,collapse:I,typography:R,checkbox:C,descriptions:M,divider:k,drawer:N,skeleton:D,steps:O,image:P,input:W,layout:L,list:U,mentions:V,modal:F,progress:B,result:H,slider:z,breadcrumb:j,menu:G,pagination:$,empty:q,badge:X,radio:Y,rate:J,switch:K,transfer:Q,avatar:Z,message:ee,tag:te,table:ne,card:ie,tabs:re,timeline:oe,timePicker:ae,upload:se,notification:le,tree:ce,colorPicker:ue,datePicker:de,wave:he},Ee=Object.assign({},_);Object.keys(ye).forEach((e=>{void 0!==ye[e]&&(Ee[e]=ye[e])})),rs.forEach((t=>{const n=e[t];n&&(Ee[t]=n)}));const be=mn((()=>Ee),Ee,((e,t)=>{const n=Object.keys(e),i=Object.keys(t);return n.length!==i.length||n.some((n=>e[n]!==t[n]))})),Se=o.useMemo((()=>({prefixCls:fe,csp:ge})),[fe,ge]);let Te=me?_e(t):t;const xe=o.useMemo((()=>{var e,t,n,i;return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=Tr(t[0]);return t.forEach((function(e){!function t(n,r){var o,a=new Set(r),s=Er(e,n),l=Array.isArray(s);if(l||"object"===nn(o=s)&&null!==o&&Object.getPrototypeOf(o)===Object.prototype){if(!a.has(s)){a.add(s);var c=Er(i,n);l?i=Sr(i,n,[]):c&&"object"===nn(c)||(i=Sr(i,n,Tr(s))),xr(s).forEach((function(e){t([].concat(tn(n),[e]),a)}))}}else i=Sr(i,n,s)}([])})),i}((null===(e=Cr.Form)||void 0===e?void 0:e.defaultValidateMessages)||{},(null===(n=null===(t=be.locale)||void 0===t?void 0:t.Form)||void 0===n?void 0:n.defaultValidateMessages)||{},(null===(i=be.form)||void 0===i?void 0:i.validateMessages)||{},(null==s?void 0:s.validateMessages)||{})}),[be,null==s?void 0:s.validateMessages]);Object.keys(xe).length>0&&(Te=o.createElement(Ar.Provider,{value:xe},t)),l&&(Te=o.createElement(Or,{locale:l,_ANT_MARK__:"internalMark"},Te)),(fe||ge)&&(Te=o.createElement(yr.Provider,{value:Se},Te)),c&&(Te=o.createElement(Uo,{size:c},Te)),Te=o.createElement(Za,null,Te);const Ae=o.useMemo((()=>{const e=ve||{},{algorithm:t,token:n,components:i}=e,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["algorithm","token","components"]),o=t&&(!Array.isArray(t)||t.length>0)?Qn(t):wo,a={};return Object.entries(i||{}).forEach((e=>{let[t,n]=e;const i=Object.assign({},n);"algorithm"in i&&(!0===i.algorithm?i.theme=o:(Array.isArray(i.algorithm)||"function"==typeof i.algorithm)&&(i.theme=Qn(i.algorithm)),delete i.algorithm),a[t]=i})),Object.assign(Object.assign({},r),{theme:o,token:Object.assign(Object.assign({},Eo),n),components:a})}),[ve]);return y&&(Te=o.createElement(Ro.Provider,{value:Ae},Te)),void 0!==E&&(Te=o.createElement(Oo,{disabled:E},Te)),o.createElement(Mo.Provider,{value:be},Te)},hs=e=>{const t=o.useContext(Mo),n=o.useContext(Dr);return o.createElement(ds,Object.assign({parentContext:t,legacyLocale:n},e))};hs.ConfigContext=Mo,hs.SizeContext=Vo,hs.config=e=>{let{prefixCls:t,iconPrefixCls:n,theme:i}=e;void 0!==t&&(os=t),void 0!==n&&(as=n),i&&(function(e){return Object.keys(e).some((e=>e.endsWith("Color")))}(i)?function(e,t){const n=function(e,t){const n={},i=(e,t)=>{let n=e.clone();return n=(null==t?void 0:t(n))||n,n.toRgbString()},r=(e,t)=>{const r=new bo(e),o=fo(r.toRgbString());n[`${t}-color`]=i(r),n[`${t}-color-disabled`]=o[1],n[`${t}-color-hover`]=o[4],n[`${t}-color-active`]=o[6],n[`${t}-color-outline`]=r.clone().setAlpha(.2).toRgbString(),n[`${t}-color-deprecated-bg`]=o[0],n[`${t}-color-deprecated-border`]=o[2]};if(t.primaryColor){r(t.primaryColor,"primary");const e=new bo(t.primaryColor),o=fo(e.toRgbString());o.forEach(((e,t)=>{n[`primary-${t+1}`]=e})),n["primary-color-deprecated-l-35"]=i(e,(e=>e.lighten(35))),n["primary-color-deprecated-l-20"]=i(e,(e=>e.lighten(20))),n["primary-color-deprecated-t-20"]=i(e,(e=>e.tint(20))),n["primary-color-deprecated-t-50"]=i(e,(e=>e.tint(50))),n["primary-color-deprecated-f-12"]=i(e,(e=>e.setAlpha(.12*e.getAlpha())));const a=new bo(o[0]);n["primary-color-active-deprecated-f-30"]=i(a,(e=>e.setAlpha(.3*e.getAlpha()))),n["primary-color-active-deprecated-d-02"]=i(a,(e=>e.darken(2)))}return t.successColor&&r(t.successColor,"success"),t.warningColor&&r(t.warningColor,"warning"),t.errorColor&&r(t.errorColor,"error"),t.infoColor&&r(t.infoColor,"info"),`\n  :root {\n    ${Object.keys(n).map((t=>`--${e}-${t}: ${n[t]};`)).join("\n")}\n  }\n  `.trim()}(e,t);Dn()&&Gn(n,`${No}-dynamic-theme`)}(ls(),i):ss=i)},hs.useConfig=function(){return{componentDisabled:(0,o.useContext)(Po),componentSize:(0,o.useContext)(Vo)}},Object.defineProperty(hs,"SizeContext",{get:()=>Vo});const ps=hs,fs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};function ms(e){var t;return null==e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}function gs(e){return"object"===nn(e)&&"string"==typeof e.name&&"string"==typeof e.theme&&("object"===nn(e.icon)||"function"==typeof e.icon)}function _s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,n){var i,r=e[n];return"class"===n?(t.className=r,delete t.class):(delete t[n],t[(i=n,i.replace(/-(.)/g,(function(e,t){return t.toUpperCase()})))]=r),t}),{})}function vs(e,t,n){return n?o.createElement(e.tag,sn(sn({key:t},_s(e.attrs)),n),(e.children||[]).map((function(n,i){return vs(n,"".concat(t,"-").concat(e.tag,"-").concat(i))}))):o.createElement(e.tag,sn({key:t},_s(e.attrs)),(e.children||[]).map((function(n,i){return vs(n,"".concat(t,"-").concat(e.tag,"-").concat(i))})))}function ys(e){return fo(e)[0]}function Es(e){return e?Array.isArray(e)?e:[e]:[]}var bs=["icon","className","onClick","style","primaryColor","secondaryColor"],Ss={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1},Ts=function(e){var t,n,i,r,a,s=e.icon,l=e.className,c=e.onClick,u=e.style,d=e.primaryColor,h=e.secondaryColor,p=zo(e,bs),f=o.useRef(),m=Ss;if(d&&(m={primaryColor:d,secondaryColor:h||ys(d)}),t=f,n=(0,o.useContext)(yr),i=n.csp,r=n.prefixCls,a="\n.anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n",r&&(a=a.replace(/anticon/g,r)),(0,o.useEffect)((function(){var e,n=function(e){return ms(e)instanceof ShadowRoot}(e=t.current)?ms(e):null;Gn(a,"@ant-design-icons",{prepend:!0,csp:i,attachTo:n})}),[]),function(e,t){Sn(e,"[@ant-design/icons] ".concat(t))}(gs(s),"icon should be icon definiton, but got ".concat(s)),!gs(s))return null;var g=s;return g&&"function"==typeof g.icon&&(g=sn(sn({},g),{},{icon:g.icon(m.primaryColor,m.secondaryColor)})),vs(g.icon,"svg-".concat(g.name),sn(sn({className:l,onClick:c,style:u,"data-icon":g.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},p),{},{ref:f}))};Ts.displayName="IconReact",Ts.getTwoToneColors=function(){return sn({},Ss)},Ts.setTwoToneColors=function(e){var t=e.primaryColor,n=e.secondaryColor;Ss.primaryColor=t,Ss.secondaryColor=n||ys(t),Ss.calculated=!!n};const xs=Ts;function As(e){var t=qn(Es(e),2),n=t[0],i=t[1];return xs.setTwoToneColors({primaryColor:n,secondaryColor:i})}var ws=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];As(vo.primary);var Is=o.forwardRef((function(e,t){var n,i=e.className,r=e.icon,a=e.spin,s=e.rotate,l=e.tabIndex,c=e.onClick,u=e.twoToneColor,d=zo(e,ws),h=o.useContext(yr),p=h.prefixCls,f=void 0===p?"anticon":p,m=h.rootClassName,g=Bo()(m,f,(on(n={},"".concat(f,"-").concat(r.name),!!r.name),on(n,"".concat(f,"-spin"),!!a||"loading"===r.name),n),i),_=l;void 0===_&&c&&(_=-1);var v=s?{msTransform:"rotate(".concat(s,"deg)"),transform:"rotate(".concat(s,"deg)")}:void 0,y=qn(Es(u),2),E=y[0],b=y[1];return o.createElement("span",j({role:"img","aria-label":r.name},d,{ref:t,tabIndex:_,onClick:c,className:g}),o.createElement(xs,{icon:r,primaryColor:E,secondaryColor:b,style:v}))}));Is.displayName="AntdIcon",Is.getTwoToneColor=function(){var e=xs.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor},Is.setTwoToneColor=As;const Rs=Is;var Cs=function(e,t){return o.createElement(Rs,j({},e,{ref:t,icon:fs}))};const Ms=o.forwardRef(Cs),ks={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"}}]},name:"close-circle",theme:"filled"};var Ns=function(e,t){return o.createElement(Rs,j({},e,{ref:t,icon:ks}))};const Ds=o.forwardRef(Ns),Os={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var Ps=function(e,t){return o.createElement(Rs,j({},e,{ref:t,icon:Os}))};const Ls=o.forwardRef(Ps),Us={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"};var Vs=function(e,t){return o.createElement(Rs,j({},e,{ref:t,icon:Us}))};const Fs=o.forwardRef(Vs),Bs={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"};var Hs=function(e,t){return o.createElement(Rs,j({},e,{ref:t,icon:Bs}))};const zs=o.forwardRef(Hs);var js={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var t=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||t>=js.F1&&t<=js.F12)return!1;switch(t){case js.ALT:case js.CAPS_LOCK:case js.CONTEXT_MENU:case js.CTRL:case js.DOWN:case js.END:case js.ESC:case js.HOME:case js.INSERT:case js.LEFT:case js.MAC_FF_META:case js.META:case js.NUMLOCK:case js.NUM_CENTER:case js.PAGE_DOWN:case js.PAGE_UP:case js.PAUSE:case js.PRINT_SCREEN:case js.RIGHT:case js.SHIFT:case js.UP:case js.WIN_KEY:case js.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=js.ZERO&&e<=js.NINE)return!0;if(e>=js.NUM_ZERO&&e<=js.NUM_MULTIPLY)return!0;if(e>=js.A&&e<=js.Z)return!0;if(-1!==window.navigator.userAgent.indexOf("WebKit")&&0===e)return!0;switch(e){case js.SPACE:case js.QUESTION_MARK:case js.NUM_PLUS:case js.NUM_MINUS:case js.NUM_PERIOD:case js.NUM_DIVISION:case js.SEMICOLON:case js.DASH:case js.EQUALS:case js.COMMA:case js.PERIOD:case js.SLASH:case js.APOSTROPHE:case js.SINGLE_QUOTE:case js.OPEN_SQUARE_BRACKET:case js.BACKSLASH:case js.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}};const Gs=js;var $s=o.forwardRef((function(e,t){var n=e.prefixCls,i=e.style,r=e.className,a=e.duration,s=void 0===a?4.5:a,l=e.eventKey,c=e.content,u=e.closable,d=e.closeIcon,h=void 0===d?"x":d,p=e.props,f=e.onClick,m=e.onNoticeClose,g=e.times,_=qn(o.useState(!1),2),v=_[0],y=_[1],E=function(){m(l)};o.useEffect((function(){if(!v&&s>0){var e=setTimeout((function(){E()}),1e3*s);return function(){clearTimeout(e)}}}),[s,v,g]);var b="".concat(n,"-notice");return o.createElement("div",j({},p,{ref:t,className:Bo()(b,r,on({},"".concat(b,"-closable"),u)),style:i,onMouseEnter:function(){y(!0)},onMouseLeave:function(){y(!1)},onClick:f}),o.createElement("div",{className:"".concat(b,"-content")},c),u&&o.createElement("a",{tabIndex:0,className:"".concat(b,"-close"),onKeyDown:function(e){"Enter"!==e.key&&"Enter"!==e.code&&e.keyCode!==Gs.ENTER||E()},onClick:function(e){e.preventDefault(),e.stopPropagation(),E()}},h))}));const Ws=$s;var qs=o.createContext({});const Xs=function(e){var t=e.children,n=e.classNames;return o.createElement(qs.Provider,{value:{classNames:n}},t)},Ys=function(e){var t=e.configList,n=e.placement,i=e.prefixCls,r=e.className,a=e.style,s=e.motion,l=e.onAllNoticeRemoved,c=e.onNoticeClose,u=(0,o.useContext)(qs).classNames,d=t.map((function(e){return{config:e,key:e.key}})),h="function"==typeof s?s(n):s;return o.createElement(Ga,j({key:n,className:Bo()(i,"".concat(i,"-").concat(n),null==u?void 0:u.list,r),style:a,keys:d,motionAppear:!0},h,{onAllRemoved:function(){l(n)}}),(function(e,t){var n=e.config,r=e.className,a=e.style,s=n,l=s.key,d=s.times,h=n,p=h.className,f=h.style;return o.createElement(Ws,j({},n,{ref:t,prefixCls:i,className:Bo()(r,p,null==u?void 0:u.notice),style:sn(sn({},a),f),times:d,key:l,eventKey:l,onNoticeClose:c}))}))};var Js=o.forwardRef((function(e,t){var n=e.prefixCls,i=void 0===n?"rc-notification":n,r=e.container,a=e.motion,s=e.maxCount,l=e.className,c=e.style,u=e.onAllRemoved,d=e.renderNotifications,h=qn(o.useState([]),2),p=h[0],f=h[1],m=function(e){var t,n=p.find((function(t){return t.key===e}));null==n||null===(t=n.onClose)||void 0===t||t.call(n),f((function(t){return t.filter((function(t){return t.key!==e}))}))};o.useImperativeHandle(t,(function(){return{open:function(e){f((function(t){var n,i=tn(t),r=i.findIndex((function(t){return t.key===e.key})),o=sn({},e);return r>=0?(o.times=((null===(n=t[r])||void 0===n?void 0:n.times)||0)+1,i[r]=o):(o.times=0,i.push(o)),s>0&&i.length>s&&(i=i.slice(-s)),i}))},close:function(e){m(e)},destroy:function(){f([])}}}));var g=qn(o.useState({}),2),_=g[0],v=g[1];o.useEffect((function(){var e={};p.forEach((function(t){var n=t.placement,i=void 0===n?"topRight":n;i&&(e[i]=e[i]||[],e[i].push(t))})),Object.keys(_).forEach((function(t){e[t]=e[t]||[]})),v(e)}),[p]);var y=function(e){v((function(t){var n=sn({},t);return(n[e]||[]).length||delete n[e],n}))},E=o.useRef(!1);if(o.useEffect((function(){Object.keys(_).length>0?E.current=!0:E.current&&(null==u||u(),E.current=!1)}),[_]),!r)return null;var b=Object.keys(_);return(0,X.createPortal)(o.createElement(o.Fragment,null,b.map((function(e){var t=_[e],n=o.createElement(Ys,{key:e,configList:t,placement:e,prefixCls:i,className:null==l?void 0:l(e),style:null==c?void 0:c(e),motion:a,onNoticeClose:m,onAllNoticeRemoved:y});return d?d(n,{prefixCls:i,key:e}):n}))),r)}));const Ks=Js;var Qs=["getContainer","motion","prefixCls","maxCount","className","style","onAllRemoved","renderNotifications"],Zs=function(){return document.body},el=0;const tl="undefined"!=typeof CSSINJS_STATISTIC;let nl=!0;function il(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!tl)return Object.assign.apply(Object,[{}].concat(t));nl=!1;const i={};return t.forEach((e=>{Object.keys(e).forEach((t=>{Object.defineProperty(i,t,{configurable:!0,enumerable:!0,get:()=>e[t]})}))})),nl=!0,i}const rl={};function ol(){}const al=e=>{const{componentCls:t,iconCls:n,boxShadow:i,colorText:r,colorSuccess:o,colorError:a,colorWarning:s,colorInfo:l,fontSizeLG:c,motionEaseInOutCirc:u,motionDurationSlow:d,marginXS:h,paddingXS:p,borderRadiusLG:f,zIndexPopup:m,contentPadding:g,contentBg:_}=e,v=`${t}-notice`,y=new _r("MessageMoveIn",{"0%":{padding:0,transform:"translateY(-100%)",opacity:0},"100%":{padding:p,transform:"translateY(0)",opacity:1}}),E=new _r("MessageMoveOut",{"0%":{maxHeight:e.height,padding:p,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),b={padding:p,textAlign:"center",[`${t}-custom-content > ${n}`]:{verticalAlign:"text-bottom",marginInlineEnd:h,fontSize:c},[`${v}-content`]:{display:"inline-block",padding:g,background:_,borderRadius:f,boxShadow:i,pointerEvents:"all"},[`${t}-success > ${n}`]:{color:o},[`${t}-error > ${n}`]:{color:a},[`${t}-warning > ${n}`]:{color:s},[`${t}-info > ${n},\n      ${t}-loading > ${n}`]:{color:l}};return[{[t]:Object.assign(Object.assign({},es(e)),{color:r,position:"fixed",top:h,width:"100%",pointerEvents:"none",zIndex:m,[`${t}-move-up`]:{animationFillMode:"forwards"},[`\n        ${t}-move-up-appear,\n        ${t}-move-up-enter\n      `]:{animationName:y,animationDuration:d,animationPlayState:"paused",animationTimingFunction:u},[`\n        ${t}-move-up-appear${t}-move-up-appear-active,\n        ${t}-move-up-enter${t}-move-up-enter-active\n      `]:{animationPlayState:"running"},[`${t}-move-up-leave`]:{animationName:E,animationDuration:d,animationPlayState:"paused",animationTimingFunction:u},[`${t}-move-up-leave${t}-move-up-leave-active`]:{animationPlayState:"running"},"&-rtl":{direction:"rtl",span:{direction:"rtl"}}})},{[t]:{[v]:Object.assign({},b)}},{[`${t}-notice-pure-panel`]:Object.assign(Object.assign({},b),{padding:0,textAlign:"start"})}]},sl=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=Array.isArray(e)?e:[e,e],[a]=r,s=r.join("-");return e=>{const[r,l,c]=Qa(),{getPrefixCls:u,iconPrefixCls:d,csp:h}=(0,o.useContext)(Mo),p=u(),f={theme:r,token:l,hashId:c,nonce:()=>null==h?void 0:h.nonce,clientOnly:i.clientOnly,order:i.order||-999};return mr(Object.assign(Object.assign({},f),{clientOnly:!1,path:["Shared",p]}),(()=>[{"&":ts(l)}])),is(d),[mr(Object.assign(Object.assign({},f),{path:[s,e,d]}),(()=>{const{token:r,flush:o}=function(e){let t,n=e,i=ol;return tl&&(t=new Set,n=new Proxy(e,{get:(e,n)=>(nl&&t.add(n),e[n])}),i=(e,n)=>{var i;rl[e]={global:Array.from(t),component:Object.assign(Object.assign({},null===(i=rl[e])||void 0===i?void 0:i.component),n)}}),{token:n,keys:t,flush:i}}(l),s=Object.assign({},l[a]);if(i.deprecatedTokens){const{deprecatedTokens:e}=i;e.forEach((e=>{let[t,n]=e;var i;((null==s?void 0:s[t])||(null==s?void 0:s[n]))&&(null!==(i=s[n])&&void 0!==i||(s[n]=null==s?void 0:s[t]))}))}const u="function"==typeof n?n(il(r,null!=s?s:{})):n,h=Object.assign(Object.assign({},u),s),f=il(r,{componentCls:`.${e}`,prefixCls:e,iconCls:`.${d}`,antCls:`.${p}`},h),m=t(f,{hashId:c,prefixCls:e,rootPrefixCls:p,iconPrefixCls:d,overrideComponentToken:s});return o(a,h),[!1===i.resetStyle?null:ns(l,e),m]})),c]}}("Message",(e=>{const t=il(e,{height:150});return[al(t)]}),(e=>({zIndexPopup:e.zIndexPopupBase+10,contentBg:e.colorBgElevated,contentPadding:`${(e.controlHeightLG-e.fontSize*e.lineHeight)/2}px ${e.paddingSM}px`})));const ll={info:o.createElement(Fs,null),success:o.createElement(Ms,null),error:o.createElement(Ds,null),warning:o.createElement(Ls,null),loading:o.createElement(zs,null)},cl=e=>{let{prefixCls:t,type:n,icon:i,children:r}=e;return o.createElement("div",{className:Bo()(`${t}-custom-content`,`${t}-${n}`)},i||ll[n],o.createElement("span",null,r))},ul={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"}}]},name:"close",theme:"outlined"};var dl=function(e,t){return o.createElement(Rs,j({},e,{ref:t,icon:ul}))};const hl=o.forwardRef(dl);function pl(e){let t;const n=new Promise((n=>{t=e((()=>{n(!0)}))})),i=()=>{null==t||t()};return i.then=(e,t)=>n.then(e,t),i.promise=n,i}const fl=3,ml=e=>{let{children:t,prefixCls:n}=e;const[,i]=sl(n);return o.createElement(Xs,{classNames:{list:i,notice:i}},t)},gl=(e,t)=>{let{prefixCls:n,key:i}=t;return o.createElement(ml,{prefixCls:n,key:i},e)},_l=o.forwardRef(((e,t)=>{const{top:n,prefixCls:i,getContainer:r,maxCount:a,duration:s=fl,rtl:l,transitionName:c,onAllRemoved:u}=e,{getPrefixCls:d,getPopupContainer:h,message:p}=o.useContext(Mo),f=i||d("message"),m=o.createElement("span",{className:`${f}-close-x`},o.createElement(hl,{className:`${f}-close-icon`})),[g,_]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.getContainer,n=void 0===t?Zs:t,i=e.motion,r=e.prefixCls,a=e.maxCount,s=e.className,l=e.style,c=e.onAllRemoved,u=e.renderNotifications,d=zo(e,Qs),h=qn(o.useState(),2),p=h[0],f=h[1],m=o.useRef(),g=o.createElement(Ks,{container:p,ref:m,prefixCls:r,motion:i,maxCount:a,className:s,style:l,onAllRemoved:c,renderNotifications:u}),_=qn(o.useState([]),2),v=_[0],y=_[1],E=o.useMemo((function(){return{open:function(e){var t=function(){for(var e={},t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach((function(t){t&&Object.keys(t).forEach((function(n){var i=t[n];void 0!==i&&(e[n]=i)}))})),e}(d,e);null!==t.key&&void 0!==t.key||(t.key="rc-notification-".concat(el),el+=1),y((function(e){return[].concat(tn(e),[{type:"open",config:t}])}))},close:function(e){y((function(t){return[].concat(tn(t),[{type:"close",key:e}])}))},destroy:function(){y((function(e){return[].concat(tn(e),[{type:"destroy"}])}))}}}),[]);return o.useEffect((function(){f(n())})),o.useEffect((function(){m.current&&v.length&&(v.forEach((function(e){switch(e.type){case"open":m.current.open(e.config);break;case"close":m.current.close(e.key);break;case"destroy":m.current.destroy()}})),y((function(e){return e.filter((function(e){return!v.includes(e)}))})))}),[v]),[E,g]}({prefixCls:f,style:()=>({left:"50%",transform:"translateX(-50%)",top:null!=n?n:8}),className:()=>Bo()({[`${f}-rtl`]:l}),motion:()=>function(e,t){return{motionName:null!=t?t:`${e}-move-up`}}(f,c),closable:!1,closeIcon:m,duration:s,getContainer:()=>(null==r?void 0:r())||(null==h?void 0:h())||document.body,maxCount:a,onAllRemoved:u,renderNotifications:gl});return o.useImperativeHandle(t,(()=>Object.assign(Object.assign({},g),{prefixCls:f,message:p}))),_}));let vl=0;function yl(e){const t=o.useRef(null),n=o.useMemo((()=>{const e=e=>{var n;null===(n=t.current)||void 0===n||n.close(e)},n=n=>{if(!t.current){const e=()=>{};return e.then=()=>{},e}const{open:i,prefixCls:r,message:a}=t.current,s=`${r}-notice`,{content:l,icon:c,type:u,key:d,className:h,style:p,onClose:f}=n,m=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(n,["content","icon","type","key","className","style","onClose"]);let g=d;return null==g&&(vl+=1,g=`antd-message-${vl}`),pl((t=>(i(Object.assign(Object.assign({},m),{key:g,content:o.createElement(cl,{prefixCls:r,type:u,icon:c},l),placement:"top",className:Bo()(u&&`${s}-${u}`,h,null==a?void 0:a.className),style:Object.assign(Object.assign({},null==a?void 0:a.style),p),onClose:()=>{null==f||f(),t()}})),()=>{e(g)})))},i={open:n,destroy:n=>{var i;void 0!==n?e(n):null===(i=t.current)||void 0===i||i.destroy()}};return["info","success","warning","error","loading"].forEach((e=>{i[e]=(t,i,r)=>{let o,a,s;o=t&&"object"==typeof t&&"content"in t?t:{content:t},"function"==typeof i?s=i:(a=i,s=r);const l=Object.assign(Object.assign({onClose:s,duration:a},o),{type:e});return n(l)}})),i}),[]);return[n,o.createElement(_l,Object.assign({key:"message-holder"},e,{ref:t}))]}let El=null,bl=e=>e(),Sl=[],Tl={};function xl(){const{prefixCls:e,getContainer:t,duration:n,rtl:i,maxCount:r,top:o}=Tl,a=null!=e?e:us().getPrefixCls("message"),s=(null==t?void 0:t())||document.body;return{prefixCls:a,getContainer:()=>s,duration:n,rtl:i,maxCount:r,top:o}}const Al=o.forwardRef(((e,t)=>{const[n,i]=o.useState(xl),[r,a]=yl(n),s=us(),l=s.getRootPrefixCls(),c=s.getIconPrefixCls(),u=s.getTheme(),d=()=>{i(xl)};return o.useEffect(d,[]),o.useImperativeHandle(t,(()=>{const e=Object.assign({},r);return Object.keys(e).forEach((t=>{e[t]=function(){return d(),r[t].apply(r,arguments)}})),{instance:e,sync:d}})),o.createElement(ps,{prefixCls:l,iconPrefixCls:c,theme:u},a)}));function wl(){if(!El){const e=document.createDocumentFragment(),t={fragment:e};return El=t,void bl((()=>{!function(e,t){ln?function(e,t){hn(!0);var n=t[pn]||ln(t);hn(!1),n.render(e),t[pn]=n}(e,t):function(e,t){dn(e,t)}(e,t)}(o.createElement(Al,{ref:e=>{const{instance:n,sync:i}=e||{};Promise.resolve().then((()=>{!t.instance&&n&&(t.instance=n,t.sync=i,wl())}))}}),e)}))}El.instance&&(Sl.forEach((e=>{const{type:t,skipped:n}=e;if(!n)switch(t){case"open":bl((()=>{const t=El.instance.open(Object.assign(Object.assign({},Tl),e.config));null==t||t.then(e.resolve),e.setCloseFn(t)}));break;case"destroy":bl((()=>{null==El||El.instance.destroy(e.key)}));break;default:bl((()=>{var n;const i=(n=El.instance)[t].apply(n,tn(e.args));null==i||i.then(e.resolve),e.setCloseFn(i)}))}})),Sl=[])}const Il={open:function(e){const t=pl((t=>{let n;const i={type:"open",config:e,resolve:t,setCloseFn:e=>{n=e}};return Sl.push(i),()=>{n?bl((()=>{n()})):i.skipped=!0}}));return wl(),t},destroy:function(e){Sl.push({type:"destroy",key:e}),wl()},config:function(e){Tl=Object.assign(Object.assign({},Tl),e),bl((()=>{var e;null===(e=null==El?void 0:El.sync)||void 0===e||e.call(El)}))},useMessage:function(e){return yl(e)},_InternalPanelDoNotUseOrYouWillBeFired:e=>{const{prefixCls:t,className:n,type:i,icon:r,content:a}=e,s=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["prefixCls","className","type","icon","content"]),{getPrefixCls:l}=o.useContext(Mo),c=t||l("message"),[,u]=sl(c);return o.createElement(Ws,Object.assign({},s,{prefixCls:c,className:Bo()(n,u,`${c}-notice-pure-panel`),eventKey:"pure",duration:null,content:o.createElement(cl,{prefixCls:c,type:i,icon:r},a)}))}},Rl=Il;["success","info","warning","error","loading"].forEach((e=>{Rl[e]=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return function(e,t){const n=pl((n=>{let i;const r={type:e,args:t,resolve:n,setCloseFn:e=>{i=e}};return Sl.push(r),()=>{i?bl((()=>{i()})):r.skipped=!0}}));return wl(),n}(e,n)}}));const Cl=Rl;var Ml,kl,Nl,Dl,Ol;!function(e){e.CENTER="TopCenter",e.LEFT="TopLeft",e.RIGHT="TopRight"}(Ml||(Ml={})),function(e){e.STATIC="static",e.LOADING="loading",e.GREET="greet",e.LISTENNING="listenning",e.SPEAKING="speaking",e.ENDING="ending",e.INPUT="input"}(kl||(kl={})),function(e){e.LAST_FRAME="last_frame",e.FIRST_FRAME="first_frame"}(Nl||(Nl={})),function(e){e.PING="pingxiaoice",e.PONG="pingxiaoice"}(Dl||(Dl={}));var Pl=new Uint8Array(16);function Ll(){if(!Ol&&!(Ol="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ol(Pl)}const Ul=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Vl=[],Fl=0;Fl<256;++Fl)Vl.push((Fl+256).toString(16).substr(1));const Bl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Vl[e[t+0]]+Vl[e[t+1]]+Vl[e[t+2]]+Vl[e[t+3]]+"-"+Vl[e[t+4]]+Vl[e[t+5]]+"-"+Vl[e[t+6]]+Vl[e[t+7]]+"-"+Vl[e[t+8]]+Vl[e[t+9]]+"-"+Vl[e[t+10]]+Vl[e[t+11]]+Vl[e[t+12]]+Vl[e[t+13]]+Vl[e[t+14]]+Vl[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Ul.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n},Hl=function(e,t,n){var i=(e=e||{}).random||(e.rng||Ll)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return Bl(i)};let zl=!0,jl=!0;function Gl(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function $l(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Wl(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(zl=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ql(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(jl=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Xl(){if("object"==typeof window){if(zl)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Yl(e,t){jl&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Jl(e){return"[object Object]"===Object.prototype.toString.call(e)}function Kl(e){return Jl(e)?Object.keys(e).reduce((function(t,n){const i=Jl(e[n]),r=i?Kl(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})}),{}):e}function Ql(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?Ql(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{Ql(e,e.get(t),n)}))})))}function Zl(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&Ql(e,n,r)}))})),r}const ec=Xl;function tc(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),ec("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return ec("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function nc(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function ic(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function rc(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else $l(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function oc(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ac(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(o(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(o(r(t)))},n])})).then(n,i)}}function sc(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Zl(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),$l(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Zl(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function lc(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function cc(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return lc(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function uc(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function dc(e,t){$l(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function hc(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){Yl("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function pc(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function fc(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mc(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function gc(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function _c(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),$l(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vc(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Yl("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function yc(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Ec(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function bc(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Sc(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Tc(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function xc(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ac(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function wc(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function Ic(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Rc(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Rc(e){return e&&void 0!==e.video?Object.assign({},e,{video:Kl(e.video)}):e}function Cc(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(Yl("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Mc(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kc(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Nc(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Dc=__webpack_require__(539),Oc=__webpack_require__.n(Dc);function Pc(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Oc().parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,$l(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Lc(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||$l(e,"icecandidate",(e=>{if(e.candidate){const t=Oc().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Uc(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Oc().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Oc().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=Oc().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>r}),this._sctp=o}return n.apply(this,arguments)}}function Vc(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},$l(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Fc(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Bc(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Hc(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function zc(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}!function({window:r}={},o={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const a=Xl,s=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Gl(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Gl(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Gl(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(r),l={browserDetails:s,commonShim:i,extractVersion:Gl,disableLog:Wl,disableWarnings:ql,sdp:Dc};switch(s.browser){case"chrome":if(!e||!uc||!o.shimChrome)return a("Chrome shim is not included in this adapter release."),l;if(null===s.version)return a("Chrome shim can not determine version, not shimming."),l;a("adapter.js shimming chrome."),l.browserShim=e,Hc(r,s),zc(r),tc(r,s),ic(r),uc(r,s),rc(r),cc(r,s),oc(r),ac(r),sc(r),dc(r,s),Pc(r),Lc(r),Fc(r),Uc(r,s),Vc(r),Bc(r,s);break;case"firefox":if(!t||!mc||!o.shimFirefox)return a("Firefox shim is not included in this adapter release."),l;a("adapter.js shimming firefox."),l.browserShim=t,Hc(r,s),zc(r),hc(r,s),mc(r,s),fc(r),vc(r),gc(r),_c(r),yc(r),Ec(r),bc(r),Sc(r),Tc(r),Pc(r),Fc(r),Uc(r,s),Vc(r);break;case"safari":if(!n||!o.shimSafari)return a("Safari shim is not included in this adapter release."),l;a("adapter.js shimming safari."),l.browserShim=n,Hc(r,s),zc(r),Cc(r),kc(r),wc(r),xc(r),Ac(r),Mc(r),Ic(r),Nc(r),Pc(r),Lc(r),Uc(r,s),Vc(r),Bc(r,s);break;default:a("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var jc,Gc=Object.create,$c=Object.defineProperty,Wc=Object.defineProperties,qc=Object.getOwnPropertyDescriptor,Xc=Object.getOwnPropertyDescriptors,Yc=Object.getOwnPropertyNames,Jc=Object.getOwnPropertySymbols,Kc=Object.getPrototypeOf,Qc=Object.prototype.hasOwnProperty,Zc=Object.prototype.propertyIsEnumerable,eu=Reflect.get,tu=Math.pow,nu=(e,t,n)=>t in e?$c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,iu=(e,t)=>{for(var n in t||(t={}))Qc.call(t,n)&&nu(e,n,t[n]);if(Jc)for(var n of Jc(t))Zc.call(t,n)&&nu(e,n,t[n]);return e},ru=(e,t)=>Wc(e,Xc(t)),ou=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),au=(e,t)=>{for(var n in t)$c(e,n,{get:t[n],enumerable:!0})},su=(e,t,n)=>(n=null!=e?Gc(Kc(e)):{},((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of Yc(t))!Qc.call(e,n)&&undefined!==n&&$c(e,n,{get:()=>t[n],enumerable:!(i=qc(t,n))||i.enumerable});return e})(!t&&e&&e.__esModule?n:$c(n,"default",{value:e,enumerable:!0}),e)),lu=(e,t,n,i)=>{for(var r,o=i>1?void 0:i?qc(t,n):t,a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i?r(t,n,o):r(o))||o);return i&&o&&$c(t,n,o),o},cu=(e,t,n)=>(nu(e,"symbol"!=typeof t?t+"":t,n),n),uu=(e,t,n)=>eu(Kc(e),n,t),du=(e,t,n)=>new Promise(((i,r)=>{var o=e=>{try{s(n.next(e))}catch(e){r(e)}},a=e=>{try{s(n.throw(e))}catch(e){r(e)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,a);s((n=n.apply(e,t)).next())})),hu=ou(((e,t)=>{var n=Object.prototype.hasOwnProperty,i="~";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,r,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new o(n,r||e,a),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function l(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),l.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},l.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},l.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var l,c,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,r),!0;case 5:return u.fn.call(u.context,t,n,r,o),!0;case 6:return u.fn.call(u.context,t,n,r,o,a),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,r);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},l.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn===t&&(!r||a.once)&&(!n||a.context===n)&&s(this,o);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||r&&!a[l].once||n&&a[l].context!==n)&&c.push(a[l]);c.length?this._events[o]=1===c.length?c[0]:c:s(this,o)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,void 0!==t&&(t.exports=l)})),pu=ou(((e,t)=>{var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),fu=ou((e=>{var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;(function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))})(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=pu(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var l=i[t][s];if(l.reg.test(r))return n(l,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}})),mu=ou(((e,t)=>{var n=pu(),i=/%[sdv%]/g,r=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?i.push(n[t.name][a]):i.push(n[t.names[o]])}else i.push(n[t.name]);return r.apply(null,i)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var i=t.outerOrder||a,r=t.innerOrder||s,l=[];return i.forEach((function(t){n[t].forEach((function(n){n.name in e&&null!=e[n.name]?l.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){l.push(o(t,n,e))}))}))})),e.media.forEach((function(e){l.push(o("m",n.m[0],e)),r.forEach((function(t){n[t].forEach((function(n){n.name in e&&null!=e[n.name]?l.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){l.push(o(t,n,e))}))}))}))})),l.join("\r\n")+"\r\n"}})),gu=ou((e=>{var t=fu(),n=mu();e.write=n,e.parse=t.parse,e.parseParams=t.parseParams,e.parseFmtpConfig=t.parseFmtpConfig,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList})),_u=ou(((e,t)=>{var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),vu=ou((e=>{var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;(function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))})(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=_u(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var l=i[t][s];if(l.reg.test(r))return n(l,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}})),yu=ou(((e,t)=>{var n=_u(),i=/%[sdv%]/g,r=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?i.push(n[t.name][a]):i.push(n[t.names[o]])}else i.push(n[t.name]);return r.apply(null,i)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var i=t.outerOrder||a,r=t.innerOrder||s,l=[];return i.forEach((function(t){n[t].forEach((function(n){n.name in e&&null!=e[n.name]?l.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){l.push(o(t,n,e))}))}))})),e.media.forEach((function(e){l.push(o("m",n.m[0],e)),r.forEach((function(t){n[t].forEach((function(n){n.name in e&&null!=e[n.name]?l.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){l.push(o(t,n,e))}))}))}))})),l.join("\r\n")+"\r\n"}})),Eu=ou((e=>{var t=vu(),n=yu();e.write=n,e.parse=t.parse,e.parseParams=t.parseParams,e.parseFmtpConfig=t.parseFmtpConfig,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList})),bu=su(hu()),Su=((jc=Su||{})[jc.INVALID_PARAMETER=4096]="INVALID_PARAMETER",jc[jc.INVALID_OPERATION=4097]="INVALID_OPERATION",jc[jc.NOT_SUPPORTED=4098]="NOT_SUPPORTED",jc[jc.DEVICE_NOT_FOUND=4099]="DEVICE_NOT_FOUND",jc[jc.INITIALIZE_FAILED=4100]="INITIALIZE_FAILED",jc[jc.SIGNAL_CHANNEL_SETUP_FAILED=16385]="SIGNAL_CHANNEL_SETUP_FAILED",jc[jc.SIGNAL_CHANNEL_ERROR=16386]="SIGNAL_CHANNEL_ERROR",jc[jc.ICE_TRANSPORT_ERROR=16387]="ICE_TRANSPORT_ERROR",jc[jc.JOIN_ROOM_FAILED=16388]="JOIN_ROOM_FAILED",jc[jc.CREATE_OFFER_FAILED=16389]="CREATE_OFFER_FAILED",jc[jc.SIGNAL_CHANNEL_RECONNECTION_FAILED=16390]="SIGNAL_CHANNEL_RECONNECTION_FAILED",jc[jc.UPLINK_RECONNECTION_FAILED=16391]="UPLINK_RECONNECTION_FAILED",jc[jc.DOWNLINK_RECONNECTION_FAILED=16392]="DOWNLINK_RECONNECTION_FAILED",jc[jc.REMOTE_STREAM_NOT_EXIST=16400]="REMOTE_STREAM_NOT_EXIST",jc[jc.CLIENT_BANNED=16448]="CLIENT_BANNED",jc[jc.SERVER_TIMEOUT=16449]="SERVER_TIMEOUT",jc[jc.SUBSCRIPTION_TIMEOUT=16450]="SUBSCRIPTION_TIMEOUT",jc[jc.PLAY_NOT_ALLOWED=16451]="PLAY_NOT_ALLOWED",jc[jc.DEVICE_AUTO_RECOVER_FAILED=16452]="DEVICE_AUTO_RECOVER_FAILED",jc[jc.START_PUBLISH_CDN_FAILED=16453]="START_PUBLISH_CDN_FAILED",jc[jc.STOP_PUBLISH_CDN_FAILED=16454]="STOP_PUBLISH_CDN_FAILED",jc[jc.START_MIX_TRANSCODE_FAILED=16455]="START_MIX_TRANSCODE_FAILED",jc[jc.STOP_MIX_TRANSCODE_FAILED=16456]="STOP_MIX_TRANSCODE_FAILED",jc[jc.NOT_SUPPORTED_H264=16457]="NOT_SUPPORTED_H264",jc[jc.SWITCH_ROLE_FAILED=16458]="SWITCH_ROLE_FAILED",jc[jc.API_CALL_TIMEOUT=16459]="API_CALL_TIMEOUT",jc[jc.SCHEDULE_FAILED=16460]="SCHEDULE_FAILED",jc[jc.API_CALL_ABORTED=16461]="API_CALL_ABORTED",jc[jc.SPC_INITIALIZED_FAILED=16462]="SPC_INITIALIZED_FAILED",jc[jc.UNKNOWN=65535]="UNKNOWN",jc),Tu=Su,xu=class extends Error{constructor({name:e="RtcError",message:t,code:n=Tu.UNKNOWN,extraCode:i=0,constraint:r}){let o=`<${function(e){for(let t in Tu)if(Tu[t]===e)return t;return"UNKNOWN"}(n)} 0x${n.toString(16)}>`,a=`${t}${r?` constraint: ${r}`:""}${null!=t&&t.includes(o)?"":` ${o}`}`;super(a),cu(this,"code"),cu(this,"extraCode"),cu(this,"message"),cu(this,"originMessage"),cu(this,"name"),cu(this,"constraint"),this.code=n,this.extraCode=i,this.name=e,this.message=a,this.constraint=r,this.originMessage=t}getCode(){return this.code}getExtraCode(){return this.extraCode}toString(){return this.originMessage}},Au=xu,wu=((new Date).getTime(),0),Iu=function(){return(new Date).getTime()+wu},Ru=function(){let e=new Date;return e.setTime(Iu()),e.toLocaleString()},Cu={};au(Cu,{bytes2ms:()=>Rf,convertObjectNumberToInt:()=>ym,copyProperties:()=>If,deepClone:()=>lm,deepMerge:()=>sm,delay:()=>Em,fibonacci:()=>Pf,formatedTime:()=>hm,getAbilityConfigUrl:()=>mf,getConstructorName:()=>Yf,getContainerFromElement:()=>um,getEnv:()=>yf,getInternalVersion:()=>em,getLoggerUrl:()=>bf,getMuteStateFromFlag:()=>rm,getNetworkType:()=>Tf,getNumNetworkType:()=>wf,getReconnectionTimeout:()=>Lf,getStringByteLength:()=>mm,getTurnServer:()=>om,getUint32Version:()=>vm,getValueType:()=>Uf,getViewListFromView:()=>cm,glog:()=>Nf,ipv4ToUint32:()=>am,isArray:()=>Gf,isAudioWorkletSupported:()=>Jf,isBoolean:()=>zf,isConstructor:()=>Xf,isEmpty:()=>im,isFunction:()=>Vf,isLangChinese:()=>Df,isMediaStreamTrack:()=>$f,isNumber:()=>Hf,isObject:()=>jf,isOverseaSdkAppId:()=>Ef,isPlainObject:()=>Of,isPortrait:()=>gm,isPromise:()=>qf,isRemoteTrack:()=>Wf,isString:()=>Bf,isUndefined:()=>Ff,loadImage:()=>_m,ms2bytes:()=>Mf,ms2samples:()=>kf,performanceNow:()=>Qf,promiseAny:()=>Kf,samples2ms:()=>Cf,setNetworkType:()=>Af,stringify:()=>pm,stringifyIncludeValue:()=>fm,throttlePromise:()=>bm});var Mu={};au(Mu,{AUDIO_MUTE_BIT:()=>gd,AUDIO_STAT_BIT:()=>md,AUX_STAT_BIT:()=>fd,AUX_STREAM_MSID:()=>yd,BACKEND_ENV:()=>ud,BASE_DOC_URL:()=>Wu,BASE_HOST:()=>zu,CAPABILITIES_KEYS:()=>uh,CLASS_NAME:()=>Kd,CLOUD_CONSOLE_URL:()=>$u,DATA_FREEZE_TIMING:()=>Gd,DOC_URL:()=>qu,DTLS_STATE_UNKNOWN:()=>Cd,ENV_NAME:()=>Qu,EXCHANGE_SDP_TIMEOUT:()=>Fd,INTERVAL:()=>lh,IS_WORKER:()=>Uu,IS_WORKLET:()=>Vu,KIBANA_EVENT:()=>Ld,LOCAL_STREAM_PUBLISH_STATE:()=>jd,LOGGER_CMD_TYPE:()=>Ku,LOGGER_DOMAIN:()=>Xu,LOGGER_DOMAIN_OVERSEA:()=>Yu,LOG_LEVEL:()=>Zu,LOG_LEVEL_NAME:()=>nh,MAIN_STREAM_MSID:()=>vd,MICROPHONE_COMMUNICATIONS:()=>th,MICROPHONE_DEFAULT:()=>Zd,NAME:()=>ld,NETWORK_TYPE:()=>nd,NOT_SUPPORTED_H264:()=>zd,PAUSED_RETRY_COUNT:()=>Qd,PEERCONNECTION_CONNECTING_TIMEOUT:()=>Xd,PEER_CONNECTION_STATE:()=>Md,PEER_LEAVE_REASON:()=>ih,RAF:()=>sh,RECOVER_CAPTURE_INTERVAL:()=>oh,REMOTE_STREAM_TYPE_AUX:()=>bd,REMOTE_STREAM_TYPE_MAIN:()=>Ed,RENDER_FREEZE_TIMING:()=>$d,RIC:()=>ah,SCHEDULE_DOMAIN:()=>Yd,SCHEDULE_TIMEOUT:()=>Jd,SDP_SEMANTICS_PLAN_B:()=>Hd,SDP_SEMANTICS_UNIFIED_PLAN:()=>Bd,SECOND_HOST:()=>ju,SIGNAL_PING_PONG_INTERVAL:()=>td,SIGNAL_PING_TIMEOUT:()=>ed,SIGNAL_RECONNECTION_COUNT:()=>Pd,SMALL_STAT_BIT:()=>pd,SPEAKER_DEFAULT:()=>eh,STORAGE_EXPIRES_TIME:()=>id,STREAM_TYPE_BIG:()=>Wd,STREAM_TYPE_SMALL:()=>qd,SUBSCRIBE_SMALL_RETRY_COUNT:()=>rh,SYNC_USER_LIST_INTERVAL:()=>Ud,Scene:()=>dd,Switch:()=>rd,THIRD_HOST:()=>Gu,TIMEOUT:()=>ch,TRANSPORT_DIRECTION:()=>cd,TRTC_ERROR_ASSISTANCE:()=>Ju,TRTC_QUALITY_BAD:()=>wd,TRTC_QUALITY_DISCONNECTED:()=>Rd,TRTC_QUALITY_EXCELLENT:()=>Td,TRTC_QUALITY_GOOD:()=>xd,TRTC_QUALITY_POOR:()=>Ad,TRTC_QUALITY_UNKNOWN:()=>Sd,TRTC_QUALITY_VERY_BAD:()=>Id,UPDATE_OFFER_TIMEOUT:()=>Vd,VIDEO_MUTE_BIT:()=>_d,VIDEO_STAT_BIT:()=>hd,audioProfileMap:()=>od,getRetryCount:()=>Dd,getScriptDir:()=>Fu,innerVersion:()=>ku,loggerProxy:()=>Bu,screenProfileMap:()=>sd,setLoggerProxy:()=>Hu,setRetryCount:()=>Nd,setVersion:()=>Du,version:()=>Nu,videoProfileMap:()=>ad});var ku="4.15.00.1600",Nu="5.0.0";function Du(e){Nu=e;let[t,n,i]=e.split(".").map((e=>parseInt(e,10)));ku=`${t}.${Math.min(15,n)}.${Math.min(15,i)}.${n.toString().padStart(2,"0")}${i.toString().padStart(2,"0")}`}var Ou,Pu,Lu,Uu="undefined"!=typeof importScripts,Vu="undefined"!=typeof registerProcessor,Fu=()=>{let e=Uu?self.location.href:document.currentScript.src;return e.substring(0,e.lastIndexOf("/")+1)},Bu="",Hu=e=>Bu=e,zu="web.sdk.qcloud.com",ju="web.sdk.tencent.cn",Gu="web.sdk.cloud.tencent.cn",$u="https://console.cloud.tencent.com/trtc",Wu=`https://${zu}/trtc/webrtc/v5/doc`,qu=`${Wu}/zh-cn/`,Xu="https://yun.tim.qq.com",Yu="https://apisgp.my-imcloud.com",Ju="trtc_error_assistance",Ku={LOG:"jssdk_log",EVENT:"jssdk_event",KEY_POINT:"jssdk_new_endreport",KV_STAT:"jssdk_key_metrics_report"},Qu={QCLOUD:"qcloud",OLD_CLOUD_LADDER:"trtc",WEBRTC:"webrtc"},Zu=((Lu=Zu||{})[Lu.TRACE=0]="TRACE",Lu[Lu.DEBUG=1]="DEBUG",Lu[Lu.INFO=2]="INFO",Lu[Lu.WARN=3]="WARN",Lu[Lu.ERROR=4]="ERROR",Lu[Lu.NONE=5]="NONE",Lu),ed=18e3,td=2e3,nd={unknown:0,wifi:1,"3g":2,"2g":3,"4g":4,wired:5,"5g":6},id=6048e5,rd=((Pu=rd||{}).USEAINS="useAINS",Pu.ENABLEDEBUG="enableDebug",Pu.USEV2="useV2",Pu.USEWT="useWt",Pu),od={standard:{sampleRate:48e3,channelCount:1,bitrate:40},"standard-stereo":{sampleRate:48e3,channelCount:2,bitrate:64},high:{sampleRate:48e3,channelCount:1,bitrate:128},"high-stereo":{sampleRate:48e3,channelCount:2,bitrate:192}},ad={"120p":{width:160,height:120,frameRate:15,bitrate:200},"120p_2":{width:160,height:120,frameRate:15,bitrate:100},"180p":{width:320,height:180,frameRate:15,bitrate:350},"180p_2":{width:320,height:180,frameRate:15,bitrate:150},"240p":{width:320,height:240,frameRate:15,bitrate:400},"240p_2":{width:320,height:240,frameRate:15,bitrate:200},"360p":{width:640,height:360,frameRate:15,bitrate:800},"360p_2":{width:640,height:360,frameRate:15,bitrate:400},"480p":{width:640,height:480,frameRate:15,bitrate:900},"480p_2":{width:640,height:480,frameRate:15,bitrate:500},"720p":{width:1280,height:720,frameRate:15,bitrate:1500},"1080p":{width:1920,height:1080,frameRate:15,bitrate:2e3},"1440p":{width:2560,height:1440,frameRate:30,bitrate:4860},"4K":{width:3840,height:2160,frameRate:30,bitrate:9e3}},sd={"480p":{width:640,height:480,frameRate:5,bitrate:900},"480p_2":{width:640,height:480,frameRate:30,bitrate:1e3},"720p":{width:1280,height:720,frameRate:5,bitrate:1200},"720p_2":{width:1280,height:720,frameRate:30,bitrate:3e3},"1080p":{width:1920,height:1080,frameRate:5,bitrate:1600},"1080p_2":{width:1920,height:1080,frameRate:30,bitrate:4e3}},ld={CANVAS:"canvas",AUDIO:"audio",VIDEO:"video",SCREEN:"screen",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",SMALL_VIDEO:"smallVideo",FACING_MODE_USER:"user",FACING_MODE_ENVIRONMENT:"environment",MUTE:"mute",UNMUTE:"unmute",ENDED:"ended",PLAYING:"playing",PAUSE:"pause",ERROR:"error",LOADEDDATA:"loadeddata",AUDIO_INPUT:"audioinput",VIDEO_INPUT:"videoinput",DETAIL:"detail",TEXT:"text",MAIN:"main",BACKUP:"backup",BANNED:"banned",KICK:"kick",USER_TIME_OUT:"user_time_out",ROOM_DISBAND:"room_disband",SEI_MESSAGE:"sei-message",ADD:"add",REMOVE:"remove",REPLACE:"replace",TRACK:"track",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",TRANSCEIVER_DIRECTION_SENDONLY:"sendonly",TRANSCEIVER_DIRECTION_RECVONLY:"recvonly",ENTER_PICTURE_IN_PICTURE:"enterpictureinpicture",LEAVE_PICTURE_IN_PICTURE:"leavepictureinpicture"},cd={INACTIVE:"inactive",SENDONLY:"sendonly",RECVONLY:"recvonly"},ud={OLD_CLOUD_LADDER:"wss://trtc.rtc.qq.com",WEBRTC:"wss://webrtc.qq.com"},dd=((Ou=dd||{}).LIVE="live",Ou.RTC="rtc",Ou),hd=1,pd=2,fd=4,md=8,gd=64,_d=16,vd="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",yd="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",Ed=ld.MAIN,bd=ld.AUXILIARY,Sd=0,Td=1,xd=2,Ad=3,wd=4,Id=5,Rd=6,Cd="unknown",Md={NEW:"new",CONNECTING:"connecting",FAILED:"failed",CLOSED:"closed",DISCONNECTED:"disconnected",CONNECTED:"connected",COMPLETED:"completed"},kd=1/0;function Nd(e){kd=e}function Dd(){return kd}var Od,Pd=30,Ld={JOIN:"join",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_LOCAL_AUDIO_TRACK:"recover-local-audio-track",RECOVER_LOCAL_VIDEO_TRACK:"recover-local-video-track",RECOVER_SUBSCRIPTION:"recover-subscription",START_MIX_TRANSCODE:"start-mix-transcode",STOP_MIX_TRANSCODE:"stop-mix-transcode",PLAYER_ERROR:"player-error",SCHEDULE:"schedule",LOAD_WORKLET:"load-worklet",VIDEO_FROZEN_COUNT:"videoFrozenCount",GET_USER_MEDIA_RETRY:"getUserMedia-retry"},Ud=1e4,Vd=1e4,Fd=1e4,Bd="unified-plan",Hd="plan-b",zd=1028,jd=((Od=jd||{})[Od.UNPUBLISH=-1]="UNPUBLISH",Od[Od.PUBLISHING=0]="PUBLISHING",Od[Od.PUBLISHED=1]="PUBLISHED",Od),Gd=500,$d=1e3,Wd=ld.BIG,qd=ld.SMALL,Xd=1e4,Yd={MAIN:"schedule.cloud-rtc.com",BACKUP:"schedule.cloud-rtc.net",MAIN_OVERSEA:"schedule.rtc-web.com",BACKUP_OVERSEA:"schedule.rtc-web.io",MAIN_OVERSEA_OLD:"schedule.rtc.tencentcloud.com",BACKUP_OVERSEA_OLD:"schedule-ecdn.rtc.tencentcloud.com"},Jd=2e3,Kd={TRTC:"TRTC",CLIENT:"Client",LOCAL_STREAM:"LocalStream",REMOTE_STREAM:"RemoteStream",STREAM:"Stream"},Qd=5,Zd="default",eh=Zd,th="communications",nh=Object.keys(Zu),ih=["normal leave","timeout leave","kick","role change"],rh=10,oh=2e3,ah="ric",sh="raf",lh="interval",ch="timeout",uh=["width","height","frameRate","facingMode","sampleRate","sampleSize","channelCount","deviceId","min","max"];function dh({url:e,body:t,method:n,timeout:i}){let r=new XMLHttpRequest;return new Promise(((o,a)=>{r.onreadystatechange=()=>{if(4===r.readyState)if(r.status>=200&&r.status<300)try{let e=JSON.parse(r.response);o({data:e})}catch(e){o({data:r.response})}else a({status:r.status,statusText:r.statusText||"request failed!"})},r.timeout=i||5e3,r.open(n||"POST",e,!0),r.send(t)}))}function hh(e){return du(this,null,(function*(){let t=Qf(),n=JSON.stringify(e);try{if(!CompressionStream||n.length<=2800)return n;let e=new Blob([n],{type:"application/json"}).stream().pipeThrough(new CompressionStream("gzip")),i=yield(yield(yield new Response(e)).blob()).arrayBuffer();return wm.debug(`compressJSON ${n.length} -> ${i.byteLength} ${Qf()-t}ms`),i}catch(e){return n}}))}var ph=1e8,fh={AVOID_REPEATED_CALL:"AVOID_REPEATED_CALL",INVALID_PARAMETER_REQUIRED:"INVALID_PARAMETER_REQUIRED",INVALID_PARAMETER_TYPE:"INVALID_PARAMETER_TYPE",INVALID_PARAMETER_EMPTY:"INVALID_PARAMETER_EMPTY",INVALID_PARAMETER_INSTANCE:"INVALID_PARAMETER_INSTANCE",INVALID_PARAMETER_RANGE:"INVALID_PARAMETER_RANGE",INVALID_PARAMETER_MIN:"INVALID_PARAMETER_MIN",INVALID_PARAMETER_MAX:"INVALID_PARAMETER_MAX",INVALID_PARAMETER_STREAMTYPE:"INVALID_PARAMETER_STREAMTYPE",API_CALL_TIMEOUT:"API_CALL_TIMEOUT",SIGNAL_CHANNEL_RECONNECTION_FAILED:"SIGNAL_CHANNEL_RECONNECTION_FAILED",SIGNAL_CHANNEL_SETUP_FAILED:"SIGNAL_CHANNEL_SETUP_FAILED",ERROR_MESSAGE:"ERROR_MESSAGE",EXCHANGE_SDP_TIMEOUT:"EXCHANGE_SDP_TIMEOUT",DOWNLINK_RECONNECTION_FAILED:"DOWNLINK_RECONNECTION_FAILED",EXCHANGE_SDP_FAILED:"EXCHANGE_SDP_FAILED",UPDATE_OFFER_TIMEOUT:"UPDATE_OFFER_TIMEOUT",UPLINK_RECONNECTION_FAILED:"UPLINK_RECONNECTION_FAILED",INVALID_RECORDID:"INVALID_RECORDID",INVALID_PURE_AUDIO:"INVALID_PURE_AUDIO",INVALID_STREAMID:"INVALID_STREAMID",INVALID_USER_DEFINE_RECORDID:"INVALID_USER_DEFINE_RECORDID",INVALID_USER_DEFINE_PUSH_ARGS:"INVALID_USER_DEFINE_PUSH_ARGS",INVALID_PROXY:"INVALID_PROXY",INVALID_JOIN:"INVALID_JOIN",INVALID_ROOMID_STRING:"INVALID_ROOMID_STRING",INVALID_ROOMID_INTEGER:"INVALID_ROOMID_INTEGER",INVALID_SIGNAL_CHANNEL:"INVALID_SIGNAL_CHANNEL",JOIN_ROOM_TIMEOUT:"JOIN_ROOM_TIMEOUT",JOIN_ROOM_FAILED:"JOIN_ROOM_FAILED",REJOIN_ROOM_FAILED:"REJOIN_ROOM_FAILED",INVALID_DESTROY:"INVALID_DESTROY",INVALID_PUBLISH:"INVALID_PUBLISH",INVALID_UNPUBLISH:"INVALID_UNPUBLISH",INVALID_AUDIENCE:"INVALID_AUDIENCE",INVALID_INITIALIZE:"INVALID_INITIALIZE",INVALID_DUPLICATE_PUBLISHING:"INVALID_DUPLICATE_PUBLISHING",INVALID_SUBSCRIBE_UNDEFINED:"INVALID_SUBSCRIBE_UNDEFINED",INVALID_SUBSCRIBE_LOCAL:"INVALID_SUBSCRIBE_LOCAL",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",SUBSCRIBE_FAILED:"SUBSCRIBE_FAILED",INVALID_ROLE:"INVALID_ROLE",INVALID_PARAMETER_SWITCH_ROLE:"INVALID_PARAMETER_SWITCH_ROLE",INVALID_OPERATION_SWITCH_ROLE:"INVALID_OPERATION_SWITCH_ROLE",SWITCH_ROLE_TIMEOUT:"SWITCH_ROLE_TIMEOUT",SWITCH_ROLE_FAILED:"SWITCH_ROLE_FAILED",CLIENT_BANNED:"CLIENT_BANNED",INVALID_OPERATION_START_PUBLISH_CDN:"INVALID_OPERATION_START_PUBLISH_CDN",INVALID_OPERATION_STOP_PUBLISH_CDN:"INVALID_OPERATION_STOP_PUBLISH_CDN",INVALID_STREAM_ID:"INVALID_STREAM_ID",START_PUBLISH_CDN_FAILED:"START_PUBLISH_CDN_FAILED",STOP_PUBLISH_CDN_FAILED:"STOP_PUBLISH_CDN_FAILED",START_MIX_TRANSCODE:"START_MIX_TRANSCODE",STOP_MIX_TRANSCODE:"STOP_MIX_TRANSCODE",INVALID_AUDIO_VOLUME:"INVALID_AUDIO_VOLUME",ENABLE_SMALL_STREAM_PUBLISHED:"ENABLE_SMALL_STREAM_PUBLISHED",DISABLE_SMALL_STREAM_PUBLISHED:"DISABLE_SMALL_STREAM_PUBLISHED",NOT_SUPPORTED_SMALL_STREAM:"NOT_SUPPORTED_SMALL_STREAM",INVALID_SMALL_STREAM_PROFILE:"INVALID_SMALL_STREAM_PROFILE",INVALID_PARAMETER_REMOTE_STREAM:"INVALID_PARAMETER_REMOTE_STREAM",INVALID_OPERATION_CHANGE_SMALL:"INVALID_OPERATION_CHANGE_SMALL",REMOTE_NOT_PUBLISH_SMALL_STREAM:"REMOTE_NOT_PUBLISH_SMALL_STREAM",INVALID_SWITCH_DEVICE:"INVALID_SWITCH_DEVICE",INVALID_SWITCH_DEVICE_PUBLISHING:"INVALID_SWITCH_DEVICE_PUBLISHING",INVALID_REPLACE_TRACK:"INVALID_REPLACE_TRACK",INVALID_INITIALIZE_LOCAL_STREAM:"INVALID_INITIALIZE_LOCAL_STREAM",INVALID_ADD_TRACK_REPETITIVE:"INVALID_ADD_TRACK_REPETITIVE",INVALID_ADD_TRACK_REMOVING:"INVALID_ADD_TRACK_REMOVING",INVALID_ADD_TRACK_PUBLISHING:"INVALID_ADD_TRACK_PUBLISHING",INVALID_STREAM_INITIALIZED:"INVALID_STREAM_INITIALIZED",INVALID_ADD_TRACK_NUMBER:"INVALID_ADD_TRACK_NUMBER",INVALID_REMOVE_AUDIO_TRACK:"INVALID_REMOVE_AUDIO_TRACK",INVALID_REMOVE_AUDIO_ADDING:"INVALID_REMOVE_AUDIO_ADDING",INVALID_REMOVE_AUDIO_ON:"INVALID_REMOVE_AUDIO_ON",INVALID_REMOVE_TRACK_PUBLISHING:"INVALID_REMOVE_TRACK_PUBLISHING",INVALID_REMOVE_TRACK_NOT_TRACK:"INVALID_REMOVE_TRACK_NOT_TRACK",INVALID_REMOVE_TRACK_NUMBER:"INVALID_REMOVE_TRACK_NUMBER",INVALID_REPLACE_TRACK_NO_TRACK:"INVALID_REPLACE_TRACK_NO_TRACK",REPEAT_JOIN:"REPEAT_JOIN",CLIENT_DESTROYED:"CLIENT_DESTROYED",NOT_BUG_PACKAGE:"NOT_BUG_PACKAGE",START_MIX_TRANSCODE_FAILED:"START_MIX_TRANSCODE_FAILED",STOP_MIX_TRANSCODE_FAILED:"STOP_MIX_TRANSCODE_FAILED",MIX_TRANSCODE_NOT_STARTED:"MIX_TRANSCODE_NOT_STARTED",CANNOT_LESS_THAN_ZERO:"CANNOT_LESS_THAN_ZERO",MIX_PARAMS_VIDEO_FRAMERATE:"MIX_PARAMS_VIDEO_FRAMERATE",MIX_PARAMS_VIDEO_GOP:"MIX_PARAMS_VIDEO_GOP",MIX_PARAMS_AUDIO_BITRATE:"MIX_PARAMS_AUDIO_BITRATE",MIX_PARAMS_USER_Z_ORDER:"MIX_PARAMS_USER_Z_ORDER",MIX_PARAMS_NOT_SELF:"MIX_PARAMS_NOT_SELF",MIX_PARAMS_USER_STREAM:"MIX_PARAMS_USER_STREAM",INVALID_PLAY:"INVALID_PLAY",INVALID_ELEMENT_ID:"INVALID_ELEMENT_ID",INVALID_ELEMENT_ID_TYPE:"INVALID_ELEMENT_ID_TYPE",PLAY_FAILED:"PLAY_FAILED",INVALID_USERID:"INVALID_USERID",INVALID_CREATE_STREAM_SOURCE:"INVALID_CREATE_STREAM_SOURCE",INVALID_CREATE_STREAM_SCREEN:"INVALID_CREATE_STREAM_SCREEN",INVALID_CREATE_STREAM_AUDIO:"INVALID_CREATE_STREAM_AUDIO",INVALID_CREATE_STREAM_SCREEN_AUDIO:"INVALID_CREATE_STREAM_SCREEN_AUDIO",NOT_SUPPORTED_HTTP:"NOT_SUPPORTED_HTTP",NOT_SUPPORTED_WEBRTC:"NOT_SUPPORTED_WEBRTC",NOT_SUPPORTED_PROFILE:"NOT_SUPPORTED_PROFILE",NOT_SUPPORTED_MEDIA:"NOT_SUPPORTED_MEDIA",NOT_SUPPORTED_H264ENCODE:"NOT_SUPPORTED_H264ENCODE",NOT_SUPPORTED_H264DECODE:"NOT_SUPPORTED_H264DECODE",NOT_SUPPORTED_TRACK:"NOT_SUPPORTED_TRACK",NOT_SUPPORTED_SWITCH_DEVICE:"NOT_SUPPORTED_SWITCH_DEVICE",NOT_SUPPORTED_CAPTURE:"NOT_SUPPORTED_CAPTURE",NOT_SUPPORTED_AUX:"NOT_SUPPORTED_AUX",MICROPHONE_NOT_FOUND:"MICROPHONE_NOT_FOUND",CAMERA_NOT_FOUND:"CAMERA_NOT_FOUND",SIGNAL_RESPONSE_FAILED:"SIGNAL_RESPONSE_FAILED",CATCH_HANDLER_ERROR:"CATCH_HANDLER_ERROR",API_NOT_EXIST:"API_NOT_EXIST",CONNECTION_CLOSED:"CONNECTION_CLOSED",SUBSCRIBE_ALL_FALSE:"SUBSCRIBE_ALL_FALSE",SEI_NOT_SUPPORT:"SEI_NOT_SUPPORT",SEI_DISABLED:"SEI_DISABLED",SEI_BEFORE_PUBLISH:"SEI_BEFORE_PUBLISH",SEI_NOT_VIDEO:"SEI_NOT_VIDEO",CALL_FREQUENCY_LIMIT:"CALL_FREQUENCY_LIMIT",CONNECTION_ABORTED:"CONNECTION_ABORTED",API_CALL_ABORTED:"API_CALL_ABORTED",DUPLICATE_AUX:"DUPLICATE_AUX"},mh={AVOID_REPEATED_CALL:e=>`previous ${e.name}() is ongoing, please avoid repeated calls.`,INVALID_PARAMETER_REQUIRED:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' is a required param when calling ${n}(), received: ${i}.`,INVALID_PARAMETER_TYPE({key:e,rule:t,fnName:n,value:i}){let r=`${e||t.name}`,o="";return o=Array.isArray(t.type)?t.type.join("|"):t.type,`'${r}' must be type of ${o} when calling ${n}(), received type: ${Uf(i)}.`},INVALID_PARAMETER_EMPTY:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' cannot be '${i}' when calling ${n}().`,INVALID_PARAMETER_INSTANCE:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' must be instanceof ${t.instanceOf.name||t.instanceOf} when calling ${n}(), received type: ${Uf(i)}.`,INVALID_PARAMETER_RANGE:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' must be one of ${t.values.join("|")} when calling ${n}(), received: ${i}.`,INVALID_PARAMETER_MIN:({key:e,rule:t,fnName:n,value:i})=>`the min value of ${e||t.name} is ${t.min}, received: ${i}.`,INVALID_PARAMETER_MAX:({key:e,rule:t,fnName:n,value:i})=>`the max value of ${e||t.name} is ${t.max}, received: ${i}.`,API_CALL_TIMEOUT:e=>`${e.commandDesc||e.command} timeout observed.`,SIGNAL_CHANNEL_RECONNECTION_FAILED:"signal channel reconnection failed, please check your network.",SIGNAL_CHANNEL_SETUP_FAILED:e=>`SignalChannel setup failure: (errorCode: ${e.errorCode}, errorMsg: ${e.errorMsg} }).`,ERROR_MESSAGE(e){let t=`${e.type} failed`;return e.message&&(t=`${t}: ${e.message}.`),t},EXCHANGE_SDP_TIMEOUT:"exchange sdp timeout.",DOWNLINK_RECONNECTION_FAILED:"downlink reconnection failed, please check your network and re-join room.",EXCHANGE_SDP_FAILED:e=>`exchange sdp failed ${e.errMsg}.`,UPDATE_OFFER_TIMEOUT:"update offer timeout observed.",UPLINK_RECONNECTION_FAILED:"uplink reconnection failed, please check your network and publish again.",INVALID_RECORDID:"recordId must be an integer number.",INVALID_PURE_AUDIO:"pureAudioPushMode must be 1 or 2.",INVALID_STREAMID:"streamId must be a sting literal within 64 bytes, and not be empty.",INVALID_USER_DEFINE_RECORDID:"userDefineRecordId must be a sting literal contains (a-zA-Z),(0-9), underline and hyphen, within 64 bytes, and not be empty.",INVALID_USER_DEFINE_PUSH_ARGS:"userDefinePushArgs must be a sting literal within 256 bytes, and not be empty.",INVALID_PROXY:'proxy server url must start with "wss://".',INVALID_JOIN:"duplicate join() called.",INVALID_ROOMID_STRING:e=>`'${e}' must be validate string when useStringRoomId is true.`,INVALID_ROOMID_INTEGER:e=>`'${e}' must be an integer between [1, 4294967294] when useStringRoomId is false.`,INVALID_SIGNAL_CHANNEL:"SignalChannel is not ready yet.",JOIN_ROOM_TIMEOUT:"join room timeout.",JOIN_ROOM_FAILED:({error:e,code:t})=>`Failed to join room - ${e} code: ${t}`,REJOIN_ROOM_FAILED:e=>`reJoin room: ${e.roomId} failed, please check your network.`,INVALID_DESTROY:"please call leave() before destroy().",INVALID_PUBLISH:"please call join() before publish().",INVALID_UNPUBLISH:"stream has not been published yet.",INVALID_AUDIENCE:'no permission to publish() under live/audience, please call switchRole("anchor") firstly before publish().',INVALID_INITIALIZE:"cannot publish stream because stream is not initialized, is switching device, or has been closed.",INVALID_DUPLICATE_PUBLISHING:e=>`duplicate ${e} stream publishing, please unpublish your prev ${e} stream and then re-publish.`,INVALID_SUBSCRIBE_UNDEFINED:"stream is undefined or null.",INVALID_SUBSCRIBE_LOCAL:"stream cannot be LocalStream.",INVALID_REMOTE_STREAM:"remoteStream does not exist because it has been unpublished by remote peer.",SUBSCRIBE_FAILED:({message:e,userId:t,streamType:n})=>`failed to subscribe ${t} ${n} stream, reason: ${e}.`,INVALID_ROLE:"switchRole can only be called in live mode.",INVALID_PARAMETER_SWITCH_ROLE:"role could only be set to a value as anchor or audience.",INVALID_OPERATION_SWITCH_ROLE:"please call join() before switchRole().",SWITCH_ROLE_TIMEOUT:"switchRole timeout.",SWITCH_ROLE_FAILED:e=>`switchRole failed, errCode: ${e.code} errMsg: ${e.message}.`,CLIENT_BANNED:e=>`client was banned because of ${e.message}.`,INVALID_OPERATION_START_PUBLISH_CDN:"please call startPublishCDNStream() after join room and publish the local stream.",INVALID_OPERATION_STOP_PUBLISH_CDN:"please call startPublishCDNStream() before stopPublishCDNStream().",START_PUBLISH_CDN_FAILED:e=>`startPublishCDNStream failed, errMsg: ${e.message}.`,STOP_PUBLISH_CDN_FAILED:e=>`stopPublishCDNStream failed, errMsg: ${e.message}.`,INVALID_STREAM_ID:e=>`'${e}' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores.`,START_MIX_TRANSCODE:"please call startMixTranscode() after join().",STOP_MIX_TRANSCODE:"please call stopMixTranscode() after startMixTranscode().",INVALID_AUDIO_VOLUME:"interval must be a number.",ENABLE_SMALL_STREAM_PUBLISHED:"Cannot enable small stream after localStream published.",DISABLE_SMALL_STREAM_PUBLISHED:"Cannot disable small stream after localStream published.",NOT_SUPPORTED_SMALL_STREAM:"your browser does not support opening small stream.",INVALID_SMALL_STREAM_PROFILE:"small stream profile is invalid.",INVALID_PARAMETER_REMOTE_STREAM:"remoteStream is invalid.",INVALID_OPERATION_CHANGE_SMALL:"cannot switch to the small stream without subscribing to the video of remoteStream.",REMOTE_NOT_PUBLISH_SMALL_STREAM:"remote peer does not publish small stream.",INVALID_SWITCH_DEVICE:"cannot switch device on current stream.",INVALID_SWITCH_DEVICE_PUBLISHING:"cannot switch device when publishing localStream.",INVALID_REPLACE_TRACK:"cannot replace track when publishing localStream.",INVALID_INITIALIZE_LOCAL_STREAM:"local stream has not initialized yet.",INVALID_ADD_TRACK_REPETITIVE:"previous addTrack is ongoing, please avoid repetitive execution.",INVALID_ADD_TRACK_REMOVING:"cannot add track when a track is removing.",INVALID_ADD_TRACK_PUBLISHING:"cannot add track when publishing localStream.",INVALID_STREAM_INITIALIZED:"your local stream haven't been initialized yet.",INVALID_ADD_TRACK_NUMBER:"a Stream has at most one audio track and one video track.",INVALID_REMOVE_AUDIO_TRACK:"remove audio track is not supported on your browser.",INVALID_REMOVE_AUDIO_ADDING:"cannot remove track when a track is adding.",INVALID_REMOVE_AUDIO_ON:"previous removeTrack is ongoing, please avoid repetitive execution.",INVALID_REMOVE_TRACK_PUBLISHING:"cannot remove track when publishing localStream.",INVALID_REMOVE_TRACK_NOT_TRACK:"localStream has not this track.",INVALID_REMOVE_TRACK_NUMBER:"remove the only video track is not supported, please use replaceTrack or muteVideo.",INVALID_REPLACE_TRACK_NO_TRACK:e=>`cannot replace ${e.kind} track because stream has not ${e.kind} track`,NOT_BUG_PACKAGE:"You need to buy packages, refer to tencent console.",START_MIX_TRANSCODE_FAILED:e=>`startMixTranscode failed, errMsg: ${e.message}.`,STOP_MIX_TRANSCODE_FAILED:e=>`stopMixTranscode failed, errMsg: ${e.message}.`,MIX_TRANSCODE_NOT_STARTED:"mixTranscode has not been started.",CANNOT_LESS_THAN_ZERO:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' cannot be less than 0 when calling ${n}().`,MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' should be an integer between 0 and 30, excluding 0.",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' should be an integer between 1 and 8.",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' should be an integer between 32 and 192.",MIX_PARAMS_USER_Z_ORDER:e=>`'${e}' is required and must be between 1 and 15.`,MIX_PARAMS_NOT_SELF:"'config.mixUsers' must contain self.",MIX_PARAMS_USER_STREAM:"'config.videoWidth' and 'config.videoHeight' of output stream should be contain all mix stream.",INVALID_PLAY:"duplicate play() call observed, please stop() firstly.",INVALID_ELEMENT_ID:({key:e,fnName:t})=>`'${e}' is not found in the document object when calling ${t}().`,INVALID_ELEMENT_ID_TYPE:({key:e,fnName:t,type:n})=>`the element corresponding to '${e}' must be instanceof HTMLElement when calling ${t}(), received: ${n}.`,PLAY_FAILED:e=>`${e.media} play failedbrowser exception: ${e.error.toString()}`,INVALID_USERID:"userId cannot be all spaces.",INVALID_CREATE_STREAM_SOURCE:"LocalStream must be created by createStream() with either audio/video or audioSource/videoSource, but can not be mixed with audio/video and audioSource/videoSource.",INVALID_CREATE_STREAM_SCREEN:"screen/video cannot be both true.",INVALID_CREATE_STREAM_AUDIO:"audio/screenAudio cannot be both true.",INVALID_CREATE_STREAM_SCREEN_AUDIO:"when screen is true, screenAudio can be configured.",NOT_SUPPORTED_HTTP:"http protocol does not support the ability to capture microphone, camera and screen. please use https to deploy your page.",NOT_SUPPORTED_WEBRTC:"your browser or environment does not support full WebRTC capabilities.",NOT_SUPPORTED_PROFILE:"your browser does not support setVideoProfile.",NOT_SUPPORTED_MEDIA:"your browser or environment does not support navigator.mediaDevices.",NOT_SUPPORTED_H264ENCODE:"your device does not support H.264 encoding.",NOT_SUPPORTED_H264DECODE:"your device does not support H.264 decoding.",NOT_SUPPORTED_TRACK:e=>`${e}Track is not supported on your browser.`,NOT_SUPPORTED_SWITCH_DEVICE:"switchDevice is not supported on your browser.",NOT_SUPPORTED_CAPTURE:"Your browser or environment does not support screen sharing, please check whether the browser version.",MICROPHONE_NOT_FOUND:"no microphone detected, please check your microphone.",CAMERA_NOT_FOUND:"no camera detected, please check your camera.",SIGNAL_RESPONSE_FAILED:e=>`${e.signalResponse} failed, response code is ${e.code} , errMsg: ${e.message}.`,CATCH_HANDLER_ERROR:({name:e,event:t})=>`an error was caught in ${e}.on('${t}', handler), please check your code in 'handler'.`,API_NOT_EXIST:({name:e})=>`experimental api ${e} does not exist.`,REPEAT_JOIN:e=>"please avoid repeated join.",CONNECTION_CLOSED:"remoteStream has been unsubscribed or unpublished by remote user.",SUBSCRIBE_ALL_FALSE:"cannot subscribe when both audio & video are false, use client.unsubscribe() instead",CLIENT_DESTROYED:({funName:e})=>`failed to call ${e}() because client was destroyed.`,SEI_NOT_SUPPORT:e=>"not support to sendSEIMessage"+(!1===e?" without using h264 codec":""),SEI_DISABLED:"SEI is disabled",SEI_BEFORE_PUBLISH:"please call sendSEIMessage() after publish() success",SEI_NOT_VIDEO:"cannot send sei when localStream has not video.",CALL_FREQUENCY_LIMIT:({isSize:e,name:t,timesInSecond:n,maxSizeInSecond:i})=>`api ${t} call ${e?"size":"times"} is over ${e?`${i} bytes`:n} in a second.`,CONNECTION_ABORTED:e=>`connection aborted due to: ${e}`,API_CALL_ABORTED(e){let t;return t=e.message.includes("REMOTE_STREAM_NOT_EXIST")?`Subscribe ${e.userId} ${e.streamType} stream aborted, reason: remote user ${e.userId} unpublished stream.`:`API aborted, reason: ${e.message}`,t},DUPLICATE_AUX:"only one auxiliary stream can be published in a room.",NOT_SUPPORTED_AUX:"publish auxiliary stream is not supported on your browser.",INVALID_PARAMETER_STREAMTYPE:e=>`'streamType' is required when 'userId' is not '*', calling ${e}()`},gh={};au(gh,{ANDROID_VERSION:()=>Ch,CHROME_MAJOR_VERSION:()=>Mp,CHROME_VERSION:()=>kp,EDGE_VERSION:()=>Lh,EDG_MAJOR_VERSION:()=>Fh,EDG_VERSION:()=>Vh,FIREFOX_MAJOR_VERSION:()=>Oh,FIREFOX_VERSION:()=>Dh,HUAWEI_VERSION:()=>yp,IE_VERSION:()=>Jh,IOS_MAIN_VERSION:()=>Up,IOS_VERSION:()=>Lp,IPADQQB_VERSION:()=>sp,IS_ANDROID:()=>Rh,IS_ANDROID_WEBVIEW:()=>Pp,IS_ANY_SAFARI:()=>Dp,IS_CHROME:()=>Rp,IS_CHROME_OS:()=>dp,IS_CHROMIUM_BASE:()=>Ip,IS_EDG:()=>Uh,IS_EDGE:()=>Ph,IS_ELECTRON:()=>fp,IS_FIREFOX:()=>Nh,IS_HEADLESS_CHROME:()=>Cp,IS_HUAWEI:()=>vp,IS_HUAWEIBROWSER:()=>_p,IS_IE:()=>Yh,IS_IE8:()=>Xh,IS_IOS:()=>Ih,IS_IOS_13_OR_14:()=>Bp,IS_IOS_15_1:()=>Fp,IS_IPAD:()=>Th,IS_IPADQQB:()=>ap,IS_IPAD_PRO:()=>xh,IS_IPHONE:()=>Ah,IS_IPOD:()=>wh,IS_LINUX:()=>up,IS_LOCAL:()=>Hp,IS_MAC:()=>cp,IS_MACQQB:()=>rp,IS_MIBROWSER:()=>mp,IS_MQQB:()=>ep,IS_NATIVE_ANDROID:()=>kh,IS_OLD_ANDROID:()=>Mh,IS_OPPOBROWSER:()=>Sp,IS_SAFARI:()=>Np,IS_SAFARI_15_1:()=>Vp,IS_SAMSUNGBROWSER:()=>Ep,IS_SOGOU:()=>zh,IS_SOGOUM:()=>Bh,IS_TBS:()=>Gh,IS_UCBROWSER:()=>pp,IS_VIVOBROWSER:()=>xp,IS_WECHAT:()=>Kh,IS_WIN:()=>lp,IS_WQQB:()=>np,IS_WX:()=>hp,IS_X5MQQB:()=>Zh,IS_XWEB:()=>Wh,MACQQB_VERSION:()=>op,MI_VERSION:()=>gp,MQQB_VERSION:()=>tp,OPPO_VERSION:()=>Tp,SAFARI_VERSION:()=>Op,SAMSUNG_VERSION:()=>bp,SOGOUM_VERSION:()=>Hh,SOGOU_VERSION:()=>jh,TBS_VERSION:()=>$h,UA_DATA_STRING:()=>Wp,USER_AGENT:()=>_h,VIVO_VERSION:()=>Ap,WECHAT_VERSION:()=>Qh,WQQB_VERSION:()=>ip,XWEB_VERSION:()=>qh,browserInfo:()=>jp,getBrowserInfo:()=>Gp,getChromeMajorVersion:()=>wp,getDeviceModel:()=>Xp,getOSName:()=>Jp,getOSString:()=>Kp,getOSType:()=>Zp,getTerminalType:()=>Qp,getUserAgentData:()=>qp,isLocalStorageEnabled:()=>zp});var _h="undefined"==typeof navigator?"":navigator.userAgent,vh=e=>new RegExp(e,"i").test(_h),yh=e=>{if(vh(e)){let t=new RegExp(`${e}\\/([\\d.]+)`),n=_h.match(t);if(n&&n[1])return n[1]}return""},Eh=e=>{if(vh(e)){let t=new RegExp(`${e}\\/(\\d+)`),n=_h.match(t);if(n&&n[1])return parseFloat(n[1])}return NaN},bh=/AppleWebKit\/([\d.]+)/i.exec(_h),Sh=bh?parseFloat(bh[1]):NaN,Th=vh("iPad"),xh="undefined"!=typeof navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&vh("Macintosh"),Ah=vh("iPhone")&&!Th,wh=vh("iPod"),Ih=Ah||Th||wh||xh,Rh=vh("Android"),Ch=function(){if(Rh){let e=_h.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(e){let t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);if(t&&n)return parseFloat(`${e[1]}.${e[2]}`);if(t)return t}}return NaN}(),Mh=Rh&&vh("webkit")&&Ch<2.3,kh=Rh&&Ch<5&&Sh<537,Nh=vh("Firefox"),Dh=yh("Firefox"),Oh=Eh("Firefox"),Ph=vh("Edge"),Lh=yh("Edge"),Uh=vh("Edg"),Vh=yh("Edg"),Fh=Eh("Edg"),Bh=vh("SogouMobileBrowser"),Hh=yh("SogouMobileBrowser"),zh=vh("MetaSr\\s"),jh=yh("MetaSr\\s"),Gh=vh("TBS"),$h=yh("TBS"),Wh=vh("XWEB"),qh=yh("XWEB"),Xh=vh("MSIE\\s8\\.0"),Yh=vh("MSIE\\/\\d+"),Jh=function(){if(Yh){let e=/MSIE\s(\d+)\.\d/.exec(_h),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(_h)&&/rv:11.0/.test(_h)&&(t=11),t}return NaN}(),Kh=vh("(micromessenger|webbrowser)"),Qh=yh("MicroMessenger"),Zh=!Gh&&vh("MQQBrowser")&&vh("COVC"),ep=!Gh&&vh("MQQBrowser")&&!vh("COVC"),tp=ep||Zh?yh("MQQBrowser"):"",np=!Gh&&vh(" QQBrowser"),ip=yh(" QQBrowser"),rp=!Gh&&vh("QQBrowserLite"),op=yh("QQBrowserLite"),ap=!Gh&&vh("MQBHD"),sp=yh("MQBHD"),lp=vh("Windows"),cp=!Ih&&vh("MAC OS X"),up=!Rh&&vh("Linux"),dp=vh("CrOS"),hp=vh("MicroMessenger"),pp=vh("UCBrowser"),fp=vh("Electron"),mp=vh("MiuiBrowser"),gp=yh("MiuiBrowser"),_p=vh("HuaweiBrowser"),vp=vh("Huawei"),yp=yh("HuaweiBrowser"),Ep=vh("SamsungBrowser"),bp=yh("SamsungBrowser"),Sp=vh("HeyTapBrowser"),Tp=yh("HeyTapBrowser"),xp=vh("VivoBrowser"),Ap=yh("VivoBrowser"),wp=()=>Eh("Chrome"),Ip=vh("Chrome"),Rp=!Ph&&!zh&&!Bh&&!Gh&&!Wh&&!Uh&&!np&&!mp&&!_p&&!Ep&&!Sp&&!xp&&Ip,Cp=vh("HeadlessChrome"),Mp=wp(),kp=yh("Chrome"),Np=!Ip&&!ep&&!Zh&&!rp&&!ap&&vh("Safari"),Dp=Np||Ih,Op=yh("Version"),Pp=/Android.*(wv|.0.0.0)/.test(_h),Lp=(()=>{if(xh)return Op;if(Ih){let e=_h.match(/OS (\d+)_(\d+)/i);if(e&&e[1]){let t=e[1];return e[2]&&(t+=`.${e[2]}`),t}}return""})(),Up=Number(Lp.split(".")[0]),Vp="15.1"===Op,Fp="15.1"===Lp,Bp=(()=>{let e=Number(Lp.split(".")[0]);return 14===e||13===e})(),Hp="undefined"!=typeof location&&("file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname),zp=(()=>{let e;return()=>{if(Ff(e))try{e=!!window.localStorage}catch(t){e=!1}return e}})(),jp=Gp();function Gp(){let e=new Map([[Nh,["Firefox",Dh]],[Uh,["Edg",Vh]],[Rp,["Chrome",kp]],[Np,["Safari",Op]],[Gh,["TBS",$h]],[Wh,["XWEB",qh]],[Kh&&Ah,["WeChat",Qh]],[np,["QQ(Win)",ip]],[ep,["QQ(Mobile)",tp]],[Zh,["QQ(Mobile X5)",tp]],[rp,["QQ(Mac)",op]],[ap,["QQ(iPad)",sp]],[mp,["MI",gp]],[_p,["HW",yp]],[Ep,["Samsung",bp]],[Sp,["OPPO",Tp]],[xp,["VIVO",Ap]],[Ph,["EDGE",Lh]],[Bh,["SogouMobile",Hh]],[zh,["Sogou",jh]]]),t="unknown",n="unknown";return e.has(!0)&&([t,n]=e.get(!0)),{name:t,version:n}}var $p=null,Wp="";function qp(){return du(this,null,(function*(){if($p)return $p;if(!navigator.userAgentData||!Vf(navigator.userAgentData.getHighEntropyValues))return null;try{return($p=yield navigator.userAgentData.getHighEntropyValues(["architecture","bitness","model","platformVersion","fullVersionList"]))&&!Wp&&(Wp=`UAData: ${$p.platform}/${$p.platformVersion}`,$p.architecture&&$p.bitness&&(Wp+=` ${$p.architecture}/${$p.bitness}`),$p.mobile&&(Wp+=" mobile"),$p.model&&(Wp+=` model: ${$p.model}`),$p.fullVersionList&&(Wp+=` ${$p.fullVersionList.filter((e=>"Not/A)Brand"!==e.brand)).map((e=>`${e.brand}/${e.version}`)).join(",")}`)),$p}catch(e){return null}}))}function Xp(){return(null==$p?void 0:$p.model)||""}var Yp=new Map([[Rh,"Android"],[Ih,"iOS"],[lp,"Windows"],[cp,"MacOS"],[up,"Linux"],[dp,"ChromeOS"]]),Jp=function(){return Yp.get(!0)?Yp.get(!0):$p?$p.platform:"unknown"},Kp=()=>{let e=Jp();return e+=`/${jp.name}/${Np?jp.version:jp.version.split(".")[0]}`,null!=$p&&$p.platformVersion&&(e+=`/${$p.platformVersion}`),null!=$p&&$p.architecture&&(e+=`/${$p.architecture}`),e};function Qp(){return Rh?4:Ah?2:Th?3:cp?12:lp?5:up?13:1}function Zp(){return Rh?"Android":Ah?"iPhone":Th?"iPad":cp?"Mac":lp?"Windows":up?"Linux":"unknown"}var ef=(e,t)=>t?`${Wu}/${e}/${t}`:`${Wu}/${e}/index.html`,tf=()=>{if(window.TRTC_ERROR_INFO&&window.TRTC_ERROR_LINK)return{TRTC_ERROR_INFO:window.TRTC_ERROR_INFO,TRTC_ERROR_LINK:window.TRTC_ERROR_LINK};let e=null==localStorage?void 0:localStorage.getItem(Ju);if(e){e=JSON.parse(e);let t=document.createElement("script");t.type="text/javascript",t.text=e.message,document.body.appendChild(t);let n=window.TRTC_ERROR_INFO,i=window.TRTC_ERROR_LINK;return document.body.removeChild(t),{TRTC_ERROR_INFO:n,TRTC_ERROR_LINK:i}}return{}};function nf(e){let{key:t,data:n,link:i,addDocLink:r=!0}=e,o="",a="",s="";Vf(mh[t])?o=mh[t](n):Bf(mh[t])&&(o=mh[t]);let{TRTC_ERROR_INFO:l,TRTC_ERROR_LINK:c}=tf();i?s=`${i.className}.html#${i.fnName}`:c&&c[t]&&(Vf(c[t])?s=c[t](n):Bf(c[t])&&(s=c[t]));let u=o;return Df()&&(l&&l[t]&&(Vf(l[t])?a=l[t](n):Bf(l[t])&&(a=l[t])),a&&(u=r?`${a}\n: ${ef("zh-cn",s)}\n\n`:`${a}\n\n`,u+=o)),r&&(u+=` \nRefer to: ${ef("en",s)}\n`),u}var rf,of=function({retryFunction:e,settings:t,onError:n,onRetrying:i,onRetryFailed:r,onRetrySuccess:o,context:a}){return function(...s){let{retries:l=5,timeout:c=1e3}=t,u=0,d=-1,h=0,p=(t,f)=>du(this,null,(function*(){let m=a||this;try{let n=yield e.apply(m,s);u>0&&o&&o.call(this,u),u=0,t(n)}catch(e){let o=()=>{clearTimeout(d),u=0,h=2,f(e)},a=()=>{2!==h&&u<(Vf(l)?l():l)?(u++,h=1,Vf(i)&&i.call(this,u,o),d=window.setTimeout((()=>{d=-1,p(t,f)}),Vf(c)?c(u):c)):(o(),Vf(r)&&r.call(this,e))};Vf(n)?n.call(this,{error:e,retry:a,reject:f,retryFuncArgs:s,retriedCount:u}):a()}}));return new Promise(p)}},af=new(su(hu(),1).default),sf=((rf=sf||{}).ROOM_DESTROY="1",rf.JOIN_START="21",rf.JOIN_SCHEDULE_SUCCESS="22",rf.JOIN_SIGNAL_CONNECTION_START="23",rf.JOIN_SIGNAL_CONNECTION_END="24",rf.JOIN_SEND_CMD="25",rf.JOIN_RECEIVED_CMD_RES="26",rf.JOIN_SUCCESS="27",rf.JOIN_FAILED="28",rf.LEAVE_START="51",rf.LEAVE_SEND_CMD="52",rf.LEAVE_SUCCESS="53",rf.PUBLISH_START="61",rf.SEND_FIRST_VIDEO_FRAME="62",rf.PUBLISH_FAILED="63",rf.SUBSCRIBE_START="81",rf.SUBSCRIBE_SUCCESS="82",rf.SUBSCRIBE_FAILED="84",rf.UNSUBSCRIBE_SUCCESS="83",rf.LOCAL_TRACK_CAPTURE_START="101",rf.LOCAL_TRACK_CAPTURE_SUCCESS="102",rf.LOCAL_TRACK_CAPTURE_FAILED="103",rf.LOCAL_TRACK_PUBLISHED="104",rf.LOCAL_TRACK_UNPUBLISHED="105",rf.LOCAL_TRACK_REPLACED="106",rf.SWITCH_DEVICE_SUCCESS="107",rf.TRACK_MUTED="108",rf.TRACK_UNMUTED="109",rf.REMOTE_TRACK_SUBSCRIBED="110",rf.REMOTE_TRACK_UNSUBSCRIBED="111",rf.LOCAL_TRACK_RECAPTURE="112",rf.PLAY_TRACK_START="151",rf.PLAYER_STATE_CHANGED="152",rf.VIDEO_LOADED_DATA="153",rf.AUTOPLAY_DIALOG_CLICK_CONFIRM="154",rf.SIGNAL_CONNECTION_STATE_CHANGED="201",rf.PEER_CONNECTION_STATE_CHANGED="202",rf.SINGLE_CONNECTION_STAT="203",rf.SPC_RECONNECTED="204",rf.HEARTBEAT_REPORT="251",rf.RECEIVED_PUBLISHED_USER_LIST="252",rf.REMOTE_PUBLISH_STATE_CHANGED="253",rf.AUDIO_LEVEL_INTERVAL="260",rf.NETWORK_QUALITY="261",rf.VIDEO_CODEC_IMPLEMENTATION_CHANGED="262",rf.QUALITY_LIMITATION_CHANGED="263",rf.LOG="264",rf),lf=new class{constructor(){this._roomIdMap=new Map,"undefined"==typeof registerProcessor&&(this._configs={sdkAppId:"",userId:"",version:Nu,env:Qu.QCLOUD,browserVersion:jp.name+jp.version,ua:navigator.userAgent})}setConfig({sdkAppId:e,env:t,userId:n,roomId:i}){e!==this._configs.sdkAppId&&(this._configs.sdkAppId=String(e)),this._configs.env=t,this._configs.userId=n,this._roomIdMap.set(n,String(i))}logSuccessEvent(e){Hp||!wm.isAbleToUpload||this._configs.env===Qu.QCLOUD&&this.uploadEventToKibana(ru(iu({},e),{result:"success"}))}logFailedEvent(e){if(Hp||!wm.isAbleToUpload)return;let{eventType:t,code:n,error:i,userId:r}=e,o={roomId:this._roomIdMap.get(r||this._configs.userId),userId:r,eventType:t,result:"failed",code:n||(null==i?void 0:i.extraCode)||(null==i?void 0:i.code)||Tu.UNKNOWN};this._configs.env===Qu.QCLOUD&&this.uploadEventToKibana(ru(iu({},o),{error:i}))}uploadEventToKibana(e){let t=`stat-${e.eventType}-${e.result}`;("delta-join"===e.eventType||"delta-leave"===e.eventType||"delta-publish"===e.eventType)&&(t=`${e.eventType}:${e.delta}`),this.uploadEvent({log:t,userId:e.userId}),"failed"===e.result&&(t=`stat-${e.eventType}-${e.result}-${e.code}`,this.uploadEvent({log:t,userId:e.userId,error:e.error}))}uploadEvent({log:e,userId:t,error:n}){let i={timestamp:Ru(),sdkAppId:this._configs.sdkAppId,userId:t||this._configs.userId,version:Nu,log:e};n&&(i.errorInfo=n.message,n.stack&&(i.errorInfo+=`\n${n.stack}`)),this.sendRequest(bf(this._configs.sdkAppId,Ku.LOG),i)}sendRequest(e,t){wm.isAbleToUpload?dh({url:e,body:JSON.stringify(t)}).catch((()=>{})):setTimeout((()=>{this.sendRequest(e,t)}),1e3)}},cf=null,uf=!0;function df(e){zf(e)&&e!==uf&&(uf=e,wm.info(`setIsNeedToSchedule ${e}`))}document&&document.head.insertAdjacentHTML("beforeend",Object.values(Yd).map((e=>`<link rel="dns-prefetch" href="https://${e}">`)).join("\r\n")),af.on("28",(()=>df(!0))),af.on("63",(()=>df(!0))),af.on("84",(()=>df(!0))),af.on("201",(e=>{"RECONNECTING"===e.state&&df(!0)})),af.on("202",(e=>{"RECONNECTING"===e.state&&df(!0)}));var hf={main:"",backup:""};function pf(e){Gf(e)?(hf.main=e[0],hf.backup=e[1]):hf.main=e}function ff(e,t=ld.MAIN,n=!1){return`https://${hf[t]||gf(e,t,n)}/api/v1/config`}function mf(e,t=ld.MAIN){return`https://${hf[t]||gf(e,t)}/api/v1/trtcAutoConf`}function gf(e,t=ld.MAIN,n=!1){if(Ef(e))return t===ld.MAIN?Yd.MAIN_OVERSEA:Yd.BACKUP_OVERSEA;let i;return i=Ef(e)?n?t===ld.MAIN?Yd.MAIN_OVERSEA_OLD:Yd.BACKUP_OVERSEA_OLD:t===ld.MAIN?Yd.MAIN_OVERSEA:Yd.BACKUP_OVERSEA:t===ld.MAIN?Yd.MAIN:Yd.BACKUP,i}function _f(e,t,n){return new Promise(((i,r)=>{dh({url:e,body:t,timeout:n.timeout}).then((e=>{0===e.data.code?i(e.data.data):r({code:e.data.code,message:e.data.msg})})).catch(r)}))}var vf=(e,t)=>of({retryFunction:_f,settings:{retries:3,timeout:0},onError:t,onRetrying:e}),yf=function(){return new URLSearchParams(location.search).get("trtc_env")||""},Ef=e=>Number(e)<14e8,bf=function(e,t){let n;return n=Bu||(Ef(e)?Yu:Xu),`${n}/v5/AVQualityReportSvc/C2S?random=${Math.floor(Math.random()*tu(2,31))}&sdkappid=${e}&cmdtype=${t}`},Sf="unknown";function Tf(){if("unknown"!==Sf)return Sf;let{userAgent:e,connection:t}=navigator,n=(e.match(/NetType\/\S+/)||[])[0]||"";n=n.toLowerCase().replace("nettype/",""),"3gnet"===n&&(n="3g");let i=t&&t.type&&t.type.toLowerCase(),r=t&&t.effectiveType&&t.effectiveType.toLowerCase();return"slow-2"===r&&(r="2g"),i&&(Sf=xf(i,r)),Sf}function xf(e,t){if(nd[e])return e;switch(e){case"cellular":case"wimax":return t||"unknown";case"ethernet":return"wired";default:return"unknown"}}function Af(e){Sf=xf(e)}function wf(){return nd[Tf()]}function If(e,t){for(let n of Reflect.ownKeys(t))if("constructor"!==n&&"prototype"!==n&&"name"!==n){let i=Object.getOwnPropertyDescriptor(t,n)||"";Object.defineProperty(e,n,i)}return e}function Rf(e,t=48e3){return Cf(e/4,t)}function Cf(e,t=48e3){return 1e3*e/t}function Mf(e,t=48e3){return 4*kf(e,t)}function kf(e,t=48e3){return e*t/1e3}var Nf="undefined"!=typeof window&&"function"==typeof window.glog?window.glog:()=>{},Df=()=>{let e=navigator.language;return e=e.substring(0,2),"zh"===e},Of=function(e){if(!e||"object"!=typeof e||"[object Object]"!=Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);if(null===t)return!0;let n=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)};function Pf(e,t=1,n=1){return e<=1?n:Pf(e-1,n,t+n)}function Lf(e){return e>8?3e4:1e3*Pf(e)}function Uf(e){return Reflect.apply(Object.prototype.toString,e,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}var Vf=e=>"function"==typeof e,Ff=e=>void 0===e,Bf=e=>"string"==typeof e,Hf=e=>"number"==typeof e,zf=e=>"boolean"==typeof e,jf=e=>"object"===Uf(e),Gf=e=>"array"===Uf(e),$f=e=>Uf(e)==="MediaStreamTrack".toLowerCase(),Wf=e=>e.isRemote,qf=e=>"promise"===Uf(e),Xf=e=>Vf(e)&&e.prototype.constructor===e,Yf=e=>Xf(e)?e.prototype.constructor.name:"",Jf="undefined"!=typeof AudioWorkletNode;function Kf(e){return new Promise(((t,n)=>{let i=[];e.forEach((r=>{r.then(t).catch((t=>{i.push(t),i.length===e.length&&n(i)}))}))}))}function Qf(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}var Zf=e=>+e<10?`0${e}`:e,em=e=>{let t=e.match(/^\d+\.\d+\.\d+/)[0];if(!t)return e;let n=t.split("."),i=Zf(n[1])+Zf(n[2]);return n[1]-15>0&&(n[1]="15"),n[2]-15>0&&(n[2]="15"),`${n.join(".")}.${i}`},tm=Object.prototype.hasOwnProperty,{toString:nm}=Object.prototype;function im(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e||"function"==typeof e||Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(Of(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(let t in e)if(tm.call(e,t))return!1;return!0}return!1}function rm(e,t){return{userId:t,hasAudio:!!(e&md),hasVideo:!!(e&hd),hasAuxiliary:!!(e&fd),hasSmall:!!(e&pd),audioMuted:!!(e&gd),videoMuted:!!(e&_d),audioAvailable:!(!(e&md)||e&gd),videoAvailable:!(!(e&hd)||e&_d)}}function om(e){let t={urls:`turn:${e.url}`};return!Ff(e.username)&&!Ff(e.credential)&&(t.username=e.username,t.credential=e.credential,t.credentialType="password",Ff(e.credentialType)||(t.credentialType=e.credentialType)),t}function am(e,t=!0){if(!Bf(e))return 0;let n=e.split(".");return t?(Number(n[0])<<24|Number(n[1])<<16|Number(n[2])<<8|Number(n[3]))>>>0:(Number(n[3])<<24|Number(n[2])<<16|Number(n[1])<<8|Number(n[0]))>>>0}var sm=function(e,t,n,i){if(!jf(e)||!jf(t))return 0;let r,o=0,a=Object.keys(t);for(let s=0,l=a.length;s<l;s++)if(r=a[s],!(Ff(t[r])||n&&n.includes(r)))if(jf(e[r])&&jf(t[r]))o+=sm(e[r],t[r],n,i);else{if(i&&i.includes(t[r]))continue;e[r]!==t[r]&&(e[r]=lm(t[r]),o+=1)}return o};function lm(e){if(Gf(e)){let t=[];return e.forEach(((e,n)=>{t[n]=lm(e)})),t}if(jf(e)){let t={};return Object.keys(e).forEach((n=>{t[n]=lm(e[n])})),t}return e}var cm=e=>{let t=[];if(Gf(e))t=[...e];else if(Bf(e)){let n=document.getElementById(e);n&&t.push(n)}else e&&t.push(e);return t},um=e=>Bf(e)?document.getElementById(e):e,dm=new Intl.DateTimeFormat("zh-CN",{dateStyle:"short",timeStyle:"medium"}),hm=()=>dm.format(new Date);function pm(e,{keysToInclude:t,keysToExclude:n}){try{if(Gf(e))return`[${e.map((e=>pm(e,{keysToInclude:t,keysToExclude:n}))).join(",")}]`;if(!Of(e)||!Gf(t)&&!Gf(n))return JSON.stringify(e);let i={},r=new Set(t),o=new Set(n);return Object.keys(e).forEach((a=>{(0===o.size&&r.has(a)||0===r.size&&!o.has(a))&&(i[a]=Of(e[a])||Gf(e[a])?JSON.parse(pm(e[a],{keysToExclude:n,keysToInclude:t})):e[a])})),JSON.stringify(i)}catch(e){return"{}"}}function fm(e,t=!1){let n=[];return Object.keys(e).forEach((i=>{t===e[i]&&n.push(i)})),pm(e,{keysToInclude:n})}function mm(e){return e.replace(/[\u4e00-\u9fa5]/g,"aa").length}var gm=()=>{var e,t,n,i;return null!=(e=window.screen)&&e.orientation?!(null==(i=null==(n=null==(t=window.screen)?void 0:t.orientation)?void 0:n.type)||!i.includes("portrait")):0===window.orientation||180===window.orientation},_m=e=>du(void 0,null,(function*(){return new Promise(((t,n)=>{let i;if(Bf(e))i=new Image,i.crossOrigin="anonymous",i.src=e;else if(i=e,i.complete)return void t(i);i.onload=()=>t(i),i.onerror=n}))})),vm=e=>{let t=e.split(".");return+t[0]<<24|+t[1]<<16|+t[2]<<8|+t[3]<<0},ym=e=>(Object.keys(e).forEach((t=>{Hf(e[t])&&(t.startsWith("uint")||t.startsWith("int"))?e[t]=Math.floor(e[t]):(Of(e[t])||Gf(e[t]))&&ym(e[t])})),e);function Em(e){return new Promise((t=>setTimeout(t,e)))}var bm=(e,t)=>{let n=null;return function(...i){return n||(n=e.apply(t||this,i),n.finally((()=>n=null)),n)}},Sm=Object.prototype.hasOwnProperty,Tm=e=>void 0===e;var xm=sf,Am=!(Ih||Rh||Cp),wm=new class{constructor(){cu(this,"_isEnableUploadLog",!0),cu(this,"_localJoinedUser",new Map),cu(this,"_queue",[]),cu(this,"_timeoutId",-1),cu(this,"_logLevel",1),cu(this,"_logLevelToUpload",2),!Uu&&!Vu&&(this.checkURLParam(),this.installEvents())}get isAbleToUpload(){return this._isEnableUploadLog&&-1!==this._timeoutId}installEvents(){af.on(xm.JOIN_SCHEDULE_SUCCESS,(({schedule:e})=>{var t;(null==(t=null==e?void 0:e.config)?void 0:t.logLevelToUpload)&&Zu[e.config.logLevelToUpload]&&(this._logLevelToUpload=e.config.logLevelToUpload)})),af.on(xm.JOIN_SUCCESS,(({room:e})=>{this.addJoinedUser({userId:e.userId,sdkAppId:e.sdkAppId}),this.startUpload()})),af.once(xm.JOIN_FAILED,(()=>{this.startUpload()})),af.on(xm.LEAVE_SUCCESS,(({room:e})=>{this.deleteJoinedUser(e.userId)}))}startUpload(){-1===this._timeoutId&&this.uploadInterval()}addJoinedUser(e){this._localJoinedUser.set(e.userId,e),this.startUpload()}deleteJoinedUser(e){this._localJoinedUser.delete(e)}uploadInterval(){this.upload().catch((()=>{})),this._timeoutId=window.setTimeout((()=>this.uploadInterval()),2e3)}getLogsToUpload(){let e={map:new Map,splicedQueue:[]};if(this._queue[0].forAllJoinedClients&&0===this._localJoinedUser.size)return e;let t=0;for(;t<this._queue.length&&50!==t;t++){let n=this._queue[t];if(n.forAllJoinedClients)this._localJoinedUser.forEach((({userId:t,sdkAppId:i})=>{e.map.has(t)?e.map.get(t).logs.push(n):e.map.set(t,{userId:t,sdkAppId:i,logs:[n]})}));else if(Bf(n.userId)&&Hf(n.sdkAppId)){let{userId:t,sdkAppId:i}=n;e.map.has(t)?e.map.get(t).logs.push(n):e.map.set(t,{userId:t,sdkAppId:i,logs:[n]})}}return e.map.size>0&&(e.splicedQueue=this._queue.splice(0,t)),e}upload(){return du(this,null,(function*(){if(0===this._queue.length||!this._isEnableUploadLog)return;let{map:e,splicedQueue:t}=this.getLogsToUpload();if(0===e.size)return;try{let t=[...e.values()];for(let e=0;e<t.length;e++){let{userId:n,sdkAppId:i,logs:r}=t[e];yield this.uploadLogWithRetry(JSON.stringify({timestamp:Ru(),sdkAppId:String(i),userId:n,version:Nu,log:r.map((e=>e.log)).join("\n")}),i),r.forEach((e=>e.uploaded=!0))}}catch(e){}let n=t.filter((e=>!e.uploaded));n.length>0&&(this._queue=n.concat(this._queue))}))}uploadLogWithRetry(e,t){return of({retryFunction:()=>dh({url:bf(t,Ku.LOG),body:e,timeout:5e3}),settings:{retries:3,timeout:1e3},onError:({retry:e})=>{e()}})()}getPrefix(e){let t=new Date;t.setTime(Iu());let n=String(t.getMilliseconds());return"padStart"in String.prototype&&(n=n.toString().padStart(3,"0")),`[${t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")}:${n}] <${Zu[e]}>`}getLogLevel(){return this._logLevel}setLogLevel(e){Ff(Zu[e])||(this._logLevel!==e&&this.info("setLogLevel",e),this._logLevel=e)}enableUploadLog(){this._isEnableUploadLog=!0}disableUploadLog(){this.warn("disableUploadLog"),this._isEnableUploadLog=!1}logChunkToString(e){if(Bf(e))return e;try{return e instanceof Error?e.toString():JSON.stringify(e)}catch(e){return""}}log(e,t,n=!0,i,r){var o;t.unshift(this.getPrefix(e));let a={log:t.reduce(((e,t)=>`${e} ${this.logChunkToString(t)}`.trim()),""),level:e,userId:i,sdkAppId:r,forAllJoinedClients:n};if(af.emit(xm.LOG,{log:a}),this._isEnableUploadLog&&e>=this._logLevelToUpload&&this._queue.push(a),e<this._logLevel)return;let s=(null==(o=Zu[e])?void 0:o.toLowerCase())||"info";Am?console[s]("%cTRTC%c%s","padding: 1px 4px;border-radius: 3px;color: #fff;background: #1E88E5;","display: inline",...t):console[s](...t)}debug(...e){this.log(1,e)}info(...e){this.log(2,e)}warn(...e){this.log(3,e)}error(...e){this.log(4,e)}createLogger(e){return new class{constructor(e){cu(this,"userId"),cu(this,"remoteUserId"),cu(this,"id"),cu(this,"sdkAppId"),cu(this,"type"),cu(this,"isLocal"),this.id=e.id,this.userId=e.userId,this.sdkAppId=e.sdkAppId,this.remoteUserId=e.remoteUserId,this.isLocal="boolean"!=typeof e.isLocal||e.isLocal,this.type=this.isLocal?"":e.type}createChild(e){return Object.setPrototypeOf(e,this)}setUserId(e){this.userId=e}setSdkAppId(e){this.sdkAppId=e}log(e,t){let n=this.isLocal?this.userId:this.remoteUserId;t.unshift(`[${this.isLocal?"":""}${this.type&&"main"!==this.type?"*":""}${this.id}${n?`|${n}`:""}]`),wm.log(e,t,Tm(this.userId)||function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e||"function"==typeof e||Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(function(e){if(!e||"object"!=typeof e||"[object Object]"!=Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);if(null===t)return!0;let n=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)}(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(let t in e)if(Sm.call(e,t))return!1;return!0}return!1}(this.userId),this.userId,this.sdkAppId)}info(...e){this.log(2,e)}debug(...e){this.log(1,e)}warn(...e){this.log(3,e)}error(...e){this.log(4,e)}}(e)}checkURLParam(){let e=new URLSearchParams(location.search).get("logLevelToUpload"),t=e?Number(e):-1;Zu[t]&&(this._logLevelToUpload=t)}getQueue(){return this._queue}},Im=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},Rm=new class{constructor(){cu(this,"_prefix","TRTC"),cu(this,"_queue",new Map),this.checkStorage()}getRealKey(e){return`${this._prefix}_${e}`}checkStorage(){zp()&&(setInterval(this.doFlush.bind(this),2e4),Object.keys(localStorage).filter((e=>{if(e.startsWith(this._prefix)){let t=localStorage.getItem(e);if(!t)return!1;let n=JSON.parse(t);if(n&&n.expiresIn<Date.now())return!0}return!1})).forEach((e=>localStorage.removeItem(e))))}doFlush(){if(zp())try{for(let[e,t]of this._queue)localStorage.setItem(e,JSON.stringify(t))}catch(e){wm.warn(e)}}getItem(e){if(!zp())return null;try{let t=localStorage.getItem(this.getRealKey(e));if(!t)return null;let n=JSON.parse(t);return n&&n.expiresIn>=Date.now()?n.value:null}catch(e){wm.warn(e)}}setItem(e,t){if(zp())try{let n={expiresIn:Date.now()+id,value:t};this._queue.set(this.getRealKey(e),n)}catch(e){wm.warn(e)}}deleteItem(e){if(!zp())return!1;try{return e=this.getRealKey(e),this._queue.delete(e),localStorage.removeItem(e),!0}catch(e){return wm.warn(e),!1}}clear(){if(zp())try{localStorage.clear()}catch(e){wm.warn(e)}}},Cm={};au(Cm,{HTTPS_API:()=>Wm,IS_GET_CAPABILITIES_SUPPORTED:()=>cg,IS_GET_SETTINGS_SUPPORTED:()=>lg,IS_SEI_SUPPORTED:()=>ug,IS_SPC_SUPPORTED:()=>rg,basis:()=>mg,checkSystemRequirementsInternal:()=>zm,decodeSupportStatus:()=>Hm,encodeSupportStatus:()=>Bm,getBrowserInfo:()=>Dm,getDisplayResolution:()=>Xm,isAddTransceiverSupported:()=>ig,isBrowserSupported:()=>Om,isGetReceiversSupported:()=>eg,isGetSendersSupported:()=>tg,isGetTransceiversSupported:()=>ng,isGetUserMediaSupported:()=>Ym,isMediaDevicesSupported:()=>Lm,isMediaSessionSupported:()=>pg,isMediaStreamTrackProcessorSupported:()=>Fm,isReplaceTrackSupported:()=>ag,isScreenCaptureApiAvailable:()=>Gm,isSelectedCandidatePair:()=>qm,isSetParametersSupported:()=>sg,isSmallStreamAPISupported:()=>Km,isSmallStreamSupported:()=>Qm,isStopTransceiverSupported:()=>og,isTRTCSupported:()=>jm,isUnifiedPlanDefault:()=>Zm,isUsedInHttpProtocol:()=>Vm,isWebAudioSupported:()=>Jm,isWebCodecSupported:()=>hg,isWebCodecsSupported:()=>Pm,isWebRTCSupported:()=>dg,isWebTransportSupported:()=>fg});var Mm=su(gu(),1),km={result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isWebCodecsSupported:!1,isMediaDevicesSupported:!1,isScreenShareSupported:!1,isSmallStreamSupported:!1,isH264EncodeSupported:!1,isVp8EncodeSupported:!1,isH264DecodeSupported:!1,isVp8DecodeSupported:!1}},Nm=new Map([[Nh,["Firefox",Dh]],[Uh,["Edg",Vh]],[Rp,["Chrome",kp]],[Np,["Safari",Op]],[Gh,["TBS",$h]],[Wh,["XWEB",qh]],[Kh&&Ah,["WeChat",Qh]],[np,["QQ(Win)",ip]],[ep,["QQ(Mobile)",tp]],[Zh,["QQ(Mobile X5)",tp]],[rp,["QQ(Mac)",op]],[ap,["QQ(iPad)",sp]],[mp,["MI",gp]],[_p,["HW",yp]],[Ep,["Samsung",bp]],[Sp,["OPPO",Tp]],[xp,["VIVO",Ap]],[Ph,["EDGE",Lh]],[Bh,["SogouMobile",Hh]],[zh,["Sogou",jh]]]);function Dm(){let e=Nm.get(!0);return{browserName:e?e[0]:"unknown",browserVersion:e?e[1]:"unknown"}}var Om=function(){return!(pp||Ph||Uh&&Fh<80||Nh&&Oh<56)},Pm=function(){return["VideoDecoder","VideoEncoder","AudioEncoder","AudioDecoder","MediaStreamTrackGenerator"].every((e=>e in window))},Lm=function(){if(!navigator.mediaDevices)return Vm()||wm.error(mh.NOT_SUPPORTED_MEDIA),!1;let e=["getUserMedia","enumerateDevices"];return e.filter((e=>e in navigator.mediaDevices)).length===e.length},Um=!1;function Vm(){return"http:"===location.protocol&&!Hp&&(Um||wm.error(nf({key:fh.NOT_SUPPORTED_HTTP})),Um=!0,!0)}var Fm=function(){return(null==window?void 0:window.OffscreenCanvas)&&(null==window?void 0:window.MediaStreamTrackProcessor)&&(null==window?void 0:window.MediaStreamTrackGenerator)},Bm=function(){return du(this,null,(function*(){if(km.detail.isH264EncodeSupported&&km.detail.isVp8EncodeSupported)return{isH264EncodeSupported:km.detail.isH264EncodeSupported,isVp8EncodeSupported:km.detail.isVp8EncodeSupported};let e,t=!1,n=!1;try{let i=new RTCPeerConnection,r=document.createElement(ld.CANVAS);r.getContext("2d");let o=r.captureStream(0);return i.addTrack(o.getVideoTracks()[0],o),e=yield i.createOffer(),-1!==e.sdp.toLowerCase().indexOf("h264")&&(t=!0),-1!==e.sdp.toLowerCase().indexOf("vp8")&&(n=!0),i.close(),km.detail.isH264EncodeSupported=t,km.detail.isVp8EncodeSupported=n,{isH264EncodeSupported:km.detail.isH264EncodeSupported,isVp8EncodeSupported:km.detail.isVp8EncodeSupported}}catch(e){return{isH264EncodeSupported:!1,isVp8EncodeSupported:!1}}}))},Hm=function(){return du(this,null,(function*(){if(km.detail.isH264DecodeSupported&&km.detail.isVp8DecodeSupported)return{isH264DecodeSupported:km.detail.isH264DecodeSupported,isVp8DecodeSupported:km.detail.isVp8DecodeSupported};let e,t=!1,n=!1;try{let i=new RTCPeerConnection;return e=yield i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}),-1!==e.sdp.toLowerCase().indexOf("h264")&&(t=!0),-1!==e.sdp.toLowerCase().indexOf("vp8")&&(n=!0),i.close(),{isH264DecodeSupported:t,isVp8DecodeSupported:n}}catch(e){return{isH264DecodeSupported:!1,isVp8DecodeSupported:!1}}}))},zm=bm((()=>du(void 0,null,(function*(){if(km.result&&km.detail.isH264EncodeSupported&&km.detail.isVp8EncodeSupported&&km.detail.isH264DecodeSupported&&km.detail.isVp8DecodeSupported)return km;let e=Om(),t=dg(),n=Pm(),i=Lm(),{isH264EncodeSupported:r,isVp8EncodeSupported:o}=yield Bm(),{isH264DecodeSupported:a,isVp8DecodeSupported:s}=yield Hm();if(!r||!o){let e=yield Bm();wm.warn(`detect encode again h264:${r} vp8:${o} result: ${JSON.stringify(e)}`),r=e.isH264EncodeSupported,o=e.isVp8EncodeSupported}if(r&&a&&Rh&&Ip&&!Wh&&!Gh){let{encode:e,decode:t}=yield function(){return du(this,null,(function*(){return $m||($m=new Promise((e=>du(this,null,(function*(){let t={encode:!1,decode:!1},n=()=>{};try{wm.warn("detectH264Supported start");let i=document.createElement("canvas"),r=i.getContext("2d");i.width=320,i.height=240;let o=setInterval((()=>{r.fillText("test",Math.floor(320*Math.random()),Math.floor(240*Math.random()))}),66),a=-1,s=-1;n=()=>{clearInterval(a),clearInterval(o),clearTimeout(s),c.close(),u.close(),l.getTracks().forEach((e=>e.stop()))},s=setTimeout((()=>{n(),e(t)}),2e3);let l=i.captureStream(),c=new RTCPeerConnection({}),u=new RTCPeerConnection({offerToReceiveAudio:!0,offerToReceiveVideo:!0});c.addEventListener("icecandidate",(e=>u.addIceCandidate(e.candidate))),u.addEventListener("icecandidate",(e=>c.addIceCandidate(e.candidate))),c.addTrack(l.getVideoTracks()[0],l);let d=yield c.createOffer();yield c.setLocalDescription(d),yield u.setRemoteDescription(d);let h=yield u.createAnswer(),p=Mm.default.parse(h.sdp),f=p.media[0].rtp.findIndex((e=>"H264"===e.codec));p.media[0].rtp=[p.media[0].rtp[f]],p.media[0].fmtp=p.media[0].fmtp.filter((e=>e.payload===p.media[0].rtp[0].payload)),p.media[0].rtcpFb&&(p.media[0].rtcpFb=p.media[0].rtcpFb.filter((e=>e.payload===p.media[0].rtp[0].payload))),h.sdp=Mm.default.write(p),yield u.setLocalDescription(h),yield c.setRemoteDescription(h),a=setInterval((()=>du(this,null,(function*(){t.encode&&t.decode&&(n(),e(t));let i=yield c.getSenders()[0].getStats(),r=yield u.getReceivers()[0].getStats();t.encode||i.forEach((e=>{"outbound-rtp"===e.type&&e.mediaType===ld.VIDEO&&e.bytesSent>0&&(t.encode=!0)})),t.decode||r.forEach((e=>{"inbound-rtp"===e.type&&e.mediaType===ld.VIDEO&&e.bytesReceived>0&&(t.decode=!0)}))}))),100)}catch(i){n(),wm.warn(i),e(t)}})))).then((e=>((!e.encode||!e.decode)&&wm.warn(`detectH264Supported encode: ${e.encode} decode: ${e.decode} ${Wp}`),e))),$m)}))}();r=e,e&&(a=t)}return km.result=e&&t&&i&&(r||o)&&(a||s),km.detail.isBrowserSupported=e,km.detail.isWebRTCSupported=t,km.detail.isWebCodecsSupported=n,km.detail.isMediaDevicesSupported=i,km.detail.isScreenShareSupported=Gm(),km.detail.isSmallStreamSupported=Qm(),km.detail.isH264EncodeSupported=r,km.detail.isVp8EncodeSupported=o,km.detail.isH264DecodeSupported=a,km.detail.isVp8DecodeSupported=s,km.result||wm.error(`${navigator.userAgent} ${fm(km.detail,!1)}`),Rm.setItem(gg,{ua:navigator.userAgent,checkResult:km}),km})))),jm=function(){return km.result},Gm=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},$m=null,Wm=(e,t,n)=>{"http:"===location.protocol&&!Hp&&(e[t]=()=>{throw new Au({code:Tu.INVALID_OPERATION,message:mh.NOT_SUPPORTED_HTTP})})},qm=function(e){return!("candidate-pair"!==e.type||!e.nominated||"in-progress"!==e.state&&"succeeded"!==e.state||zf(e.selected)&&!e.selected)};function Xm(){let e="";return screen.width&&(e+=`${screen.width?screen.width*window.devicePixelRatio:""} * ${screen.height?screen.height*window.devicePixelRatio:""}`),e}function Ym(){return navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function Jm(){let e={isSupported:!1},t=["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"];for(let n=0;n<t.length;n++)if(t[n]in window){e.isSupported=!0;break}return e.isSupported}function Km(){return"captureStream"in HTMLCanvasElement.prototype}function Qm(){return!(Kh||Ih||Mp&&Mp<63||!Om()||!Km())}var Zm=function(){if(Ff(window.RTCRtpTransceiver)||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=null,t=!1;try{e=new RTCPeerConnection({sdpSemantics:Bd}),e.addTransceiver(ld.AUDIO),t=!0}catch(e){}return null==e||e.close(),t};function eg(){return"RTCPeerConnection"in window&&"getReceivers"in window.RTCPeerConnection.prototype}function tg(){return"RTCPeerConnection"in window&&"getSenders"in window.RTCPeerConnection.prototype}function ng(){return"RTCPeerConnection"in window&&"getTransceivers"in window.RTCPeerConnection.prototype}function ig(){return 11!==Up&&"RTCPeerConnection"in window&&"addTransceiver"in window.RTCPeerConnection.prototype}var rg=!(!ig()||Ip&&Mp<86);function og(){return"RTCRtpTransceiver"in window&&"stop"in window.RTCRtpTransceiver.prototype}function ag(){return"RTCRtpSender"in window&&"replaceTrack"in window.RTCRtpSender.prototype}function sg(){return"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&tg()}var lg=window.MediaStreamTrack&&"getSettings"in MediaStreamTrack.prototype,cg=window.MediaStreamTrack&&"getCapabilities"in MediaStreamTrack.prototype,ug="RTCRtpSender"in window&&"createEncodedStreams"in window.RTCRtpSender.prototype&&wp()>=86,dg=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter((e=>e in window)).length>0};function hg(){let e={AudioDecoder:!1,AudioEncoder:!1,VideoDecoder:!1,VideoEncoder:!1,ImageDecoder:!1};return Ff(window.AudioDecoder)||(e.AudioDecoder=!0),Ff(window.AudioEncoder)||(e.AudioEncoder=!0),Ff(window.VideoDecoder)||(e.VideoDecoder=!0),Ff(window.VideoEncoder)||(e.VideoEncoder=!0),Ff(window.ImageDecoder)||(e.ImageDecoder=!0),e}function pg(){return"mediaSession"in navigator&&!Ff(navigator.mediaSession.setActionHandler)}function fg(){return!Ff(window.WebTransport)}function mg(){let e={browser:`${jp.name}/${jp.version}`,os:Jp(),displayResolution:Xm(),isScreenShareSupported:Gm(),isWebRTCSupported:dg(),isGetUserMediaSupported:Ym(),isWebAudioSupported:Jm(),isWebSocketsSupported:"WebSocket"in window&&2===window.WebSocket.CLOSING,isWebCodecSupported:hg(),isMediaSessionSupported:pg(),isWebTransportSupported:fg()};return navigator.userAgent.includes("miniProgram")&&(e.browser=`mini/${e.browser}`),e}var gg="checkResult";!function(){Vm();let e=Rm.getItem(gg);e&&e.ua===navigator.userAgent&&(km=e.checkResult),zm()}();var _g=su(hu(),1),vg=Symbol("instance"),yg=(Symbol("abortCtrl"),Symbol("cacheResult")),Eg=class{constructor(e,t,n){this.oldState=e,this.newState=t,this.action=n,this.aborted=!1}abort(e){this.aborted=!0,Ag.call(e,this.oldState,new Error(`action '${this.action}' aborted`))}toString(){return`${this.action}ing`}},bg=class extends Error{constructor(e,t,n){super(t),this.state=e,this.message=t,this.cause=n}},Sg=new Map;function Tg(e,t,n={}){return(i,r,o)=>{let a=n.action||r;if(!n.context){let n=Sg.get(i)||[];Sg.has(i)||Sg.set(i,n),n.push({from:e,to:t,action:a})}let s=o.value;o.value=function(...i){let r=this;if(n.context&&(r=wg.get("function"==typeof n.context?n.context.call(this,...i):n.context)),r.state===t)return n.sync?r[yg]:Promise.resolve(r[yg]);r.state instanceof Eg&&r.state.action==n.abortAction&&r.state.abort(r);let o=null;Array.isArray(e)?0==e.length?r.state instanceof Eg&&r.state.abort(r):("string"!=typeof r.state||!e.includes(r.state))&&(o=new bg(r._state,`${r.name} ${a} to ${t} failed: current state ${r._state} not from ${e.join("|")}`)):e!==r.state&&(o=new bg(r._state,`${r.name} ${a} to ${t} failed: current state ${r._state} not from ${e}`));let l=e=>{if(n.fail&&n.fail.call(this,e),n.sync){if(n.ignoreError)return e;throw e}return n.ignoreError?Promise.resolve(e):Promise.reject(e)};if(o)return l(o);let c=r.state,u=new Eg(c,t,a);Ag.call(r,u);let d=e=>{var i;return r[yg]=e,u.aborted||(Ag.call(r,t),null===(i=n.success)||void 0===i||i.call(this,r[yg])),e},h=e=>{let t=e instanceof Error?e.message:String(e);return Ag.call(r,c,e),l(new bg(r._state,`action '${a}' failed :${t}`,e instanceof Error?e:new Error(t)))};try{let e=s.apply(this,i);return function(e){return"object"==typeof e&&e&&"then"in e}(e)?e.then(d).catch(h):n.sync?d(e):Promise.resolve(d(e))}catch(e){return h(e)}}}}var xg="undefined"!=typeof window&&window.__AFSM__?(e,t)=>{window.dispatchEvent(new CustomEvent(e,{detail:t}))}:"undefined"!=typeof importScripts?(e,t)=>{postMessage({type:e,payload:t})}:()=>{};function Ag(e,t){let n=this._state;this._state=e;let i=e.toString();e&&this.emit(i,n),this.emit(wg.STATECHANGED,e,n,t),this.updateDevTools({value:e,old:n,err:t instanceof Error?t.message:String(t)})}var wg=class extends _g.default{constructor(e,t,n){super(),this.name=e,this.groupName=t,this._state=wg.INIT,e||(e=Date.now().toString(36)),n?Object.setPrototypeOf(this,n):n=Object.getPrototypeOf(this),t||(this.groupName=this.constructor.name);let i=n[vg];i?this.name=i.name+"-"+i.count++:n[vg]={name:this.name,count:0},this.updateDevTools({diagram:this.stateDiagram})}get stateDiagram(){let e=Object.getPrototypeOf(this),t=Sg.get(e)||[],n=new Set,i=[],r=[],o=new Set,a=Object.getPrototypeOf(e);Sg.has(a)&&(a.stateDiagram.forEach((e=>n.add(e))),a.allStates.forEach((e=>o.add(e)))),t.forEach((({from:e,to:t,action:n})=>{"string"==typeof e?i.push({from:e,to:t,action:n}):e.length?e.forEach((e=>{i.push({from:e,to:t,action:n})})):r.push({to:t,action:n})})),i.forEach((({from:e,to:t,action:i})=>{o.add(e),o.add(t),o.add(i+"ing"),n.add(`${e} --\x3e ${i}ing : ${i}`),n.add(`${i}ing --\x3e ${t} : ${i} `),n.add(`${i}ing --\x3e ${e} : ${i} `)})),r.forEach((({to:e,action:t})=>{n.add(`${t}ing --\x3e ${e} : ${t} `),o.forEach((i=>{i!==e&&n.add(`${i} --\x3e ${t}ing : ${t}`)}))}));let s=[...n];return Object.defineProperties(e,{stateDiagram:{value:s},allStates:{value:o}}),s}static get(e){let t;return"string"==typeof e?(t=wg.instances.get(e),t||wg.instances.set(e,t=new wg(e,void 0,Object.create(wg.prototype)))):(t=wg.instances2.get(e),t||wg.instances2.set(e,t=new wg(e.constructor.name,void 0,Object.create(wg.prototype)))),t}static getState(e){var t;return null===(t=wg.get(e))||void 0===t?void 0:t.state}updateDevTools(e={}){xg(wg.UPDATEAFSM,Object.assign({name:this.name,group:this.groupName},e))}get state(){return this._state}set state(e){Ag.call(this,e)}};wg.STATECHANGED="stateChanged",wg.UPDATEAFSM="updateAFSM",wg.INIT="[*]",wg.ON="on",wg.OFF="off",wg.instances=new Map,wg.instances2=new WeakMap;var Ig=(null==window?void 0:window.requestIdleCallback)||function(e){let t=Date.now();return setTimeout((()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})}),1e3)},Rg=(null==window?void 0:window.cancelIdleCallback)||function(e){clearTimeout(e)},Cg=(null==window?void 0:window.cancelAnimationFrame)||(null==window?void 0:window.mozCancelAnimationFrame),Mg=class{static generateTaskID(){return this.currentTaskID++}static run(e=ch,t,n){n=iu(e===lh?{delay:2e3,count:0,backgroundTask:!0}:e===ah?{delay:1e4,count:0}:e===sh?{fps:60,delay:16.6,count:0,backgroundTask:!0}:{delay:2e3,count:0,backgroundTask:!0},n),jf(t)&&(n=iu(iu({},n),t)),Vf(e)&&(t=e,e=ch);let i=iu({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,ricID:null,taskName:e,callback:t},n);return this.taskMap.set(i.taskID,i),this[e](i),i.taskID}static interval(e){return e.intervalID=setInterval((()=>{e.callback(),e.loopCount+=1,this.isBreakLoop(e)}),e.delay)}static intervalInWorker(e){e.delay=(1e3/e.fps).toFixed(2);let t=new Worker(URL.createObjectURL(new Blob([`\n        let timerID = null;\n        self.onmessage = function (e) {\n          if (e.data === 'start') {\n            timerID = setInterval(() => {\n              self.postMessage('tick');\n            }, ${e.delay});\n          } else if (e.data === 'stop') {\n            clearInterval(timerID);\n          }\n        };\n      `],{type:"application/javascript"})));t.onmessage=n=>{"tick"===n.data&&(e.callback(),e.loopCount+=1,this.isBreakLoop(e)&&t.postMessage("stop"))},e.worker=t,t.postMessage("start")}static timeout(e){let t=()=>{if(e.callback(),e.loopCount+=1,!this.isBreakLoop(e))return e.timeoutID=setTimeout(t,e.delay)};return e.timeoutID=setTimeout(t,e.delay)}static ric(e){let t,n=Qf(),i=()=>{if(t=Qf()-n,t>=e.delay&&(n=Qf()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),!this.isBreakLoop(e))return e.ricID=Ig(i,{timeout:e.delay})};return e.ricID=Ig(i,{timeout:e.delay})}static raf(e){e.delay=(1e3/e.fps).toFixed(2);let t,n=Qf(),i=()=>document.hidden&&e.backgroundTask?(t=Qf()-n,n=Qf(),e.callback(),e.loopCount+=1,this.isBreakLoop(e)?void 0:e.timeoutID=setTimeout(i,e.delay-Math.floor(t%e.delay))):(t=Qf()-n,t>=e.delay&&(n=Qf()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),this.isBreakLoop(e)?void 0:e.rafID=requestAnimationFrame(i));if(e.rafID=requestAnimationFrame(i),e.backgroundTask){let t=()=>{if(document.hidden){let t=Qf()-n;t>=e.delay?i():e.timeoutID=setTimeout(i,e.delay-t)}};document.addEventListener("visibilitychange",t),e.onVisibilitychange=t,document.hidden&&t()}return e.taskID}static hasTask(e){return this.taskMap.has(e)}static clearTask(e){if(!this.taskMap.has(e))return!0;let{intervalID:t,timeoutID:n,rafID:i,ricID:r,onVisibilitychange:o,worker:a}=this.taskMap.get(e);return a&&a.terminate(),t&&clearInterval(t),n&&clearTimeout(n),i&&Cg(i),r&&Rg(r),o&&document.removeEventListener("visibilitychange",o),this.taskMap.delete(e),!0}static isBreakLoop(e){return!this.taskMap.has(e.taskID)||0!==e.count&&e.loopCount>=e.count&&(this.clearTask(e.taskID),!0)}};Mg.taskMap=new Map,Mg.currentTaskID=1;var kg=Mg,Ng=(ld.SEI_MESSAGE,{LOADED_DATA:ld.LOADEDDATA,MEDIA_TRACK_CHANGED:"media-track-changed",PLAYER_STATE_CHANGED:"player-state-changed",ERROR:"error"}),Dg={};au(Dg,{create:()=>Pg,remove:()=>Lg});var Og=new WeakMap;function Pg(e,t){Og.has(e)||Og.set(e,[]);let n=Og.get(e),i={add:(e,r)=>("addEventListener"in t?(n.push(t.removeEventListener.bind(t,e,r)),t.addEventListener(e,r)):(n.push(t.off.bind(t,e,r)),t.on(e,r)),i)};return i}function Lg(e){let t=Og.get(e);t&&(t.forEach((e=>e())),Og.delete(e))}var Ug=new WeakMap;function Vg({settings:e={retries:5,timeout:2e3},onError:t,onRetrying:n,onRetryFailed:i}){return function(r,o,a){let s=of({retryFunction:a.value,settings:e,onError({error:e,retry:n,reject:i,retryFuncArgs:a}){var s;t?t.call(this,e,(()=>{var t;null!=(t=Ug.get(r))&&t.has(o)?n():i(e)}),i,a):null!=(s=Ug.get(r))&&s.has(o)?n():i(e)},onRetrying(e,t){var i;Vf(n)&&n.call(this,e,t),null!=(i=Ug.get(r))&&i.has(o)&&(Ug.get(r).get(o).stopRetry=t)},onRetryFailed:i});return a.value=function(...e){let t=Ug.get(r);return t?t.set(o,{args:e}):Ug.set(r,new Map([[o,{args:e}]])),s.apply(this,e).finally((()=>{var e;return null==(e=Ug.get(r))?void 0:e.delete(o)}))},a}}function Fg({fnName:e,callback:t,validateArgs:n=!0}){return function(i,r,o){let a=o.value;return o.value=function(...r){var o,s;if(null!=(o=Ug.get(i))&&o.has(e)){let{stopRetry:o,args:a}=Ug.get(i).get(e),l=!0;if(n)for(let e of a)if(!r.find((t=>t===e))){l=!1;break}l&&(t&&t.apply(this,r),o&&o(),null==(s=Ug.get(i))||s.delete(e))}return a.apply(this,r)},o}}var Bg,Hg,zg=class{constructor(e=!0){this.countMap=new Map,this.distributionMap=new Map,this.log=wm.createLogger({id:"kv"}),e&&(af.on("102",(({track:e,cost:t})=>{this.addSuccessEvent({key:e.kind===ld.AUDIO?qg.START_MICROPHONE:Xg.START_CAMERA,cost:t})})),af.on("103",(({track:e,error:t})=>{this.addFailedEvent({key:e.kind===ld.AUDIO?qg.START_MICROPHONE:Xg.START_CAMERA,error:t})})))}getReportData(){let e={msg_sdk_basic_info:{uint32_sdk_version:vm(this.version||Nu),uint32_terminal_type:15,bytes_device_name:"",bytes_os_version:"",uint32_framework:30,uint32_network_type:0},stats_count:[...this.countMap.entries()].map((([e,t])=>({uint32_key:e,uint32_count:t}))),stats_distribution:[...this.distributionMap.entries()].map((([e,t])=>({uint32_key:e,distribution_items:[...t.entries()].map((([e,t])=>({uint32_item_key:e,uint32_item_value:t})))})))};return this.countMap.clear(),this.distributionMap.clear(),e}clear(){this.countMap.clear(),this.distributionMap.clear()}isEnumKey(e){let t=+String(e).slice(-3);return t>=700&&t<799}isErrorCodeKey(e){let t=+String(e).slice(-3);return t>=600&&t<699}isCountKey(e){let t=+String(e).slice(-3);return t>=0&&t<599}isNumberKey(e){let t=+String(e).slice(-3);return t>=800&&t<899}addCount({key:e,useUV:t=!1}){this.isCountKey(e)?t&&this.countMap.has(e)||this.countMap.set(e,(this.countMap.get(e)||0)+1):this.log.debug(`${e} is not count key, last 3 number should be 0~599`)}addEnum({key:e,value:t,useUV:n=!0}){var i;if(!this.isEnumKey(e))return this.log.debug(`${e} is not enum key, last 3 number should be 700~799`);if(n&&this.countMap.has(e))return;this.countMap.set(e,(this.countMap.get(e)||0)+1);let r=(null==(i=this.distributionMap)?void 0:i.get(e))||new Map;r.set(t,(r.get(t)||0)+1),this.distributionMap.set(e,r)}addNumber({key:e,value:t,split:n=100,useUV:i=!1}){var r;if(!this.isNumberKey(e))return this.log.debug(`${e} is not number key, last 3 number should be 800~899`);if(i&&this.countMap.has(e))return;this.countMap.set(e,(this.countMap.get(e)||0)+1);let o=(null==(r=this.distributionMap)?void 0:r.get(e))||new Map,a=0;if(Hf(n))a=Math.floor(t/n);else for(let e=n.length-1;e>0;e--)if(t>n[e]){a=e;break}o.set(a,(o.get(a)||0)+1),this.distributionMap.set(e,o)}addSuccessEvent({key:e,cost:t,timeKey:n,split:i}){if(e&&(this.addEnum({key:e,value:1,useUV:!1}),t)){let r=+String(e).slice(-3);r<800&&r>=700?this.addNumber({key:n||e+100,value:t,split:i}):n||this.log.debug(`time stat ignored, ${e}`)}}addFailedEvent({key:e,error:t}){if(!e)return;let n=Tu.UNKNOWN;t&&(Hf(t)?n=t:(!Ff(t.extraCode)||!Ff(t.code))&&(n=t.extraCode||t.code)),this.addEnum({key:e,value:0,useUV:!1}),this.addEnum({key:e,value:n,useUV:!1})}},jg=((Hg=jg||{})[Hg.enterRoom=500700]="enterRoom",Hg[Hg.exitRoom=500701]="exitRoom",Hg[Hg.switchRole=500702]="switchRole",Hg[Hg.destroy=500703]="destroy",Hg[Hg.startLocalAudio=500704]="startLocalAudio",Hg[Hg.updateLocalAudio=500705]="updateLocalAudio",Hg[Hg.stopLocalAudio=500706]="stopLocalAudio",Hg[Hg.startLocalVideo=500707]="startLocalVideo",Hg[Hg.updateLocalVideo=500708]="updateLocalVideo",Hg[Hg.stopLocalVideo=500709]="stopLocalVideo",Hg[Hg.startScreenShare=500710]="startScreenShare",Hg[Hg.updateScreenShare=500711]="updateScreenShare",Hg[Hg.stopScreenShare=500712]="stopScreenShare",Hg[Hg.startRemoteVideo=500713]="startRemoteVideo",Hg[Hg.updateRemoteVideo=500714]="updateRemoteVideo",Hg[Hg.stopRemoteVideo=500715]="stopRemoteVideo",Hg[Hg.muteRemoteAudio=500716]="muteRemoteAudio",Hg[Hg.setRemoteAudioVolume=500717]="setRemoteAudioVolume",Hg[Hg.use=500718]="use",Hg[Hg.sendSEIMessage=5e5]="sendSEIMessage",Hg[Hg.sendCustomMessage=500001]="sendCustomMessage",Hg),Gg=((Bg=Gg||{})[Bg.AudioMixer=550700]="AudioMixer",Bg[Bg.AIDenoiser=551700]="AIDenoiser",Bg[Bg.VirtualBackground=570700]="VirtualBackground",Bg[Bg.Beauty=571700]="Beauty",Bg[Bg.Watermark=572700]="Watermark",Bg[Bg.BasicBeauty=574700]="BasicBeauty",Bg[Bg.CDNStreaming=590700]="CDNStreaming",Bg[Bg.DeviceDetector=591700]="DeviceDetector",Bg[Bg.Debug=592700]="Debug",Bg),$g=(e=>(e[e.AudioMixer=550701]="AudioMixer",e[e.AIDenoiser=551701]="AIDenoiser",e[e.VirtualBackground=570701]="VirtualBackground",e[e.Beauty=571701]="Beauty",e[e.Watermark=572701]="Watermark",e[e.BasicBeauty=574701]="BasicBeauty",e[e.CDNStreaming=590701]="CDNStreaming",e[e.DeviceDetector=591701]="DeviceDetector",e[e.Debug=592701]="Debug",e))($g||{}),Wg=(e=>(e[e.AudioMixer=550702]="AudioMixer",e[e.AIDenoiser=551702]="AIDenoiser",e[e.VirtualBackground=570702]="VirtualBackground",e[e.Beauty=571702]="Beauty",e[e.Watermark=572702]="Watermark",e[e.BasicBeauty=574702]="BasicBeauty",e[e.CDNStreaming=590702]="CDNStreaming",e[e.DeviceDetector=591702]="DeviceDetector",e[e.Debug=592702]="Debug",e))(Wg||{}),qg=(e=>(e[e.START_MICROPHONE=501700]="START_MICROPHONE",e[e.MICROPHONE_CAHNNELS=501701]="MICROPHONE_CAHNNELS",e[e.MICROPHONE_SAMPLERATE=501702]="MICROPHONE_SAMPLERATE",e))(qg||{}),Xg=(e=>(e[e.START_CAMERA=511700]="START_CAMERA",e))(Xg||{}),Yg=new zg(!0),Jg=new zg(!1),Kg=Yg,Qg=class extends wg{constructor(e,t){super(e.id,`${t}-player`),this.kind=t,cu(this,"id"),cu(this,"element",null),cu(this,"track"),cu(this,"url"),cu(this,"attr"),cu(this,"muted"),cu(this,"_log"),cu(this,"_pausedRetryCount"),cu(this,"_isElementPlayingFired",!1),cu(this,"_interval"),cu(this,"_delayDestroyTimeoutId",0),cu(this,"_isReplayByRecreateMediaStreamIng",!1),this.id=e.id,this._log=e.log,this.track=e.track,this.muted=e.muted,this._pausedRetryCount=Qd,this._state="STOPPED",this.bindTrackEvents(),this._log.info(`create ${t}-player ${this.id}`)}get isPlaying(){var e;return"PLAYING"===this._state&&!1===(null==(e=this.element)?void 0:e.paused)}get isStopped(){return"STOPPED"===this._state}setAttr(e){this.attr=e}setUrl(e){this.track&&(this.unbindTrackEvents(),this.element&&(this.element.srcObject=null),this.track=null),e!==this.url&&(this.url=e,null!==e&&this.element&&(this.element.crossOrigin="anonymous",this.element.src=e))}play(){return du(this,null,(function*(){if(!this.isPlaying)try{this._delayDestroyTimeoutId&&(clearTimeout(this._delayDestroyTimeoutId),this._delayDestroyTimeoutId=0,this.bindTrackEvents(),this.bindElementEvents()),this.bindAutoPlayEvent(),yield this.element.play()}catch(e){let t=nf({key:fh.PLAY_FAILED,data:{media:this.kind,error:e}});if(this.track&&!this.track.muted&&this._log.warn(e),t.includes("NotAllowedError"))throw new Au({code:Tu.PLAY_NOT_ALLOWED,message:t})}}))}stop(e=0){this._isElementPlayingFired=!1,this.unbindEvents(),e>0?this._delayDestroyTimeoutId||(this._log.info(`destroy element after 3 * ${e}`),this._delayDestroyTimeoutId=setTimeout((()=>this.destroyElement()),3*e)):this.destroyElement(),this.handleStopped(ld.ENDED),this._interval>0&&kg.clearTask(this._interval)}destroyElement(){this.element&&(this._log.debug("destroy element"),this.element.remove(),this.element.srcObject=null,this.element=null),clearTimeout(this._delayDestroyTimeoutId),this._delayDestroyTimeoutId=0}pause(){var e;this.isPlaying&&(null==(e=this.element)||e.pause())}resume(){return this._log.info("resume"),this.isPlaying?Promise.resolve():Fp?this.replay():this.play().catch((()=>{}))}setMuted(e){this.element&&(this.element.muted=e),this.muted=e}replay(){return this.stop(),this.play().catch((()=>{}))}bindElementEvents(){if(this.element){let e=this.handleElementEvent.bind(this);return Pg(this.element,this.element).add(ld.PLAYING,e).add(ld.ENDED,e).add(ld.PAUSE,e).add(ld.ERROR,e).add(ld.LOADEDDATA,e)}}bindTrackEvents(){if(this.track){let e=this.handleTrackEvent.bind(this);null==Dg||Dg.create(this.track,this.track).add(ld.ENDED,e).add(ld.MUTE,e).add(ld.UNMUTE,e),this.track.readyState===ld.ENDED&&this.handleTrackEvent({type:ld.ENDED}),this.track.muted&&this.handleTrackEvent({type:ld.MUTE})}}bindAutoPlayEvent(){af.on(xm.AUTOPLAY_DIALOG_CLICK_CONFIRM,this.resume,this)}unbindTrackEvents(){this.track&&Lg(this.track)}unbindEvents(){this.element&&Lg(this.element),this.unbindTrackEvents(),af.off(xm.AUTOPLAY_DIALOG_CLICK_CONFIRM,this.resume,this)}handleElementEvent(e){switch(e.type){case ld.PLAYING:this._isElementPlayingFired=!0,this._log.info(`${this.kind} player is playing`),this.handlePlaying(ld.PLAYING),this._interval&&(kg.clearTask(this._interval),this._interval=-1);break;case ld.ENDED:this._log.info(`${this.kind} player is ended`),this.handleStopped(ld.ENDED);break;case ld.PAUSE:this._log.info(`${this.kind} player is paused`),this.handlePaused(ld.PAUSE),Ih&&(this._interval=kg.run(ch,(()=>{this.element&&"PAUSED"===this._state&&this.resume()}),{delay:3e3}));break;case ld.ERROR:if(this.element&&this.element.error){this.handlePaused(ld.ERROR);let{code:e,message:t}=this.element.error;this._log.error(`${this.kind} ${this._log.isLocal?"local":"remote"} MediaError code: ${e} message: ${t} userAgent: ${navigator.userAgent}`),lf.uploadEvent({log:`stat-${this.kind}-${Ld.PLAYER_ERROR}-${e}-${navigator.userAgent}`,error:this.element.error}),this.replayByRecreateMediaStream()}break;case ld.LOADEDDATA:this.kind===ld.VIDEO&&this.emit(Ng.LOADED_DATA)}}replayByRecreateMediaStream(){if(!this._isReplayByRecreateMediaStreamIng)return this._isReplayByRecreateMediaStreamIng=!0,this.doReplayByRecreateMediaStream(1e3).then((()=>{this._log.warn("replayByRecreateMediaStream success"),lf.uploadEvent({log:"stat-replayByRecreateMediaStream-success"}),Kg.addSuccessEvent({key:this.kind===ld.AUDIO?506700:516700})})).catch((()=>{var e,t;this._log.error("replayByRecreateMediaStream failed"),lf.uploadEvent({log:"stat-replayByRecreateMediaStream-failed"}),Kg.addFailedEvent({key:this.kind===ld.AUDIO?506700:516700,error:null==(e=this.element)?void 0:e.error}),null!=(t=this.element)&&t.error&&this.emit(Ng.ERROR,this.element.error)})).finally((()=>{this._isReplayByRecreateMediaStreamIng=!1}))}doReplayByRecreateMediaStream(e){return this._log.warn(`delay ${e}ms to recreate mediaStream`),new Promise(((t,n)=>{Em(e).then((()=>{this.element&&(this.element.srcObject=null,this.element.srcObject=new MediaStream([this.track]),this._log.warn("recreated mediaStream"),this.element.onerror=()=>{var e,t,i;this._log.warn(`element onerror ${null==(t=null==(e=this.element)?void 0:e.error)?void 0:t.code} fired after recreated mediaStream`),n(null==(i=this.element)?void 0:i.error)}),Em(5e3).then((()=>{var e,i;(!this.isPlaying||(null==(e=this.element)?void 0:e.error))&&n(null==(i=this.element)?void 0:i.error),t()}))}))})).finally((()=>{this.element&&(this.element.onerror=null)}))}handleTrackEvent(e){switch(e.type){case ld.ENDED:this.handleStopped(ld.ENDED);break;case ld.MUTE:this.handlePaused(ld.MUTE);break;case ld.UNMUTE:this._isElementPlayingFired&&this.handlePlaying(ld.UNMUTE)}}handlePlaying(e){this.emit(Ng.PLAYER_STATE_CHANGED,{type:this.kind,state:"PLAYING",reason:e})}handlePaused(e){this.emit(Ng.PLAYER_STATE_CHANGED,{type:this.kind,state:"PAUSED",reason:e})}handleStopped(e){this.emit(Ng.PLAYER_STATE_CHANGED,{type:this.kind,state:"STOPPED",reason:e})}getElement(){return this.element}};lu([Vg({settings:{retries:2,timeout:0},onError(e,t,n,i){i[0]=(i[0]||1e3)+1e3,t()}})],Qg.prototype,"doReplayByRecreateMediaStream",1),lu([Tg([],"PLAYING",{sync:!0})],Qg.prototype,"handlePlaying",1),lu([Tg("PLAYING","PAUSED",{ignoreError:!0,sync:!0})],Qg.prototype,"handlePaused",1),lu([Tg([],"STOPPED",{sync:!0})],Qg.prototype,"handleStopped",1);var Zg="trtc_autoplay",e_=`${Zg}_mask`,t_=`${Zg}_wrapper`,n_=`${Zg}_header`,i_=`${Zg}_content`,r_=`${Zg}_action_wrapper`,o_=`${Zg}_question`,a_=`${Zg}_collapse`,s_=`${Zg}_action_confirm`,l_=`${Zg}_detail`,c_="#2473E8",u_="dialog",d_=`${u_}-show`,h_=`${u_}-1`,p_=`${u_}-2`,f_=!1,m_=()=>!!document.querySelector(`.${t_}`),g_=`${Wu}/${Df()?"zh-cn":"en"}/tutorial-21-advanced-auto-play-policy.html`,__=`<br><a href='${g_}' target='_blank'>${Df()?"":"Any other solution?"}</a>`,v_=Df()?`${__}`:`Autoplay Policy: Before user interacts with the web page (clicking, touching), page will not be allowed to play media with sound. This Dialog is used to help users resume playback. ${__}`,y_=class extends Qg{constructor(e){super(e,ld.VIDEO),cu(this,"viewMirror",!1),cu(this,"objectFit"),cu(this,"container"),cu(this,"canvas"),this.container=e.container,this.canvas=e.canvas,Ff(e.viewMirror)||(this.viewMirror=e.viewMirror),Ff(e.objectFit)||(this.objectFit=e.objectFit),this.initializeElement()}initializeElement(){var e;let t=document.createElement(ld.VIDEO);this.track&&(t.srcObject=new MediaStream([this.track])),t.muted=!0,t.setAttribute("id",`video_${this.id}`),t.setAttribute("style",this.styleAttribute),this.canvas&&this.canvas.setAttribute("style",this.styleAttribute),t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),this.element=t,null==(e=this.container)||e.appendChild(this.elementToRender),this.bindElementEvents()}get styleAttribute(){let e=`width: 100%; height: 100%; object-fit: ${this.objectFit};background-color: black;`;return this.viewMirror&&(e+="transform: scaleX(-1);"),e}setContainer(e){var t;this.container=e,this.track&&this.elementToRender&&(null==(t=this.container)||t.appendChild(this.elementToRender))}bindElementEvents(){let e=super.bindElementEvents();this.handleElementEvent=this.handleElementEvent.bind(this),e&&e.add(ld.ENTER_PICTURE_IN_PICTURE,this.handleElementEvent).add(ld.LEAVE_PICTURE_IN_PICTURE,this.handleElementEvent)}handleElementEvent(e){var t;super.handleElementEvent(e);let n=e.type;if(n===ld.PAUSE&&(this.container&&document.getElementById(this.container.id)||this._log.warn(`${this.kind} player has been remove, element ID: ${null==(t=this.container)?void 0:t.id}`),this._pausedRetryCount>0&&!m_()&&(this._log.info(`${this.kind} player auto resume when paused`),this.resume(),this._pausedRetryCount--)),this.viewMirror&&this.element){let e=this.element.style.transform;n===ld.ENTER_PICTURE_IN_PICTURE?this.element.style.transform=e.replace("scaleX(-1)",""):n===ld.LEAVE_PICTURE_IN_PICTURE&&!e.includes("scaleX")&&(this.element.style.transform=`${e} scaleX(-1)`)}}setCanvas(e){var t,n;this.canvas!==e&&(null==(t=this.canvas)||t.remove(),null==e||e.setAttribute("style",this.styleAttribute),this.canvas=e,e&&(null==(n=this.container)||n.appendChild(e)))}setAttr(e){let t=Object.assign({autoplay:"autoplay",playsinline:"playsinline",muted:!0},e);t.style=Object.assign({width:"100%",height:"100%"},t.style),super.setAttr(t)}get mirror(){return this.viewMirror}setRect(e,t){this.elementToRender&&(this.elementToRender.style.width=`${e}px`,this.elementToRender.style.height=`${t}px`)}setViewMirror(e){this.elementToRender&&(this.elementToRender.style.transform=e?"scaleX(-1)":""),this.viewMirror=e}setObjectFit(e){this.elementToRender&&(this.elementToRender.style.objectFit=`${e}`),this.objectFit=e}stop(e=0){var t;super.stop(e),null==(t=this.canvas)||t.remove()}play(){return this.element?this.elementToRender&&this.elementToRender.parentElement!==this.container&&this.container&&this.container.append(this.elementToRender):this.initializeElement(),super.play()}get elementToRender(){return this.canvas||this.element}setTrack(e){e!==this.track&&(this.unbindTrackEvents(),this.track=e,this.emit(Ng.MEDIA_TRACK_CHANGED,e),null!==e&&(this.bindTrackEvents(),this.element&&(this.element.srcObject=new MediaStream([e]),this.element.remove()),this.elementToRender&&this.elementToRender.parentElement!==this.container&&this.container&&this.container.append(this.elementToRender)))}getVideoFrame(){if(this.canvas)return this.canvas.toDataURL("image/png");if(!this.element)return"";let e=document.createElement("canvas");return e.width=this.element.videoWidth,e.height=this.element.videoHeight,e.getContext("2d").drawImage(this.element,0,0),e.toDataURL("image/png")}getElement(){return this.element}};function E_(e,t){return du(this,null,(function*(){if(!e.audioWorklet)return Promise.reject("audioWorklet is not supported");try{yield e.audioWorklet.addModule(t),wm.info("worklet addModule success")}catch(e){throw wm.info(`worklet addModule catch error. ${e.message}`),e}}))}"undefined"!=typeof window&&(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext);var b_=new window.AudioContext({sampleRate:48e3}),S_=()=>{"suspended"===b_.state?(b_.resume(),document.addEventListener("click",S_)):"interrupted"===b_.state?b_.resume():document.removeEventListener("click",S_)};document.addEventListener("click",S_),b_.onstatechange=()=>{wm.info(`context state: ${b_.state}`),S_()};var T_=e=>b_,x_=class{constructor(){this.pre=new Set,this.next=new Set,this.connectedNodes=new Set,this._channelCount=1}get channelCount(){return this._channelCount}set channelCount(e){this._channelCount=e,this.node&&(this.node.channelCount=e),this.next.forEach((t=>t.channelCount=e))}setContext(e){this.context=e,this.node&&e.addMixWeight()}removeContext(){var e;this.node&&(null==(e=this.context)||e.reduceMixWeight()),delete this.context}setNode(e){var t;if(!this.node)try{null==(t=this.context)||t.addMixWeight(),this.node=e,this.node.channelCountMode="explicit",this.node.channelCount=this._channelCount,this.preNodeReconnect(),this.reconnect(),Kg.addSuccessEvent({key:502701})}catch(e){wm.error(e),Kg.addFailedEvent({key:502701,error:e})}}deleteNode(){var e;if(this.node)try{this._disconnect(),delete this.node,null==(e=this.context)||e.reduceMixWeight(),this.preNodeReconnect(),Kg.addSuccessEvent({key:502702})}catch(e){wm.error(e),Kg.addFailedEvent({key:502702,error:e})}}preNodeReconnect(){this.pre.forEach((e=>{e.node?e.reconnect():e.preNodeReconnect()}))}connectNext(e){this.next.forEach((t=>e._connect(t.node)||t.connectNext(e)))}_connect(e){return!(!this.node||!e||(this.node.connect(e),this.connectedNodes.add(e),0))}_disconnect(){this.connectedNodes.forEach((e=>{var t;return null==(t=this.node)?void 0:t.disconnect(e)})),this.connectedNodes.clear()}reconnect(){this._disconnect(),this.connectNext(this)}pipeTo(...e){return e.forEach((e=>{this.next.add(e),e.pre.add(this)})),this}},A_=class extends x_{constructor(e=256){super(),this.fftSize=e,this.dataArray=new Uint8Array(0)}setNode(e){e.fftSize=this.fftSize,this.dataArray=new Uint8Array(e.frequencyBinCount),super.setNode(e)}getByteTimeDomainData(){var e;return null==(e=this.node)||e.getByteTimeDomainData(this.dataArray),this.dataArray}get level(){var e;return null==(e=this.node)||e.getByteTimeDomainData(this.dataArray),Math.max(...this.dataArray)/128-1}get timeDomainPathData(){let e=this.getByteTimeDomainData(),t=0,n=0,i=`M${t},${n}`;for(let r=0;r<e.length;r++)n=e[r]/128*100/2,i+=`L${t},${n}`,t+=1;return i}},w_=class{constructor(){this.source=new x_,this.gain=new x_,this.destination=new x_}get volume(){var e;return(null==(e=this.gain.node)?void 0:e.gain.value)||1}setVolume(e){1!==e?(this.gain.node||this.gain.setNode(this.source.node.context.createGain()),this.gain.node.gain.value=e):this.gain.node&&this.gain.deleteNode()}replaceSource(e){this.source.deleteNode(),this.source.setNode(function(e){let t=C_.get(e);if(t)return t;let n=T_();if(e instanceof HTMLAudioElement)t=n.createMediaElementSource(e);else{if(!(e instanceof MediaStreamTrack))return e;t=n.createMediaStreamSource(new MediaStream([e]))}return C_.set(e,t),t}(e))}get track(){var e;return null==(e=this.stream)?void 0:e.getAudioTracks()[0]}get stream(){var e;return null==(e=this.destination.node)?void 0:e.stream}},I_=class extends w_{constructor(e){super(),this.context=e,this.denoiser=new x_,this.source.pipeTo(this.denoiser.pipeTo(this.gain.pipeTo(this.destination)))}connect(){this.context.inputs.has(this)||(this.destination.setNode(this.context.destination),this.source.setContext(this.context),this.denoiser.setContext(this.context),this.gain.setContext(this.context),this.context.inputs.add(this))}disconnect(){!this.context.inputs.has(this)||(this.destination.deleteNode(),this.source.removeContext(),this.denoiser.removeContext(),this.gain.removeContext(),this.context.inputs.delete(this))}remove(){this.gain.deleteNode(),this.denoiser.deleteNode(),this.source.deleteNode(),this.disconnect()}setVolume(e){1!==e?(this.gain.node||this.gain.setNode(this.context.audioContext.createGain()),this.gain.node.gain.value=e):this.gain.node&&this.gain.deleteNode()}},R_=class{constructor(){this.audioContext=T_(),this.destination=this.audioContext.createMediaStreamDestination(),this.inputs=new Set,this.mixWeight=0}addMixWeight(e=1){this.mixWeight+=e,this.mixWeight-1==e+1>>1&&this.mixOnChange()}reduceMixWeight(e=1){this.addMixWeight(-e)}close(){this.inputs.forEach((e=>e.remove()))}get mixTrack(){return this.destination.stream.getAudioTracks()[0]}},C_=new WeakMap,M_=class{constructor(e){cu(this,"_volume",0),cu(this,"_log"),cu(this,"_scriptProcessorNode",null),cu(this,"_audioWorkletNode",null),cu(this,"_interval",200),cu(this,"ready",this.preload());let{log:t}=e;this._log=t,af.on(xm.AUDIO_LEVEL_INTERVAL,this.handleAudioLevelInterval,this)}get node(){return this._audioWorkletNode||this._scriptProcessorNode}preload(){return M_.workletReady||(M_.workletReady=E_(M_.audioContext,URL.createObjectURL(new Blob(['\nclass VolumeMeter extends AudioWorkletProcessor{constructor(){super();this.volume=0;this.intervalTime=200;this.tick=this.intervalTime;this.isStop=false;this.cache=[];this.sentFirstInfo1=false;this.unmute=false;this.port.onmessage=(event)=>{const{data}=event;switch(data.name){case"chunk":this.cache.push.apply(this.cache,data.data);if(!this.sentFirstInfo1){this.port.postMessage({cl:data.data.length});this.sentFirstInfo1=true;}\nbreak;case"setIntervalTime":this.intervalTime=data.intervalTime;break;case"unmute":this.unmute=true;break;case"stop":this.isStop=true;break;}};}\nprocess(inputs,outputs){const input=inputs[0];const output=outputs[0];if(!input&&!output){return true;}\nif(this.isStop){return false;}\nconst l=output?output[0].length:0;const cl=this.cache.length;if(cl>l){output[0].set(this.cache.slice(0,l));this.cache=this.cache.slice(l);}else if(this.unmute){output[0].set(input[0]);}\nconst firstChannel=cl>l?output[0]:input[0];if(!firstChannel){return true;}\nlet sum=0;let rms;for(let i=0;i<firstChannel.length;++i){sum+=firstChannel[i]*firstChannel[i];}\nrms=Math.sqrt(sum/firstChannel.length);this.volume=Math.max(rms,this.volume*0.95);this.tick-=firstChannel.length;if(this.tick<0){this.tick+=(this.intervalTime/1000)*sampleRate;this.port.postMessage({volume:this.volume,cacheLen:cl,outputLen:l});}\nreturn true;}}\nregisterProcessor("volume-meter",VolumeMeter);\n'],{type:"application/javascript"})))),M_.workletReady.then((()=>this.initAudioWorklet())).catch((()=>this.initScriptProcessor()))}initAudioWorklet(){if(!this._audioWorkletNode)try{this._audioWorkletNode=new AudioWorkletNode(M_.audioContext,"volume-meter");let e=!1;this._audioWorkletNode.port.onmessage=t=>{this._volume=t.data.volume||0,!e&&t.data.cacheLen&&t.data.outputLen&&(this._log.warn("worklet play success"),e=!0)},this.handleAudioLevelInterval({interval:this._interval})}catch(e){lf.logFailedEvent({userId:this._log.userId,eventType:Ld.LOAD_WORKLET,error:e}),this.initScriptProcessor()}}initScriptProcessor(){if(!this._scriptProcessorNode)try{this._scriptProcessorNode=T_().createScriptProcessor(2048,1,1),this._scriptProcessorNode.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0),n=0;for(let e=0;e<t.length;++e)n+=t[e]*t[e];this._volume=Math.sqrt(n/t.length)||0}}catch(e){this._log.error(`volumeMeter init script processor error: ${e}`)}}destroy(){this._scriptProcessorNode&&(this._scriptProcessorNode.onaudioprocess=null),this._audioWorkletNode&&(this._audioWorkletNode.port.postMessage({name:"stop"}),this._audioWorkletNode.port.onmessage=null),this._audioWorkletNode=null,this._scriptProcessorNode=null,af.off(xm.AUDIO_LEVEL_INTERVAL,this.handleAudioLevelInterval,this)}getInternalAudioLevel(){return this._volume}getCalculatedVolume(){return parseFloat(this._volume.toFixed(2))}handleAudioLevelInterval(e){var t;let{interval:n}=e;this._interval=n,null==(t=this._audioWorkletNode)||t.port.postMessage({name:"setIntervalTime",intervalTime:n})}},k_=M_;cu(k_,"audioContext",T_()),cu(k_,"workletReady");var N_=class extends x_{constructor(e){super(),cu(this,"_volumeMeter"),this._volumeMeter=new k_(e)}deleteNode(){super.deleteNode(),this._volumeMeter.destroy()}init(){return du(this,null,(function*(){yield this._volumeMeter.preload(),this.setNode(this._volumeMeter.node)}))}getCalculatedVolume(){return this._volumeMeter.getCalculatedVolume()}getInternalAudioLevel(){return this._volumeMeter.getInternalAudioLevel()}write(e){if(this.node){let t=e.allocationSize({planeIndex:0}),n=new Float32Array(t>>2);e.copyTo(n,{planeIndex:0}),this.node.port.postMessage({name:"chunk",data:n},[n.buffer]),e.close()}}},D_=su(hu(),1),O_=e=>t=>t.deviceId===e,P_=class{constructor(e,t="Input"){cu(this,"kind"),cu(this,"type"),cu(this,"devices",[]),this.kind=e,this.type=t}update(e,t){let n=e.filter((e=>e.kind===`${this.kind}${this.type.toLocaleLowerCase()}`));1===this.devices.length&&V_(this.devices[0])||t&&(n.forEach((e=>{if(e.deviceId&&!this.devices.find(O_(e.deviceId))){let n=`${this.kind}${this.type}Added`;wm.warn(`${n}: ${JSON.stringify(e)}`),t.emit(n,e)}})),this.devices.forEach((e=>{if(e.deviceId&&!n.find(O_(e.deviceId))){let n=`${this.kind}${this.type}Removed`;wm.warn(`${n}: ${JSON.stringify(e)}`),t.emit(n,e)}}))),this.devices=n}hasDevice(e){return!!this.devices.find((t=>t.deviceId===e))}},L_=class extends D_.EventEmitter{constructor(){super(),cu(this,"audioInputs",new P_(ld.AUDIO)),cu(this,"videoInputs",new P_(ld.VIDEO)),cu(this,"audioOutputs",new P_(ld.AUDIO,"Output")),this.init(),navigator.mediaDevices&&(navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",(()=>this.update())),"ondevicechange"in navigator.mediaDevices||kg.run(lh,(()=>{this.update()}),{delay:1e4}))}init(){F_().then((e=>{this.audioInputs.update(e),this.videoInputs.update(e),this.audioOutputs.update(e)}))}update(){return du(this,arguments,(function*(e=0){let t=yield F_(e);return this.audioInputs.update(t,this),this.videoInputs.update(t,this),this.audioOutputs.update(t,this),this}))}},U_=Vu||Uu?null:new L_;function V_(e){return e.deviceId===e.groupId&&""===e.groupId}function F_(){return du(this,arguments,(function*(e=0){if(Vm()||!Lm())return[];let t=yield navigator.mediaDevices.enumerateDevices();if(0!==e){let n={audio:!1,video:!1};if(t.forEach((e=>{V_(e)&&(e.kind===ld.AUDIO_INPUT?n.audio=!0:e.kind===ld.VIDEO_INPUT&&(n.video=!0))})),2===e&&(n.audio=!1),1===e&&(n.video=!1),n.audio||n.video){let e;try{e=yield navigator.mediaDevices.getUserMedia(n)}catch(e){wm.debug("capture before getDevices failed: ",e)}t=yield navigator.mediaDevices.enumerateDevices(),null==e||e.getTracks().forEach((e=>e.stop()))}}return t.map(((e,t)=>{let n={kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label||`${e.kind}_${t}`};return e.deviceId.length>0&&G_.add(`${e.deviceId}_${e.kind}`),e.getCapabilities&&(n.getCapabilities=()=>e.getCapabilities()),n}))}))}function B_(e=!1){return U_.update(e?1:0).then((e=>e.audioInputs.devices))}function H_(e=!1){return U_.update(e?2:0).then((e=>e.videoInputs.devices))}var z_=!1;function j_(e=!1){return du(this,null,(function*(){return U_.update(e?1:0).then((e=>e.audioOutputs.devices))}))}var G_=new Set;function $_(e,t){return du(this,null,(function*(){let n=(yield B_()).find((e=>e.deviceId===Zd));return(null==n?void 0:n.groupId)===e&&n.label===t}))}var W_,q_=class extends w_{constructor(e){super(),this.log=e,cu(this,"volumeMeter"),cu(this,"volumeDestination"),cu(this,"analyser",new A_),this.volumeMeter=new N_({log:this.log}),this.volumeDestination=new x_,this.volumeMeter.pipeTo(this.volumeDestination)}destory(){this.gain.deleteNode(),this.volumeMeter.deleteNode(),this.analyser.deleteNode(),this.source.deleteNode(),this.destination.deleteNode(),this.volumeDestination.deleteNode()}},X_=class extends Qg{constructor(e){super(e,ld.AUDIO),cu(this,"_outputDeviceId"),cu(this,"_volume",1),cu(this,"_destination",T_().createMediaStreamDestination()),cu(this,"pipeline"),cu(this,"volumeMeterMode","worklet"),this.pipeline=new q_(this._log)}getMediaStream(){return this.pipeline.stream||(this.track?new MediaStream([this.track]):null)}initializeElement(){if(("15.2"===Lp||"15.3"===Lp||"15.4"===Lp)&&this.muted)return void this._log.info("audioElement is muted.");let e=W_||new Audio;e.setAttribute("autoplay","autoplay"),e.srcObject=this.getMediaStream(),e.muted=this.muted,this.element=e,e===W_&&(W_=void 0),this.bindElementEvents()}play(){return du(this,null,(function*(){if(this.track)return this.pipeline.source.node||this.pipeline.replaceSource(this.track),this.element||this.initializeElement(),this._outputDeviceId&&(yield this.setSinkId(this._outputDeviceId)),"worklet"===this.volumeMeterMode?this.pipeline.volumeMeter.init():"analyser"===this.volumeMeterMode&&this.pipeline.analyser.setNode(T_().createAnalyser()),this.setVolume(this._volume),function(){du(this,null,(function*(){try{z_||(z_=!0,wm.info(`speakers:${(yield j_()).map((e=>` ${e.deviceId.slice(0,8)}: ${e.label}`))}`))}catch(e){}}))}(),uu(X_.prototype,this,"play").call(this)}))}stop(e=0){this.pipeline.destory(),super.stop(e)}setSinkId(e){return du(this,null,(function*(){var t,n;this._outputDeviceId!==e&&(this._outputDeviceId=e),this.element&&this.element.sinkId!==e&&(yield null==(n=(t=this.element).setSinkId)?void 0:n.call(t,e))}))}get useDestination(){return!!this.pipeline.stream}setLoop(e){!this.element||(this.element.loop=e)}getAudioLevel(){return this.pipeline.volumeMeter.getCalculatedVolume()}getInternalAudioLevel(){return this.pipeline.volumeMeter.getInternalAudioLevel()}},Y_=class extends X_{constructor(e){super(e),this.pipeline.source.pipeTo(this.pipeline.volumeMeter,this.pipeline.destination)}setTrack(e){var t;this.track!==e&&(this.unbindTrackEvents(),this.track=e,this.emit(Ng.MEDIA_TRACK_CHANGED,e),e?(this.bindTrackEvents(),this.pipeline.source.channelCount=(null==(t=e.getSettings())?void 0:t.channelCount)||1,this.pipeline.replaceSource(e),!this.useDestination&&this.element&&(this.element.srcObject=new MediaStream([e]))):this.pipeline.source.deleteNode())}setSourceNode(e){!e||this.pipeline.source.node===e||(this.pipeline.replaceSource(e),e instanceof MediaStreamAudioSourceNode?this.pipeline.destination.setNode(this._destination):this.pipeline.destination.deleteNode(),this.element&&(this.element.srcObject=this.getMediaStream(),this.element.play().catch((()=>{})),this.setVolume(this._volume)))}setVolume(e){this._volume=e,this.element&&(this.element.volume=e)}},J_=class extends X_{constructor(e){super(e),cu(this,"_sourceElement"),this.pipeline.source.pipeTo(this.pipeline.gain.pipeTo(this.pipeline.volumeMeter,this.pipeline.destination))}write(e){this.pipeline.volumeMeter.write(e)}setTrack(e){var t,n,i;(null==(n=null==(t=this.element)?void 0:t.error)?void 0:n.code)!==MediaError.MEDIA_ERR_DECODE&&this.track!==e&&(this.unbindTrackEvents(),this.track=e,this.emit(Ng.MEDIA_TRACK_CHANGED,e),e?(this.bindTrackEvents(),this._sourceElement?this._sourceElement.srcObject=new MediaStream([e]):!this.useDestination&&this.element&&(this.element.srcObject=new MediaStream([e])),this.pipeline.source.channelCount=(null==(i=e.getSettings())?void 0:i.channelCount)||1,this.pipeline.replaceSource(e)):this.pipeline.source.deleteNode())}setVolume(e){this._volume=e,this.useDestination?(this.pipeline.setVolume(e),this._log.info(`set pipeline volume: ${e}`)):e<=1?(this.element?this._log.info(`set element volume: ${e}`):this._log.info("set element volume: no element"),this.element&&(this.element.volume=e)):(this._log.info(`start set pipeline volume: ${e}`),this.pipeline.setVolume(e),this.element&&!this._sourceElement&&(this.pipeline.destination.setNode(this._destination),Lg(this.element),this._sourceElement=this.element,this._sourceElement.muted=!0,this.element=null,this.play()))}stop(e=0){this.pipeline.destory();let t=this._sourceElement||this.element;t&&Dp&&(W_=t),this._sourceElement&&(this._sourceElement.srcObject=null,delete this._sourceElement),super.stop(e)}},K_=class extends wg{constructor({userId:e,sdkAppId:t,mediaType:n,room:i,PlayerClass:r=(1===n?J_:y_)}){var o;super(),cu(this,"id",Im()),cu(this,"userId",""),cu(this,"isRemote"),cu(this,"mediaType"),cu(this,"room"),cu(this,"user"),cu(this,"_log"),cu(this,"_inputTrack"),cu(this,"_outputTrack"),cu(this,"isPlayCalled"),cu(this,"container",null),cu(this,"player"),cu(this,"subVideoPlayerMap"),cu(this,"muted",!1),cu(this,"abortCtrl"),cu(this,"objectFit","cover"),cu(this,"mirror"),cu(this,"isScreen",!1),cu(this,"manager"),cu(this,"trackSettings"),cu(this,"onPlayerError"),this.userId=e||"",this.mediaType=n,this._log=wm.createLogger({id:`${this.kind[0]}t`,userId:null==(o=i||this.room)?void 0:o.userId,remoteUserId:this instanceof vv?void 0:this.userId,sdkAppId:t,type:2===this.mediaType?"auxiliary":"main",isLocal:this instanceof vv}),this.player=new r({id:this.userId||this.id,track:null,muted:!1,container:null,log:this._log}),this.player.on(Ng.PLAYER_STATE_CHANGED,(e=>{af.emit(xm.PLAYER_STATE_CHANGED,iu({track:this},e)),this.emit("player-state-changed",e)})),this.kind===ld.VIDEO&&(this.player.on(Ng.LOADED_DATA,(()=>{af.emit(xm.VIDEO_LOADED_DATA,{track:this})})),this.player.on(Ng.MEDIA_TRACK_CHANGED,(e=>{var t;null==(t=this.subVideoPlayerMap)||t.forEach((t=>t.setTrack(e)))}))),this.onTrackMuted=this.onTrackMuted.bind(this),this.onTrackUnmuted=this.onTrackUnmuted.bind(this),this.onTrackEnded=this.onTrackEnded.bind(this),this.onPlayerError&&this.player.on(Ng.ERROR,this.onPlayerError.bind(this))}get log(){return this._log||wm}get kind(){return 1===this.mediaType?ld.AUDIO:ld.VIDEO}get strMediaType(){return 4===this.mediaType?ld.VIDEO:2===this.mediaType?ld.SCREEN:ld.AUDIO}get streamType(){return 0==(2&this.mediaType)?"main":"auxiliary"}play(e,t){return du(this,null,(function*(){let n=Gf(e)?e[0]:e;if(this.isPlayCalled)return this.log.info(`play update options: ${JSON.stringify(t)}`),t&&!Ff(t.muted)&&this.setPlayerMute(t.muted),t&&!Ff(t.objectFit)&&(this.objectFit=t.objectFit),void(this.player instanceof y_&&(this.player.setObjectFit(this.objectFit),this.container!==n&&n&&(this.container=n,this.player.setContainer(n)),Gf(e)&&e.length>=1&&(yield this.playSubContainer(e.slice(1),t))));if(t&&!Ff(t.muted)?this.setPlayerMute(t.muted):(!this.isRemote||this.kind===ld.VIDEO)&&this.setPlayerMute(!0),t&&!Ff(t.objectFit)&&(this.objectFit=t.objectFit),this.player instanceof y_&&this.player.setObjectFit(this.objectFit),this.isPlayCalled=!0,n&&(this.container=n,this.player instanceof y_&&this.player.setContainer(n)),af.emit(xm.PLAY_TRACK_START,{track:this}),this._outputTrack){this._log.info(`play with options: ${JSON.stringify(t)}`);try{this.player.setTrack(this.playerMediaTrack),yield this.player.play(),Gf(e)&&e.length>1&&(yield this.playSubContainer(e.slice(1),t))}catch(e){throw this.handleAutoPlayFailed(),this.emit("error",e),e}}else this.log.info("play has not mediaTrack, abort")}))}setMirror(e,t){if(this.isScreen||this.kind!==ld.VIDEO||Ff(e)||e===this.mirror)return;this.mirror=e;let n=this.player;t&&(n=t);let i=this.manager;if(zf(this.mirror))return n.setViewMirror(this.mirror),void(i&&(i.mirror=!1));switch(this.mirror){case"view":i&&(i.mirror=!1),n.setViewMirror(!0);break;case"publish":i&&(i.mirror=!0),n.setViewMirror(!0);break;case"both":i&&(i.mirror=!0),n.setViewMirror(!1)}}playSubContainer(e,t){return du(this,null,(function*(){if(!this._outputTrack||this.kind===ld.AUDIO)return;this.subVideoPlayerMap||(this.subVideoPlayerMap=new Map),this.subVideoPlayerMap.forEach(((t,n)=>{var i;e.find((e=>n===e))||(t.stop(),null==(i=this.subVideoPlayerMap)||i.delete(n))}));for(let[n,i]of e.entries()){let e=this.subVideoPlayerMap.get(i);e?t&&(Ff(t.objectFit)||e.setObjectFit(t.objectFit)):this.subVideoPlayerMap.set(i,new y_({id:this.userId||this.id,track:this.playerMediaTrack,container:i,muted:this.player.muted,objectFit:this.objectFit,log:this.log.createChild({id:`vp-sub${n+1}`})}))}let n=[...this.subVideoPlayerMap.values()];for(let e of n)e.setViewMirror(this.player.mirror),yield e.play()}))}setAudioOutput(e){return this.player.setSinkId(e)}setAudioVolume(e){this.player.setVolume(e)}getAudioLevel(){return this.player.getAudioLevel()||0}getInternalAudioLevel(){var e;return(null==(e=this.player)?void 0:e.getInternalAudioLevel())||0}stop(){!this.isPlayCalled||(this.isPlayCalled=!1,this.player&&(this.log.info(`stop ${this.kind} player`),this.player.stop(Wf(this)?this.jitterBufferDelay:0)),this.subVideoPlayerMap&&this.subVideoPlayerMap.size>0&&this.subVideoPlayerMap.forEach((e=>{e.stop()})),this.container=null)}resume(){return du(this,null,(function*(){var e;!this.isPlayCalled||(yield null==(e=this.player)?void 0:e.resume())}))}close(){this.log.info("close"),this.isPlayCalled&&this.stop()}setMute(e){this.muted=e,this._inputTrack&&(this._inputTrack.enabled=!e),this._outputTrack&&(this._outputTrack.enabled=!e),this.emit(e?"mute":"unmute",this),af.emit(e?xm.TRACK_MUTED:xm.TRACK_UNMUTED,{track:this})}setPlayerMute(e){this.player.setMuted(e)}get mediaTrack(){return this._inputTrack||null}get outMediaTrack(){return this._outputTrack||null}get playerMediaTrack(){return this.outMediaTrack}installTrackEvent(e){Pg(e,e).add(ld.MUTE,this.onTrackMuted).add(ld.UNMUTE,this.onTrackUnmuted).add(ld.ENDED,this.onTrackEnded),e.muted&&this.onTrackMuted(),e.readyState===ld.ENDED&&this.onTrackEnded()}uninstallTrackEvent(e){Lg(e)}setInputMediaStreamTrack(e){var t;let n=this._inputTrack;if(e!==n)return this._inputTrack=e,this.trackSettings=null==(t=e.getSettings)?void 0:t.call(e),e.enabled=!this.muted,n&&this.uninstallTrackEvent(n),this.installTrackEvent(e),this.emit("input-media-track-changed",e||null,n||null),this.manager?this.manager.changeInput(this):this.setOutputMediaStreamTrack(e)}setOutputMediaStreamTrack(e){var t;e!==this._outputTrack&&(this.isRemote?this.log.debug("setOutputMediaStreamTrack",e.label):this.log.info("setOutputMediaStreamTrack",null==(t=e.getSettings)?void 0:t.call(e).deviceId,e.label),this._outputTrack=e,this.updatePlayingState(!!e),this.emit("output-media-track-changed",e))}setMediaType(e){this.mediaType=e}updatePlayingState(e){if(this.isPlayCalled)if(e){if(this.player.setTrack(this.playerMediaTrack),this.player.isStopped)return this.player.play().catch((()=>this.handleAutoPlayFailed())),void this.log.info(`playing state updated, play ${this.kind}`)}else if(!this.player.isStopped)return this.player.stop(Wf(this)?this.jitterBufferDelay:0),void this.log.info(`playing state updated, stop ${this.kind}`);this.log.debug(`updatePlayingState abort ${this.isPlayCalled} ${e} ${this.player.isStopped}`)}handleAutoPlayFailed(){if(this.room&&this.room.enableAutoPlayDialog)new class{constructor(){if(cu(this,"content",""),cu(this,"_dialogNode",null),cu(this,"_bodyPosition",""),cu(this,"_showDetail",!1),cu(this,"_isCollapseClicked",!1),cu(this,"_isQuestionClicked",!1),Df()||(this.content='Media playback failed. Click the "Resume" to resume playback.'),!f_){let e=document.createElement("style");e.innerHTML=`.${e_}{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.5);z-index:1500;}.${e_} div:not(.${r_}){display:block !important;}.${t_}{padding:14px;background:#fff;border-radius:3px;box-shadow:0px 3px 15px #434343;border:1px solid #d1cfcf;max-width:500px;}.${t_} a{color:${c_};}.${n_}{overflow:hidden;text-overflow:ellipsis;font-size:16px;font-weight:600;}.${i_}{margin:8px 0;}.${r_}{width:100%;display:flex !important;align-items:center;justify-content:right;float:right;}.${a_}{margin-right:auto;cursor:pointer}.${o_}{height:100%;line-height:16px;cursor:pointer;}.${s_}{margin-left:8px;color:#fff;background:${c_};padding:4px 12px;outline:none;border:1px solid;border-radius:3px;font-weight:bold;}.${s_}:hover{opacity:0.9;}.${a_},.${s_},.${i_},.${o_}{font-size:14px;}@media screen and (max-width:750px){.${t_}{width:80vw;}}`,document.head.appendChild(e),f_=!0}this.addDiaLog()}createDiaLog(){let e=document.createElement("template");e.innerHTML=`<div class="${e_}"><div class='${t_}'><div class='${n_}'>${location.host}</div><div class='${i_}'>${this.content}</div><div class='${l_}' style="visibility:hidden;width:100%;height:0;font-size:12px;color:gray;">${v_}</div><div class='${r_}'></div></div></div>`.trim();let t=document.createElement("button");t.className=s_,t.innerText=Df()?"":"Resume",t.onclick=this.onConfirm.bind(this);let n=document.createElement("div");n.className=o_,n.innerHTML='<?xml version="1.0" encoding="UTF-8"?>\n    <svg class="icon" width="18" height="18" p-id="2030" t="1639646523624" version="1.1" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n    <path d="m464 784.35c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z" p-id="2031"/>\n    <path d="m512 960c-247.04 0-448-200.96-448-448s200.96-448 448-448 448 200.96 448 448-200.96 448-448 448zm0-831.71c-211.58 0-383.71 172.13-383.71 383.71 0 211.55 172.13 383.71 383.71 383.71 211.55 0 383.71-172.16 383.71-383.71 0-211.58-172.16-383.71-383.71-383.71z" p-id="2032"/>\n    <path d="m512 673.7c-17.665 0-32.001-14.336-32.001-31.999v-54.112c0-52.353 40-92.352 75.328-127.65 25.887-25.92 52.672-52.672 52.672-74.017 0-53.343-43.072-96.735-95.999-96.735-53.823 0-95.999 41.536-95.999 94.559 0 17.665-14.336 31.999-32.001 31.999s-32.001-14.336-32.001-31.999c0-87.424 71.775-158.56 160-158.56s160 72.095 160 160.74c0 47.904-36.32 84.192-71.424 119.3-27.84 27.776-56.576 56.512-56.576 82.336v54.112c0 17.665-14.336 32.032-32.001 32.032z" p-id="2033"/>\n    </svg>\n    ',n.onclick=this.onQuestionClick.bind(this);let i=document.createElement("div");i.className=a_,i.innerText=Df()?" >":"Detail >",i.onclick=this.onCollapseClick.bind(this);let r=e.content.firstChild,o=r.querySelector(`.${r_}`);return o.appendChild(i),o.appendChild(n),o.appendChild(t),r}addDiaLog(){m_()||(this._dialogNode=this.createDiaLog(),document.body.appendChild(this._dialogNode),this._dialogNode.onclick=this.onConfirm.bind(this),this._dialogNode.querySelector(`.${t_}`).onclick=e=>e.stopPropagation(),this._bodyPosition=document.body.style.position,document.body.style.position="fixed",wm.info("show autoplay dialog"),lf.uploadEvent({log:d_}))}deleteDiaLog(){this._dialogNode&&(document.body.removeChild(this._dialogNode),document.body.style.position=this._bodyPosition,this._dialogNode=null)}onConfirm(){wm.warn("confirm clicked, try resume stream"),af.emit(xm.AUTOPLAY_DIALOG_CLICK_CONFIRM),this.deleteDiaLog()}onCollapseClick(){let e=this._dialogNode.querySelector(`.${l_}`);e.style.visibility=this._showDetail?"hidden":"visible",e.style.height=`${this._showDetail?0:"fit-content"}`,this._showDetail=!this._showDetail,this._isCollapseClicked||lf.uploadEvent({log:h_}),this._isCollapseClicked=!0}onQuestionClick(){window.open(g_,"_blank"),this._isQuestionClicked||lf.uploadEvent({log:p_}),this._isQuestionClicked=!0}};else{let e=()=>{this.resume().then((()=>{document.removeEventListener("click",e,!0)}))};document.addEventListener("click",e,!0)}}getVideoFrame(){return this.player instanceof y_?this.player.getVideoFrame():""}onTrackMuted(){this._log.warn(`${this.kind} track is unable to provide media output`)}onTrackUnmuted(){this._log.info(`${this.kind} track is able to provide media output`)}onTrackEnded(){this._log.warn(`${this.kind} track ended`)}};lu([Tg([],wg.INIT,{sync:!0})],K_.prototype,"close",1);var Q_=Object.prototype.hasOwnProperty,{toString:Z_}=Object.prototype,ev=function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e||"function"==typeof e||Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(Of(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(let t in e)if(Q_.call(e,t))return!1;return!0}return!1},tv=of({retryFunction:function(e){return du(this,null,(function*(){let t=function(e){return{audio:iv(e),video:rv(e)}}(e);wm.info(`getUserMedia with constraints: ${JSON.stringify(t)}`);let n=[],i=[],r=["label","deviceId"];t.audio&&(n=yield B_(),wm.info(`microphones: ${pm(n,{keysToInclude:r})}`)),t.video&&(i=yield H_(),wm.info(`cameras: ${pm(i,{keysToInclude:r})}`));try{let e=yield navigator.mediaDevices.getUserMedia(t);return cg&&e.getTracks().forEach((e=>{wm.info(`${e.kind} capabilities: ${pm(e.getCapabilities(),{keysToInclude:uh})}`)})),e}catch(t){let{message:r}=t;throw"NotFoundError"===t.name&&(e.video&&i&&0===i.length&&(r=nf({key:fh.CAMERA_NOT_FOUND})),e.audio&&n&&0===n.length&&(r=nf({key:fh.MICROPHONE_NOT_FOUND}))),new Au({code:Tu.INITIALIZE_FAILED,name:t.name,message:r,constraint:t.constraint})}}))},settings:{retries:3,timeout:500},onError:({error:e,retry:t,reject:n,retryFuncArgs:i,retriedCount:r})=>{let o=r+1;"NotReadableError"===e.name||"OverconstrainedError"===e.name?(1===o?i[0].video&&(i[0].maxResolution=!1,(!Np||i[0].width*i[0].height<=2073600)&&i[0].frameRate&&(i[0].frameRate=i[0].frameRate>10?10:5)):2===o?i[0].useDeviceIdOnly=!0:3===o&&!i[0].useExactDeviceId&&(i[0].useTrueAsConstraint=!0),t()):n(e),i[0].microphoneId&&nv(i[0].microphoneId,!1),i[0].cameraId&&nv(i[0].cameraId,!0)},onRetrying:e=>{wm.warn(`getUserMedia NotReadableError observed, retrying [${e}/3]`)},onRetryFailed:e=>{lf.logFailedEvent({eventType:Ld.GET_USER_MEDIA_RETRY,error:e})},onRetrySuccess:e=>{lf.logSuccessEvent({eventType:Ld.GET_USER_MEDIA_RETRY}),lf.uploadEvent({log:`stat-${Ld.GET_USER_MEDIA_RETRY}-success-${e}`})}});function nv(e,t){return du(this,null,(function*(){let n=(t?yield H_():yield B_()).find((t=>t.deviceId===e));n&&Vf(n.getCapabilities)&&wm.warn(pm(n.getCapabilities(),{keysToInclude:uh}))}))}function iv(e){if(!e.audio)return!1;if(e.useTrueAsConstraint)return!0;let t={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:e.sampleRate};return!ev(e.microphoneId)&&(t.deviceId=e.useExactDeviceId?{exact:e.microphoneId}:e.microphoneId,e.useDeviceIdOnly)?t:(Hf(e.channelCount)&&(t.channelCount=e.channelCount),zf(e.echoCancellation)&&!e.echoCancellation&&(t.echoCancellation=!1),zf(e.noiseSuppression)&&!e.noiseSuppression&&(t.noiseSuppression=!1),zf(e.autoGainControl)&&!e.autoGainControl&&(t.autoGainControl=!1),!!ev(t)||t)}function rv(e){if(!e.video)return!1;if(e.useTrueAsConstraint)return!0;let{maxResolution:t=!0}=e,n={};return e.cameraId?n.deviceId=e.useExactDeviceId?{exact:e.cameraId}:e.cameraId:e.facingMode&&(n.facingMode=e.facingMode),e.useDeviceIdOnly&&!ev(n)?n:(e.width&&(n.width={ideal:e.width},t&&!Nh&&(n.width.max=e.width)),e.height&&(n.height={ideal:e.height},t&&!Nh&&(n.height.max=e.height)),Nh&&cp&&e.width&&e.height&&e.width*e.height<101376&&(n.width=e.width,n.height=e.height),e.frameRate&&(n.frameRate=e.frameRate),!!ev(n)||n)}var ov=tv;function av(e){return lv(((t,n)=>function(...n){return du(this,null,(function*(){return yield e.apply(this,n),t.apply(this,n)}))}))}function sv(e){return lv(((t,n)=>function(...n){return du(this,null,(function*(){let i=yield t.apply(this,n);return yield e.call(this,...n),i}))}))}function lv(e){return function(t,n,i){return i.value=e(i.value,n),i}}var cv=(()=>{let e=!1,t=document.visibilityState;return()=>{document.visibilityState!==t&&wm.info(`visibility change: ${document.visibilityState}`),!e&&(document.addEventListener("visibilitychange",(()=>{wm.info(`visibility change: ${document.visibilityState}`),t=document.visibilityState})),e=!0)}})(),uv=0,dv=class{constructor(){this.log=wm.createLogger({id:"fq"+ ++uv}),this.isRunning=!1,this.queue=[]}get length(){return this.queue.length}get lastQueueItem(){return 0===this.length?null:this.queue[this.length-1]}push(e,t=!1){var n,i;let r=iu({},e),o=new Promise(((e,t)=>{r.resolve=e,r.reject=t}));return r.promise=o,t?this.length<=1?this.queue.push(r):null==(i=null==(n=this.lastQueueItem)?void 0:n.promise)||i.then(r.resolve,r.reject):this.queue.push(r),this.log.debug(`push ${this.length}`),this.isRunning||this.callNext(),o}shift(){let e=this.queue.shift();return this.log.debug(`shift ${this.length}`),e}callNext(){if(this.isRunning||0===this.length)return;this.log.debug("callNext ",this.length);let{fn:e,args:t,context:n,resolve:i,reject:r}=this.queue[0];this.isRunning=!0,e.apply(n,t).then(i,r).finally((()=>{this.isRunning=!1,this.shift(),this.callNext()}))}},hv=new WeakMap,pv=new WeakMap;function fv(e=!1){return function(t,n,i){let r=i.value;return i.value=function(...t){let n=hv.get(this)||new dv;return hv.set(this,n),n.push({fn:r,args:t,context:this},e)},i}}function mv(e){return function(t,n,i){let r=i.value;return i.value=function(...t){var n,i,o;let a=[];return null==(i=null==(n=hv.get(this))?void 0:n.queue)||i.forEach((e=>a.push(e))),null==(o=pv.get(this))||o.forEach((e=>null==e?void 0:e.queue.forEach((e=>a.push(e))))),a.forEach((t=>{t.reject(new Au({code:Tu.API_CALL_ABORTED,message:e}))})),hv.delete(this),pv.delete(this),r.apply(this,t)},i}}function gv(e){return function(t,n,i){let r=i.value,o=t=>e(...t);return i.value=function(...e){let t=pv.get(this)||new Map,n=t.get(o(e))||new dv;return t.set(o(e),n),pv.set(this,t),n.push({fn:r,args:e,context:this})},i}}var _v=class extends K_{constructor(e,t){super({mediaType:e,PlayerClass:t}),cu(this,"isRemote",!1),cu(this,"deviceId"),cu(this,"groupId",""),cu(this,"label",""),cu(this,"_isRecapturing",!1),cu(this,"_lastRecaptureTime",0),cu(this,"_onMuteTimeoutId",-1),cu(this,"profile")}get enableEncodeFrame(){return!1}get isPublished(){return"publish"===this.state}encodeFrame(e,t){throw new Error("Method not implemented.")}installTrackEvent(e){Pg(e,e).add(ld.MUTE,this.onTrackMuted).add(ld.UNMUTE,this.onTrackUnmuted).add(ld.ENDED,this.onTrackEnded),e.muted&&this.onTrackMuted(),e.readyState===ld.ENDED&&this.onTrackEnded()}uninstallTrackEvent(e){Lg(e)}setStateToCapture(){}capture(e){return du(this,null,(function*(){var t;try{let n,i=Qf();af.emit(xm.LOCAL_TRACK_CAPTURE_START,{track:this}),e.customSource?(n=new MediaStream,n.addTrack(e.customSource)):(null==(t=this.mediaTrack)||t.stop(),n=yield ov(e));let r=n.getTracks()[0];return yield this.setInputMediaStreamTrack(r),e.customSource||(this.updateDeviceIdInUse(),this.listenDeviceChange()),af.emit(xm.LOCAL_TRACK_CAPTURE_SUCCESS,{track:this,cost:Qf()-i}),n}catch(e){throw af.emit(xm.LOCAL_TRACK_CAPTURE_FAILED,{track:this,error:e}),this.log.error(`getUserMedia error observed ${e}`),e}}))}setInputMediaStreamTrack(e){return this.state===wg.INIT&&this.setStateToCapture(),super.setInputMediaStreamTrack(e)}setOutputMediaStreamTrack(e){var t;return super.setOutputMediaStreamTrack(e),null==(t=this.room)?void 0:t.replaceTrack(this)}publish(e,t){return this.room=e,this.emit("4",{mediaType:this.strMediaType,state:"starting",prevState:"stopped"}),this.userId=e.userId,this._log.setUserId(e.userId),this._log.setSdkAppId(e.sdkAppId),t}unpublish(){this.room&&this.room.localTracks.delete(this),af.emit(xm.LOCAL_TRACK_UNPUBLISHED,{track:this})}updateDeviceIdInUse(){return du(this,null,(function*(){if(this.mediaTrack&&lg){let{deviceId:e,groupId:t}=this.mediaTrack.getSettings(),{label:n}=this.mediaTrack;(yield function(e){return du(this,arguments,(function*({newDeviceId:e,oldDeviceId:t,oldGroupId:n,oldLabel:i,kind:r}){return e===t&&(r!==ld.AUDIO||e!==Zd||(yield $_(n,i)))}))}({newDeviceId:e,oldDeviceId:this.deviceId,oldGroupId:this.groupId,oldLabel:this.label,kind:this.kind}))||(this.deviceId=e,this.label=n,t&&(this.groupId=t),F_().then((t=>{let n=t.find((t=>t.deviceId===e));n&&this.emit("2",n)})))}}))}setProfile(e){this.log.info("setProfile",e),Object.assign(this.profile,e)}isNeedToRecapture(e=!1){return!(!this.deviceId||!this.mediaTrack||this.kind===ld.AUDIO&&!function(e){if(e instanceof CanvasCaptureMediaStreamTrack||!(e instanceof MediaStreamTrack))return!1;let t=e.label.toLocaleLowerCase();if(t.includes("mic")||t.includes(""))return!0;let n=`${((null==e?void 0:e.getSettings())||{}).deviceId}_${ld.AUDIO_INPUT}`;return!!G_.has(n)}(this.mediaTrack)||this.kind===ld.VIDEO&&!function(e){if(e instanceof CanvasCaptureMediaStreamTrack||!(e instanceof MediaStreamTrack))return!1;let t=e.label.toLocaleLowerCase();if(t.includes("camera")||t.includes("webcam"))return!0;let n=`${((null==e?void 0:e.getSettings())||{}).deviceId}_${ld.VIDEO_INPUT}`;return!!G_.has(n)}(this.mediaTrack)||this._isRecapturing||e&&cp&&Np)}onTrackMuted(){if(super.onTrackMuted(),cv(),this.isNeedToRecapture(!0)){if(Date.now()-this._lastRecaptureTime<oh)return void setTimeout((()=>this.onTrackMuted()),oh);this._onMuteTimeoutId=setTimeout((()=>du(this,null,(function*(){var e;if(null!=(e=this.mediaTrack)&&e.muted){if((Ih||Rh)&&"visible"!==document.visibilityState)return;this.recapture(yield this.getRecoverCaptureDeviceId())}}))),5e3)}}onTrackUnmuted(){super.onTrackUnmuted(),this._onMuteTimeoutId>0&&clearTimeout(this._onMuteTimeoutId)}onTrackEnded(){return du(this,null,(function*(){if(uu(_v.prototype,this,"onTrackEnded").call(this),this.isNeedToRecapture()){if(Date.now()-this._lastRecaptureTime<oh)return void setTimeout((()=>this.onTrackEnded()),oh);this.recapture(yield this.getRecoverCaptureDeviceId())}}))}recapture(e){return du(this,null,(function*(){var t;if(this._isRecapturing||!this._inputTrack)return;this.log.warn("recapture trying"),null==(t=this._inputTrack)||t.stop(),this._isRecapturing=!0,this._lastRecaptureTime=Date.now();let n={useExactDeviceId:!0};if("user"===e||"environment"===e)n.facingMode=e;else{let t;("audio"===this.kind?yield B_():yield H_()).find((t=>t.deviceId===e))&&(t=e),n.deviceId=t}return this.capture(n).then((()=>{this._isRecapturing=!1,this.log.warn("recapture success"),this.emit("1",{deviceId:this.deviceId}),af.emit(xm.LOCAL_TRACK_RECAPTURE,{track:this})})).catch((e=>{this._isRecapturing=!1,this.log.warn(`recapture failed ${e.message}`),this.emit("5",e),af.emit(xm.LOCAL_TRACK_RECAPTURE,{track:this,error:e})}))}))}getRecoverCaptureDeviceId(){return du(this,null,(function*(){let e=this instanceof Sv;if(e&&this.facingMode)return this.facingMode;let{deviceId:t}=this;if(t){let n=(yv.get(t)||0)+1;if(yv.set(t,n),n>=3){let i=e?(yield H_()).find((e=>!yv.has(e.deviceId))):(yield B_()).find((e=>!yv.has(e.deviceId)));i&&(this.log.warn(`${t} capture fail ${n} times, change new ${i.deviceId}`),t=i.deviceId)}}return t}))}close(){var e;super.close(),this._inputTrack&&(this._inputTrack.stop(),this.uninstallTrackEvent(this._inputTrack)),null==(e=this.manager)||e.removeInput(this)}},vv=_v;lu([Tg(wg.INIT,"capture",{ignoreError:!0,sync:!0})],vv.prototype,"setStateToCapture",1),lu([fv()],vv.prototype,"capture",1),lu([Tg("capture","publish",{ignoreError:!0,success(){this.room.localTracks.add(this),af.emit(xm.LOCAL_TRACK_PUBLISHED,{track:this}),this.emit("4",{mediaType:this.strMediaType,state:"started",prevState:"starting"})},fail(e){let t="error",n=e.cause;n.message.includes("timeout")?t="timeout":n.code===Tu.API_CALL_ABORTED&&(t="api-call"),this.emit("4",{mediaType:this.strMediaType,state:"stopped",prevState:"starting",reason:t,error:n})}})],vv.prototype,"publish",1),lu([lv((e=>function(){return du(this,null,(function*(){let t="publish"===this.state?"started":"starting";e.call(this),this.emit("4",{mediaType:this.strMediaType,state:"stopped",prevState:t,reason:"api-call"})}))})),Tg([],"capture",{sync:!0})],vv.prototype,"unpublish",1);var yv=new Map;af.on(xm.SWITCH_DEVICE_SUCCESS,(e=>{e.track.deviceId&&yv.delete(e.track.deviceId)}));var Ev=class extends vv{constructor(e){super(1,Y_),cu(this,"mediaType",1),cu(this,"volume",0),cu(this,"profile",{echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,sampleRate:48e3,channelCount:1,bitrate:40}),cu(this,"playerMuted",!0),cu(this,"pipeline"),this.manager=e,this.pipeline=new I_(e),this.handleMicrophoneAdded=this.handleMicrophoneAdded.bind(this),this.handleMicrophoneRemoved=this.handleMicrophoneRemoved.bind(this)}getAudioLevel(){let e=(this.volume||super.getAudioLevel())*this.captureVolume;return e>1?1:e}get playerMediaTrack(){return this.mediaTrack}setInputMediaStreamTrack(e){return du(this,null,(function*(){yield uu(Ev.prototype,this,"setInputMediaStreamTrack").call(this,e);let t=this.trackSettings||{};Kg.addEnum({key:501701,value:t.channelCount||0,useUV:!1}),Kg.addEnum({key:501702,value:t.sampleRate||0,useUV:!1}),Kg.addEnum({key:502700,value:0});let{sampleRate:n,channelCount:i}=t;this._log.info(`local audio track input ${JSON.stringify({sampleRate:n,channelCount:i})}`),this.pipeline.source.channelCount=i||1,this.pipeline.replaceSource(e),this.updatePlayingState(!!e)}))}capture({deviceId:e,customSource:t,useExactDeviceId:n=!1}){return super.capture({video:!1,audio:!0,microphoneId:e,echoCancellation:this.profile.echoCancellation,autoGainControl:this.profile.autoGainControl,noiseSuppression:this.profile.noiseSuppression,sampleRate:this.profile.sampleRate,channelCount:this.profile.channelCount,useExactDeviceId:n,customSource:t})}switchDevice(e){return du(this,null,(function*(){if(this.mediaTrack){if(this.deviceId===e){if(e!==Zd)return;if(yield $_(this.groupId,this.label))return}try{this.log.info(`switchDevice audio to: ${e}`),this.mediaTrack&&this.mediaTrack.stop(),yield this.capture({deviceId:e,useExactDeviceId:!0}),this.room&&(yield this.room.replaceTrack(this)),af.emit(xm.SWITCH_DEVICE_SUCCESS,{track:this}),this.log.info("switch microphone success")}catch(e){throw this.log.error(`switch microphone failed ${e}`),this.deviceId&&this.recapture(this.deviceId),e}}}))}listenDeviceChange(){U_&&!U_.listeners("audioInputRemoved").includes(this.handleMicrophoneRemoved)&&U_.on("audioInputRemoved",this.handleMicrophoneRemoved,this)}handleMicrophoneRemoved(e){return du(this,null,(function*(){if(e.deviceId===this.deviceId){this.log.warn(`current microphone is lost: ${JSON.stringify(e)}`),Ay(this.userId,{eventId:2003,param1:6,streamType:1});let t=yield B_();t[0]?this.recapture(t[0].deviceId):U_.on("audioInputAdded",this.handleMicrophoneAdded,this)}}))}handleMicrophoneAdded(e){this.log.warn(`microphone added: ${JSON.stringify(e)}`),this.recapture(e.deviceId)}update3A(e){return du(this,arguments,(function*({echoCancellation:e,noiseSuppression:t,autoGainControl:n}){let i=!1;!Ff(e)&&e!==this.profile.echoCancellation&&(this.profile.echoCancellation=e,i=!0),!Ff(t)&&t!==this.profile.noiseSuppression&&(this.profile.noiseSuppression=t,i=!0),!Ff(n)&&n!==this.profile.autoGainControl&&(this.profile.autoGainControl=n,i=!0),i&&this.deviceId&&(yield this.recapture(this.deviceId))}))}get captureVolume(){return this.pipeline.volume}setCaptureVolume(e){this.pipeline.setVolume(e/100),this.pipeline.gain.node&&Kg.addEnum({key:502700,value:2}),this.resetPlayerSource()}enableTrackANS(e){if(!this._inputTrack)return;let t=this._inputTrack.getConstraints();return t.noiseSuppression=e,this._inputTrack.applyConstraints(t).catch((t=>this._log.warn((e?"enable":"disable")+" ANS failed ",t)))}addDenoiser(e){var t;Mp<=92&&48e3!==(null==(t=this.trackSettings)?void 0:t.sampleRate)?this._log.warn("denoiser only support sampleRate 48000 before chrome 93"):(Kg.addEnum({key:502700,value:1}),this.pipeline.denoiser.setNode(e),this.resetPlayerSource(),this.enableTrackANS(!1))}removeDenoiser(e){this.pipeline.denoiser.node===e&&(this.pipeline.denoiser.deleteNode(),this.resetPlayerSource(),this.enableTrackANS(!0))}resetPlayerSource(){this.player.setSourceNode(this.pipeline.gain.node||this.pipeline.denoiser.node||this.pipeline.source.node)}close(){this.pipeline.remove(),U_.off("audioInputAdded",this.handleMicrophoneAdded,this),U_.off("audioInputRemoved",this.handleMicrophoneRemoved,this),super.close()}recapture(e){return du(this,null,(function*(){try{yield uu(Ev.prototype,this,"recapture").call(this,e)}catch(t){let n=(yield B_()).find((t=>t.deviceId!==e));if(!n)throw t;yield uu(Ev.prototype,this,"recapture").call(this,n.deviceId)}}))}},bv=class{constructor(e,t=!1){this.dataView=e,this.isSEI&&(t?this.addPreventionByte():this.removePreventionByte())}addPreventionByte(){let e=this.seiPayloadStartIndex,t=this.dataView.byteLength-2,n=[],i=0;for(let r=e;r<=t;r++){let e=this.dataView.getInt8(r);switch(e){case 0:case 1:case 2:case 3:2===i&&(n.push(3),i=0),0==e?i++:i=0,n.push(e);break;default:i=0,n.push(e)}}n.push(this.dataView.getInt8(this.dataView.byteLength-1));let r=new DataView(new Uint8Array([...new Uint8Array(this.dataView.buffer).slice(0,e),...n]).buffer);this.dataView=r}removePreventionByte(){let e=this.seiPayloadStartIndex,t=this.dataView.byteLength-1,n=[],i=0;for(let r=e;r<=t;r++)switch(this.dataView.getInt8(r)){case 0:i++,n.push(this.dataView.getInt8(r));break;case 3:2!==i&&n.push(this.dataView.getInt8(r)),i=0;break;default:n.push(this.dataView.getInt8(r)),i=0}let r=new DataView(new Uint8Array([...new Uint8Array(this.dataView.buffer).slice(0,e),...n]).buffer);this.dataView=r}get isSEI(){return 6===this.dataView.getUint8(4)}get seiPayloadStartIndex(){let e=6;for(let t=6;t<this.dataView.buffer.byteLength&&(e++,255===this.dataView.getUint8(t));t++);return e}get seiPayloadType(){return this.isSEI?this.dataView.getUint8(5):null}get seiPayload(){if(!this.isSEI)return null;let e=0,t=6;for(let n=6;n<this.dataView.buffer.byteLength;n++){let i=this.dataView.getUint8(n);if(t++,255!==i){e+=i;break}e+=255}let n=new ArrayBuffer(e),i=new DataView(n);for(let e=0;e<n.byteLength;e++,t++)i.setInt8(e,this.dataView.getInt8(t));return i}},Sv=class extends vv{constructor(e,t=4){super(t,y_),cu(this,"profile",{width:640,height:480,frameRate:15,bitrate:500}),cu(this,"stat",{bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0}),cu(this,"small"),cu(this,"isNeedToSetBandwidth"),cu(this,"muteImage"),cu(this,"manager"),cu(this,"_seiCodec",new class{constructor(){cu(this,"_seiMessageList",[]),cu(this,"_smallSeiMessageList",[]),cu(this,"_seiPayloadType",243)}encodeSEINalu(e){let t=e.byteLength,n=parseInt(String(t/255),10),i=t%255,r=[];r.push(0,0,0,1,6,this._seiPayloadType);for(let e=0;e<n;e++)r.push(255);r.push(i);let o=new DataView(e);return r.push(...new Uint8Array(o.buffer)),r.push(128),new bv(new DataView(new Uint8Array(r).buffer),!0)}sendSEI(e,t){null!=t&&t.seiPayloadType&&(this._seiPayloadType=t.seiPayloadType),this._seiMessageList.push(e),null!=t&&t.small&&this._smallSeiMessageList.push(e)}getNaluCount(e){let t=0,n=0,i=new DataView(e);for(let r=0;r<e.byteLength;r++)switch(i.getUint8(r)){case 0:t++;break;case 1:(2===t||3===t)&&n++,t=0;break;default:t=0}return n}encode(e,t){let n=t?this._smallSeiMessageList:this._seiMessageList;if(n.length>0&&e.data.byteLength>0){let t=9-this.getNaluCount(e.data);if(t<=0)return 0;let i=n.splice(0,t).reverse().map(this.encodeSEINalu.bind(this)),r=i.reduce(((e,t)=>e+t.dataView.byteLength),0),o=new ArrayBuffer(r+e.data.byteLength),a=new DataView(o),s=new DataView(e.data),l=0;for(let e=0;e<i.length;e++)for(let t=0;t<i[e].dataView.byteLength;t++)a.setInt8(l++,i[e].dataView.getInt8(t));for(let t=0;t<e.data.byteLength;t++)a.setInt8(l++,s.getInt8(t));return e.data=o,i.length}return 0}}),cu(this,"pipeline",[]),this.manager=e;let n=()=>{this.isAllowed2k4k(this.profile)?this.room&&this.settings.height>=1440&&"publish"===this.state&&this.room.sendAbilityStatus({"2k4k":1}):(this.log.warn("Resolution is reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386"),this.setProfile(ru(iu({},this.profile),{width:1920,height:1080})),this.applyProfile())};this.on("input-media-track-changed",n),this.on("publish",n),this.handleCameraAdded=this.handleCameraAdded.bind(this),this.handleCameraRemoved=this.handleCameraRemoved.bind(this)}get facingMode(){if(lg&&this.mediaTrack)return this.mediaTrack.getSettings().facingMode}get isQosClearFirst(){var e;return"detail"===(null==(e=this._inputTrack)?void 0:e.contentHint)}setMute(e){return du(this,null,(function*(){var t,n,i;if(Bf(e)){if(this.muteImage===e)return;yield null==(t=this.manager)?void 0:t.deleteWatermark("mute"),yield null==(n=this.manager)?void 0:n.setWatermark({x:0,y:0,width:this.settings.width,height:this.settings.height,type:"mute",zIndex:999,imageUrl:e}),this.muteImage=e,uu(Sv.prototype,this,"setMute").call(this,!1)}else yield null==(i=this.manager)?void 0:i.deleteWatermark("mute"),this.muteImage=void 0,uu(Sv.prototype,this,"setMute").call(this,e)}))}capture({deviceId:e,facingMode:t,useExactDeviceId:n=!1,customSource:i}){return super.capture({audio:!1,video:!0,facingMode:t||this.facingMode,cameraId:e,width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate,useExactDeviceId:n,customSource:i})}setProfile(e){let t=iu({},e),n=t.width>t.height;t.width*t.height<=19200&&Rh&&Ip&&(this.log.warn(`resolution is ${t.width}*${t.height}, fallback to 240*180`),t.width=n?240:180,t.height=n?180:240,t.bitrate=Math.max(t.bitrate,150)),t.width*t.height>921600&&Bp&&(t.width=n?1280:720,t.height=n?720:1280,this.log.warn("reset to 1280 * 720 on iOS 13~14")),t.bitrate&&(this.isNeedToSetBandwidth=t.bitrate!==this.profile.bitrate),this.isAllowed2k4k(this.profile)?super.setProfile(t):(this.log.warn("Resolution is reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386"),super.setProfile(ru(iu({},this.profile),{width:1920,height:1080})))}applyProfile(){var e;if(!this.mediaTrack)return;let t=this.settings;return t.height!==this.profile.height||t.width!==this.profile.width||t.frameRate!==this.profile.frameRate?null==(e=this.mediaTrack)?void 0:e.applyConstraints({width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate}).then((()=>{if(this.manager&&this.manager.changeInput(this),this.room&&this.settings.height>=1440&&"publish"===this.state&&this.room.sendAbilityStatus({"2k4k":1}),this.isNeedToSetBandwidth&&this.room&&this.room.setBandWidth)return this.isNeedToSetBandwidth=!1,this.room.setBandWidth({bandwidth:this.profile.bitrate,type:ld.VIDEO,videoType:ld.BIG})})):void 0}get settings(){let e={width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate};return lg&&this.mediaTrack&&Object.assign(e,this.mediaTrack.getSettings()),e}get scaleResolutionDownBy(){let{settings:e}=this;return e.width===this.profile.width&&e.height===this.profile.height?1:gm()&&this.profile.width>this.profile.height&&e.height>e.width?Math.max(e.width/this.profile.height,e.height/this.profile.width,1):Math.max(e.width/this.profile.width,e.height/this.profile.height,1)}isAllowed2k4k(e){var t;return!(this.room&&this.room.scheduleResult&&!this.isScreen&&!(e.height*e.width<3686400))||1===(null==(t=this.room.scheduleResult.trtcAutoConf)?void 0:t["2k4k"])}isNeedToSwitchDevice(e){return!(!this.mediaTrack||this.deviceId===e||this.facingMode===e)}switchDevice(e){return du(this,null,(function*(){try{if(!this.isNeedToSwitchDevice(e))return;let t={useExactDeviceId:!0};"user"===e||"environment"===e?t.facingMode=e:t.deviceId=e,this.mediaTrack.stop(),yield this.capture(t),af.emit(xm.SWITCH_DEVICE_SUCCESS,{track:this}),this.log.info("switch camera success")}catch(e){throw this.log.error(`switch camera failed ${e}`),this.deviceId&&this.recapture(this.deviceId),e}}))}listenDeviceChange(){U_&&!U_.listeners("videoInputRemoved").includes(this.handleCameraRemoved)&&U_.on("videoInputRemoved",this.handleCameraRemoved,this)}handleCameraRemoved(e){return du(this,null,(function*(){if(e.deviceId===this.deviceId){this.log.warn(`current camera is lost: ${JSON.stringify(e)}`),Ay(this.userId,{eventId:2003,param1:7,streamType:2});let t=yield H_();t[0]?this.recapture(t[0].deviceId):U_.on("videoInputAdded",this.handleCameraAdded,this)}}))}handleCameraAdded(e){return du(this,null,(function*(){this.log.warn(`camera added: ${JSON.stringify(e)}`),this.recapture(e.deviceId)}))}encodeFrame(e,t){let n=t?8:this.mediaType;return this.pipeline.reduce(((e,t)=>t?t(e,n):e),e)}get enableEncodeFrame(){return this.pipeline.some((e=>e))}play(e,t){return du(this,null,(function*(){return Ff(this.mirror)&&!this.isScreen&&this.setMirror("view"),uu(Sv.prototype,this,"play").call(this,e,t)}))}close(){U_.off("videoInputAdded",this.handleCameraAdded,this),U_.off("videoInputRemoved",this.handleCameraRemoved,this),super.close()}recapture(e){return du(this,null,(function*(){try{yield uu(Sv.prototype,this,"recapture").call(this,e)}catch(t){let n=(yield H_()).find((t=>t.deviceId!==e));if(!n)throw t;yield uu(Sv.prototype,this,"recapture").call(this,n.deviceId)}}))}},Tv=Im();if(navigator.mediaDevices&&"setCaptureHandleConfig"in navigator.mediaDevices)try{navigator.mediaDevices.setCaptureHandleConfig({handle:Tv,exposeOrigin:!0,permittedOrigins:["*"]})}catch(e){}var xv,Av=class extends Sv{constructor(e){super(e,2),cu(this,"profile",{width:1920,height:1080,frameRate:5,bitrate:1600}),cu(this,"objectFit","contain"),cu(this,"isScreen",!0),this._log.id=`s-${this._log.id}`}capture(e){return du(this,arguments,(function*({systemAudio:e=!1,autoGainControl:t,echoCancellation:n,noiseSuppression:i,audioTrack:r,videoTrack:o,captureElement:a,preferDisplaySurface:s}){try{let l;return o||r?(l=new MediaStream,o&&l.addTrack(o),r&&l.addTrack(r)):l=yield function(e){return du(this,null,(function*(){let t=null,n=function(e){let t={preferCurrentTab:"current-tab"===e.preferDisplaySurface||!!e.captureElement,systemAudio:"include",selfBrowserSurface:"include",surfaceSwitching:"include"},n={width:Np?{max:e.width}:{ideal:e.width,max:e.width},height:Np?{max:e.height}:{ideal:e.height,max:e.height},frameRate:e.frameRate,displaySurface:e.preferDisplaySurface||"monitor"};if(t.video=n,e.systemAudio){let{echoCancellation:n=!0,noiseSuppression:i=!1,autoGainControl:r=!1}=e;t.audio={echoCancellation:n,noiseSuppression:i,autoGainControl:r,sampleRate:48e3}}return t}(e);wm.info(`getDisplayMedia with constraints: ${JSON.stringify(n)}`);let i=yield navigator.mediaDevices.getDisplayMedia(n);e.systemAudio&&0===i.getAudioTracks().length&&(Rp&&Mp<74||Np||Nh)&&wm.warn("Your browser not support capture system audio");let r=i.getVideoTracks()[0];if(r){if(e.frameRate)try{yield r.applyConstraints({frameRate:{min:e.frameRate,ideal:e.frameRate},width:e.width,height:e.height})}catch(e){wm.warn(`screen applyConstraints failed: ${e}`)}e.captureElement&&(yield function(e,t){return du(this,null,(function*(){var n;if("CropTarget"in window&&"fromElement"in CropTarget&&Vf(e.cropTo))try{if((null==(n=e.getCaptureHandle())?void 0:n.handle)!==Tv)return;let i=yield CropTarget.fromElement(t);yield e.cropTo(i)}catch(e){wm.warn(`cropTo target failed ${e}`)}}))}(r,e.captureElement))}if(e.audio){let n=function(e){let t={echoCancellation:e.echoCancellation,autoGainControl:e.autoGainControl,noiseSuppression:e.noiseSuppression,sampleRate:e.sampleRate,channelCount:e.channelCount};return Ff(e.microphoneId)||(t.deviceId=e.microphoneId),{audio:t,video:!1}}(e);wm.info(`getUserMedia with constraints: ${JSON.stringify(n)}`),t=yield navigator.mediaDevices.getUserMedia(n),i.addTrack(t.getAudioTracks()[0])}return i}))}({audio:!1,systemAudio:e,width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate,autoGainControl:t,echoCancellation:n,noiseSuppression:i,captureElement:a,preferDisplaySurface:s}),yield this.setInputMediaStreamTrack(l.getVideoTracks()[0]),l}catch(e){throw this.log.error(`getDisplayMedia error observed ${e}`),e instanceof Au?e:new Au({code:Tu.INITIALIZE_FAILED,name:e.name,message:e.message})}}))}switchDevice(e){return du(this,null,(function*(){throw new Error("Method not implemented.")}))}},wv=class extends Ev{constructor(e){super(e),this._log.id=`s-${this._log.id}`}},Iv=class extends R_{constructor(e){super(),this.room=e,cu(this,"_localAudioTrack"),cu(this,"_localScreenAudioTrack"),cu(this,"log",wm.createLogger({id:"am"})),cu(this,"denoiser"),e&&(this.log.setUserId(e.userId),this.log.setSdkAppId(e.sdkAppId))}get _localAudioPipline(){var e;return null==(e=this._localAudioTrack)?void 0:e.pipeline}dump(e){var t,n;if(!this._localAudioTrack)return;let i=[],r=[];null!=(t=this._localAudioPipline)&&t.source.node&&(i.push(this._localAudioPipline.source.node),r.push("mic")),null!=(n=this._localAudioPipline)&&n.denoiser.node&&(i.push(this._localAudioPipline.denoiser.node),r.push("mic-processed")),this.mixWeight>1&&(i.push(this.audioContext.createMediaStreamSource(this._localAudioPipline.stream)),r.push("mix")),this.log.info(`dump audio track ${r}, duration: ${e}`);let o=new AbortController,a=[],s=setTimeout((()=>{this.log.info('dump audio track complete please input "download()" to download.'),o.abort("timeout")}),1e3*e),l=()=>{for(let e=0;e<r.length;e++){let t=URL.createObjectURL(new Blob(a[e])),n=document.createElement("a");n.href=t,n.download=`${r[e]}.pcm`,n.style.display="none",document.body.appendChild(n),n.click(),URL.revokeObjectURL(t),n.remove()}clearTimeout(s),o.abort("download")},c=function(e){return du(this,null,(function*(){let t=T_();xv||(xv=E_(t,URL.createObjectURL(new Blob(["registerProcessor('dumper', class extends AudioWorkletProcessor {process(inputs) {this.port.postMessage(inputs);return true;}});"],{type:"application/javascript"})))),yield xv;let n=new AudioWorkletNode(t,"dumper",{numberOfInputs:e.length,numberOfOutputs:0});return e.forEach(((e,t)=>e.connect(n,0,t))),new ReadableStream({start(e){n.port.onmessage=t=>{e.enqueue(t.data)}},cancel(){e.forEach((e=>e.disconnect(n))),n.port.close()}})}))}(i).then((e=>e.pipeTo(new WritableStream({write(e){e.forEach(((e,t)=>a[t]=a[t]?a[t].concat(e[0]):[e[0]]))}}),o).catch((e=>l))));return{then:c.then.bind(c),download:l}}get hasScreenAudioTrack(){return null!==this._localScreenAudioTrack}get hasAudioTrack(){return null!==this._localAudioTrack}changeInput(e){if(e instanceof wv)this._localScreenAudioTrack=e,e.pipeline.connect(),this.mixOnChange();else if(e instanceof Ev)this._localAudioTrack=e,this.denoiser&&e.addDenoiser(this.denoiser),e.pipeline.connect(),this.mixOnChange();else if(e instanceof kv)return e.setOutputMediaStreamTrack(e.mediaTrack)}mixOnChange(){var e,t;null==(e=this._localAudioTrack)||e.setOutputMediaStreamTrack(this.mixWeight>1?this.mixTrack:this._localAudioTrack.mediaTrack),null==(t=this._localScreenAudioTrack)||t.setOutputMediaStreamTrack(this.mixWeight>1?this.mixTrack:this._localScreenAudioTrack.mediaTrack)}removeInput(e){e instanceof wv?delete this._localScreenAudioTrack:e instanceof Ev&&delete this._localAudioTrack}addDenoiser(e){var t;this.denoiser=e,null==(t=this._localAudioTrack)||t.addDenoiser(e)}removeDenoiser(e){var t;delete this.denoiser,null==(t=this._localAudioTrack)||t.removeDenoiser(e)}destroy(){this.close()}};function Rv(e=30,t=2){return lv(((n,i)=>function(...r){return new Promise(((o,a)=>{let s=setTimeout((()=>{let n=new Au({code:Tu.API_CALL_TIMEOUT,message:`checkPendingPromise ${i}() timeout ${e}s`});wm.warn(n),2===t?a(n):1===t&&o()}),1e3*e);n.apply(this,r).then(o,a).finally((()=>{clearTimeout(s)}))}))}))}var Cv=class extends K_{constructor(e,t,n){super({userId:t.userId,sdkAppId:e.sdkAppId,mediaType:n,room:e}),this.room=e,this.user=t,cu(this,"tinyId"),cu(this,"isRemote",!0),cu(this,"jitterBufferDelay",0),this.tinyId=t.tinyId}setMute(e){this.hasFlag&&super.setMute(e)}setInputMediaStreamTrack(e){super.setInputMediaStreamTrack(e),this.hasFlag&&this.isSubscribed&&this.player.setTrack(this.outMediaTrack)}waitHasMediaTrack(){return new Promise((e=>{this.mediaTrack?e():this.once("input-media-track-changed",e)}))}get isSubscribing(){return"subscribeing"===this.state.toString()}get isSubscribed(){return this.state===Cv.STATE_SUBSCRIBE}subscribe(e){return e}unsubscribe(){this.player.setTrack(null),"main"===this.streamType&&"video"===this.kind&&this.room.changeType(!1,this.user)}updatePlayingState(e){if(this.isPlayCalled&&this.player.isStopped===e){if(e&&(!this.isSubscribed||!this.hasFlag||!this.outMediaTrack))return void this.log.info(`abort play, isSubscribed:${this.isSubscribed} hasFlag:${this.hasFlag} hasTrack:${!!this.outMediaTrack}`);super.updatePlayingState(e)}}onFlagChanged(){this.updatePlayingState(this.hasFlag)}onTrackMuted(){this.hasFlag&&(this.isSubscribed||this.isSubscribing)&&this.isPlayCalled&&super.onTrackMuted()}onTrackUnmuted(){this.hasFlag&&(this.isSubscribed||this.isSubscribing)&&this.isPlayCalled&&super.onTrackUnmuted()}onTrackEnded(){this.hasFlag&&(this.isSubscribed||this.isSubscribing)&&this.isPlayCalled&&super.onTrackEnded()}},Mv=Cv;cu(Mv,"STATE_SUBSCRIBE","subscribe"),lu([Rv(5,1)],Mv.prototype,"waitHasMediaTrack",1),lu([Tg(wg.INIT,Mv.STATE_SUBSCRIBE,{success(){this.log.info("subscribed"),af.emit(xm.REMOTE_TRACK_SUBSCRIBED,{track:this}),this.updatePlayingState(!0)},ignoreError:!0})],Mv.prototype,"subscribe",1),lu([Tg(Mv.STATE_SUBSCRIBE,wg.INIT,{sync:!0,success(){this.log.info("unsubscribed"),this.updatePlayingState(!1),af.emit(xm.REMOTE_TRACK_UNSUBSCRIBED,{track:this})}})],Mv.prototype,"unsubscribe",1);var kv=class extends Mv{constructor(e,t){super(e,t,1),cu(this,"volume",0),cu(this,"mediaType",1),cu(this,"stat",{bytesReceived:0,packetsReceived:0,packetsLost:0,end2EndDelay:0,jitterBufferDelay:0}),cu(this,"audioDecoder"),this.manager=e.audioManager}onPlayerError(e){if(this.enableDecodeFrame){this.room.enableInsertableStreams();let e=new AudioDecoder({error:e=>this._log.error(e),output:e=>{this.player.write(e)}});e.configure({codec:"opus",sampleRate:48e3,numberOfChannels:1}),this._log.info(`audioDecoder state:${e.state}`),this.audioDecoder=e}}get enableDecodeFrame(){var e,t;return(null==(t=null==(e=this.player.element)?void 0:e.error)?void 0:t.code)===MediaError.MEDIA_ERR_DECODE&&ug&&hg().AudioDecoder}decodeFrame(e){var t;return"configured"===(null==(t=this.audioDecoder)?void 0:t.state)&&this.audioDecoder.decode(new EncodedAudioChunk({data:e.data,timestamp:e.timestamp,type:"key"})),e}getAudioLevel(){let e=this.volume||super.getAudioLevel();return e>1?1:e}get hasFlag(){return this.user.muteState.hasAudio}isFlagChanged(e){let t=e.hasAudio&&!e.audioMuted;return this.hasFlag||(this.volume=0),this.hasFlag!==t}},Nv=[-1,-1,1,-1,-1,1,1,1],Dv=[0,0,1,0,0,1,1,1],Ov=class extends wg{constructor(e,t){if(super(),this.context=e,cu(this,"name"),cu(this,"input"),cu(this,"output"),cu(this,"texture"),cu(this,"ctx2d",null),cu(this,"fbo"),cu(this,"width",0),cu(this,"height",0),cu(this,"x",0),cu(this,"y",0),cu(this,"program"),cu(this,"vertexShader"),cu(this,"fragmentShader"),cu(this,"totalFrames",0),cu(this,"dropFrames",0),cu(this,"matchInputSize",!0),cu(this,"texCoordBuffer"),cu(this,"positionBuffer"),cu(this,"lastInfo",{name:"",timestamp:0,totalFrames:0,x:0,y:0,width:0,height:0,fps:0}),cu(this,"cost",0),cu(this,"_canvas",null),cu(this,"_image"),this.context.on("disconnect",this.close,this),this.name=t.name,this.matchInputSize=!1!==t.matchInputSize,this.width=t.width||e.width,this.height=t.height||e.height,this._image=t.image,e instanceof Wv){if(e.ctx&&t.create2d){let e=document.createElement("canvas"),t="function"==typeof e.transferControlToOffscreen?e.transferControlToOffscreen():e;t.width=this.width,t.height=this.height,this.ctx2d=t.getContext("2d"),this._image=t,this._canvas=t}}else try{let n=e.ctx;this.texCoordBuffer=this.createBuffer(Dv),this.positionBuffer=this.createBuffer(Nv),!1!==t.createTexture&&(this.texture=n.createTexture(),this.useTexture(),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.pixelStorei(n.PACK_ALIGNMENT,1),n.pixelStorei(n.UNPACK_ALIGNMENT,1)),t.useFbo&&(this.fbo=n.createFramebuffer(),this.useBufferFrame(),this.useTexture(),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.texture,0)),t.useDefaultProgram?this.program=e.defaultProgam:(t.vertexShaderSource||t.fragmentShaderSource)&&(this.vertexShader=t.vertexShaderSource?e.createShader(n.VERTEX_SHADER,t.vertexShaderSource):e.defaultVShader,this.fragmentShader=t.fragmentShaderSource?e.createShader(n.FRAGMENT_SHADER,t.fragmentShaderSource):e.defaultFShader,this.program=e.createProgram(this.vertexShader,this.fragmentShader))}catch(e){this.context.destroy(e)}}get image(){return this._image}set image(e){this._image=e}createFramebuffer(e){let t=this.context.ctx,n=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),n}connect(e,...t){return e.addInput(this,...t),this.output=e,e}addInput(e,...t){this.input=e,this.matchInputSize&&e.width&&e.height&&this.resize(e.width,e.height)}requestFrame(e){let t=Date.now();return!!(this.context instanceof $v&&this.render(e)||this.context instanceof Wv&&this.render2d(e))&&(this.totalFrames++,this.cost=Date.now()-t,!0)}render2d(e){var t;return!(null==(t=this.input)||!t.requestFrame(e))&&this.draw2d(this.input.image,0,0,this.width,this.height)}disconnect(...e){var t;null==(t=this.output)||t.removeInput(this,...e),delete this.output}removeInput(e,...t){delete this.input}close(){var e,t;if(this.context.off("disconnect",this.close,this),null==(e=this.output)||e.removeInput(this),delete this.output,null==(t=this.input)||t.disconnect(),this.context instanceof $v){let e=this.context.ctx;e.deleteBuffer(this.texCoordBuffer),e.deleteBuffer(this.positionBuffer),this.fbo&&e.deleteFramebuffer(this.fbo),this.texture&&e.deleteTexture(this.texture),this.vertexShader&&this.vertexShader!==this.context.defaultVShader&&e.deleteShader(this.vertexShader),this.fragmentShader&&this.fragmentShader!==this.context.defaultFShader&&e.deleteShader(this.fragmentShader),this.program&&this.program!==this.context.defaultProgam&&e.deleteProgram(this.program)}this._canvas&&(this._canvas.width=0,this._canvas.height=0,this.ctx2d=null),this.removeAllListeners()}useTexture(){this.useTextures(this.texture)}useInputTexture(){var e;this.useTextures(null==(e=this.input)?void 0:e.texture)}useTextures(...e){let t=this.context.ctx;e.forEach(((e,n)=>{e&&(t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e))}))}useProgram(){this.context.ctx.useProgram(this.program)}useBufferFrame(){let e=this.context.ctx;e.bindFramebuffer(e.FRAMEBUFFER,this.fbo||null)}createBuffer(e){let t=this.context.ctx,n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),n}setTexBuffer(e){let t=this.context.ctx;t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}setPosBuffer(e){let t=this.context.ctx;t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}changeBufferData(e,t){let n=this.context.ctx;n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW)}setAttributes(...e){let t=this.context.ctx;e.forEach(((e,n)=>{t.enableVertexAttribArray(n),t.bindBuffer(t.ARRAY_BUFFER,e),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0)}))}getVertexPoint(e,t){return[e/this.width*2-1,t/this.height*2-1]}layout2texCoords(e){return[...this.getVertexPoint(e.x,e.y),...this.getVertexPoint(e.x+e.width,e.y),...this.getVertexPoint(e.x,e.y+e.height),...this.getVertexPoint(e.x+e.width,e.y+e.height)]}resize(e,t){if(this.width!==e||this.height!==t){if(this.width=e,this.height=t,this._canvas&&(this._canvas.width=e,this._canvas.height=t),this.texture&&this.fbo){this.useTexture();let n=this.context.ctx;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null)}this.output&&this.output.matchInputSize&&this.output.resize(e,t)}}draw(e,t){this.setAttributes(e||this.positionBuffer,t||this.texCoordBuffer);let n=this.context.ctx;n.drawArrays(n.TRIANGLE_STRIP,0,4)}draw2d(e,t,n,i,r){return!(!this.ctx2d||!e||(e instanceof ImageData?this.ctx2d.putImageData(e,t,n):this.ctx2d.drawImage(e,t,n,i,r),0))}getInfo(){var e;let{totalFrames:t,x:n,y:i,width:r,height:o,name:a,cost:s}=this,l=Date.now(),c=(t-this.lastInfo.totalFrames)/((l-this.lastInfo.timestamp)/1e3)>>0;return this.lastInfo={totalFrames:t,x:n,y:i,width:r,height:o,timestamp:l,fps:c,name:a,cost:s},iu({parent:null==(e=this.input)?void 0:e.getInfo()},this.lastInfo)}createTexture(e){let t=this.context.ctx,n=t.createTexture();return this.useTextures(n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),n}};lu([Tg(wg.INIT,"connected",{sync:!0})],Ov.prototype,"connect",1),lu([Tg("connected",wg.INIT,{ignoreError:!0,sync:!0})],Ov.prototype,"disconnect",1),lu([Tg([],"closed",{sync:!0})],Ov.prototype,"close",1);var Pv=[0,1,1,1,0,0,1,0],Lv=class extends Ov{constructor(e,t){super(e,Object.assign({useDefaultProgram:!0,createTexture:!1,name:"destination"},t)),cu(this,"_intervalId",0),cu(this,"_sequence",0),cu(this,"checkGLError",!1),e instanceof Wv?this.ctx2d=e.ctx:e.available&&(null==t?void 0:t.mirrorUpAndDown)&&this.setTexBuffer(Pv)}start(e){this._intervalId=kg.run("intervalInWorker",(()=>{if(e!==this.context.frameRate&&(kg.clearTask(this._intervalId),this.start(this.context.frameRate)),this.requestFrame(this._sequence++),this.checkGLError&&this.context instanceof $v){let e=this.context.ctx.getError();e&&this.context.destroy(new Error(`${this.name} req ${this._sequence} render ${this.totalFrames} faild ${e}`))}}),{fps:this.context.frameRate})}render(e){var t;return!(null==(t=this.input)||!t.requestFrame(e)||(this.useProgram(),this.useBufferFrame(),this.useInputTexture(),this.draw(),0))}addInput(e,...t){super.addInput(e,...t),this.start(this.context.frameRate)}removeInput(e){super.removeInput(e),kg.clearTask(this._intervalId)}resize(e,t){super.resize(e,t),this.context.setSize(e,t)}},Uv=class extends Lv{constructor(e,t){super(e,t),cu(this,"_videoTrack"),[this._videoTrack]=e._canvas.captureStream(e.frameRate).getVideoTracks();let n=e=>{var t;let n=()=>{var t;return null==(t=this._videoTrack)?void 0:t.removeEventListener(e,i)},i=()=>{n(),this.context.destroy(new Error(`video track ${e}`))};this.once("closed",n),null==(t=this._videoTrack)||t.addEventListener(e,i)};e instanceof $v&&n("mute"),n("ended")}get videoTrack(){return this._videoTrack}close(){var e;super.close(),null==(e=this._videoTrack)||e.stop(),delete this._videoTrack}},Vv=class extends Uv{render(e){var t;return!(null==(t=this.input)||!t.requestFrame(e))}},Fv=class extends Uv{constructor(e,t){super(e,{name:"smallDestination"}),this.resolution=t}resize(e,t){let n,i=e*t,r=this.resolution.width*this.resolution.height;wm.info(`big res: ${e}*${t} small res: ${this.resolution.width}*${this.resolution.height} `),i>r?n=i/r:(wm.warn(`Small stream resolution is not smaller than big stream, which is invalid. big: ${e} * ${t} small: ${this.resolution.width} * ${this.resolution.height}`),n=i/19200),super.resize(e/Math.sqrt(n),t/Math.sqrt(n))}},Bv=class extends Ov{constructor(e,t){super(e,iu({name:"imageSource"},t)),cu(this,"_lastImage"),cu(this,"_totalFrames",0),cu(this,"_autoResize",!1),this._autoResize=!1!==(null==t?void 0:t.autoResize)}_render(e,t){var n,i;let{width:r,height:o}=this;if(this.image instanceof HTMLVideoElement){if(Vf(this.image.getVideoPlaybackQuality)&&!Dp){let e=this.image.getVideoPlaybackQuality().totalVideoFrames;if(!0===(null==(i=null==(n=this.image.srcObject)?void 0:n.getVideoTracks()[0])?void 0:i.muted)||this._totalFrames===e)return!1;this._totalFrames=e,this.dropFrames=this._totalFrames-this.totalFrames}if(({videoWidth:r,videoHeight:o}=this.image),!r||!o)return!1;this.image.width=r,this.image.height=o}else if(this.image instanceof HTMLImageElement||this.image instanceof ImageData||this.image instanceof ImageBitmap){if(({width:r,height:o}=this.image),this.image!==this._lastImage)this._lastImage=this.image;else if(r===this.width&&o===this.height)return!1}else(this.image instanceof HTMLCanvasElement||this.image instanceof OffscreenCanvas)&&(({width:r,height:o}=this.image),this._lastImage=this.image);if(!this._autoResize)return!0;if(this.width===r&&this.height===o&&this.totalFrames){if(t){this.useTexture();let e=this.context.ctx;e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.image)}}else{if(t){this.useTexture();let e=this.context.ctx;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image)}this.resize(r,o)}return!0}render(e){return this._render(e,!0)}render2d(e){return this._render(e,!1)}},Hv=class extends Bv{constructor(e,t,n){super(e,n),this._player=t,this.name="videoPlayerSource"}get image(){return this._player.element}},zv=class extends Hv{constructor(e,t,n){super(e,new y_({id:n.name,track:t,muted:!0,container:null,objectFit:"contain",log:n.logger}),n),this.name="videoTrackSource",this._player.play()}get image(){return this._player.element}replaceTrack(e){this._player.setTrack(e),this._player.play()}close(){super.close(),this._player.stop()}},jv=class extends wg{constructor(e){super(),cu(this,"frameRate"),cu(this,"_canvas"),cu(this,"log"),cu(this,"hasAlpha",!1),cu(this,"name"),this.name=e.name,this.log=e.logger.createChild({id:`vc-${this.name}`}),this.frameRate=e.frameRate}set width(e){this._canvas&&(this._canvas.width=e)}get width(){var e;return(null==(e=this._canvas)?void 0:e.width)||0}set height(e){this._canvas&&(this._canvas.height=e)}get height(){var e;return(null==(e=this._canvas)?void 0:e.height)||0}setSize(e,t){this._canvas&&(this._canvas.width=e,this._canvas.height=t)}createVideoTrackSource(e,t){return new zv(this,e,{logger:this.log,name:t})}createVideoTrackDestination(e){return new Uv(this,e)}createVideoImageSource(e,t){return new Bv(this,t?Object.assign(t,{logger:this.log,image:e}):{logger:this.log,image:e})}createVideoPlayerSource(e,t){return new Hv(this,e,t?Object.assign(t,{logger:this.log}):{logger:this.log})}get available(){return"created"===this.state}disconnect(){this.emit("disconnect")}},Gv={alpha:!0,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0,powerPreference:"low-power"},$v=class extends jv{constructor(){super(...arguments),cu(this,"defaultProgam"),cu(this,"defaultVShader"),cu(this,"defaultFShader"),cu(this,"ctx")}create(){if(this._canvas||(this._canvas=document.createElement("canvas")),this.ctx=this._canvas.getContext("webgl2",Gv),!this.ctx)throw new Error("webgl2 not supported");this.defaultVShader=this.createShader(this.ctx.VERTEX_SHADER,"\n// \nattribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  gl_Position = a_position;\n  v_texCoord = a_texCoord;\n}\n"),this.defaultFShader=this.createShader(this.ctx.FRAGMENT_SHADER,"\n// \nprecision mediump float;\nvarying vec2 v_texCoord;\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n} "),this.defaultProgam=this.createProgram(this.defaultVShader,this.defaultFShader),this._canvas.addEventListener("webglcontextlost",(()=>{this.destroy(new Error("webgl context lost"))})),this.log.info("video context created use webgl")}destroy(e){return this.disconnect(),this.log.info("video context destroy "+(e?`: ${e}`:"")),this.ctx&&(this.ctx.deleteShader(this.defaultVShader),this.ctx.deleteShader(this.defaultFShader),this.ctx.deleteProgram(this.defaultProgam),delete this.ctx),e}set width(e){var t;null==(t=this.ctx)||t.viewport(0,0,e,this.height),super.width=e}set height(e){var t;null==(t=this.ctx)||t.viewport(0,0,this.width,e),super.height=e}setSize(e,t){var n;null==(n=this.ctx)||n.viewport(0,0,e,t),super.setSize(e,t)}createShader(e,t){let n=this.ctx,i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}createProgram(e,t){let n=this.ctx,i=n.createProgram();return n.attachShader(i,e),n.attachShader(i,t),n.linkProgram(i),n.getProgramParameter(i,n.LINK_STATUS)||this.log.error(n.getProgramInfoLog(i)),i}};lu([Tg(wg.INIT,"created",{sync:!0})],$v.prototype,"create",1),lu([Tg("created",wg.INIT,{ignoreError:!0,sync:!0,success(e){e&&this.emit("unavailable",e),this.removeAllListeners()}})],$v.prototype,"destroy",1);var Wv=class extends jv{constructor(){super(...arguments),cu(this,"ctx")}create(e){if(this.hasAlpha=e.alpha,this._canvas=document.createElement("canvas"),this.ctx=this._canvas.getContext("2d",{alpha:e.alpha}),!this.ctx)throw new Error("2d context not supported");this.log.info("video context created use 2d")}destroy(e){this.disconnect(),this.log.info("video context destroy "+(e?`: ${e}`:"")),delete this.ctx,this._canvas&&(this._canvas.remove(),this._canvas.width=0,this._canvas.height=0,delete this._canvas),this.removeAllListeners()}};lu([Tg(wg.INIT,"created",{sync:!0})],Wv.prototype,"create",1),lu([Tg("created",wg.INIT,{ignoreError:!0,sync:!0})],Wv.prototype,"destroy",1);var qv=class extends Mv{constructor(e,t,n=4){super(e,t,n),cu(this,"mediaType",4),cu(this,"source"),cu(this,"stat",{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,end2EndDelay:0,jitterBufferDelay:0}),cu(this,"pipeline",[]),this.manager=e.videoManager}play(e,t){return 17===Up&&!1!==(null==t?void 0:t.canvasRender)&&!this.source&&this.useCanvasPlayer(),super.play(e,t)}useCanvasPlayer(){if(this.log.info(`useCanvasPlayer(), ${!!this.player.element}`),!this.player.element)return;let e=new Wv({frameRate:15,logger:this.log,name:this.userId});e.create({alpha:!1});let t=e.createVideoPlayerSource(this.player);this.source=t;let n=new Lv(e);t.connect(n),this.player.setCanvas(e._canvas),this.updateCanvasPlayerFPS=this.updateCanvasPlayerFPS.bind(this,e),this.room.on("heartbeat-report",this.updateCanvasPlayerFPS,this)}updateCanvasPlayerFPS(e){let t=this.decodeFPS,n=(i=t,[15,30,45,60].reduce(((e,t)=>Math.abs(t-i)<Math.abs(e-i)?t:e)));var i;!Hf(t)||t<=0?this.log.debug(`updateCanvasPlayerFPS() ignore decoder: ${t} `):n!==e.frameRate?(this.log.info(`updateCanvasPlayerFPS() decoder: ${t}, closest: ${n}, current: ${e.frameRate}`),e.frameRate=n):this.log.debug(`updateCanvasPlayerFPS() ignore ClosestFPS ${n} == ${e.frameRate}`)}get decodeFPS(){var e;let{msg_video_status:t}=(null==(e=this.room.heartbeatReport)?void 0:e.msg_down_stream_info.find((e=>e.msg_user_info.str_identifier===this.userId)))||{},n=2===this.mediaType?7:this.isSmall?3:2;if(!t||0===t.length)return 0;let i=t.find((e=>e.uint32_video_stream_type===n));return(null==i?void 0:i.uint32_video_dec_fps)||0}stop(){return this.room.off("heartbeat-report",this.updateCanvasPlayerFPS,this),super.stop()}get enableDecodeFrame(){return this.manager.configPipeline(this),this.pipeline.some((e=>e))}decodeFrame(e){return this.pipeline.reduce(((e,t)=>t?t(e,this):e),e)}get isBig(){return 4===this.mediaType}get isSmall(){return 8===this.mediaType}changeType(e){this.room.changeType(e,this.user)}get hasFlag(){return this.user.muteState.hasVideo&&!this.user.muteState.videoMuted}isFlagChanged(e){let t=e.hasVideo&&!e.videoMuted;return this.hasFlag!==t}setMirror(e){"publish"===e||"both"===e||super.setMirror(e)}},Xv=class extends qv{constructor(e,t){super(e,t,2),cu(this,"mediaType",2),cu(this,"objectFit","contain")}get hasFlag(){return this.user.muteState.hasAuxiliary}isFlagChanged(e){let t=e.hasAuxiliary;return this.hasFlag!==t}};function Yv(...e){}var Jv=e=>e();function Kv(){this.dispose()}var Qv=()=>"undefined"!=typeof __FASTRX_DEVTOOLS__,Zv=1,ey=class extends Function{toString(){return`${this.name}(${this.args.length?[...this.args].join(", "):""})`}subscribe(e){let t=new ay(e,this,this.streamId++);return sy.subscribe({id:this.id,end:!1},{nodeId:t.sourceId,streamId:t.id}),this(t),t}},ty=class{constructor(){this.defers=new Set,this.disposed=!1}next(e){}complete(){this.dispose()}error(e){this.dispose()}get bindDispose(){return()=>this.dispose()}dispose(){this.disposed=!0,this.complete=Yv,this.error=Yv,this.next=Yv,this.dispose=Yv,this.subscribe=Yv,this.doDefer()}subscribe(e){return e instanceof ey?e.subscribe(this):e(this),this}get bindSubscribe(){return e=>this.subscribe(e)}doDefer(){this.defers.forEach(Jv),this.defers.clear()}defer(e){this.defers.add(e)}removeDefer(e){this.defers.delete(e)}reset(){this.disposed=!1,delete this.complete,delete this.next,delete this.dispose,delete this.next,delete this.subscribe}resetNext(){delete this.next}resetComplete(){delete this.complete}resetError(){delete this.error}},ny=class extends ty{constructor(e){super(),this.sink=e,e.defer(this.bindDispose)}next(e){this.sink.next(e)}complete(){this.sink.complete()}error(e){this.sink.error(e)}};function iy(e,t,n){if(Qv()){let i=Object.defineProperties(Object.setPrototypeOf(e,ey.prototype),{streamId:{value:0,writable:!0,configurable:!0},name:{value:t,writable:!0,configurable:!0},args:{value:n,writable:!0,configurable:!0},id:{value:0,writable:!0,configurable:!0}});sy.create(i);for(let e=0;e<n.length;e++){let t=n[e];"function"==typeof t&&t instanceof ey&&sy.addSource(i,t)}return i}return e}function ry(e,t){return function(...n){return i=>{if(i instanceof ey){let r=iy((t=>{let o=new e(t,...n);o.sourceId=r.id,o.subscribe(i)}),t,arguments);return r.source=i,sy.pipe(r),r}return t=>i(new e(t,...n))}}}function oy(e,t){window.postMessage({source:"fastrx-devtools-backend",payload:{event:e,payload:t}})}var ay=class extends ny{constructor(e,t,n){super(e),this.source=t,this.id=n,this.sourceId=e.sourceId,this.defer((()=>{sy.defer(this.source,this.id)}))}next(e){sy.next(this.source,this.id,e),this.sink.next(e)}complete(){sy.complete(this.source,this.id),this.sink.complete()}error(e){sy.complete(this.source,this.id,e),this.sink.error(e)}},sy={addSource(e,t){oy("addSource",{id:e.id,name:e.toString(),source:{id:t.id,name:t.toString()}})},next(e,t,n){oy("next",{id:e.id,streamId:t,data:n&&n.toString()})},subscribe({id:e,end:t},n){oy("subscribe",{id:e,end:t,sink:{nodeId:n&&n.nodeId,streamId:n&&n.streamId}})},complete(e,t,n){oy("complete",{id:e.id,streamId:t,err:n?n.toString():null})},defer(e,t){oy("defer",{id:e.id,streamId:t})},pipe(e){oy("pipe",{name:e.toString(),id:e.id,source:{id:e.source.id,name:e.source.toString()}})},update(e){oy("update",{id:e.id,name:e.toString()})},create(e){e.id||(e.id=Zv++),oy("create",{name:e.toString(),id:e.id})}},ly=class extends Error{constructor(e){super(`timeout after ${e}ms`),this.timeout=e}},cy=class extends ty{constructor(e){super(),this.source=e,this.sinks=new Set}add(e){e.defer((()=>this.remove(e))),1===this.sinks.add(e).size&&(this.reset(),this.subscribe(this.source))}remove(e){this.sinks.delete(e),0===this.sinks.size&&this.dispose()}next(e){this.sinks.forEach((t=>t.next(e)))}complete(){this.sinks.forEach((e=>e.complete())),this.sinks.clear()}error(e){this.sinks.forEach((t=>t.error(e))),this.sinks.clear()}};function uy(){return e=>{let t=new cy(e);if(e instanceof ey){let n=iy((e=>{t.add(e)}),"share",arguments);return t.sourceId=n.id,n.source=e,sy.pipe(n),n}return iy(t.add.bind(t),"share",arguments)}}ry(class extends(null){constructor(e,...t){super(e);let n=new ny(this.sink);n.next=e=>this.buffer=e,n.complete=Yv,n.subscribe(function(...e){return iy((t=>{let n=e.length,i=n,r=n,o=new Array(n),a=()=>{0==--r&&t.complete()};e.forEach(((e,n)=>{let r=new ny(t);r.next=e=>{0==--i?(r.next=e=>{o[n]=e,t.next(o)},r.next(e)):o[n]=e},r.complete=a,r.subscribe(e)}))}),"combineLatest",arguments)}(...t))}next(e){this.buffer&&this.sink.next([e,...this.buffer])}},"withLatestFrom"),ry(class extends(null){constructor(e,t,n){super(e),this.bufferSize=t,this.startBufferEvery=n,this.buffer=[],this.count=0,this.startBufferEvery&&(this.buffers=[[]])}next(e){this.startBufferEvery?(this.count++===this.startBufferEvery&&(this.buffers.push([]),this.count=1),this.buffers.forEach((t=>{t.push(e)})),this.buffers[0].length===this.bufferSize&&this.sink.next(this.buffers.shift())):(this.buffer.push(e),this.buffer.length===this.bufferSize&&(this.sink.next(this.buffer),this.buffer=[]))}complete(){this.buffer.length?this.sink.next(this.buffer):this.buffers.length&&this.buffers.forEach((e=>this.sink.next(e))),super.complete()}},"bufferCount"),ry(class extends(null){constructor(e,t){super(e),this.buffer=[];let n=new ny(e);n.next=t=>{e.next(this.buffer),this.buffer=[]},n.complete=Yv,n.subscribe(t)}next(e){this.buffer.push(e)}complete(){this.buffer.length&&this.sink.next(this.buffer),super.complete()}},"buffer"),ry(class extends(null){constructor(e,t,n){super(e),this.f=t;let i=()=>{this.sink.next(this.acc),this.sink.complete()};void 0===n?this.next=e=>{this.acc=e,this.complete=i,this.resetNext()}:(this.acc=n,this.complete=i)}next(e){this.acc=this.f(this.acc,e)}},"reduce"),ry(class extends(null){constructor(e,t,n){super(e),this.filter=t,this.thisArg=n}next(e){this.filter.call(this.thisArg,e)&&this.sink.next(e)}},"filter"),ry(class extends(null){next(e){}},"ignoreElements"),ry(class extends(null){constructor(e,t){super(e),this.count=t}next(e){this.sink.next(e),0==--this.count&&this.complete()}},"take"),ry(class extends(null){constructor(e,t){super(e);let n=new ny(e);n.next=()=>e.complete(),n.complete=Kv,n.subscribe(t)}},"takeUntil"),ry(class extends(null){constructor(e,t){super(e),this.f=t}next(e){this.f(e)?this.sink.next(e):this.complete()}},"takeWhile"),ry(class extends(null){constructor(e,t){super(e),this.count=t}next(e){0==--this.count&&(this.next=super.next)}},"skip"),ry(class extends(null){constructor(e,t){super(e),e.next=Yv;let n=new ny(e);n.next=()=>{n.dispose(),e.resetNext()},n.complete=Kv,n.subscribe(t)}},"skipUntil"),ry(class extends(null){constructor(e,t){super(e),this.f=t}next(e){this.f(e)||(this.next=super.next,this.next(e))}},"skipWhile");var dy={leading:!0,trailing:!1},hy=(ry(class extends(null){constructor(e,t,n=dy){super(e),this.durationSelector=t,this.config=n,this._throttle=new class extends(null){constructor(e,t,n){super(e),this.durationSelector=t,this.trailing=n}cacheValue(e){this.last=e,this.disposed&&this.throttle(e)}send(e){this.sink.next(e),this.throttle(e)}throttle(e){this.reset(),this.subscribe(this.durationSelector(e))}next(){this.complete()}complete(){this.dispose(),this.trailing&&this.send(this.last)}}(this.sink,this.durationSelector,this.config.trailing),this._throttle.dispose()}next(e){this._throttle.disposed&&this.config.leading?this._throttle.send(e):this._throttle.cacheValue(e)}complete(){this._throttle.throttle=Yv,this._throttle.complete(),super.complete()}},"throttle"),ry(class extends(null){constructor(e,t){super(e),this.durationSelector=t,this._debounce=new class extends(null){next(){this.complete()}complete(){this.dispose(),this.sink.next(this.last)}}(this.sink),this._debounce.dispose()}next(e){this._debounce.dispose(),this._debounce.reset(),this._debounce.last=e,this._debounce.subscribe(this.durationSelector(e))}complete(){this._debounce.complete(),super.complete()}},"debounce"),ry(class extends(null){constructor(e,t,n){super(e),this.count=t,this.defaultValue=n}next(e){0==this.count--&&(this.defaultValue=e,this.complete())}complete(){void 0!==this.defaultValue?(this.sink.next(this.defaultValue),super.complete()):this.error(new Error("not enough elements in sequence"))}},"elementAt"),ry(class extends(null){constructor(e,t){super(e),this.f=t,this.i=0}next(e){this.f(e)?(this.sink.next(this.i++),this.complete()):++this.i}},"findIndex"),ry(class extends(null){constructor(e,t,n){super(e),this.f=t,this.defaultValue=n,this.index=0}next(e){(!this.f||this.f(e,this.index++))&&(this.defaultValue=e,this.complete())}complete(){void 0!==this.defaultValue?(this.sink.next(this.defaultValue),super.complete()):this.error(new Error("no elements in sequence"))}},"first"),ry(class extends(null){constructor(e,t,n){super(e),this.f=t,this.defaultValue=n,this.index=0}next(e){(!this.f||this.f(e,this.index++))&&(this.defaultValue=e)}complete(){void 0!==this.defaultValue?(this.sink.next(this.defaultValue),super.complete()):this.error(new Error("no elements in sequence"))}},"last"),ry(class extends(null){constructor(e,t){super(e),this.predicate=t,this.index=0}next(e){this.predicate(e,this.index++)?this.result=!0:(this.result=!1,this.complete())}complete(){void 0!==this.result?(this.sink.next(this.result),super.complete()):this.error(new Error("no elements in sequence"))}},"every"),ry(class extends(null){constructor(e,t,n){super(e),this.f=t,void 0===n?this.next=e=>{this.acc=e,this.resetNext(),this.sink.next(this.acc)}:this.acc=n}next(e){this.sink.next(this.acc=this.f(this.acc,e))}},"scan"),ry(class extends(null){constructor(){super(...arguments),this.hasLast=!1}next(e){this.hasLast?this.sink.next([this.last,e]):this.hasLast=!0,this.last=e}},"pairwise"),ry(class extends(null){constructor(e,t,n){super(e),this.mapper=t,this.thisArg=n}next(e){super.next(this.mapper.call(this.thisArg,e))}},"map")),py=class extends ny{constructor(e,t,n){super(e),this.data=t,this.context=n}next(e){let t=this.context.combineResults;t?this.sink.next(t(this.data,e)):this.sink.next(e)}tryComplete(){this.context.resetComplete(),this.dispose()}},fy=class extends ny{constructor(e,t,n){super(e),this.makeSource=t,this.combineResults=n,this.index=0}subInner(e,t){let n=this.currentSink=new t(this.sink,e,this);this.complete=this.tryComplete,n.complete=n.tryComplete,n.subscribe(this.makeSource(e,this.index++))}tryComplete(){this.currentSink.resetComplete(),this.dispose()}},my=class extends py{},gy=class extends fy{next(e){this.subInner(e,my),this.next=e=>{this.currentSink.dispose(),this.subInner(e,my)}}};function _y(e){return(t,n)=>e((()=>t),n)}ry(gy,"switchMap"),_y(ry(gy,"switchMapTo"));var vy=class extends(null){tryComplete(){this.dispose(),this.context.sources.length?this.context.subNext():(this.context.resetNext(),this.context.resetComplete())}},yy=class extends(null){constructor(){super(...arguments),this.sources=[],this.next2=this.sources.push.bind(this.sources)}next(e){this.next2(e),this.subNext()}subNext(){this.next=this.next2,this.subInner(this.sources.shift(),vy),this.disposed&&0===this.sources.length&&this.currentSink.resetComplete()}tryComplete(){0===this.sources.length&&this.currentSink.resetComplete(),this.dispose()}},Ey=(ry(yy,"concatMap"),_y(ry(yy,"concatMapTo")),class extends(null){tryComplete(){this.context.inners.delete(this),super.dispose(),0===this.context.inners.size&&this.context.resetComplete()}}),by=class extends(null){constructor(){super(...arguments),this.inners=new Set}next(e){this.subInner(e,Ey),this.inners.add(this.currentSink)}tryComplete(){1===this.inners.size?this.inners.forEach((e=>e.resetComplete())):this.dispose()}},Sy=(ry(by,"mergeMap"),_y(ry(by,"mergeMapTo")),class extends(null){dispose(){this.context.resetNext(),super.dispose()}}),Ty=class extends(null){next(e){this.next=Yv,this.subInner(e,Sy)}},xy=(ry(Ty,"exhaustMap"),_y(ry(Ty,"exhaustMapTo")),ry(class extends(null){constructor(e,t){super(e),this.f=t,this.groups=new Map}next(e){let t=this.f(e),n=this.groups.get(t);void 0===n&&(n=function(e){let t=arguments,n=uy()(iy((t=>{n.next=e=>t.next(e),n.complete=()=>t.complete(),n.error=e=>t.error(e),e&&t.subscribe(e)}),"subject",t));return n.next=Yv,n.complete=Yv,n.error=Yv,n}(),n.key=t,this.groups.set(t,n),super.next(n)),n.next(e)}complete(){this.groups.forEach((e=>e.complete())),super.complete()}error(e){this.groups.forEach((t=>t.error(e))),super.error(e)}},"groupBy"),ry(class extends(null){constructor(){super(...arguments),this.start=new Date}next(e){this.sink.next({value:e,interval:Number(new Date)-Number(this.start)}),this.start=new Date}},"timeInterval"),ry(class extends(null){constructor(e,t){super(e),this.miniseconds=t,this.buffer=[],this.id=setInterval((()=>{this.sink.next(this.buffer.concat()),this.buffer.length=0}),this.miniseconds)}next(e){this.buffer.push(e)}complete(){this.sink.next(this.buffer),super.complete()}dispose(){clearInterval(this.id),super.dispose()}},"bufferTime"),ry(class extends(null){constructor(e,t){super(e),this.buffer=[],this.delayTime=t}dispose(){clearTimeout(this.timeoutId),super.dispose()}delay(e){this.timeoutId=setTimeout((()=>{let e=this.buffer.shift();if(e){let{time:t,data:n}=e;super.next(n),this.buffer.length&&this.delay(Number(this.buffer[0].time)-Number(t))}}),e)}next(e){this.buffer.length||this.delay(this.delayTime),this.buffer.push({time:new Date,data:e})}complete(){this.timeoutId=setTimeout((()=>super.complete()),this.delayTime)}},"delay"),ry(class extends(null){constructor(e,t){super(e),this.selector=t}error(e){this.dispose(),this.selector(e)(this.sink)}},"catchError"),ry(class extends(null){constructor(e,t){super(e),t instanceof Function?this.next=n=>{t(n),e.next(n)}:(t.next&&(this.next=n=>{t.next(n),e.next(n)}),t.complete&&(this.complete=()=>{t.complete(),e.complete()}),t.error&&(this.error=n=>{t.error(n),e.error(n)}))}},"tap"),ry(class extends(null){constructor(e,t){super(e),this.timeout=t,this.id=setTimeout((()=>this.error(new ly(this.timeout))),this.timeout)}next(e){super.next(e),clearTimeout(this.id),this.next=super.next}dispose(){clearTimeout(this.id),super.dispose()}},"timeout"),function(e,...t){t.reduce(((e,t)=>t(e)),e)}(function(e){return iy((t=>{let n=0,i=setInterval((()=>t.next(n++)),e);return t.defer((()=>{clearInterval(i)})),"interval"}),"interval",arguments)}(250),hy((()=>performance.now())),uy()),new Map);function Ay(e,t){let n=ru(iu({},t),{timestamp:Iu()});xy.has(e)?xy.get(e).push(n):xy.set(e,[n])}af.on(xm.JOIN_SUCCESS,(({room:e})=>{Ay(e.userId,{eventId:32788})})),af.on(xm.LEAVE_START,(({room:e})=>{Ay(e.userId,{eventId:32789})})),af.on(xm.LOCAL_TRACK_PUBLISHED,(({track:e})=>{if(e.room){let t=32769;4===e.mediaType?t=32768:2===e.mediaType&&(t=32805),Ay(e.room.userId,{eventId:t})}})),af.on(xm.LOCAL_TRACK_UNPUBLISHED,(({track:e})=>{if(e.room){let t=32771;4===e.mediaType?t=32770:2===e.mediaType&&(t=32806),Ay(e.room.userId,{eventId:t})}})),af.on(xm.TRACK_MUTED,(({track:e})=>{e.room&&(e.kind===ld.AUDIO?Ay(e.room.userId,{eventId:e.isRemote?32785:32772,remoteUserId:e.isRemote?e.userId:void 0}):Ay(e.room.userId,{eventId:e.isRemote?32784:32773,remoteUserId:e.isRemote?e.userId:void 0}))})),af.on(xm.TRACK_UNMUTED,(({track:e})=>{e.room&&(e.kind===ld.AUDIO?Ay(e.room.userId,{eventId:e.isRemote?32787:32774,remoteUserId:e.isRemote?e.userId:void 0}):Ay(e.room.userId,{eventId:e.isRemote?32786:32775,remoteUserId:e.isRemote?e.userId:void 0}))})),af.on(xm.REMOTE_TRACK_SUBSCRIBED,(({track:e})=>{!e.room||(1===e.mediaType&&Ay(e.room.userId,{eventId:32777,remoteUserId:e.userId}),4===e.mediaType&&Ay(e.room.userId,{eventId:32776,remoteUserId:e.userId}),8===e.mediaType&&Ay(e.room.userId,{eventId:32803,remoteUserId:e.userId}))})),af.on(xm.REMOTE_TRACK_UNSUBSCRIBED,(({track:e})=>{!e.room||(1===e.mediaType&&Ay(e.room.userId,{eventId:32779,remoteUserId:e.userId}),4===e.mediaType&&Ay(e.room.userId,{eventId:32778,remoteUserId:e.userId}),8===e.mediaType&&Ay(e.room.userId,{eventId:32804,remoteUserId:e.userId}))})),af.on(xm.SWITCH_DEVICE_SUCCESS,(({track:e})=>{e.room&&Ay(e.room.userId,{eventId:e.kind===ld.VIDEO?32780:32781})})),af.on(xm.LOCAL_TRACK_REPLACED,(({track:e})=>{e.room&&Ay(e.room.userId,{eventId:e.kind===ld.VIDEO?32782:32783})})),af.on(xm.SIGNAL_CONNECTION_STATE_CHANGED,(({room:e,prevState:t,state:n})=>{let i;switch(n){case"CONNECTED":i="RECONNECTING"===t?32795:32791;break;case"DISCONNECTED":i="RECONNECTING"===t?32796:32790;break;case"RECONNECTING":i=32794}i&&Ay(e.userId,{eventId:i})})),af.on(xm.PEER_CONNECTION_STATE_CHANGED,(({room:e,prevState:t,state:n,remoteUserId:i})=>{let r,o=!!i;switch(n){case"CONNECTED":r="RECONNECTING"===t?o?32801:32798:o?32793:32792;break;case"DISCONNECTED":"RECONNECTING"===t&&(r=o?32802:32799);break;case"RECONNECTING":r=o?32800:32797}r&&Ay(e.userId,{eventId:r,remoteUserId:i})})),af.on(xm.VIDEO_CODEC_IMPLEMENTATION_CHANGED,(({userId:e,remoteUserId:t,codec:n,isHWCodec:i,prevImplementation:r,streamType:o})=>{let a=i?1:0;r||(a=i?3:2);let s="h264"===n?0:2,l={eventId:4004,param1:a,param2:s,streamType:o||2};t&&(l.remoteUserId=t,l.eventId=4005),Ay(e,l),Kg.addEnum({key:t?514701:513701,value:a}),Kg.addEnum({key:t?514700:513700,value:s})})),af.on(xm.LOCAL_TRACK_RECAPTURE,(({track:e,error:t})=>{if(e.userId){let n={eventId:2003,param1:0};e.kind===ld.AUDIO?(n.streamType=1,t&&(n.param1=2)):(n.streamType="auxiliary"===e.streamType?7:2,t&&(n.param1=8)),Ay(e.userId,n)}}));var wy=su(hu(),1),Iy=class extends wy.EventEmitter{constructor(e,t,n="userId"){super(),this.mySelfId=e,this._log=t,this.key=n,cu(this,"userMap",new Map),cu(this,"remotePublishedUserMap",new Map)}getPublishedUser(e){return this.remotePublishedUserMap.get(e)}addUser(e){let t=e[this.key],{userId:n,tinyId:i,role:r}=e;if(this.userMap.has(t))return;let o={userId:n,tinyId:i,role:20===r?"anchor":"audience"};this.userMap.set(t,o),this.emit("1",o)}deleteUser(e,t){let n=this.userMap.get(e);if(!n)return;let i=`peer leave [${e}]`;Ff(t)||(i+=`:${ih[t]}`),this._log.info(i);let r=this.remotePublishedUserMap.get(e);if(r){let t=r.muteState;r.flag=0,this.emit("5",r.userId),this.deleteRemotePublishedUser(e),this.emit("6",{prevMuteState:t,muteState:r.muteState,flag:0})}this.userMap.delete(e),this.emit("2",n.userId)}setUserList(e){this.userMap.forEach((t=>{e.findIndex((e=>e[this.key]===t[this.key]))<0&&this.deleteUser(t[this.key],0)})),e.forEach((e=>{!this.userMap.has(e[this.key])&&e[this.key]!==this.mySelfId&&this.addUser(e)}))}addRemotePublishedUser(e){this.remotePublishedUserMap.has(e[this.key])||this.remotePublishedUserMap.set(e[this.key],e)}deleteRemotePublishedUser(e){!this.remotePublishedUserMap.has(e)||this.remotePublishedUserMap.delete(e)}setRemotePublishedUserList(e){this.remotePublishedUserMap.forEach((t=>{let n=t[this.key];if(e.findIndex((e=>e[this.key]===t[this.key]))<0){this._log.info(`remote [${n}] unpublish`);let e=t.muteState;t.flag=0,this.emit("5",t.userId),this.deleteRemotePublishedUser(n),this.emit("6",{prevMuteState:e,muteState:t.muteState,flag:0})}})),e.forEach((e=>{var t;let n=e[this.key];if(n===this.mySelfId)return;let{flag:i,userId:r,tinyId:o}=e,a=rm(i,r),s=null==(t=this.remotePublishedUserMap.get(n))?void 0:t.muteState;if(s){let e=this.remotePublishedUserMap.get(n);e&&e.flag!==i&&(e.flag=i,this._log.info(`remote publish updated: ${JSON.stringify(e.muteState)}`),this.emit("6",{prevMuteState:s,muteState:a,flag:i}))}else this._log.info(`remote publish. state: ${JSON.stringify(a)}`),this.addUser({userId:r,tinyId:o,role:20}),this.emit("3",e),this.emit("6",{prevMuteState:rm(0,r),muteState:a,flag:i})}))}clear(){this.userMap.clear(),this.remotePublishedUserMap.clear()}};function Ry({timesInSecond:e,maxSizeInSecond:t,getSize:n}){return lv(((i,r)=>{let o=new Map;return af.on(xm.ROOM_DESTROY,(({room:e})=>o.delete(e))),function(...a){let s=o.get(this);if(s||(s={callCountInSecond:0,timestamp:0,totalSizeInSecond:0},o.set(this,s)),0===s.timestamp?s.timestamp=Date.now():Date.now()-s.timestamp>1e3&&(s.timestamp=Date.now(),s.callCountInSecond=0,s.totalSizeInSecond=0),n&&(s.totalSizeInSecond+=n(...a)),0!==s.timestamp&&Date.now()-s.timestamp<1e3&&(s.callCountInSecond>=e||s.totalSizeInSecond>t))throw new Au({code:Tu.INVALID_OPERATION,message:nf({key:fh.CALL_FREQUENCY_LIMIT,data:{isTimes:s.callCountInSecond>=e,isSize:s.totalSizeInSecond>t,name:r,timesInSecond:e,maxSizeInSecond:t}})});s.callCountInSecond++,i.call(this,...a)}}))}var Cy,My=!0,ky={SCENE_LIVE:"live",SCENE_RTC:"rtc",ROLE_ANCHOR:"anchor",ROLE_AUDIENCE:"audience",STREAM_TYPE_MAIN:"main",STREAM_TYPE_SUB:"sub",AUDIO_PROFILE_STANDARD:"standard",AUDIO_PROFILE_STANDARD_STEREO:"standard-stereo",AUDIO_PROFILE_HIGH:"high",AUDIO_PROFILE_HIGH_STEREO:"high-stereo",QOS_PREFERENCE_SMOOTH:"smooth",QOS_PREFERENCE_CLEAR:"clear"},Ny=(e=>(e.Debug="Debug",e))(Ny||{}),Dy={INVALID_PARAMETER:5e3,INVALID_OPERATION:5100,ENV_NOT_SUPPORTED:5200,DEVICE_ERROR:5300,SERVER_ERROR:5400,OPERATION_FAILED:5500,OPERATION_ABORT:5998,UNKNOWN_ERROR:5999},Oy=((Cy=Oy||{})[Cy.INVALID_PARAMETER=5e3]="INVALID_PARAMETER",Cy[Cy.INVALID_PARAMETER_REQUIRED=5001]="INVALID_PARAMETER_REQUIRED",Cy[Cy.INVALID_PARAMETER_TYPE=5002]="INVALID_PARAMETER_TYPE",Cy[Cy.INVALID_PARAMETER_EMPTY=5003]="INVALID_PARAMETER_EMPTY",Cy[Cy.INVALID_PARAMETER_INSTANCE=5004]="INVALID_PARAMETER_INSTANCE",Cy[Cy.INVALID_PARAMETER_RANGE=5005]="INVALID_PARAMETER_RANGE",Cy[Cy.INVALID_PARAMETER_LESS_THAN_ZERO=5006]="INVALID_PARAMETER_LESS_THAN_ZERO",Cy[Cy.INVALID_PARAMETER_MIN=5007]="INVALID_PARAMETER_MIN",Cy[Cy.INVALID_PARAMETER_MAX=5008]="INVALID_PARAMETER_MAX",Cy[Cy.INVALID_ELEMENT_ID=5009]="INVALID_ELEMENT_ID",Cy[Cy.INVALID_ELEMENT_ID_TYPE=5010]="INVALID_ELEMENT_ID_TYPE",Cy[Cy.INVALID_STREAM_ID=5011]="INVALID_STREAM_ID",Cy[Cy.INVALID_ROOM_ID_STRING=5012]="INVALID_ROOM_ID_STRING",Cy[Cy.INVALID_ROOM_ID_INTEGER=5013]="INVALID_ROOM_ID_INTEGER",Cy[Cy.INVALID_STREAM_TYPE=5014]="INVALID_STREAM_TYPE",Cy[Cy.INVALID_ROOM_ID_REQUIED=5015]="INVALID_ROOM_ID_REQUIED",Cy[Cy.INVALID_ROOM_ID_INTEGER_STRING=5016]="INVALID_ROOM_ID_INTEGER_STRING",Cy[Cy.INVALID_BUFFER_EMPTY=5017]="INVALID_BUFFER_EMPTY",Cy[Cy.INVALID_BUFFER_OVERSIZE=5018]="INVALID_BUFFER_OVERSIZE",Cy[Cy.INVALID_OPERATION=5100]="INVALID_OPERATION",Cy[Cy.INVALID_OPERATION_NOT_JOINED=5101]="INVALID_OPERATION_NOT_JOINED",Cy[Cy.INVALID_OPERATION_REMOTE_USER_NOT_EXIST=5102]="INVALID_OPERATION_REMOTE_USER_NOT_EXIST",Cy[Cy.INVALID_OPERATION_STREAM_TYPE_NOT_EXIST=5103]="INVALID_OPERATION_STREAM_TYPE_NOT_EXIST",Cy[Cy.INVALID_OPERATION_REPEAT_CALL=5104]="INVALID_OPERATION_REPEAT_CALL",Cy[Cy.INVALID_OPERATION_NEED_VIDEO=5105]="INVALID_OPERATION_NEED_VIDEO",Cy[Cy.INVALID_OPERATION_NEED_AUDIO=5106]="INVALID_OPERATION_NEED_AUDIO",Cy[Cy.INVALID_ROLE_AUDIENCE=5107]="INVALID_ROLE_AUDIENCE",Cy[Cy.INVALID_NOT_ENABLE_SEI=5108]="INVALID_NOT_ENABLE_SEI",Cy[Cy.INVALID_NEED_CALL_PUBLISHED=5109]="INVALID_NEED_CALL_PUBLISHED",Cy[Cy.ENV_NOT_SUPPORTED=5200]="ENV_NOT_SUPPORTED",Cy[Cy.NOT_SUPPORTED_HTTP=5201]="NOT_SUPPORTED_HTTP",Cy[Cy.NOT_SUPPORTED_WEBRTC=5202]="NOT_SUPPORTED_WEBRTC",Cy[Cy.NOT_SUPPORTED_H264_ENCODE=5203]="NOT_SUPPORTED_H264_ENCODE",Cy[Cy.NOT_SUPPORTED_H264_DECODE=5204]="NOT_SUPPORTED_H264_DECODE",Cy[Cy.NOT_SUPPORTED_SCREEN_SHARE=5205]="NOT_SUPPORTED_SCREEN_SHARE",Cy[Cy.NOT_SUPPORTED_SMALL_VIDEO=5206]="NOT_SUPPORTED_SMALL_VIDEO",Cy[Cy.NOT_SUPPORTED_SEI=5207]="NOT_SUPPORTED_SEI",Cy[Cy.NOT_SUPPORTED_WEBGL=5208]="NOT_SUPPORTED_WEBGL",Cy[Cy.NOT_SUPPORTED_CHROME_VERSION=5209]="NOT_SUPPORTED_CHROME_VERSION",Cy[Cy.DEVICE_ERROR=5300]="DEVICE_ERROR",Cy[Cy.DEVICE_NOT_FOUND_ERROR=5301]="DEVICE_NOT_FOUND_ERROR",Cy[Cy.DEVICE_NOT_ALLOWED_ERROR=5302]="DEVICE_NOT_ALLOWED_ERROR",Cy[Cy.DEVICE_NOT_READABLE_ERROR=5303]="DEVICE_NOT_READABLE_ERROR",Cy[Cy.DEVICE_OVERCONSTRAINED_ERROR=5304]="DEVICE_OVERCONSTRAINED_ERROR",Cy[Cy.DEVICE_INVALID_STATE_ERROR=5305]="DEVICE_INVALID_STATE_ERROR",Cy[Cy.DEVICE_SECURITY_ERROR=5306]="DEVICE_SECURITY_ERROR",Cy[Cy.DEVICE_ABORT_ERROR=5307]="DEVICE_ABORT_ERROR",Cy[Cy.CAMERA_RECOVER_FAILED=5308]="CAMERA_RECOVER_FAILED",Cy[Cy.MICROPHONE_RECOVER_FAILED=5309]="MICROPHONE_RECOVER_FAILED",Cy[Cy.SERVER_ERROR=5400]="SERVER_ERROR",Cy[Cy.NEED_TO_BUY=5401]="NEED_TO_BUY",Cy[Cy.ACCOUNT_NO_MONEY=-100013]="ACCOUNT_NO_MONEY",Cy[Cy.OPERATION_FAILED=5500]="OPERATION_FAILED",Cy[Cy.FIREWALL_RESTRICTION=5501]="FIREWALL_RESTRICTION",Cy[Cy.REJOIN_FAILED=5502]="REJOIN_FAILED",Cy[Cy.EVENT_HANDLER_ERROR=5503]="EVENT_HANDLER_ERROR",Cy[Cy.VIDEO_CONTEXT_ERROR=5504]="VIDEO_CONTEXT_ERROR",Cy[Cy.OPERATION_ABORT=5998]="OPERATION_ABORT",Cy[Cy.UNKNOWN_ERROR=5999]="UNKNOWN_ERROR",Cy),Py=ru(iu({},mh),{INVALID_PARAMETER:({fnName:e})=>`the parameters of the '${e}' you called does not meet the requirements, please check the API documentation.`,INVALID_PARAMETER_REQUIRED:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' is a required param when calling ${n}(), received: ${i}.`,INVALID_PARAMETER_TYPE({key:e,rule:t,fnName:n,value:i}){let r=`${e||t.name}`,o="";return o=Array.isArray(t.type)?t.type.join("|"):t.type,`'${r}' must be type of ${o} when calling ${n}(), received type: ${Uf(i)}.`},INVALID_PARAMETER_EMPTY:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' cannot be '${i}' when calling ${n}().`,INVALID_PARAMETER_INSTANCE:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' must be instanceof ${t.instanceOf.name||t.instanceOf} when calling ${n}(), received type: ${Uf(i)}.`,INVALID_PARAMETER_RANGE:({key:e,rule:t,fnName:n,value:i})=>`'${e||t.name}' must be one of ${t.values.join("|")} when calling ${n}(), received: ${i}.`,INVALID_PARAMETER_LESS_THAN_ZERO:({key:e,rule:t,fnName:n})=>`'${e||t.name}' cannot be less than 0 when calling ${n}().`,INVALID_PARAMETER_MIN:({key:e,rule:t,value:n})=>`the min value of ${e||t.name} is ${t.min}, received: ${n}.`,INVALID_PARAMETER_MAX:({key:e,rule:t,value:n})=>`the max value of ${e||t.name} is ${t.max}, received: ${n}.`,INVALID_ELEMENT_ID:({key:e,fnName:t})=>`'${e}' is not found in the document object when calling ${t}().`,INVALID_ELEMENT_ID_TYPE:({key:e,fnName:t,type:n})=>`the element corresponding to '${e}' must be instanceof HTMLElement when calling ${t}(), received: ${n}.`,INVALID_STREAM_ID:({key:e})=>`'${e}' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores.`,INVALID_ROOM_ID_STRING:({key:e})=>`'${e}' must be a valid string.`,INVALID_ROOM_ID_INTEGER:({key:e})=>`'${e}' must be an integer between [1, 4294967294].`,INVALID_ROOM_ID_INTEGER_STRING:({key:e})=>`'${e}' must be an integer but go a string, use 'parseInt' to convert it or use 'strRoomId' instead.`,INVALID_ROOM_ID_REQUIED:()=>"at least one of 'roomId'(between [1, 4294967294]) and 'strRoomId'(not empty) is required.",INVALID_STREAM_TYPE:({fnName:e})=>`'streamType' is required when 'userId' is not '*', calling ${e}()`,INVALID_IMAGE_URL:"The 'src' param must be filled in when the background type is image.",INVALID_OPERATION:({fnName:e})=>`the API '${e}' you called does not meet the requirements, please check the API documentation.`,INVALID_OPERATION_NOT_JOINED:({fnName:e})=>`cannot ${e} because you are not enter room yet.`,INVALID_OPERATION_REMOTE_USER_NOT_EXIST:({fnName:e,value:t})=>`cannot ${e} because remote user(userId: ${t.userId}) does not publishing stream.`,INVALID_OPERATION_STREAM_TYPE_NOT_EXIST:({fnName:e,value:t})=>`cannot ${e} because remote user(userId: ${t.userId}) does not publishing ${t.streamType} video.`,INVALID_OPERATION_REPEAT_CALL:({fnName:e})=>`you are already ${e}(), cannot repeated call '${e}'.`,INVALID_OPERATION_NEED_VIDEO:({fnName:e})=>`cannot call '${e}' because the camera is not turned on.`,INVALID_OPERATION_NEED_AUDIO:({fnName:e})=>`cannot call '${e}' because the microphone is not turned on.`,INVALID_BUFFER_EMPTY:({key:e})=>`the buffer size of paramerter '${e}' cannot be empty`,INVALID_BUFFER_OVERSIZE:()=>"buffer size is over 1000 Bytes",INVALID_ROLE_AUDIENCE:()=>"role: 'audience' cannot call this api.",INVALID_NOT_ENABLE_SEI:()=>"you need to enable SEI in TRTC.create({ enableSEI: true })",INVALID_NEED_CALL_PUBLISHED:({fnName:e})=>`you need to call ${e}() after publish stream.`,ENV_NOT_SUPPORTED:({fnName:e})=>`the current browser does not support the capability of the function '${e}' you are calling, please check the API documentation.`,NOT_SUPPORTED_WEBRTC:"the current browser does not support WebRTC capability, please check the SDK documentation.",NOT_SUPPORTED_H264_ENCODE:"this browser does not support H264 encode.",NOT_SUPPORTED_H264_DECODE:"this browser does not support H264 decode.",NOT_SUPPORTED_SCREEN_SHARE:"this browser does not support screen share, please check the browser version.",NOT_SUPPORTED_SMALL_VIDEO:"this browser does not support small video, please check the browser version.",NOT_SUPPORTED_SEI:"this browser does not support SEI, please check the browser version.",NOT_SUPPORTED_WEBGL:"this browser does not support WebGL, please check the browser version.",NOT_SUPPORTED_CHROME_VERSION:({fnName:e})=>`cannot call ${e} because the browser version is too low, please upgrade to the latest version`,DEVICE_ERROR:({fnName:e,error:t})=>`'${e}' got device exception${t?`, error: ${t.toString()}.`:"."}`,DEVICE_NOT_FOUND_ERROR:({fnName:e,deviceType:t=Ly(e),error:n})=>`NotFoundError, no ${t} detected, please check your device and the configuration on '${e}'${n?`, error: ${n.toString()}.`:"."}`,DEVICE_NOT_ALLOWED_ERROR:({fnName:e,deviceType:t=Ly(e),error:n})=>`NotAllowedError, you have disabled ${t} access, please allow the current application to use the ${t}${n?`, error: ${n.toString()}.`:"."}`,DEVICE_NOT_READABLE_ERROR:({fnName:e,deviceType:t=Ly(e),error:n})=>`NotReadableError, the ${t} maybe in use by another APP, please check if the device is pre-occupied by another APP.`,DEVICE_OVERCONSTRAINED_ERROR:({fnName:e,deviceType:t=Ly(e),error:n})=>"OverconstrainedError, the device ID is incorrect, please check whether the device ID passed in is correct"+(n?`, error: ${n.toString()}.`:"."),DEVICE_INVALID_STATE_ERROR:({fnName:e,deviceType:t=Ly(e),error:n})=>`InvalidStateError, after the user clicks and interacts with the page, turn on the ${t}${n?`, error: ${n.toString()}.`:"."}`,DEVICE_SECURITY_ERROR:({fnName:e,deviceType:t=Ly(e),error:n})=>`SecurityError, check whether the system security policy restricts the use of the ${t}, and it is recommended to turn on the ${t} after the user interacts with the page${n?`, error: ${n.toString()}.`:"."}`,DEVICE_ABORT_ERROR:({fnName:e,deviceType:t=Ly(e),error:n})=>"AbortError, an unknown exception in the system makes the device unusable, recommended to change the device or browser and re-check whether the device is normal"+(n?` error: ${n.toString()}.`:"."),CAMERA_RECOVER_FAILED:({error:e})=>`camera recover capture failed ${(null==e?void 0:e.name)||""}: ${(null==e?void 0:e.originMessage)||(null==e?void 0:e.message)}`,MICROPHONE_RECOVER_FAILED:({error:e})=>`microphone recover capture failed ${(null==e?void 0:e.name)||""}: ${(null==e?void 0:e.originMessage)||(null==e?void 0:e.message)}`,OPERATION_FAILED:({fnName:e,error:t})=>`'${e}' failed, reason: ${null==t?void 0:t.toString()}`,FIREWALL_RESTRICTION:()=>"media connection failure due to firewall restrictions, please try to change your network.",EVENT_HANDLER_ERROR:({eventName:e})=>`an error was caught on trtc.on('${e}', handler), please check your code on 'handler'.`,VIDEO_CONTEXT_ERROR:({reason:e,error:t})=>`video context error ${e} ${(null==t?void 0:t.name)||""} ${(null==t?void 0:t.message)||""}`,SERVER_ERROR:({fnName:e,error:t})=>`'${e}' got server error: ${null==t?void 0:t.toString()}, please check the SDK documentation.`,NEED_TO_BUY:({value:e,url:t})=>`You need to buy packages for ${e}. Refer to: ${t}`,ACCOUNT_NO_MONEY:({fnParams:e})=>"your TRTC account run out of credit, please recharge."+(e.sdkAppId?` SDKAppId: ${e.sdkAppId}`:""),OPERATION_ABORT:({fnName:e})=>`'${e}' abort`,UNKNOWN_ERROR:({fnName:e,error:t})=>`'${e}' throw unknown exception${t?`, error: ${t.toString()}.`:"."}`});function Ly(e){if(!e)return"camera";let t=e.toLowerCase();return t.includes("screen")?"screen share":t.includes("audio")?"microphone":"camera"}var Uy=class extends Error{constructor({code:e,extraCode:t,message:n="",messageParams:i,fnName:r="",originError:o}){var a;let s;s=n||function({code:e,params:t,enableDocLink:n=!1}){let i,r="",o=Oy[e];try{i=Py[o]}catch(e){i=Py.UNKNOWN_ERROR}return Vf(i)?r=i(t):Bf(i)&&(r=i),t.fnName&&!r.includes(t.fnName)&&("."!==r[r.length-1]&&(r+="."),r+=` thrown from ${t.fnName}()`),n&&(r+=" doc:"),r}({code:t||e,params:iu({fnName:r,error:o},i)}),super(s),cu(this,"name","RtcError"),cu(this,"code"),cu(this,"extraCode"),cu(this,"functionName"),cu(this,"message"),cu(this,"handler"),cu(this,"originError"),this.name=Oy[e],this.code=e,this.extraCode=t,this.functionName=r,this.originError=o,this.message=s,5302===this.extraCode&&(null==(a=this.originError)?void 0:a.message.includes("system"))&&(this.handler=()=>{let e=document.createElement("a");lp?e.href=`ms-settings:privacy-${{startLocalVideo:"webcam",startLocalAudio:"microphone"}[this.functionName]}`:cp&&(e.href=`x-apple.systempreferences:com.apple.preference.security?Privacy_${{startLocalVideo:"Camera",startLocalAudio:"Microphone",startScreenShare:"ScreenCapture"}[this.functionName]}`),e.href.length>0&&e.click()})}static convertFrom(e,t,n){let i=e;if(e instanceof Au){let{stack:r}=e,o={code:Dy.UNKNOWN_ERROR,fnName:t,originError:e};switch(e.getCode()){case Tu.INVALID_PARAMETER:o.code=Dy.INVALID_PARAMETER,o.message=e.message;break;case Tu.INVALID_OPERATION:o.code=Dy.INVALID_OPERATION;break;case Tu.NOT_SUPPORTED:case Tu.NOT_SUPPORTED_H264:o.code=Dy.ENV_NOT_SUPPORTED,e.getCode()===Tu.NOT_SUPPORTED_H264&&(o.extraCode=e.message.includes(mh.NOT_SUPPORTED_H264ENCODE)?5203:5204);break;case Tu.JOIN_ROOM_FAILED:o.messageParams={fnParams:n};case Tu.SERVER_TIMEOUT:case Tu.SWITCH_ROLE_FAILED:o.code=Dy.SERVER_ERROR,o.extraCode=e.getExtraCode();break;case Tu.API_CALL_ABORTED:o.code=Dy.OPERATION_ABORT;break;case Tu.DEVICE_NOT_FOUND:case Tu.DEVICE_AUTO_RECOVER_FAILED:case Tu.INITIALIZE_FAILED:o.code=5300,e.name&&(o.extraCode=function(e){let t;switch(e){case"NotFoundError":t=5301;break;case"NotAllowedError":t=5302;break;case"NotReadableError":t=5303;break;case"OverconstrainedError":t=5304;break;case"InvalidStateError":t=5305;break;case"SecurityError":t=5306;break;case"AbortError":t=5307;break;default:t=5300}return t}(e.name));break;case Tu.UNKNOWN:break;default:o.code=Dy.OPERATION_FAILED}i=new Uy(o),r&&(i.stack+=r.substr(r.indexOf("\n")))}else{if(e instanceof Uy)return e;i=new Uy({code:Dy.UNKNOWN_ERROR,fnName:t,originError:e})}return i}},Vy=Uy,Fy={type:"object",properties:{cameraId:{type:"string"},useFrontCamera:{type:"boolean"},fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:["string","boolean"],values:[!0,!1,"view","publish","both"]},small:{properties:{width:{type:"number"},height:{type:"number"},frameRate:{type:"number"},bitrate:{type:"number"}}},videoTrack:{instanceOf:MediaStreamTrack}}},By={type:"object",properties:{systemAudio:{type:"boolean"},fillMode:{type:"string",values:["contain","cover","fill"]},profile:{type:["string","object"],properties:{width:{type:"number"},height:{type:"number"},frameRate:{type:"number"},bitrate:{type:"number"}}},videoTrack:{instanceOf:MediaStreamTrack},audioTrack:{instanceOf:MediaStreamTrack}}},Hy={type:["string",HTMLElement,null,"array"],arrayItem:{instanceOf:HTMLElement},validate(e,t,n){if(Bf(e)&&!document.getElementById(e))throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5009,fnName:n,messageParams:{key:t}})}},zy={name:"userId",required:!0,type:"string"},jy={type:"object",properties:{microphoneId:{type:"string"},audioTrack:{instanceOf:MediaStreamTrack},captureVolume:{type:"number",min:0},earMonitorVolume:{type:"number",min:0,max:100},profile:{values:[ky.AUDIO_PROFILE_STANDARD,ky.AUDIO_PROFILE_STANDARD_STEREO,ky.AUDIO_PROFILE_HIGH,ky.AUDIO_PROFILE_HIGH_STEREO]},echoCancellation:{type:"boolean"},autoGainControl:{type:"boolean"},noiseSuppression:{type:"boolean"}}};function Gy(e,t){if(!e)throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5101,fnName:t})}function $y(e,t,n){if(!e)throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5102,fnName:t,messageParams:{value:n}})}var Wy={create:[{name:"RoomConfig",instanceOf:Function},{name:"CreateConfig",type:"object",properties:{plugins:{type:"array",arrayItem:{instanceOf:Function}}}}],enterRoom:{name:"EnterRoomConfig",type:"object",required:!0,validate(e,t,n){if(this._room.isJoined)throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5104,fnName:n});if(e.roomId){if(Bf(e.roomId))throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5016,fnName:n,messageParams:{key:t}});if(!(/^[1-9]\d*$/.test(String(e.roomId))&&e.roomId<4294967295))throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5013,fnName:n,messageParams:{key:t}})}else{if(!e.strRoomId)throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5015,fnName:n});if(!/^[A-Za-z\d\s!#$%&()+\-:;<=.>?@[\]^_{}|~,]{1,64}$/.test(e.strRoomId))throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5012,fnName:n,messageParams:{key:t}})}},properties:{sdkAppId:{required:!0,type:"number",allowEmpty:!1},userId:{required:!0,type:"string",allowEmpty:!1},userSig:{required:!0,type:"string",allowEmpty:!1},scene:{type:"string",values:["live","rtc"]},role:{type:"string",values:["audience","anchor"]},roomId:{type:["string","number"]},strRoomId:{type:"string"},proxy:{type:["object","string"],properties:{websocketProxy:{type:"string"},turnServer:{type:["object","array"],properties:{url:{required:!0,type:"string"},username:{type:"string"},credential:{type:"string"},credentialType:{type:"string",values:["password"]}}},loggerProxy:{type:"string"},webtransportProxy:{type:"string"}}},enableAutoPlayDialog:{type:"boolean"},userDefineRecordId:{type:"string"},latencyLevel:{type:"number"}}},startLocalVideo:{name:"LocalVideoConfig",type:"object",properties:{view:Hy,mute:{type:["boolean","string"]},publish:{type:"boolean"},option:Fy},validate(e){var t;if((null==(t=null==e?void 0:e.option)||!t.videoTrack)&&Vm())throw new Vy({code:Dy.ENV_NOT_SUPPORTED,extraCode:5201})}},updateLocalVideo:{name:"updateLocalVideoConfig",type:"object",required:!0,properties:{view:ru(iu({},Hy),{required:!1}),publish:{type:"boolean"},mute:{type:["boolean","string"]},option:Fy}},startLocalAudio:{name:"LocalAudioConfig",type:"object",properties:{publish:{type:"boolean"},option:jy},validate(e){var t;if((null==(t=null==e?void 0:e.option)||!t.audioTrack)&&Vm())throw new Vy({code:Dy.ENV_NOT_SUPPORTED,extraCode:5201})}},updateLocalAudio:{name:"updateLocalAudioConfig",type:"object",required:!0,properties:{publish:{type:"boolean"},mute:{type:"boolean"},option:jy}},startScreenShare:{name:"ScreenShareConfig",type:"object",properties:{view:Hy,publish:{type:"boolean"},option:By},validate(e,t,n,i,r){var o;if((null==(o=null==e?void 0:e.option)||!o.videoTrack)&&Vm())throw new Vy({code:Dy.ENV_NOT_SUPPORTED,extraCode:5201});if(!Gm())throw new Vy({code:Dy.ENV_NOT_SUPPORTED,fnName:n,extraCode:5205})}},updateScreenShare:{name:"updateScreenShareConfig",type:"object",required:!0,properties:{view:Hy,publish:{type:"boolean"},option:By}},muteRemoteAudio:[zy,{name:"mute",required:!0,type:"boolean"}],setRemoteAudioVolume:[zy,{name:"volume",required:!0,type:"number",min:0}],startRemoteVideo:{name:"startRemoteVideoConfig",type:"object",required:!0,properties:{view:Hy,userId:{type:"string",required:!0},streamType:{values:["main","sub"],required:!0},option:{type:"object",properties:{fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:"boolean"}}}},validate(e,t,n){Gy(this._room.isJoined,n);let i=this._room.remotePublishedUserMap.get(e.userId);if($y(!!i,n,e),i&&("main"===e.streamType&&!i.muteState.videoAvailable||"sub"===e.streamType&&!i.muteState.hasAuxiliary))throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5103,fnName:n,messageParams:{value:e}})}},updateRemoteVideo:{name:"updateRemoteVideoConfig",type:"object",required:!0,properties:{view:ru(iu({},Hy),{required:!1}),userId:{type:"string",required:!0},streamType:{values:["main","sub"],required:!0},option:{type:"object",properties:{fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:"boolean"}}}},validate(e,t,n){Gy(this._room.isJoined,n);let i=this._room.remotePublishedUserMap.get(e.userId);if($y(!!i,n,e),i&&("main"===e.streamType&&!i.muteState.videoAvailable||"sub"===e.streamType&&!i.muteState.hasAuxiliary))throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5103,fnName:n,messageParams:{value:e}})}},stopRemoteVideo:{name:"stopRemoteVideoConfig",type:"object",required:!0,properties:{userId:{type:"string",required:!0},streamType:{values:["main","sub"]}},validate(e,t,n){if("*"!==e.userId&&Ff(e.streamType))throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5014,fnName:n})}},switchRole:{name:"role",required:!0,values:["anchor","audience"],validate(e,t,n){Gy(this._room.isJoining||this._room.isJoined,n)}},enableAudioVolumeEvaluation:[{name:"interval",type:"number"},{name:"enableInBackground",type:"boolean"}],sendSEIMessage:[{name:"buffer",required:!0,instanceOf:ArrayBuffer,validate(e,t,n,i){if(!ug)throw new Vy({code:Dy.ENV_NOT_SUPPORTED,fnName:n,extraCode:5207});if(!this._room.enableSEI)throw new Vy({code:Dy.INVALID_OPERATION,fnName:n,extraCode:5108});if(e.byteLength>1e3)throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5018,fnName:n});if(0===e.byteLength)throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5017,messageParams:{key:t},fnName:n});Gy(this._room.isJoined,n)}},{name:"options",type:"object",properties:{seiPayloadType:{type:"number",values:[5,243]},toSubStream:{type:"boolean",validate(e,t,n){if(!e&&!this._room.isMainStreamPublished||e&&!this._room.isAuxStreamPublished)throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5109,messageParams:{key:t},fnName:n})}}}}],sendCustomMessage:{name:"message",required:!0,type:"object",properties:{cmdId:{type:"number",required:!0,min:1,max:10},data:{instanceOf:ArrayBuffer,required:!0,validate(e,t,n,i){if(e.byteLength>1e3)throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5018,fnName:n});if(0===e.byteLength)throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5017,fnName:n,messageParams:{key:t}})}}},validate(e,t,n){if(Gy(this._room.isJoined,n),"live"===this._room.scene&&"audience"===this._room.role)throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5107,fnName:n,messageParams:{key:t}})}}},qy={TRTC:Wy},Xy=class extends Error{};function Yy(e,t){let n=lm(e);for(let e=0;e<t.length;e++)sm(n[e],t[e]);return n}function Jy(e){this._resolve=Promise.resolve(e)}function Ky(e){this._reject=Promise.reject(e)}var Qy=class{constructor(e,t){this.instance=e,this.group=t,this.started=!1,this.ops=[],this.startSame=()=>!0,this.mergeUpdate=Yy;let n=Qy.instances.get(e);n?n.set(t,this):Qy.instances.set(e,new Map([[t,this]]))}static get(e,t){if(!t)return;let n=Qy.instances.get(e);return n&&n.get(t)||new Qy(e,t)}static gets(e,t){let n=Qy.instances.get(e),i=[];return n&&n.forEach(((e,n)=>{t.test(n)&&i.push(e)})),i}action(e,t,n){let i=t=>{var n;return 0===e?this.started=!0:3===e&&(this.started=!1),this.ops.shift(),null==(n=this.currentOp)||n.action(),t},r=t=>{var n,i;throw this.ops.shift(),0===e&&2===(null==(n=this.currentOp)?void 0:n.type)&&this.ops.shift().reject(new Xy("start failed")),null==(i=this.currentOp)||i.action(),t},o={type:e,action:()=>t(...o.args).then(i,r),args:n,resolve:Jy,reject:Ky};try{switch(this.state){case 1:if(0===e)throw new Xy("already started");break;case 4:if(2===e)throw new Xy("not started");break;default:return this.cacheOp(o)}}catch(e){return Promise.reject(e)}return this.ops.push(o),o.promise=t(...o.args).then(i,r)}cacheOp(e){if(1===this.ops.length)switch(this.state){case 0:case 2:if(0===e.type)throw new Xy("already start");break;case 3:switch(e.type){case 2:throw new Xy("update not allowed when stopping");case 3:return this.currentOp.promise}break;default:throw new Xy("unknown state")}else switch(e.type){case 3:if(3===this.lastOpType)return this.lastOp.promise;{let e=new Xy("keep stop");if(this.ops.slice(1).forEach((t=>t.reject(e))),this.ops=this.ops.slice(0,1),3===this.state)return this.currentOp.promise}break;case 2:switch(this.lastOpType){case 2:return this.lastOp.args=this.mergeUpdate(this.lastOp.args,e.args),this.lastOp.promise;case 3:throw new Xy("update not allowed after stop")}break;case 0:switch(this.lastOpType){case 2:throw new Xy("start not allowed after update");case 0:throw new Xy("duplicate start");case 3:if(this.startSame(this.currentOp.args,e.args))throw this.ops.pop().reject(new Xy("keep start")),new Xy("already start")}}e.promise=new Promise(((t,n)=>{e._resolve?e._resolve.then(t):e.resolve=t,e._reject?e._reject.catch(n):e.reject=n}));let{action:t}=e;return e.action=()=>t().then(e.resolve,e.reject),this.ops.push(e),e.promise}get lastOp(){return this.ops[this.ops.length-1]}get lastOpType(){return this.lastOp.type}get currentOp(){return this.ops[0]}get state(){return this.currentOp?this.currentOp.type:this.started?1:4}},Zy=Qy;Zy.instances=new WeakMap;var eE=new WeakMap,tE=(e,t)=>{if(t instanceof Xy){let{stack:n}=t;t=new Vy({code:Dy.OPERATION_ABORT,message:`${e} abort: ${t.message}`,fnName:e}),n&&(t.stack+=n.substr(n.indexOf("\n")))}throw t};function nE(e,t){return lv(((n,i)=>function(...r){let o=Zy.get(this,"string"==typeof e?e:e.call(this,...r));return o?(t&&(o.startSame=t.bind(this)),o.action(0,n.bind(this),r).catch(tE.bind(null,i))):n.apply(this,r)}))}function iE(e,t){let{merge:n,debounce:i}=t||{};return lv(((t,r)=>function(...o){let a=Zy.get(this,"string"==typeof e?e:e.call(this,...o));if(!a)return t.apply(this,o);if(n&&(a.mergeUpdate=n.bind(this)),i&&i.isNeedToDebounce.apply(this,o)){let{delay:e,getKey:n}=i;return new Promise(((i,s)=>{var l,c;let u=null==(l=eE.get(this))?void 0:l.get(n(...o));if(u){let{timeoutId:e,resolve:t}=u;clearTimeout(e),t()}let d=setTimeout((()=>{if(3===a.state||4===a.state)return i();a.action(2,t.bind(this),o).catch(tE.bind(null,r)).then(i,s)}),e);eE.has(this)?null==(c=eE.get(this))||c.set(n(...o),{timeoutId:d,resolve:i}):eE.set(this,new Map([[n(...o),{timeoutId:d,resolve:i}]]))}))}return a.action(2,t.bind(this),o).catch(tE.bind(null,r))}))}function rE(e){return lv(((t,n)=>function(...i){let r="function"==typeof e?e.call(this,...i):e;if(r instanceof RegExp)return Promise.all(Zy.gets(this,r).map((e=>e.action(3,(()=>Promise.resolve()),i)))).then((()=>t.call(this,...i)));let o=Zy.get(this,r);return o?o.action(3,t.bind(this),i).catch(tE.bind(null,n)):t.apply(this,i)}))}var oE={ERROR:"error",AUTOPLAY_FAILED:"autoplay-failed",KICKED_OUT:"kicked-out",REMOTE_USER_ENTER:"remote-user-enter",REMOTE_USER_EXIT:"remote-user-exit",REMOTE_AUDIO_AVAILABLE:"remote-audio-available",REMOTE_AUDIO_UNAVAILABLE:"remote-audio-unavailable",REMOTE_VIDEO_AVAILABLE:"remote-video-available",REMOTE_VIDEO_UNAVAILABLE:"remote-video-unavailable",AUDIO_VOLUME:"audio-volume",NETWORK_QUALITY:"network-quality",CONNECTION_STATE_CHANGED:"connection-state-changed",AUDIO_PLAY_STATE_CHANGED:"audio-play-state-changed",VIDEO_PLAY_STATE_CHANGED:"video-play-state-changed",SCREEN_SHARE_STOPPED:"screen-share-stopped",DEVICE_CHANGED:"device-changed",PUBLISH_STATE_CHANGED:"publish-state-changed",TRACK:"track",STATISTICS:"statistics",SEI_MESSAGE:"sei-message",CUSTOM_MESSAGE:"custom-message"};function aE(e){return"sub"===e?"auxiliary":"auxiliary"===e?"sub":"main"}function sE(e){return e===ky.QOS_PREFERENCE_CLEAR?"detail":e===ky.QOS_PREFERENCE_SMOOTH?"motion":""}var lE=class{constructor(){cu(this,"_log"),this._log=wm.createLogger({id:"fd"})}download(e,t){return du(this,null,(function*(){let{type:n="blob"}=t||{};try{let t,i=Qf();if(t=Vf(fetch)?yield this.downloadWithFetch(e,n):yield this.downloadWithXHR(e,n),!t||!t.data)throw new Error("data is empty");let r=Qf()-i;return this._log.info(`downloaded: ${e}, return type: ${n}, cost: ${r}ms`),Kg.addSuccessEvent({key:522700,cost:Qf()-i}),t.data}catch(t){throw this._log.error(`failed to download: ${e}, error: ${t}`),Kg.addFailedEvent({key:522700,error:t}),t}}))}downloadWithFetch(e,t){return du(this,null,(function*(){this._log.info(`download with fetch: ${e}, return type: ${t}`);try{let n,i=yield fetch(e);if(!i.ok)throw new Error("network response was not ok");return n="arraybuffer"===t?yield i.arrayBuffer():yield i.blob(),{data:n}}catch(e){throw e}}))}downloadWithXHR(e,t){return this._log.info(`download with xhr: ${e}, return type: ${t}`),new Promise(((n,i)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType=t,r.onload=()=>{200===r.status||0===r.status&&r.response?n({data:r.response}):i(new Error("XHR failed"))},r.onerror=i,r.send(null)}))}loadWasm(e,t){return du(this,null,(function*(){this._log.info(`loadWasm ${e}, importObject: ${JSON.stringify(t)}`);let n=Qf(),i=null,r=null;if(Vf(WebAssembly.instantiateStreaming)&&!e.startsWith("data:application/octet-stream;base64,")&&!(e=>e.startsWith("file://"))(e)&&Vf(fetch))try{let n=fetch(e);i=(yield WebAssembly.instantiateStreaming(n,t)).instance}catch(e){r=e}if(!i)try{let n=yield this.download(e,{type:"arraybuffer"});i=(yield WebAssembly.instantiate(n,t)).instance}catch(e){r=e}if(i){let t=Qf()-n;return this._log.info(`loadedWasm ${e}, cost: ${t}ms`),Kg.addSuccessEvent({key:522701,cost:t}),i}throw this._log.error(`failed to loadWasm ${e}, error: ${r}`),Kg.addFailedEvent({key:522701,error:r}),r}))}};lu([Vg({settings:{timeout:0,retries:3},onRetrying(e){this._log.warn(`download retrying: ${e}`)}})],lE.prototype,"download",1);var cE=new lE;function uE({TRTC:e,room:t,errorModule:n,assetsPath:i}){return{TRTC:e,room:t,assetsPath:i,fileDownloader:cE,innerEmitter:af,constants:Mu,environment:gh,utils:Cu,eventLogger:lf,log:this.room.getLogger(),loggerManager:wm,errorModule:n,kvStatManager:Kg,trtc:this,clearStarted:(e,t)=>{let n=e.getAlias(),i=Zy.instances.get(this);if(i)if(t){let e=i.get(n+t);if(!e)return;e.started=!1}else i.forEach(((e,t)=>{t.startsWith(n)&&(e.started=!1)}))}}}var dE=new WeakMap;function hE(...e){return lv(((t,n)=>function(...i){try{fE.call(this,e,i,n,this._name)}catch(e){return Promise.reject(e)}return t.apply(this,i)}))}function pE(...e){return lv(((t,n)=>function(...i){try{fE.call(this,e,i,n,this._name)}catch(e){throw e}return t.apply(this,i)}))}function fE(e,t,n,i){if(Gf(e))for(let r=0;r<e.length;r++)mE.call(this,{rule:e[r],value:t[r],key:e[r].name,fnName:n,className:i});else mE.call(this,{rule:e,value:t[0],key:e.name,fnName:n,className:i})}function mE({rule:e,value:t,key:n,fnName:i,className:r}){function o(r){return{code:Dy.INVALID_PARAMETER,extraCode:r,fnName:i,messageParams:{key:n,rule:e,value:t}}}if(Ff(t)){if(e.required)throw new Vy(o(5001));if(Ff(e.defaultValue))return void(Vf(e.validate)&&e.validate.call(this,t,n,i,r,this));t=e.defaultValue}if(Array.isArray(e.type)){let r=!1;for(let n=0;n<e.type.length;n++)null===e.type[n]&&null===t&&(r=!0),Vf(e.type[n])&&t instanceof e.type[n]&&(r=!0),Bf(e.type[n])&&Uf(t)===e.type[n].toLowerCase()&&(r=!0);if(!r)throw new Vy({code:Dy.INVALID_PARAMETER,extraCode:5002,fnName:i,messageParams:{key:n,rule:{type:e.type.map((e=>Xf(e)?Yf(e):Bf(e)?e:Uf(e)))},value:t}})}else if(!Ff(e.type)&&Uf(t)!==e.type)throw new Vy(o(5002));if(!1===e.allowEmpty){let e=Hf(t)&&(0===t||Number.isNaN(t)),n=Bf(t)&&""===t.trim();if(e||n)throw new Vy(o(5003))}if(e.notLessThanZero&&Hf(t)&&t<0)throw new Vy(o(5006));if(!Ff(e.min)&&Hf(t)&&t<e.min)throw new Vy(o(5007));if(!Ff(e.max)&&Hf(t)&&t>e.max)throw new Vy(o(5008));if(Bf(e.instanceOf)){if(!t||t._name!==e.instanceOf)throw new Vy(o(5004))}else if(Vf(e.instanceOf)&&!(t instanceof e.instanceOf))throw new Vy(o(5004));if(Array.isArray(e.values)&&!e.values.includes(t))throw new Vy(o(5005));let{properties:a}=e;Of(a)&&jf(t)&&Object.keys(a).forEach((e=>{mE.call(this,{rule:a[e],value:t&&t[e],key:`${e}`,fnName:i,className:r})}));let{arrayItem:s}=e;Of(s)&&Gf(t)&&t.forEach(((e,t)=>{mE.call(this,{rule:s,value:e,key:`${n}[${t}]`,fnName:i,className:r})})),Vf(e.validate)&&e.validate.call(this,t,n,i,r,this)}function gE(e={}){let{getRemoteId:t=(()=>""),replaceArg:n,getKVReportKey:i}=e;return lv(((e,r)=>function(...o){function a(e,t,i){if(i&&i.includes(e))return"hided";if(n){let e=n(...o);if(o[e.argIndex]===t)return e.value}if(t===o||e in o)return t;try{return t instanceof HTMLElement?`id: ${t.id} type:${Uf(t)}`:(JSON.stringify(t),t)}catch(e){return`type:${Uf(t)}`}}let s=this._log||wm;o.length>0?s.info(`${r}() ${JSON.stringify(o,((e,t)=>a(e,t,["userSig","privateMapKey"])))}`):s.info(`${r}()`);let l=i?i(...o):jg[r];try{let n=e.apply(this,o),i=Qf();return qf(n)?n.then((e=>(s.info(`${r}() success ${t.call(this,...o)}`),Kg.addSuccessEvent({key:l,cost:Qf()-i}),e))).catch((e=>{throw e=Vy.convertFrom.call(this,e,r,1===o.length?o[0]:o),s.error(`${r}() failed ${t.call(this,...o)} ${e} params: ${JSON.stringify(o,a)}`),Kg.addFailedEvent({key:l,error:e}),e})):(Kg.addSuccessEvent({key:l}),n)}catch(e){throw e=Vy.convertFrom.call(this,e,r),s.error(`${r}() failed ${e} params: ${JSON.stringify(o,a)}`),Kg.addFailedEvent({key:l,error:e}),e}}))}var _E=e=>lv(((t,n)=>function(i,r){return du(this,null,(function*(){let o=this._plugins.get(i);if(!o)throw this._log.error(`plugin ${String(i)} is not found`),new Vy({code:Dy.OPERATION_ABORT,message:`plugin ${String(i)} is not found`,fnName:n});return fE.call(this,o.getValidateRule(e),[r],n,"TRTC"),t.call(this,o,r)}))})),vE=0;function yE(e,t){if(t&&"function"!=typeof t)throw new Vy({code:Dy.INVALID_PARAMETER,message:`start audioMixer plugin: param ${e} should be a function.`})}var EE=class{constructor(e){this.core=e,cu(this,"log"),cu(this,"mixedMusicMap",new Map),cu(this,"cacheMusicMap",new Map),vE+=1,this.log=e.log.createChild({id:`${this.getAlias()}${vE}`}),this.log.info(`[audioMixer] created id=${this.getAlias()}${vE}`),this.core=e}getName(){return EE.Name}getAlias(){return"ax"}getGroup(e){return null==e?void 0:e.id}getValidateRule(e){switch(e){case"start":return EE.startValidateRule;case"update":return EE.updateValidateRule;case"stop":return EE.stopValidateRule}}start(e){return du(this,null,(function*(){let{room:t}=this.core;this.log.info(`add music source, id: ${e.id} url: ${e.url}, track: ${e.track}`);let{id:n,url:i}=e;if(this.mixedMusicMap.has(n))return;let r=this.cacheMusicMap.get(n);r?e.url?r.reset():(r.mixInput.replaceSource(e.track),r.mixInput.connect()):(r=new class{constructor(e,t){cu(this,"player"),cu(this,"publisher"),cu(this,"mixInput"),this.mixInput=new I_(t),e.url?(this.player=new Audio(e.url),this.player.crossOrigin="anonymous",this.publisher=new Audio(e.url),this.publisher.crossOrigin="anonymous",this.mixInput.replaceSource(this.publisher)):this.mixInput.replaceSource(e.track),this.mixInput.connect()}updateSettings(e){!this.player||(Ff(e.volume)||(this.volume=e.volume),Ff(e.loop)||(this.loop=e.loop),Ff(e.playbackRate)||(this.playbackRate=e.playbackRate))}updateListener(e){if(this.player){if(e.onDurationChange){let{onDurationChange:t}=e;this.player.ondurationchange=e=>{t(e.target.duration)}}if(e.onTimeUpdate){let t=e.onTimeUpdate,{player:n}=this;n.ontimeupdate=()=>{t(n.currentTime,n.duration)}}e.onEnded&&(this.player.onended=e.onEnded)}}reset(){this.seek(0),this.mixInput.connect()}seek(e){!this.player||e<0&&e>this.player.duration||(this.player.currentTime=e,this.publisher.currentTime=e)}play(){var e,t;return null==(e=this.publisher)||e.play(),null==(t=this.player)?void 0:t.play()}pause(){var e,t;null==(e=this.player)||e.pause(),null==(t=this.publisher)||t.pause()}stop(){var e;null==(e=this.player)||e.pause(),this.mixInput.disconnect()}setOperation(e){"pause"===e&&this.pause(),"resume"===e&&(this.pause(),this.play()),"stop"===e&&(this.pause(),this.seek(0))}set volume(e){!this.player||!this.publisher||(this.player.volume=e,this.publisher.volume=e)}set loop(e){!this.player||!this.publisher||(this.player.loop=e,this.publisher.loop=e)}set playbackRate(e){!this.player||!this.publisher||(this.player.playbackRate=e,this.publisher.playbackRate=e)}}(e,t.audioManager),this.cacheMusicMap.set(n,r)),r.updateListener(e),r.updateSettings(e),yield r.play(),this.mixedMusicMap.set(n,r),this.log.info(`start mix audio track ${n} success.`),Kg.addEnum({key:502700,value:3}),this.kvUpload(e)}))}update(e){return du(this,null,(function*(){let{id:t,operation:n,seekFrom:i,playbackRate:r}=e;this.log.info(`update music source, ${JSON.stringify(e)}`);let o=this.mixedMusicMap.get(t);o?(o.updateSettings(e),o.updateListener(e),Ff(n)||o.setOperation(n),Ff(i)||o.seek(i),this.kvUpload(e)):this.log.warn(`update music source failed, music id: ${t} not found.`)}))}stop(e){return du(this,arguments,(function*({id:e}){var t;this.mixedMusicMap.has(e)&&(this.log.info(`remove music source, music id: ${e}`),null==(t=this.mixedMusicMap.get(e))||t.stop(),this.mixedMusicMap.delete(e)),"*"===e&&this.destroyAllMusic()}))}kvUpload(e){let{track:t,loop:n,volume:i,playbackRate:r,operation:o,seekFrom:a,onTimeUpdate:s,onDurationChange:l,onEnded:c}=e;t&&Kg.addCount({key:502711}),n&&Kg.addCount({key:502703}),i&&Kg.addCount({key:502704}),r&&Kg.addCount({key:502705}),o&&Kg.addCount({key:502706}),a&&Kg.addCount({key:502707}),"function"!=typeof s&&Kg.addCount({key:502709}),"function"!=typeof c&&Kg.addCount({key:502710}),"function"!=typeof l&&Kg.addCount({key:502708})}destroyAllMusic(){this.log.info("destroy all music source."),this.mixedMusicMap.forEach(((e,t)=>this.stop({id:t})))}destroyAllCache(){this.log.info("destroy all music cache."),this.cacheMusicMap.clear()}destroy(){this.log.info("destroy audio mixer plugin."),this.destroyAllMusic(),this.destroyAllCache()}},bE=EE;cu(bE,"startValidateRule",{name:"options",required:!0,type:"object",properties:{id:{type:"string",required:!0},url:{type:"string",required:!1},track:{required:!1},loop:{type:"boolean"},volume:{type:"number"}},validate(e,t,n){if(e.url&&"*"!==e.url){let t=e.url.split("?")[0],i=["mp3","ogg","wav","flac"],r=t.split(".").pop(),o=i.indexOf(r)>=0,a=t.startsWith("blob"),s=t.startsWith("data");if(!(o||a||s))throw new Vy({code:Dy.INVALID_PARAMETER,message:"start audioMixer plugin: music url is invalid, please check your file format.",fnName:n})}if(!e.url&&!e.track)throw new Vy({code:Dy.INVALID_PARAMETER,message:"start audioMixer plugin: param url or track is required.",fnName:n});yE("onTimeUpdate",e.onTimeUpdate),yE("onEnded",e.onEnded),yE("onDurationChange",e.onDurationChange)}}),cu(bE,"updateValidateRule",{name:"options",required:!0,type:"object",properties:{id:{type:"string",required:!0},loop:{type:"boolean"},volume:{type:"number"},seekFrom:{type:"number"},operation:{type:"string",values:["pause","resume","stop"]}},validate(e,t,n){yE("onTimeUpdate",e.onTimeUpdate),yE("onEnded",e.onEnded),yE("onDurationChange",e.onDurationChange)}}),cu(bE,"stopValidateRule",{name:"options",type:"object",required:!0,properties:{id:{type:"string",required:!0}}}),cu(bE,"Name","AudioMixer");var SE,TE=0,xE=class{constructor(e){this.core=e,cu(this,"log"),cu(this,"audioContext",T_()),cu(this,"workletNode"),TE+=1,this.log=e.log.createChild({id:`${this.getAlias()}${TE}`}),this.log.info(`[audioDenoiser] created id=${this.getAlias()}${TE}`),e.assetsPath&&this.preload(`${e.assetsPath}/denoiser-wasm.js`)}static startValidateRule(e){return{name:"options",required:!0,type:"object",properties:{sdkAppId:{type:"number",required:!0},userId:{type:"string",required:!0},userSig:{type:"string",required:!0}},validate(t,n,i,r){if(!e.room.audioManager.hasAudioTrack)throw new Vy({code:Dy.INVALID_OPERATION,extraCode:5106,fnName:i})}}}preload(e){return SE||(SE=this.doPreload(e)),SE}doPreload(e){return du(this,null,(function*(){let t=yield this.core.fileDownloader.download(e,{type:"blob"}),n=URL.createObjectURL(t);try{yield E_(this.audioContext,n)}finally{URL.revokeObjectURL(n)}}))}getName(){return xE.Name}getAlias(){return"ad"}getGroup(){return`AIDenoiser_${Date.now()}`}getValidateRule(e){switch(e){case"start":return xE.startValidateRule(this.core);case"update":return xE.updateValidateRule;case"stop":return xE.stopValidateRule}}start(e){return du(this,null,(function*(){let{room:t}=this.core;if(yield this.preload(`${e.assetsPath}/denoiser-wasm.js`),!this.workletNode){let t=String(Date.now()).slice(0,-3),{auth:n,sign:i,status:r,message:o}=yield function(e){return du(this,arguments,(function*({sdkAppId:e,userId:t,userSig:n,timestamp:i}){let r=`https://${function(e){let t;return t=(e=>(e=Number(e))>0&&e<14e8)(e)?wE.MAIN_OVERSEA:wE.MAIN,t}(e)}/api/v1/audioAiAuth?sdkAppId=${e}&userId=${t}&userSig=${n}&timestamp=${i}`,o=yield fetch(r),{data:{errCode:a,errMsg:s,sign:l,status:c}}=yield o.json();if("1"===c)return{auth:!0,sign:l,status:c,message:s};let u="Init RTCAIDenoiser failed.",d="";switch(a){case 1:d="Please check your params.";break;case 2:d="You need to buy packages. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 3:d="Server is invalid. Please contact our engineer. ";break;case 4:d="Your packages is not active. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 5:d="Your packages is expired. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 6:d="Your version is not supported."}return{auth:!1,status:c,message:s?`${u} Reason: ${s}. ${d}`:`${u}, ${d}`}}))}(ru(iu({},e),{timestamp:t}));if(!n)throw this.log.info(`RTCAIDenoiser: ${e.userId} auth result: ${n}. Message: ${o}`),new Vy({code:Dy.INVALID_PARAMETER,message:o});this.workletNode=new AudioWorkletNode(this.audioContext,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1}),this.workletNode.port.postMessage({type:"init",data:{sdkAppId:String(e.sdkAppId),userId:e.userId,timestamp:t,sign:i,status:r}}),this.workletNode.port.onmessage=e=>{let{data:t}=e;"cost"===t.type&&this.log.debug(`[RTCAIDenoiser] ${t.value}`)}}this.workletNode.port.postMessage({type:"enable"}),t.audioManager.addDenoiser(this.workletNode),t.sendAbilityStatus({ai_denoise:1})}))}update(){return du(this,null,(function*(){}))}stop(){return du(this,null,(function*(){if(!this.workletNode)return;let{room:e}=this.core;this.workletNode.port.postMessage({type:"disable"}),yield e.audioManager.removeDenoiser(this.workletNode)}))}destroy(){}},AE=xE;cu(AE,"updateValidateRule",{type:"object"}),cu(AE,"stopValidateRule",{type:"object"}),cu(AE,"Name","AIDenoiser");var wE={MAIN:"schedule.cloud-rtc.com",MAIN_OVERSEA:"schedule.rtc.tencentcloud.com"},IE=su(hu(),1),RE=class extends IE.EventEmitter{constructor(){super(),this.state="nominal",this.onPressureChange=this.onPressureChange.bind(this)}get stateNum(){switch(this.state){case"nominal":return 1;case"fair":return 2;case"serious":return 3;case"critical":return 4}}start(){return du(this,null,(function*(){if(!this.observer)try{"PressureObserver"in window&&!Rh&&(this.observer=new PressureObserver(this.onPressureChange),yield this.observer.observe("cpu",{sampleInterval:2e3}))}catch(e){lf.uploadEvent({log:"stat-pressure-detector-start-failed",error:e})}}))}onPressureChange(e){let t=this.stateNum,n=e[e.length-1];this.state=n.state,(this.stateNum>3||t>3)&&wm.info(`${n.source}: ${n.state}`),this.emit("state-changed",{type:n.source,state:this.state})}destroy(){var e;try{null==(e=this.observer)||e.disconnect(),this.observer=null}catch(e){lf.uploadEvent({log:"stat-pressure-detector-destroy-failed",error:e})}}},CE=new RE,ME=0,kE=class{constructor(e){this.core=e,cu(this,"log"),cu(this,"_seiMessageList",[]),cu(this,"_smallSeiMessageList",[]),cu(this,"_subStreamSeiMessageList",[]),ME++,this.log=e.log.createChild({id:`${this.getAlias()}${ME}`}),this.log.info(`[sei] created id=${this.getAlias()}${ME}`),this.core=e}hasSEI(e){return 1===e.getInt32(0)&&6===e.getInt8(4)}encodeSEINalu([e,t]){let n=t.byteLength,i=parseInt(String(n/255),10),r=n%255,o=[];o.push(0,0,0,1,6,e);for(let e=0;e<i;e++)o.push(255);o.push(r);let a=new DataView(t);return o.push(...new Uint8Array(a.buffer)),o.push(128),new bv(new DataView(new Uint8Array(o).buffer),!0)}getNaluCount(e){let t=0,n=0,i=new DataView(e);for(let r=0;r<e.byteLength;r++)switch(i.getUint8(r)){case 0:t++;break;case 1:(2===t||3===t)&&n++,t=0;break;default:t=0}return n}encode(e,t){let n=8===t?this._smallSeiMessageList:2===t?this._subStreamSeiMessageList:this._seiMessageList;if(n.length>0&&e.data.byteLength>0){let t=9-this.getNaluCount(e.data);if(t<=0)return 0;let i=n.splice(0,t).reverse().map(this.encodeSEINalu.bind(this)),r=i.reduce(((e,t)=>e+t.dataView.byteLength),0),o=new ArrayBuffer(r+e.data.byteLength),a=new DataView(o),s=new DataView(e.data),l=0;for(let e=0;e<i.length;e++)for(let t=0;t<i[e].dataView.byteLength;t++)a.setInt8(l++,i[e].dataView.getInt8(t));for(let t=0;t<e.data.byteLength;t++)a.setInt8(l++,s.getInt8(t));return e.data=o,i.length}return 0}destroy(){}getValidateRule(e){switch(e){case"start":case"update":case"stop":return{type:"object"}}}decode(e,t){try{if("empty"===e.type||0===e.data.byteLength)return e;let n=new DataView(e.data);if(!this.hasSEI(n))return e;let i=[],r=0,o=-1,a=-1;for(let t=0;t<e.data.byteLength;t++){let s=n.getUint8(t);if(0===s)r++;else if(1===s){if(2===r||3===r){let s=t-r;if(-1===o?o=s:-1===a&&(a=s,i.push(new bv(new DataView(n.buffer.slice(o,a)))),o=s,a=-1),6!==n.getUint8(t+1)){e.data=n.buffer.slice(s);break}}r=0}else r=0}this.log.debug(`${i.length} sei received`),i.reverse().forEach((e=>{this.core.trtc.emit(oE.SEI_MESSAGE,{seiPayloadType:e.seiPayloadType,data:e.seiPayload.buffer,userId:t.userId,streamType:2===t.mediaType?"sub":"main"})}))}catch(e){this.log.warn(e)}return e}start(e){this.core.room.videoManager.enableSEI(((e,t)=>{try{let n=this.encode(e,t);n&&this.log.debug(`${n} sei sent`)}catch(e){this.log.warn(e)}return e}),((e,t)=>this.decode(e,t)))}stop(e){this.core.room.videoManager.disableSEI()}update(e){(e.options.toSubStream?this._subStreamSeiMessageList:this._seiMessageList).push([e.options.seiPayloadType,e.buffer])}getName(){return kE.Name}getAlias(){return"sei"}getGroup(){return"sei"}},NE=kE;cu(NE,"Name","SEI");var DE=0,OE=new Set,PE=null;Du("5.8.1-beta.2");var LE={RtcError:Vy,ErrorCode:Dy,ErrorCodeDictionary:Oy},UE=class extends bu.EventEmitter{constructor(e,t){super(),cu(this,"_room"),cu(this,"_eventListened",new Set),cu(this,"_localVideoTrack",null),cu(this,"_localAudioTrack",null),cu(this,"_localScreenTrack",null),cu(this,"_localScreenAudioTrack",null),cu(this,"_localVideoConfig",null),cu(this,"_localScreenConfig",null),cu(this,"_localAudioConfig",null),cu(this,"_remoteVideoConfigMap",new Map),cu(this,"_remoteAudioConfigMap",new Map),cu(this,"_remoteAudioMuteMap",new Map),cu(this,"_mediaTrackMap",new WeakMap),cu(this,"_log",wm.createLogger({id:"t"+ ++DE})),cu(this,"_plugins",new Map),cu(this,"_networkQuality",null),cu(this,"_speakerId"),this._room=new e(iu({logger:this._log,frameWorkType:UE.frameWorkType},t)),this._log.debug(JSON.stringify(t)),Object.defineProperties(this,{dumpAudio:{enumerable:!1,value(e){return this._room.audioManager.dump(e)}}}),t.plugins&&t.plugins.forEach((e=>{this._use(e,t.assetsPath)})),this._use(bE,t.assetsPath),this._use(AE,t.assetsPath),t.enableSEI&&ug&&(this._use(NE),this.startPlugin("SEI")),this._room.on("audio-volume",(e=>{!e.find((e=>""===e.userId))&&this._localAudioTrack&&e.push({userId:"",volume:Math.floor(100*this._localAudioTrack.getAudioLevel())}),this.emit(oE.AUDIO_VOLUME,{result:e.sort(((e,t)=>t.volume-e.volume))})})),this._room.videoManager.on("error",(({reason:e,error:t})=>{this._log.error(new Vy({code:Dy.OPERATION_FAILED,extraCode:5504,messageParams:{reason:e,error:t}}))})),this._listenEvents(),this._initActiveSpeaker(),((e,t)=>{let{emit:n}=e;e.emit=(...t)=>{try{return n.apply(e,t)}catch(e){let n=nf({key:fh.CATCH_HANDLER_ERROR,data:{name:"trtc",event:t[0]},addDocLink:!1});return wm.warn(`${n}\n\n${e.stack}`),!1}}})(this)}static create(e){}static _create(e,t){var n;My&&(My=!1,5!==wm.getLogLevel()&&(console.info("******************************************************************************"),console.info("*   TRTC Web SDK"),console.info(`*   API Document: ${Wu}/en/index.html`),console.info(`*   Changelog: ${Wu}/en/tutorial-01-info-changelog.html`),console.info("*   Report issues: https://github.com/LiteAVSDK/TRTC_Web/issues"),console.info("******************************************************************************")),wm.info("TRTC Web SDK Version:",Nu),wm.info("UA:",navigator.userAgent),wm.info(`URL: ${location.href}${"IFRAME"===(null==(n=self.frameElement)?void 0:n.tagName)?" in iframe":""}`),qp().then((e=>{e&&wm.info(Wp)})));let i=new UE(e,t||{});return OE.add(i),i}get room(){return this._room}_listenEvents(){Pg(this,this._room).add("peer-join",(e=>{let{userId:t}=e;this.emit(oE.REMOTE_USER_ENTER,{userId:t})})).add("peer-leave",(e=>{this.emit(oE.REMOTE_USER_EXIT,{userId:e})})).add("banned",(e=>{this._exitRoom().then((()=>{this.emit(oE.KICKED_OUT,{reason:e.reason})}))})).add("error",(e=>{this._exitRoom().then((()=>{this.emit(oE.ERROR,Vy.convertFrom(e))}))})).add("signal-connection-state-changed",(e=>{this.emit(oE.CONNECTION_STATE_CHANGED,e)})).add("network-quality",(e=>{this._networkQuality=e,this.emit(oE.NETWORK_QUALITY,e)})).add("remote-published",(e=>{[e.remoteAudioTrack,e.remoteVideoTrack,e.remoteAuxiliaryTrack].forEach((t=>{Pg(t,t).add("player-state-changed",(n=>{let i=ru(iu({},n),{userId:e.userId});t.kind===ld.VIDEO&&(i.streamType=aE(t.streamType)),this.emit(t.kind===ld.AUDIO?oE.AUDIO_PLAY_STATE_CHANGED:oE.VIDEO_PLAY_STATE_CHANGED,i)})).add("error",(e=>{e.getCode()===Tu.PLAY_NOT_ALLOWED&&this.emit(oE.AUTOPLAY_FAILED,{userId:t.userId})}))}))})).add("remote-unpublished",(e=>{[e.remoteAudioTrack,e.remoteVideoTrack,e.remoteAuxiliaryTrack].forEach((e=>{Lg(e)}))})).add("remote-publish-state-changed",(({prevMuteState:e,muteState:t})=>{let{userId:n}=t,i=e.audioAvailable,r=e.videoAvailable,{audioAvailable:o,videoAvailable:a}=t;o||this._remoteAudioConfigMap.delete(n),a||this._remoteVideoConfigMap.delete(`${n}_main`),t.hasAuxiliary||this._remoteVideoConfigMap.delete(`${n}_sub`),i!==o&&(this.emit(o?oE.REMOTE_AUDIO_AVAILABLE:oE.REMOTE_AUDIO_UNAVAILABLE,{userId:n}),o?this._onAudioAvailable({userId:n}):this._onAudioUnavailable({userId:n,muteState:t})),r!==a&&(this.emit(a?oE.REMOTE_VIDEO_AVAILABLE:oE.REMOTE_VIDEO_UNAVAILABLE,{userId:n,streamType:"main"}),a?this._onVideoAvailable({userId:n,streamType:"main"}):this._onVideoUnavailable({userId:n,streamType:"main"})),e.hasAuxiliary!==t.hasAuxiliary&&(this.emit(t.hasAuxiliary?oE.REMOTE_VIDEO_AVAILABLE:oE.REMOTE_VIDEO_UNAVAILABLE,{userId:n,streamType:"sub"}),t.hasAuxiliary?this._onVideoAvailable({userId:n,streamType:"sub"}):this._onVideoUnavailable({userId:n,streamType:"sub"}))})).add("firewall-restriction",(()=>{this.emit(oE.ERROR,new Vy({code:Dy.OPERATION_FAILED,extraCode:5501}))})).add("heartbeat-report",(e=>{var t,n,i,r,o,a,s;let l={2:"big",3:"small",7:"sub"},c={rtt:e.msg_up_stream_info.msg_network_status.uint32_rtt||(null==(t=e.msg_down_stream_info[0])?void 0:t.msg_network_status.uint32_rtt)||(null==(n=this._networkQuality)?void 0:n.uplinkRTT)||(null==(i=this._networkQuality)?void 0:i.downlinkRTT)||0,upLoss:(null==(r=this._networkQuality)?void 0:r.uplinkLoss)||0,downLoss:(null==(o=this._networkQuality)?void 0:o.downlinkLoss)||0,bytesSent:e.bytes_sent||0,bytesReceived:e.bytes_received||0,localStatistics:{audio:{bitrate:((null==(a=e.msg_up_stream_info.msg_audio_status)?void 0:a.uint32_audio_codec_bitrate)||0)/1e3,audioLevel:((null==(s=e.msg_up_stream_info.msg_audio_status)?void 0:s.uint32_audio_level)||0)/ph},video:e.msg_up_stream_info.msg_video_status.filter((e=>l[e.uint32_video_stream_type])).map((e=>({bitrate:(e.uint32_video_codec_bitrate||0)/1e3,width:e.uint32_video_width,height:e.uint32_video_height,frameRate:e.uint32_video_enc_fps,videoType:l[e.uint32_video_stream_type]})))},remoteStatistics:e.msg_down_stream_info.map((e=>({userId:e.msg_user_info.str_identifier,audio:{bitrate:(e.msg_audio_status.uint32_audio_codec_bitrate||0)/1e3,audioLevel:(e.msg_audio_status.uint32_audio_level||0)/ph},video:e.msg_video_status.map((e=>({bitrate:(e.uint32_video_codec_bitrate||0)/1e3,width:e.uint32_video_width,height:e.uint32_video_height,frameRate:e.uint32_video_dec_fps,videoType:l[e.uint32_video_stream_type]})))})))};this.emit(oE.STATISTICS,c)})).add("custom-message",(e=>{this.emit(oE.CUSTOM_MESSAGE,e)})),Pg(this,U_).add("audioInputAdded",(e=>{this.emit(oE.DEVICE_CHANGED,{type:"microphone",action:"add",device:e})})).add("audioInputRemoved",(e=>{this.emit(oE.DEVICE_CHANGED,{type:"microphone",action:"remove",device:e})})).add("videoInputAdded",(e=>{this.emit(oE.DEVICE_CHANGED,{type:"camera",action:"add",device:e})})).add("videoInputRemoved",(e=>{this.emit(oE.DEVICE_CHANGED,{type:"camera",action:"remove",device:e})})).add("audioOutputAdded",(e=>du(this,null,(function*(){if(this.emit(oE.DEVICE_CHANGED,{type:"speaker",action:"add",device:e}),PE&&PE.deviceId===eh){let e=(yield j_()).find((e=>e.deviceId===eh));e&&PE.groupId!==e.groupId&&(PE=e,this.emit(oE.DEVICE_CHANGED,{type:"speaker",action:"active",device:e}))}})))).add("audioOutputRemoved",(e=>du(this,null,(function*(){this.emit(oE.DEVICE_CHANGED,{type:"speaker",action:"remove",device:e});let t=(yield j_())[0];t&&PE&&(PE.deviceId===e.deviceId||PE.deviceId===eh&&PE.groupId!==t.groupId)&&(PE=t,this.emit(oE.DEVICE_CHANGED,{type:"speaker",action:"active",device:t}))}))))}use(e){let t,n;"plugin"in e?(t=e.plugin,n=e.assetsPath):t=e,this._use(t,n||"https://web.sdk.qcloud.com/trtc/webrtc/v5/assets/")}_use(e,t){if(this._plugins.get(e.Name))return void this._log.warn("duplicate install plugin",e.Name);let n=new e(uE.call(this,{TRTC:UE,room:this._room,errorModule:LE,assetsPath:t}));this._plugins.set(e.Name,n),Object.values(Ny).includes(n.getName())&&(this.startPlugin(n.getName()),this._log.info("auto start plugin",e.Name))}enterRoom(e){return du(this,null,(function*(){var t,n;let{scene:i="rtc",enableAutoPlayDialog:r=!0,autoReceiveAudio:o=!0,autoReceiveVideo:a=!1}=e;e.proxy&&(this._room.setProxyServer(e.proxy),!Bf(e.proxy)&&e.proxy.turnServer&&(null==(n=(t=this._room).setTurnServer)||n.call(t,e.proxy.turnServer,e.proxy.iceTransportPolicy))),this._room.enableAutoPlayDialog=r,this._room.autoReceiveAudio=o,this._room.autoReceiveVideo=a,zf(e.preferHW)&&(this._room.preferHW=e.preferHW);let s={sdkAppId:e.sdkAppId,userId:e.userId,userSig:e.userSig,privateMapKey:e.privateMapKey||null,latencyLevel:e.latencyLevel,role:"audience"===e.role?21:20,roomId:e.roomId||0,strRoomId:e.strRoomId||"",businessInfo:e.businessInfo||null,streamId:null,userDefineRecordId:e.userDefineRecordId||null,frameWorkType:e.frameWorkType,component:e.component,language:e.language};e.strRoomId&&!e.roomId?this._room.useStringRoomId=!0:this._room.useStringRoomId=!1,yield this._room.join(s,i,UE.frameWorkType),this._checkTrackToPublish(),CE.start()}))}exitRoom(){return du(this,null,(function*(){return yield this._exitRoom()}))}switchRole(e,t){return du(this,null,(function*(){null!=t&&t.privateMapKey&&(this._room.privateMapKey=t.privateMapKey),null!=t&&t.latencyLevel&&(this._room.latencyLevel=t.latencyLevel),yield this._room.switchRole(e),"anchor"===e&&this._checkTrackToPublish()}))}destroy(){Lg(this),this.removeAllListeners(),this._room.destroy(),OE.delete(this),0===OE.size&&CE.destroy(),this._localAudioTrack&&this.stopLocalAudio(),this._localVideoTrack&&this.stopLocalVideo(),this._localScreenTrack&&this.stopScreenShare(),this._plugins.forEach((e=>{var t;return null==(t=e.destroy)?void 0:t.call(e)}))}startLocalAudio(){return du(this,arguments,(function*(e={publish:!0}){if(this._localAudioTrack)return void this._log.warn("local audio is already started");let{publish:t=!0,mute:n,option:i}=e,r=new Ev(this._room.audioManager),o={},a={muted:!0};i&&(Ff(i.microphoneId)?Ff(i.audioTrack)||(o.customSource=i.audioTrack):o.deviceId=i.microphoneId,i&&Hf(i.captureVolume)&&r.setCaptureVolume(i.captureVolume),Ff(i.profile)||(Bf(i.profile)?od[i.profile]&&r.setProfile(od[i.profile]):r.setProfile(i.profile)),Hf(i.earMonitorVolume)&&(a.muted=!(i.earMonitorVolume>0),a.volume=i.earMonitorVolume),Ff(i.echoCancellation)||(r.profile.echoCancellation=i.echoCancellation),Ff(i.noiseSuppression)||(r.profile.noiseSuppression=i.noiseSuppression),Ff(i.autoGainControl)||(r.profile.autoGainControl=i.autoGainControl)),r.on("5",(e=>{this.emit(oE.ERROR,new Vy({code:Dy.DEVICE_ERROR,extraCode:5309,messageParams:{error:e}}))})),r.on("2",(e=>{this.emit(oE.DEVICE_CHANGED,{type:"microphone",action:"active",device:e})})),r.on("4",(e=>{let t;e.error&&(t=Vy.convertFrom(e.error)),this.emit(oE.PUBLISH_STATE_CHANGED,ru(iu({},e),{error:t}))})),this._listenOutputTrackChanged(r),this._speakerId&&r.setAudioOutput(this._speakerId),yield r.capture(o),Ff(n)||r.setMute(n),Pg(r,r).add("player-state-changed",(e=>{this.emit(oE.AUDIO_PLAY_STATE_CHANGED,ru(iu({},e),{userId:""}))})),t&&this._room.isJoined&&this._room.publish(r).catch((()=>{})),this._localAudioTrack=r,this._localAudioConfig=ru(iu({},e),{publish:t}),yield this._updateAudioPlayOption({playOption:a,track:r})}))}updateLocalAudio(e){return du(this,null,(function*(){if(!this._localAudioTrack||!this._localAudioConfig)return;let{publish:t,mute:n,option:i}=e,r={};i&&(i.microphoneId?yield this._localAudioTrack.switchDevice(i.microphoneId):Ff(i.audioTrack)||(yield this._localAudioTrack.setInputMediaStreamTrack(i.audioTrack)),Ff(i.captureVolume)||this._localAudioTrack.setCaptureVolume(i.captureVolume),Ff(i.earMonitorVolume)||(r.muted=!(i.earMonitorVolume>0),r.volume=i.earMonitorVolume),yield this._localAudioTrack.update3A(i)),this._room.isJoined&&!Ff(t)&&(t&&!this._localAudioConfig.publish&&this._room.publish(this._localAudioTrack).catch((()=>{})),this._localAudioConfig.publish&&!t&&this._room.unpublish(this._localAudioTrack).catch((()=>{}))),Ff(n)||this._localAudioTrack.setMute(n),yield this._updateAudioPlayOption({playOption:r,track:this._localAudioTrack,prevConfig:this._localAudioConfig}),sm(this._localAudioConfig,e)}))}stopLocalAudio(){return du(this,null,(function*(){!this._localAudioTrack||(this._room.isJoined&&(yield this._room.unpublish(this._localAudioTrack).catch((()=>{}))),this._localAudioTrack.stop(),this._localAudioTrack.close(),this._room.audioManager.removeInput(this._localAudioTrack),Lg(this._localAudioTrack),this._localAudioTrack=null,this._localAudioConfig=null)}))}startLocalVideo(){return du(this,arguments,(function*(e={publish:!0,view:null}){if(this._localVideoTrack)return void this._log.warn("local video is already started");let{view:t,publish:n=!0,mute:i,option:r}=e,o=new Sv(this._room.videoManager),a={},s={};if(r&&(r.cameraId?a.deviceId=r.cameraId:Ff(r.useFrontCamera)?Ff(r.videoTrack)||(a.customSource=r.videoTrack):a.facingMode=r.useFrontCamera?ld.FACING_MODE_USER:ld.FACING_MODE_ENVIRONMENT,Ff(r.profile)||(Bf(r.profile)?ad[r.profile]&&o.setProfile(ad[r.profile]):o.setProfile(r.profile)),Ff(r.fillMode)||(s.objectFit=r.fillMode),Ff(r.mirror)||(s.mirror=r.mirror),Ff(r.small)||(Qm()?Bf(r.small)?o.small=ad[r.small]:!0===r.small?o.small=ad["120p"]:o.small=r.small:this._log.warn("small stream is not supported"))),o.on("5",(e=>{this.emit(oE.ERROR,new Vy({code:Dy.DEVICE_ERROR,extraCode:5308,messageParams:{error:e}}))})),o.on("2",(e=>{this.emit(oE.DEVICE_CHANGED,{type:"camera",action:"active",device:e})})),o.on("4",(e=>{let t;e.error&&(t=Vy.convertFrom(e.error)),this.emit(oE.PUBLISH_STATE_CHANGED,ru(iu({},e),{error:t}))})),this._listenOutputTrackChanged(o),yield o.capture(a),Ff(i)||(yield o.setMute(i)),o.mediaTrack)if(null!=r&&r.qosPreference){let e=sE(r.qosPreference);o.mediaTrack.contentHint=e}else null!=r&&r.videoTrack||(o.mediaTrack.contentHint=sE(ky.QOS_PREFERENCE_SMOOTH));Pg(o,o).add("player-state-changed",(e=>{this.emit(oE.VIDEO_PLAY_STATE_CHANGED,ru(iu({},e),{userId:"",streamType:"main"}))})),n&&this._room.isJoined&&this._room.publish(o).catch((()=>{})),this._localVideoTrack=o,this._localVideoConfig=ru(iu({},e),{view:t,publish:n}),yield this._updateVideoPlayOption({view:t,playOption:s,track:o})}))}updateLocalVideo(e){return du(this,null,(function*(){if(!this._localVideoTrack||!this._localVideoConfig)return;let{view:t,publish:n,mute:i,option:r}=e,o={};if(r){if(Ff(r.profile)||(Bf(r.profile)?ad[r.profile]&&this._localVideoTrack.setProfile(ad[r.profile]):this._localVideoTrack.setProfile(r.profile),(!r.cameraId||!this._localVideoTrack.isNeedToSwitchDevice(r.cameraId))&&Ff(r.useFrontCamera)&&this._localVideoTrack.applyProfile()),r.cameraId?yield this._localVideoTrack.switchDevice(r.cameraId):Ff(r.useFrontCamera)?Ff(r.videoTrack)||(yield this._localVideoTrack.setInputMediaStreamTrack(r.videoTrack)):yield this._localVideoTrack.switchDevice(r.useFrontCamera?ld.FACING_MODE_USER:ld.FACING_MODE_ENVIRONMENT),Ff(r.fillMode)||(o.objectFit=r.fillMode),Ff(r.mirror)||(o.mirror=r.mirror),r.qosPreference&&this._localVideoTrack.mediaTrack){let e=sE(r.qosPreference);this._localVideoTrack.mediaTrack.contentHint=e}if(r.small){let e=!this._localVideoTrack.small;Qm()?(!0===r.small?this._localVideoTrack.small=ad["120p"]:Bf(r.small)?this._localVideoTrack.small=ad[r.small]:this._localVideoTrack.small=r.small,this._room.videoManager.update(),e&&this._room.enableSmall(!0)):this._log.warn("small stream is not supported")}else!1===r.small&&this._localVideoTrack.small&&(delete this._localVideoTrack.small,this._room.videoManager.update(),this._room.enableSmall(!1))}this._room.isJoined&&!Ff(n)&&(n&&!this._localVideoConfig.publish&&this._room.publish(this._localVideoTrack).catch((()=>{})),this._localVideoConfig.publish&&!n&&this._room.unpublish(this._localVideoTrack).catch((()=>{}))),Ff(i)||(yield this._localVideoTrack.setMute(i)),yield this._updateVideoPlayOption({view:t,playOption:o,track:this._localVideoTrack,prevConfig:this._localVideoConfig}),sm(this._localVideoConfig,e)}))}stopLocalVideo(){return du(this,null,(function*(){!this._localVideoTrack||(this._room.isJoined&&(yield this._room.unpublish(this._localVideoTrack).catch((()=>{}))),this._localVideoTrack.stop(),this._localVideoTrack.close(),Lg(this._localVideoTrack),this._localVideoTrack=null,this._localVideoConfig=null)}))}startScreenShare(){return du(this,arguments,(function*(e={publish:!0,view:null}){if(this._localScreenTrack)return void this._log.warn("screen share is already started");let{view:t=null,publish:n=!0,option:i}=e,r=new Av(this._room.videoManager);r.on("4",(e=>{let t;e.error&&(t=Vy.convertFrom(e.error)),this.emit(oE.PUBLISH_STATE_CHANGED,ru(iu({},e),{error:t}))})),this._listenOutputTrackChanged(r);let o=null,a={},s={};i&&(Ff(i.profile)||(Bf(i.profile)?sd[i.profile]&&r.setProfile(sd[i.profile]):r.setProfile(i.profile)),i.systemAudio&&(a.systemAudio=!0,a.echoCancellation=i.echoCancellation,a.noiseSuppression=i.noiseSuppression,a.autoGainControl=i.autoGainControl),Ff(i.fillMode)||(s.objectFit=i.fillMode),i.videoTrack&&(a.videoTrack=i.videoTrack),i.audioTrack&&(a.audioTrack=i.audioTrack),i.captureElement&&(a.captureElement=i.captureElement),i.preferDisplaySurface&&(a.preferDisplaySurface=i.preferDisplaySurface));let l=yield r.capture(a);if(null!=i&&i.qosPreference){let e=sE(i.qosPreference);r.mediaTrack.contentHint=e}else null!=i&&i.videoTrack||(r.mediaTrack.contentHint=sE(ky.QOS_PREFERENCE_CLEAR));if(r.mediaTrack.addEventListener(ld.ENDED,(()=>{this._stopScreenShare(),this.emit(oE.SCREEN_SHARE_STOPPED)})),l.getAudioTracks()[0]&&(o=new wv(this._room.audioManager),o.setInputMediaStreamTrack(l.getAudioTracks()[0]),this._speakerId&&o.setAudioOutput(this._speakerId)),Pg(r,r).add("player-state-changed",(e=>{this.emit(oE.VIDEO_PLAY_STATE_CHANGED,ru(iu({},e),{userId:"",streamType:"sub"}))})),n&&this._room.isJoined){let e=[r];o&&e.push(o),this._room.publish(...e).catch((()=>{}))}this._localScreenTrack=r,this._localScreenAudioTrack=o,this._localScreenConfig=ru(iu({},e),{view:t,publish:n}),yield this._updateVideoPlayOption({view:t,playOption:s,track:r})}))}updateScreenShare(e){return du(this,null,(function*(){if(!this._localScreenTrack||!this._localScreenConfig)return;let{view:t,publish:n,option:i}=e,r={};if(i&&(Ff(i.fillMode)||(r.objectFit=i.fillMode),i.qosPreference)){let e=sE(i.qosPreference);this._localScreenTrack.mediaTrack.contentHint=e}this._room.isJoined&&!Ff(n)&&(n&&!this._localScreenConfig.publish&&(this._room.publish(this._localScreenTrack).catch((()=>{})),this._localScreenAudioTrack&&this._room.publish(this._localScreenAudioTrack).catch((()=>{}))),this._localScreenConfig.publish&&!n&&(this._room.unpublish(this._localScreenTrack).catch((()=>{})),this._localScreenAudioTrack&&this._room.unpublish(this._localScreenAudioTrack).catch((()=>{})))),yield this._updateVideoPlayOption({view:t,playOption:r,track:this._localScreenTrack,prevConfig:this._localScreenConfig}),sm(this._localScreenConfig,e)}))}stopScreenShare(){return du(this,null,(function*(){return yield this._stopScreenShare()}))}startRemoteVideo(e){return du(this,null,(function*(){let{view:t,userId:n,streamType:i,option:r}=e,o=`${n}_${i}`;if(this._remoteVideoConfigMap.has(o))return void this._log.warn(`remote video has already started. userId:${n}, streamType:${i}`);let a=this._room.remotePublishedUserMap.get(n);if(!a)return;let s={},l="main"===i?a.remoteVideoTrack:a.remoteAuxiliaryTrack;this._listenOutputTrackChanged(l),r&&(Ff(r.fillMode)||(s.objectFit=r.fillMode),Ff(r.mirror)||(s.mirror=r.mirror),s.canvasRender=r.canvasRender,"main"===i&&!Ff(r.small)&&(a.remoteVideoTrack.setMediaType(r.small?8:4),this._room.changeType(r.small,l.user))),yield this._room.subscribe(l),yield this._updateVideoPlayOption({view:t,playOption:s,track:l}),this._emitTrackEvent(l),this._remoteVideoConfigMap.set(o,{config:e}),r&&!Ff(r.receiveWhenViewVisible)&&this._observeView({remoteTrack:l,view:t,receiveWhenViewVisible:r.receiveWhenViewVisible,viewRoot:null==r?void 0:r.viewRoot})}))}updateRemoteVideo(e){return du(this,null,(function*(){var t,n;let{view:i,userId:r,streamType:o,option:a}=e,s=`${r}_${o}`,l=this._remoteVideoConfigMap.get(s);if(!l||!this._room.remotePublishedUserMap.has(r))return;let c={};a&&(Ff(a.fillMode)||(c.objectFit=a.fillMode),Ff(a.mirror)||(c.mirror=a.mirror));let u=null,d=this._room.remotePublishedUserMap.get(r);if("main"===o&&(null==d?void 0:d.muteState.hasVideo)&&(u=d.remoteVideoTrack),"sub"===o&&(null==d?void 0:d.muteState.hasAuxiliary)&&(u=d.remoteAuxiliaryTrack),!u)return;let{config:h}=l;"main"===o&&a&&!Ff(a.small)&&this._room.changeType(a.small,u.user),yield this._updateVideoPlayOption({view:i,playOption:c,track:u,prevConfig:h}),sm(h,e);let p=Ff(null==a?void 0:a.receiveWhenViewVisible)?null==(t=h.option)?void 0:t.receiveWhenViewVisible:a.receiveWhenViewVisible,f=Ff(i)?h.view:i,m=Ff(null==a?void 0:a.viewRoot)?null==(n=h.option)?void 0:n.viewRoot:a.viewRoot;this._observeView({remoteTrack:u,view:f,receiveWhenViewVisible:p,viewRoot:m})}))}stopRemoteVideo(e){return du(this,null,(function*(){return this._stopRemoteVideo(e)}))}_stopRemoteVideo(e,t=!0){return du(this,null,(function*(){let n=[],i=this._room.remotePublishedUserMap.get(e.userId);if(i){let{muteState:t,remoteVideoTrack:r,remoteAuxiliaryTrack:o}=i;"main"===e.streamType&&(r.stop(),t.hasVideo&&n.push(r)),"sub"===e.streamType&&(o.stop(),t.hasAuxiliary&&n.push(o))}for(let e of n)t&&(yield this._room.unsubscribe(e),this._mediaTrackMap.get(e.outMediaTrack)===e.userId&&this._mediaTrackMap.delete(e.outMediaTrack));let r=this._remoteVideoConfigMap.get(`${e.userId}_${e.streamType}`);r&&r.observer&&r.observer.disconnect(),this._remoteVideoConfigMap.delete(`${e.userId}_${e.streamType}`)}))}muteRemoteAudio(e,t){return du(this,null,(function*(){if("*"===e)if(t)yield this._stopRemoteAudio({userId:e});else{let e=[...this._room.remotePublishedUserMap.values()];for(let t of e)t.muteState.hasAudio&&!this._remoteAudioConfigMap.has(t.userId)&&(yield this._startRemoteAudio({userId:t.userId}))}else t?yield this._stopRemoteAudio({userId:e}):this._remoteAudioConfigMap.has(e)||(yield this._startRemoteAudio({userId:e}));this._remoteAudioMuteMap.set(e,t)}))}setRemoteAudioVolume(e,t){if("*"===e){let e=[...this._room.remotePublishedUserMap.values()];for(let n of e)this._updateAudioPlayOption({playOption:{volume:t},track:n.remoteAudioTrack})}else if(e){let n=this._room.remotePublishedUserMap.get(e);n&&this._updateAudioPlayOption({playOption:{volume:t},track:n.remoteAudioTrack})}}startPlugin(e,t){return du(this,null,(function*(){return e.start(t)}))}updatePlugin(e,t){return du(this,null,(function*(){return e.update(t)}))}stopPlugin(e,t){return du(this,null,(function*(){return e.stop(t)}))}enableAudioVolumeEvaluation(e=2e3,t=!1){this._room.enableAudioVolumeEvaluation(e,t)}on(e,t,n){return this.listeners(e).includes(t)||(this._log.debug("on",e),super.on(e,t,n),this._eventListened.add(e)),this}off(e,t,n){return this._log.debug("off",e),"*"===e?(this._eventListened.clear(),this.removeAllListeners()):super.off(e,t,n),this}getAudioTrack(e={userId:"",streamType:"main"}){var t,n;let i,r="main";if(Bf(e)?i=e:(i=e.userId,e.streamType&&(r=e.streamType)),!i)return"sub"===r?(null==(t=this._localScreenAudioTrack)?void 0:t.mediaTrack)||null:(null==(n=this._localAudioTrack)?void 0:n.mediaTrack)||null;{let e=this._room.remotePublishedUserMap.get(i);if(e)return e.remoteAudioTrack.mediaTrack}return null}getVideoTrack(e={userId:"",streamType:"main"}){let{userId:t="",streamType:n="main"}=e;if(""===t){if("main"===n&&this._localVideoTrack)return this._localVideoTrack.mediaTrack;if("sub"===n&&this._localScreenTrack)return this._localScreenTrack.mediaTrack}else{let e=this._room.remotePublishedUserMap.get(t);if(e)return"main"===n?e.remoteVideoTrack.mediaTrack:e.remoteAuxiliaryTrack.mediaTrack}return null}getVideoSnapshot(e={}){let{userId:t,streamType:n="main"}=e;if(t){let e=this._room.remotePublishedUserMap.get(t);if("main"===n&&(null==e?void 0:e.muteState.hasVideo))return e.remoteVideoTrack.getVideoFrame();if("sub"===n&&(null==e?void 0:e.muteState.hasAuxiliary))return e.remoteAuxiliaryTrack.getVideoFrame()}else{if("main"===n&&this._localVideoTrack)return this._localVideoTrack.getVideoFrame();if("sub"===n&&this._localScreenTrack)return this._localScreenTrack.getVideoFrame()}return""}setCurrentSpeaker(e){var t,n;this._speakerId=e,null==(t=this._localAudioTrack)||t.setAudioOutput(e),null==(n=this._localScreenAudioTrack)||n.setAudioOutput(e),this._room.remotePublishedUserMap.forEach((t=>t.remoteAudioTrack.setAudioOutput(e)))}_startRemoteAudio(e){return this._doStartRemoteAudio(e)}_doStartRemoteAudio(e){return du(this,null,(function*(){let{userId:t,option:n}=e;if(this._remoteAudioConfigMap.has(t))return void this._log.warn(`remote audio has already started. userId:${t}`);let i=this._room.remotePublishedUserMap.get(t);if(!i)return;let r={};n&&(Ff(n.volume)||(r.volume=n.volume));let o=i.remoteAudioTrack;this._listenOutputTrackChanged(o),this._speakerId&&o.setAudioOutput(this._speakerId);try{this._remoteAudioConfigMap.set(t,e),yield this._room.subscribe(o),yield this._updateAudioPlayOption({playOption:r,track:o})}catch(e){throw this._remoteAudioConfigMap.delete(t),e}this._emitTrackEvent(o)}))}_stopRemoteAudio(e,t=!0){return du(this,null,(function*(){let n=this._room.remotePublishedUserMap.get(e.userId);n&&(n.remoteAudioTrack.stop(),n.muteState.hasAudio&&t&&(yield this._room.unsubscribe(n.remoteAudioTrack)),this._mediaTrackMap.get(n.remoteAudioTrack.outMediaTrack)===e.userId&&this._mediaTrackMap.delete(n.remoteAudioTrack.outMediaTrack)),this._remoteAudioConfigMap.delete(`${e.userId}`)}))}_updateVideoPlayOption(e){return du(this,arguments,(function*({view:e,playOption:t,track:n,prevConfig:i}){if(n.setMirror(t.mirror),Ff(e)&&i&&i.view&&!im(t)){let e=cm(i.view);e.length>0&&(yield n.play(e,t))}if(!Ff(e)){let i=cm(e);i.length>0?yield n.play(i,t):n.stop()}}))}_updateAudioPlayOption(e){return du(this,arguments,(function*({playOption:e={},track:t,prevConfig:n}){if(!t.isPlayCalled)try{yield t.play(null,e)}catch(e){}Ff(e.muted)||t.setPlayerMute(e.muted),Ff(e.volume)||t.setAudioVolume(e.volume/100)}))}_listenOutputTrackChanged(e){0===e.listeners("output-media-track-changed").length&&e.on("output-media-track-changed",(()=>this._emitTrackEvent(e,!1)))}_emitTrackEvent(e,t=!0){let n=e.isRemote?e.userId:"";!e.outMediaTrack||t&&this._mediaTrackMap.get(e.outMediaTrack)===n||(this._mediaTrackMap.set(e.outMediaTrack,n),this.emit(oE.TRACK,{userId:n,streamType:aE(e.streamType),track:e.outMediaTrack}))}_checkTrackToPublish(){var e,t,n;let i=[];if((null==(e=this._localAudioConfig)?void 0:e.publish)&&this._localAudioTrack&&i.push(this._localAudioTrack),(null==(t=this._localVideoConfig)?void 0:t.publish)&&this._localVideoTrack&&i.push(this._localVideoTrack),null!=(n=this._localScreenConfig)&&n.publish&&(this._localScreenTrack&&i.push(this._localScreenTrack),this._localScreenAudioTrack&&i.push(this._localScreenAudioTrack)),0!==i.length)return this._room.publish(...i).catch((()=>{}))}_observeView({remoteTrack:e,view:t,receiveWhenViewVisible:n=!1,viewRoot:i}){if(Ff(t))return;let r=this._remoteVideoConfigMap.get(`${e.userId}_${aE(e.streamType)}`);if(!r)return;let o=r.observer||void 0;if(null===t||Gf(t)&&0===t.length||!n)return null==o||o.disconnect(),void(e.isSubscribed||this._room.subscribe(e).catch((()=>{})));let a=r.visibleViewMap||new Map,s=-1;(!o||o.root!==i)&&(null==o||o.disconnect(),a.clear(),o=new IntersectionObserver((t=>{t.forEach((e=>{a.set(e.target,e.isIntersecting)})),clearTimeout(s),s=window.setTimeout((()=>{[...a.values()].find((e=>e))?e.isSubscribed||this._room.subscribe(e).catch((()=>{})):e.isSubscribed&&this._room.unsubscribe(e).catch((()=>{}))}),200)}),{root:i}));let l=new Set(cm(t));a.forEach(((e,t)=>{l.has(t)||(o.unobserve(t),a.delete(t))})),l.forEach((e=>{a.set(e,!0),o.observe(e)})),o.takeRecords().forEach((e=>{a.set(e.target,e.isIntersecting)})),r.visibleViewMap=a,r.observer=o}_exitRoom(){return du(this,null,(function*(){this._room.isJoined&&(yield this._room.leave()),new Set([...this._remoteAudioConfigMap.keys(),...this._remoteAudioMuteMap.keys()]).forEach((e=>{this._stopRemoteAudio({userId:e}).catch()})),[...this._remoteVideoConfigMap.keys()].forEach((e=>{let t=e.includes("main")?"main":"sub",n=e.split(`_${t}`)[0];n&&this._stopRemoteVideo({userId:n,streamType:t}).catch()})),this._remoteVideoConfigMap.clear(),this._remoteAudioConfigMap.clear(),this._remoteAudioMuteMap.clear(),this._room.remotePublishedUserMap.forEach((e=>{Lg(e.remoteAudioTrack),Lg(e.remoteVideoTrack),Lg(e.remoteAuxiliaryTrack)}))}))}_stopScreenShare(){return du(this,null,(function*(){var e;if(this._localScreenTrack){if(this._room.isJoined){let t=[this._localScreenTrack];this._localScreenAudioTrack&&t.push(this._localScreenAudioTrack),yield null==(e=this._room)?void 0:e.unpublish(...t).catch((()=>{}))}this._localScreenTrack.stop(),this._localScreenTrack.close(),this._localScreenAudioTrack&&(this._localScreenAudioTrack.stop(),this._localScreenAudioTrack.close(),this._room.audioManager.removeInput(this._localScreenAudioTrack),this._localScreenAudioTrack=null),Lg(this._localScreenTrack),this._localScreenTrack=null,this._localScreenConfig=null}}))}_initActiveSpeaker(){return du(this,null,(function*(){if(PE&&!V_(PE))this.emit(oE.DEVICE_CHANGED,{type:"speaker",action:"active",device:PE});else{let e=yield j_();if(e[0]&&!V_(e[0]))PE=e[0],this.emit(oE.DEVICE_CHANGED,{type:"speaker",action:"active",device:e[0]});else{let e=({track:e})=>{"audio"===e.kind&&(!PE||V_(PE))&&(this._initActiveSpeaker(),af.off("102",this._initActiveSpeaker))};af.on("102",e)}}}))}_onAudioAvailable({userId:e}){let t=this._remoteAudioMuteMap.has(e)?this._remoteAudioMuteMap.get(e):this._remoteAudioMuteMap.get("*");(!1===t||this._room.autoReceiveAudio&&!t)&&this._doStartRemoteAudio({userId:e}).catch((()=>{}))}_onVideoAvailable({userId:e,streamType:t}){if(!this._room.autoReceiveVideo)return;let n=this._room.remotePublishedUserMap.get(e);if(n){let e="main"===t?n.remoteVideoTrack:n.remoteAuxiliaryTrack;this._room.subscribe(e).then((()=>{this._emitTrackEvent(e)})).catch((()=>{}))}}_onAudioUnavailable({userId:e,muteState:t}){t.hasAudio&&t.audioMuted||this._stopRemoteAudio({userId:e},!1).catch((()=>{}))}_onVideoUnavailable({userId:e,streamType:t}){this._stopRemoteVideo({userId:e,streamType:t},!1).catch((()=>{}))}sendSEIMessage(e,t){let n=this._plugins.get("SEI");n&&(n.update({buffer:e,options:t||{seiPayloadType:243}}),Kg.addCount({key:5e5,useUV:!0}))}sendCustomMessage(e){var t,n;null==(n=(t=this._room).sendCustomMessage)||n.call(t,e),Kg.addCount({key:500001,useUV:!0})}static setLogLevel(e,t){wm.setLogLevel(e),Ff(t)||(t?wm.enableUploadLog():wm.disableUploadLog())}static isSupported(){return zm()}static getCameraList(e=!0){return H_(e)}static getMicrophoneList(e=!0){return B_(e)}static getSpeakerList(e=!0){return j_(e)}static setCurrentSpeaker(e){return du(this,null,(function*(){(yield j_()).forEach((t=>{t.deviceId===e&&(OE.forEach((n=>{n.setCurrentSpeaker(e),n.emit(oE.DEVICE_CHANGED,{type:"speaker",action:"active",device:t})})),PE=t)}))}))}static _addKVStat({type:e,key:t,value:n,base:i,useUV:r,version:o}){switch(o&&(Jg.version=o),e){case"count":Jg.addCount({key:t,useUV:r});break;case"enum":Jg.addEnum({key:t,value:n,useUV:r});break;case"number":Jg.addNumber({key:t,value:n,split:i})}}},VE=UE;cu(VE,"_loggerManager",wm),cu(VE,"EVENT",oE),cu(VE,"ERROR_CODE",Dy),cu(VE,"TYPE",ky),cu(VE,"frameWorkType",30),lu([gE({replaceArg:e=>({argIndex:0,value:{name:"plugin"in e?e.plugin.Name:e.Name,assetsPath:"assetsPath"in e?null==e?void 0:e.assetsPath:"default"}})})],VE.prototype,"use",1),lu([hE(qy.TRTC.enterRoom),nE("room",(([e],[t])=>(e.roomId||e.strRoomId)===(t.roomId||t.strRoomId)&&e.userId===t.userId&&e.sdkAppId===t.sdkAppId)),lv((e=>function(t){return this._log.setUserId(t.userId),this._log.setSdkAppId(t.sdkAppId),e.call(this,t)})),gE()],VE.prototype,"enterRoom",1),lu([gE()],VE.prototype,"exitRoom",1),lu([hE(qy.TRTC.switchRole),iE("room",{merge:(e,t)=>t}),gE()],VE.prototype,"switchRole",1),lu([gE()],VE.prototype,"destroy",1),lu([hE(qy.TRTC.startLocalAudio),nE("audio",(([e],[t])=>{var n,i;return(null==(n=null==e?void 0:e.option)?void 0:n.microphoneId)===(null==(i=null==t?void 0:t.option)?void 0:i.microphoneId)})),gE()],VE.prototype,"startLocalAudio",1),lu([hE(qy.TRTC.updateLocalAudio),iE("audio",{debounce:{delay:200,getKey:()=>`${DE}-localAudio`,isNeedToDebounce:e=>{var t;return!Ff(null==(t=e.option)?void 0:t.captureVolume)}}}),gE()],VE.prototype,"updateLocalAudio",1),lu([rE("audio"),gE()],VE.prototype,"stopLocalAudio",1),lu([hE(qy.TRTC.startLocalVideo),nE("video",(([e],[t])=>{var n,i;return(null==(n=null==e?void 0:e.option)?void 0:n.cameraId)===(null==(i=null==t?void 0:t.option)?void 0:i.cameraId)})),gE()],VE.prototype,"startLocalVideo",1),lu([hE(qy.TRTC.updateLocalVideo),iE("video"),gE()],VE.prototype,"updateLocalVideo",1),lu([rE("video"),gE()],VE.prototype,"stopLocalVideo",1),lu([hE(qy.TRTC.startScreenShare),nE("screen",(()=>!0)),gE()],VE.prototype,"startScreenShare",1),lu([hE(qy.TRTC.updateScreenShare),iE("screen"),gE()],VE.prototype,"updateScreenShare",1),lu([gE()],VE.prototype,"stopScreenShare",1),lu([hE(qy.TRTC.startRemoteVideo),nE((e=>`v${e.userId}${e.streamType}`),(()=>!0)),gE({getRemoteId:e=>`${e.userId}_${e.streamType}`})],VE.prototype,"startRemoteVideo",1),lu([hE(qy.TRTC.updateRemoteVideo),iE((e=>`v${e.userId}${e.streamType}`)),gE({getRemoteId:e=>`${e.userId}_${e.streamType}`})],VE.prototype,"updateRemoteVideo",1),lu([hE(qy.TRTC.stopRemoteVideo),lv((e=>function(t){return du(this,null,(function*(){if("*"===t.userId){let e=[];return this._room.remotePublishedUserMap.forEach((t=>{this._remoteVideoConfigMap.has(`${t.userId}_main`)&&e.push(this.stopRemoteVideo({streamType:"main",userId:t.userId}).catch((()=>{}))),this._remoteVideoConfigMap.has(`${t.userId}_sub`)&&e.push(this.stopRemoteVideo({streamType:"sub",userId:t.userId}).catch((()=>{})))})),Promise.all(e)}return e.call(this,t)}))})),gE({getRemoteId:e=>`${e.userId}_${e.streamType}`})],VE.prototype,"stopRemoteVideo",1),lu([rE((e=>`v${e.userId}${e.streamType}`))],VE.prototype,"_stopRemoteVideo",1),lu([hE(...qy.TRTC.muteRemoteAudio),gE({getRemoteId:e=>e})],VE.prototype,"muteRemoteAudio",1),lu([pE(...qy.TRTC.setRemoteAudioVolume),function(e,t){return lv(((e,n)=>function(...n){var i,r;let o=null==(i=dE.get(this))?void 0:i.get(t(...n));o&&o>0&&clearTimeout(o);let a=window.setTimeout((()=>{e.apply(this,n)}),200);dE.has(this)?null==(r=dE.get(this))||r.set(t(...n),a):dE.set(this,new Map([[t(...n),a]]))}))}(0,(e=>e)),gE({getRemoteId:e=>e})],VE.prototype,"setRemoteAudioVolume",1),lu([_E("start"),sv((e=>{var t;return null==(t=e.afterStart)?void 0:t.call(e)})),nE(((e,t)=>e.getAlias()+e.getGroup(t))),gE({replaceArg:e=>({argIndex:0,value:e.getName()}),getKVReportKey:e=>Gg[e.getName()]})],VE.prototype,"startPlugin",1),lu([_E("update"),iE(((e,t)=>e.getAlias()+e.getGroup(t))),gE({replaceArg:e=>({argIndex:0,value:e.getName()}),getKVReportKey:e=>$g[e.getName()]})],VE.prototype,"updatePlugin",1),lu([_E("stop"),rE(((e,t)=>{let n=e.getGroup(t),i=e.getAlias();return"*"===n?new RegExp(`${i}.*`):i+n})),gE({replaceArg:e=>({argIndex:0,value:e.getName()}),getKVReportKey:e=>Wg[e.getName()]})],VE.prototype,"stopPlugin",1),lu([pE(...qy.TRTC.enableAudioVolumeEvaluation)],VE.prototype,"enableAudioVolumeEvaluation",1),lu([gE()],VE.prototype,"getVideoSnapshot",1),lu([gE()],VE.prototype,"setCurrentSpeaker",1),lu([nE((e=>`a${e.userId}`),(()=>!0))],VE.prototype,"_startRemoteAudio",1),lu([lv((e=>function(t){return du(this,null,(function*(){return"*"===t.userId?Promise.all([...this._room.remotePublishedUserMap.values()].map((e=>this._stopRemoteAudio(ru(iu({},t),{userId:e.userId})).catch((()=>{}))))):e.call(this,t)}))})),rE((e=>`a${e.userId}`))],VE.prototype,"_stopRemoteAudio",1),lu([rE("room")],VE.prototype,"_exitRoom",1),lu([rE("screen")],VE.prototype,"_stopScreenShare",1),lu([hE(...qy.TRTC.sendSEIMessage),Ry({timesInSecond:30,maxSizeInSecond:8e3,getSize:(...e)=>e[0].byteLength})],VE.prototype,"sendSEIMessage",1),lu([hE(qy.TRTC.sendCustomMessage),Ry({timesInSecond:30,maxSizeInSecond:8e3,getSize:e=>e.data.byteLength})],VE.prototype,"sendCustomMessage",1),lu([hE(qy.TRTC.create)],VE,"_create",1);var FE=VE;function BE(){return du(this,null,(function*(){let e,t;try{let t=yield B_();e=t&&t.length}catch(e){}try{let e=yield H_();t=e&&e.length}catch(e){}let n={microphone:e,camera:t},{isH264EncodeSupported:i,isVp8EncodeSupported:r,isH264DecodeSupported:o,isVp8DecodeSupported:a}=this.checkSystemResult.detail,s=Cm.basis(),l={webRTC:s.isWebRTCSupported,getUserMedia:s.isGetUserMediaSupported,webSocket:s.isWebSocketsSupported,screenShare:s.isScreenShareSupported,webAudio:s.isWebAudioSupported,h264Encode:i,h264Decode:o,vp8Encode:r,vp8Decode:a},c={browser:s.browser,os:s.os,trtc:l,devices:n},u={isWebCodecSupported:s.isWebCodecSupported,isMediaSessionSupported:s.isMediaSessionSupported,isWebTransportSupported:s.isWebTransportSupported};lf.uploadEvent({log:`trtcstats-${JSON.stringify(c)}`,userId:this.userId}),this._log.info(`TrtcStats-${JSON.stringify(c)}`),lf.uploadEvent({log:`trtcadvancedstats-${JSON.stringify(u)}`,userId:this.userId})}))}var HE=su(hu()),zE="3",jE={CLIENT_BANNED:9,CHANNEL_SETUP_RESULT:19,CHANNEL_RECONNECT_RESULT:514,JOIN_ROOM_RESULT:20,PEER_JOIN:4134,PEER_LEAVE:4135,STREAM_ADDED:16,STREAM_REMOVED:18,UPLINK_NETWORK_STATS:22,UPDATE_REMOTE_MUTE_STAT:23,PUBLISH_RESULT:4098,PUBLISH_STATE_CHANGE_RESULT:4112,UNPUBLISH_RESULT:4100,SUBSCRIBE_RESULT:4102,UNSUBSCRIBE_RESULT:4104,SUBSCRIBE_CHANGE_RESULT:4106,MUTE_RESULT:4108,UPDATE_OFFER_RESULT:4128,START_PUBLISH_TENCENT_CDN_RES:1286,STOP_PUBLISH_TENCENT_CDN_RES:1288,START_PUBLISH_GIVEN_CDN_RES:777,STOP_PUBLISH_GIVEN_CDN_RES:779,START_MIX_TRANSCODE_RES:781,STOP_MIX_TRANSCODE_RES:783,USER_LIST_RES:4137,SWITCH_ROLE_RES:4110,UPDATE_CONSTRAINT_CONFIG_RES:772,REBUILD_PEER_CONNECTION_RES:4150,SPC_PUBLISH_RESULT:4146,SPC_SUBSCRIBE_RESULT:4156,ABILITY_STATUS_REPORT_RESULT:4158,SERVER_FIRST_PACKAGE_RECEIVED:5e3,RECEIVE_CUSTOM_MSG:4140},GE=[jE.UPDATE_REMOTE_MUTE_STAT,jE.UPLINK_NETWORK_STATS,jE.USER_LIST_RES,jE.MUTE_RESULT,jE.SERVER_FIRST_PACKAGE_RECEIVED,jE.RECEIVE_CUSTOM_MSG],$E={CLIENT_BANNED:"client-banned",CHANNEL_SETUP_RESULT:"channel-setup-result",CHANNEL_RECONNECT_RESULT:"channel-reconnect-result",JOIN_ROOM_RESULT:"join-room-result",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",UPLINK_NETWORK_STATS:"uplink-network-stats",UPDATE_REMOTE_MUTE_STAT:"update-remote-mute-stat",PUBLISH_RESULT:"publish-result",PUBLISH_STATE_CHANGE_RESULT:"publish-state-change-result",UNPUBLISH_RESULT:"unpublish-result",SUBSCRIBE_RESULT:"subscribe-result",SUBSCRIBE_CHANGE_RESULT:"subscribe-change-result",UNSUBSCRIBE_RESULT:"unsubscribe-result",UPDATE_OFFER_RESULT:"update-offer-result",START_PUBLISH_TENCENT_CDN_RES:"start-publish-tencent-cdn-res",STOP_PUBLISH_TENCENT_CDN_RES:"stop-publish-tencent-cdn-res",START_PUBLISH_GIVEN_CDN_RES:"start-publish-given-cdn-res",STOP_PUBLISH_GIVEN_CDN_RES:"stop-publish-given-cdn-res",START_MIX_TRANSCODE_RES:"start-mix-transcode-res",STOP_MIX_TRANSCODE_RES:"stop-mix-transcode-res",USER_LIST_RES:"user-list-res",SWITCH_ROLE_RES:"switch_role_res",MUTE_RESULT:"mute-result",UPDATE_CONSTRAINT_CONFIG_RES:"update-contraint-config-res",REBUILD_PEER_CONNECTION_RES:"rebuild-pc-res",SPC_PUBLISH_RESULT:"spc-publish-result",SPC_SUBSCRIBE_RESULT:"spc-subscribe-result",ABILITY_STATUS_REPORT_RESULT:"ability-status-report",SERVER_FIRST_PACKAGE_RECEIVED:"first-pkg-received",RECEIVE_CUSTOM_MSG:"receive-custom-msg"},WE="mute_uplink",qE="publish_state_change",XE="unpublish",YE="unsubscribe",JE="subscribe_change",KE="update_constraint_config",QE=new Set,ZE=class extends HE.default{constructor(e){var t,n;super(),cu(this,"room"),cu(this,"url"),cu(this,"backupUrl"),cu(this,"race"),cu(this,"destroyed",!1),cu(this,"_socketInUse"),cu(this,"_socket"),cu(this,"_backupSocket"),cu(this,"_signalInfo",{tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0}),cu(this,"_currentState","DISCONNECTED"),cu(this,"_isReconnecting",!1),cu(this,"_seq",0),cu(this,"_log"),cu(this,"_lastMessageTime",-1),cu(this,"_connnectStartTime",-1),cu(this,"_stopConnectRetry"),cu(this,"bytesSent",0),cu(this,"bytesReceived",0),cu(this,"keepAlive",!1),cu(this,"signalDomainWhenUnifiedProxy"),this.room=e.room,this.race=!!Ff(e.race)||e.race,this.signalDomainWhenUnifiedProxy=e.signalDomainWhenUnifiedProxy,((null==(n=null==(t=this.room.scheduleResult)?void 0:t.config)?void 0:n.keepAliveClient)||0)-QE.size>0&&this.room.enableSPC&&(this.keepAlive=!0,QE.add(this)),this.url=e.url,this.backupUrl=e.backupUrl,this._seq=0,this._log=wm.createLogger({id:"ws",userId:this.userId,sdkAppId:this.sdkAppId}),this.onmessage=this.onmessage.bind(this),this.onerror=this.onerror.bind(this),this.onclose=this.onclose.bind(this)}get urlParam(){let e=`?sdkAppId=${encodeURIComponent(this.sdkAppId)}&userId=${encodeURIComponent(this.userId)}&userSig=${encodeURIComponent(this.userSig)}&keepAlive=${encodeURIComponent(Number(this.keepAlive))}`;return this.signalDomainWhenUnifiedProxy&&(e+=`&signalDomain=${encodeURIComponent(this.signalDomainWhenUnifiedProxy)}`),this.race?`${e}&race=1`:e}get _urlWithParam(){return`${this.url}${this.race?"/v2/ws":""}${this.urlParam}`}get _backupUrlWithParam(){return`${this.backupUrl}${this.race?"/v2/ws":""}${this.urlParam}`}get isConnected(){return"CONNECTED"===this._currentState}get isConnecting(){return"CONNECTING"===this._currentState}get sdkAppId(){return this.room.sdkAppId}get userId(){return this.room.userId}get userSig(){return this.room.userSig}get isOnline(){return"CONNECTED"===this._currentState&&Date.now()-this._lastMessageTime<12e3}connect(){return du(this,arguments,(function*(e=1e4){if(this.isConnected)return Promise.resolve();this._log.info(`connect to [${this.url}, ${this.backupUrl}]${e?` timeout: ${e}`:""} keepAlive: ${Number(this.keepAlive)}`),this.emitConnectionStateChanged("CONNECTING"),this._connnectStartTime=Qf();let t=[this.connectWS({url:this._urlWithParam,isMain:!0,timeout:e})];this.race&&this._backupUrlWithParam!==this._urlWithParam&&t.push(this.connectWS({url:this._backupUrlWithParam,isMain:!1,timeout:e})),this._socketInUse=yield Kf(t),this.unbindAndCloseSocket(this._socketInUse===this._socket?ld.BACKUP:ld.MAIN),this.emitConnectionStateChanged("CONNECTED")}))}connectWS({url:e,timeout:t,isMain:n}){let i=new WebSocket(e);this.bindSocket(i),n?this._socket=i:this._backupSocket=i;let r=-1;return new Promise(((e,o)=>{i.onclose=o,i.onerror=o,i.onopen=()=>e(i),t&&(r=setTimeout((()=>{this.unbindAndCloseSocket(n?ld.MAIN:ld.BACKUP),o(new Au({code:Tu.SIGNAL_CHANNEL_SETUP_FAILED,message:"ws connect timeout"}))}),t))})).finally((()=>{i.onclose=null,i.onerror=null,i.onopen=null,clearTimeout(r)}))}bindSocket(e){e.addEventListener("close",this.onclose),e.addEventListener("error",this.onerror),e.addEventListener("message",this.onmessage)}unbindSocket(e){e.removeEventListener("close",this.onclose),e.removeEventListener("error",this.onerror),e.removeEventListener("message",this.onmessage)}unbindAndCloseSocket(e){if(e===ld.MAIN){if(this._socket){this.unbindSocket(this._socket);try{this._socket.close(1e3)}catch(e){}this._socket=null}}else if(this._backupSocket){this.unbindSocket(this._backupSocket);try{this._backupSocket.close(1e3)}catch(e){}this._backupSocket=null}}onclose(e){if(e.target===this._socketInUse&&(this._log.warn(`${e.target===this._socket?"main":"backup"} is closed code:${e.code} ${e.reason}`),this.emitConnectionStateChanged("DISCONNECTED"),!e.wasClean||1e3!==e.code)){this._socketInUse.onclose=null,this._socketInUse.close(4011);let e=this._socketInUse===this._socket;this.unbindAndCloseSocket(e?ld.MAIN:ld.BACKUP),this._socketInUse=null,this.reconnect()}}onerror(e){this._log.error((e.target===this._socket?"main":"backup")+" error observed"),this.emitConnectionStateChanged("DISCONNECTED"),e.target===this._socketInUse&&(this.unbindAndCloseSocket(ld.MAIN),this.unbindAndCloseSocket(ld.BACKUP),this._socketInUse=null,this.reconnect())}onmessage(e){if(!this.isConnected)return;this._lastMessageTime=Date.now(),this.bytesReceived+=mm(e.data);let t=JSON.parse(e.data),{cmd:n,data:i}=t,r=Object.values(jE),o=Object.keys(jE)[r.indexOf(n)],a=$E[o]||n;switch(GE.includes(n)||(this._log.debug(`received ${n} msg: ${e.data}`),a&&this._log.info(`Received event: [ ${a} ]`)),n){case jE.CHANNEL_SETUP_RESULT:if(0===t.code)this._signalInfo.clientIp=i.clientIp,this._signalInfo.signalIp=i.signalInnerIp,i.svrTime&&function(e){wu=e-(new Date).getTime();let t=new Date;t.setTime(e),wm.info(`baseTime from server: ${t} offset: ${wu}`)}(i.svrTime),this._log.info("ChannelSetup Success"),Kg.addSuccessEvent({key:521701,cost:Qf()-this._connnectStartTime}),this._connnectStartTime=-1,this.emit("1",{signalInfo:this._signalInfo});else{let e=new Au({code:Tu.SIGNAL_CHANNEL_SETUP_FAILED,extraCode:t.code,message:nf({key:fh.SIGNAL_CHANNEL_SETUP_FAILED,data:{errorCode:t.code,errorMsg:t.message}})});this._log.error(`${t.code}, ${t.message}`),this.close(),Kg.addFailedEvent({key:521701,error:e}),this.emit("5",e)}break;case jE.JOIN_ROOM_RESULT:0===t.code&&(this._signalInfo.relayIp=i.relayOuterIp,this._signalInfo.relayInnerIp=i.relayInnerIp,this._signalInfo.relayPort=i.relayPort,this._signalInfo.tinyId=t.tinyId,this._log.info(`signalIp:${this._signalInfo.signalIp} clientIp:${this._signalInfo.clientIp} relayIp: ${this._signalInfo.relayIp}`)),this.emit(a,{data:t});break;default:this.emit(String(a),{data:t})}}reGetSignalChannelUrl(){return du(this,null,(function*(){try{if(!this.room.joinParams)return;df(!0),yield this.room.schedule(this.room.joinParams);let{mainUrl:e,backupUrl:t}=this.room.getSignalChannelUrl();this.url=e,this.backupUrl=t}catch(e){}}))}reconnect(){return du(this,null,(function*(){if(!this._isReconnecting){if(!this.room.isJoined&&this.keepAlive)return void this.close();this._isReconnecting=!0;try{this._log.warn("reconnect"),yield this.connect();let{roomId:e,useStringRoomId:t}=this.room,{relayIp:n,relayInnerIp:i,relayPort:r}=this._signalInfo,{data:o}=yield this.sendWaitForResponse({command:"reconnect",data:{roomId:e,useStringRoomId:t,relayInnerIp:i,relayOuterIp:n,relayPort:r},responseCommand:$E.CHANNEL_RECONNECT_RESULT});0===o.code?(this._log.warn("reconnect success"),this.stopReconnection(),Kg.addSuccessEvent({key:521702,cost:Qf()-this._connnectStartTime}),this._connnectStartTime=-1,this.room.syncUserList(),this.room.checkConnectionsToReconnect()):(Kg.addFailedEvent({key:521702,error:o.code}),this._log.warn(`reconnect failed, ${o.code} ${o.message}`),this.room.reJoin())}catch(e){this._log.error(e),this.room.reJoin()}}}))}send(e,t={}){if(this.isConnected&&!this.room.isLeft){let n={cmd:e,data:t,userId:this.userId,tinyId:this._signalInfo.tinyId,seq:++this._seq},i=JSON.stringify(n);return this._socketInUse.send(i),this.bytesSent+=mm(i),n.seq}}sendWaitForResponse({command:e,data:t,timeout:n=5e3,responseCommand:i,commandDesc:r,enableLog:o=!0}){return new Promise(((a,s)=>{let l=setTimeout((()=>{this.off(i,c);let t=new Au({code:Tu.API_CALL_TIMEOUT,message:nf({key:fh.API_CALL_TIMEOUT,data:{commandDesc:r,command:e}})});o&&this._log.warn(t),s(t)}),n),c=e=>{e.data.seq===u&&(clearTimeout(l),this.off(i,c),a(e))};this.on(i,c);let u=this.send(e,t)}))}sendWaitForResponseWithRetry(e){let{commandDesc:t,command:n,retries:i=0,retryTimeout:r=0}=e;return of({retryFunction:this.sendWaitForResponse,onError:({retry:e})=>{this.isOnline?e():(this._log.warn(`retry ${n} when connected`),this.once(zE,e))},onRetrying:e=>{this._log.warn(`${t||n} timeout observed, retrying [${e}/${i}]`)},settings:{retries:i,timeout:r},context:this})(e)}getCurrentState(){return this._currentState}getSignalInfo(){return this._signalInfo}stopReconnection(){this._isReconnecting=!1,this._stopConnectRetry&&this._stopConnectRetry()}close(){this._log.info("closed"),QE.delete(this),this.stopReconnection(),this._signalInfo={tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0},this._socketInUse=null,this.bytesSent=0,this.bytesReceived=0,this._stopConnectRetry&&this._stopConnectRetry(),this.unbindAndCloseSocket(ld.MAIN),this.unbindAndCloseSocket(ld.BACKUP),this.emitConnectionStateChanged("DISCONNECTED")}destroy(){this.close(),this.destroyed=!0}stopKeepAliveIn(e=3600){if(this.keepAlive){this._log.info(`stopKeepAlive in ${e}s`);let t=setTimeout((()=>{this.keepAlive=!1,this._log.info(`close due to not used ${e}s`),this.close(),this.off($E.JOIN_ROOM_RESULT,n)}),1e3*e),n=e=>{0===e.data.code&&(this._log.info("stopKeepAlive clear timeout"),clearTimeout(t),this.off($E.JOIN_ROOM_RESULT,n))};this.on($E.JOIN_ROOM_RESULT,n)}}emitConnectionStateChanged(e){e!==this._currentState&&(this._log.info(`${this._currentState} -> ${e}`),this.emit("2",{prevState:this._currentState,state:e}),this._currentState=e,"CONNECTED"===e?this.emit(zE):"DISCONNECTED"===e&&this.emit("5"))}};lu([Vg({settings:{retries:1/0,timeout:2e3},onError(e,t){!this.room.isDestroyed&&!this.destroyed&&t()},onRetrying(e,t){this._log.warn(`retrying to connect ${e}`),e>=3&&e%3==0&&this.reGetSignalChannelUrl(),t&&(this._stopConnectRetry=t,(this.room.isDestroyed||this.destroyed)&&t())}})],ZE.prototype,"connect",1);var eb=su(hu()),tb=0,nb=!1,ib=new Set,rb=!1,ob=class{constructor(e){cu(this,"userId"),cu(this,"tinyId"),cu(this,"_sdpSemantics"),cu(this,"_isUplink"),cu(this,"_room"),cu(this,"_log"),cu(this,"_signalChannel"),cu(this,"_isErrorObserved",!1),cu(this,"_waitForPeerConnectionConnectedPromise"),cu(this,"_waitForPeerConnectionConnectedPromiseReject",null),cu(this,"_peerConnection",null),cu(this,"_emitter",new eb.default),cu(this,"_currentState","DISCONNECTED"),cu(this,"_isReconnecting",!1),cu(this,"_reconnectionCount",0),cu(this,"_reconnectionTimer",-1),cu(this,"_isFirstConnection",!0),cu(this,"_prevTime",-1),cu(this,"_enableSEI"),cu(this,"_sei"),cu(this,"_localAddress"),cu(this,"_remoteAddress"),this.userId=e.userId,this.tinyId=e.tinyId,this._room=e.room,this._sdpSemantics=e.room.sdpSemantics,this._isUplink=e.isUplink,this._log=wm.createLogger({id:"n-mpc",userId:this._room.userId,remoteUserId:this.userId,sdkAppId:this._room.sdkAppId,isLocal:this._isUplink}),this._signalChannel=e.signalChannel,this._enableSEI=e.enableSEI}beforeConnect(){this._prevTime<0&&(this._prevTime=Qf())}afterConnect(){try{this._isFirstConnection?(this._isFirstConnection=!1,Kg.addSuccessEvent({key:521705,cost:Math.min(Qf()-this._prevTime,3e4)})):this._isReconnecting&&Kg.addSuccessEvent({key:521706,cost:Qf()-this._prevTime}),this._prevTime=-1}catch(e){throw this._isFirstConnection?(this._isFirstConnection=!1,Kg.addFailedEvent({key:521705,error:e})):this._isReconnecting&&this._reconnectionCount>=3&&Kg.addFailedEvent({key:521706,error:e}),e}}initialize(){let e={encodedInsertableStreams:this._enableSEI&&ug,iceServers:this._room.getIceServers(),iceTransportPolicy:this._room.getIceTransportPolicy(),sdpSemantics:this._sdpSemantics,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"};this._peerConnection=new RTCPeerConnection(e),this._peerConnection.onconnectionstatechange=this.onConnectionStateChange.bind(this)}close(e){this._log.info("close connection"),this._emitter.emit("closed",e),this._isReconnecting&&this.stopReconnection(),this.closePeerConnection(),this._sei&&(this._sei.destroy(),this._sei=null),ib.delete(this)}closePeerConnection(e=!1){this._peerConnection&&(this._log.info("close pc"),this._peerConnection.onconnectionstatechange=null,this._peerConnection.close(),this._peerConnection=null,e&&this.emitConnectionStateChangedEvent("DISCONNECTED")),this._waitForPeerConnectionConnectedPromiseReject&&this._waitForPeerConnectionConnectedPromiseReject(new Au({code:Tu.API_CALL_ABORTED,message:"connection closed"}))}getDTLSTransportState(){if(!this._peerConnection)return Cd;let e=null;if(this._isUplink){if(!tg()||0===this._peerConnection.getSenders().length)return Cd;e=this._peerConnection.getSenders()[0].transport}else{if(!eg()||0===this._peerConnection.getReceivers().length)return Cd;e=this._peerConnection.getReceivers()[0].transport}return e?e.state:Cd}onConnectionStateChange(e){let t=this._peerConnection.iceConnectionState,n=this.getDTLSTransportState();if(this._log.info(`connectionState: ${e.target.connectionState}, ICE: ${t}, DTLS: ${n}`),e.target.connectionState===Md.CONNECTING&&this.emitConnectionStateChangedEvent("CONNECTING"),e.target.connectionState===Md.FAILED||e.target.connectionState===Md.CLOSED){let i=`connection ${e.target.connectionState}. ICE Transport state: ${t}, DTLS Transport state: ${n}`,r=new Au({message:i,code:Tu.ICE_TRANSPORT_ERROR});this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection(),this._isErrorObserved||this._emitter.emit("error",r)}(e.target.connectionState===Md.CONNECTED||e.target.connectionState===Md.COMPLETED)&&(this.logSelectedCandidate(),lf.logSuccessEvent({userId:this._room.userId,eventType:Ld.ICE_CONNECTION_STATE}),this.emitConnectionStateChangedEvent("CONNECTED"))}emitConnectionStateChangedEvent(e){return e!==this._currentState&&("CONNECTED"===e?(tb=0,nb=!1,rb=!0,ib.add(this)):ib.delete(this),af.emit(xm.PEER_CONNECTION_STATE_CHANGED,{room:this._room,prevState:this._currentState,state:e,remoteUserId:this._isUplink?void 0:this.userId}),this._emitter.emit("connection-state-changed",{prevState:this._currentState,state:e}),this._currentState=e,!0)}getPeerConnection(){return this._peerConnection}getRoom(){return this._room}getUserId(){return this.userId}getTinyId(){return this.tinyId}logSelectedCandidate(){return du(this,null,(function*(){if(!this._peerConnection)return;let e=yield this._peerConnection.getStats();for(let[,t]of e)if(qm(t)){let n=e.get(t.localCandidateId),i=e.get(t.remoteCandidateId);n&&(this._log.info(`local candidate: ${n.candidateType} ${n.protocol}:${n.ip||n.address}:${n.port} ${n.networkType||""} ${"relay"===n.candidateType?`relayProtocol:${n.relayProtocol}`:""}`),this._localAddress=`${n.ip||n.address}:${n.port}`),i&&(this._log.info(`remote candidate: ${i.candidateType} ${i.protocol}:${i.ip||i.address}:${i.port}`),this._remoteAddress=`${i.protocol}:${i.ip||i.address}`);break}}))}getCurrentState(){return this._currentState}waitForPeerConnectionConnected(){return this._waitForPeerConnectionConnectedPromise||(this._waitForPeerConnectionConnectedPromise=new Promise(((e,t)=>{if("CONNECTED"===this._currentState)return e();this._waitForPeerConnectionConnectedPromiseReject=t;let n=t=>{"CONNECTED"===t.state&&(clearTimeout(o),r(),e())},i=({room:e})=>{e===this._room&&(clearTimeout(o),r(),t(new Au({code:Tu.API_CALL_ABORTED,message:nf({key:fh.CONNECTION_ABORTED,data:"leave room"})})))},r=()=>{af.off(xm.LEAVE_SUCCESS,i,this),this._emitter.off("connection-state-changed",n,this)},o=setTimeout((()=>{r();let e=new Au({code:Tu.API_CALL_TIMEOUT,message:"connection timeout"});var n;tb+=1,n=this._signalChannel.isConnected,tb>2&&!nb&&0===ib.size&&n&&(this._log.warn("firewall restriction"),nb=!0,this._emitter.emit("firewall-restriction")),t(e)}),Xd);af.on(xm.LEAVE_SUCCESS,i,this),this._emitter.on("connection-state-changed",n,this)})),this._waitForPeerConnectionConnectedPromise=this._waitForPeerConnectionConnectedPromise.finally((()=>{this._waitForPeerConnectionConnectedPromise=null,this._waitForPeerConnectionConnectedPromiseReject=null}))),this._waitForPeerConnectionConnectedPromise}getReconnectionCount(){return this._reconnectionCount}startReconnection(){this._isReconnecting=!0,this.reconnect()}clearReconnectionTimer(){-1!==this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}stopReconnection(){this._log.info("stop reconnection"),this._isReconnecting=!1,this._reconnectionCount=0,this.clearReconnectionTimer(),this._signalChannel.off(zE,this.reconnect,this)}beforeReconnect(){if(-1!==this._reconnectionTimer)return this._log.warn("reconnect() is reconnecting, ignore"),-1;if(this._reconnectionCount>=Dd()){this._log.warn(`SDK has tried reconnect for ${this._reconnectionCount} times, but all failed, please check your network`),this.stopReconnection();let e=new Au({code:this._isUplink?Tu.UPLINK_RECONNECTION_FAILED:Tu.DOWNLINK_RECONNECTION_FAILED,message:nf({key:this._isUplink?fh.UPLINK_RECONNECTION_FAILED:fh.DOWNLINK_RECONNECTION_FAILED})});return this.emitConnectionStateChangedEvent("DISCONNECTED"),this._emitter.emit("error",e),-1}return this._signalChannel.isConnected?(this._reconnectionCount+=1,this._log.warn(`reconnect() trying [${this._reconnectionCount}]`),1):(this._log.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this._signalChannel.once(zE,this.reconnect,this),-1)}on(e,t,n){this._emitter.on(e,t,n)}off(e,t,n){this._emitter.off(e,t,n)}getIsReconnecting(){return this._isReconnecting}get isH264(){var e,t;return!(null==(t=null==(e=this._peerConnection)?void 0:e.remoteDescription)||!t.sdp.includes("H264"))}},ab=su(Eu()),sb=function(e){return ab.default.parse(e)},lb=function(e){return ab.default.write(e)};function cb(e){return Object.keys(e).filter((t=>e[t]))}var ub=class extends ob{constructor(e){super(ru(iu({},e),{isUplink:!1})),cu(this,"_flag",0),cu(this,"role","anchor"),cu(this,"remoteAudioTrack"),cu(this,"remoteVideoTrack"),cu(this,"remoteAuxiliaryTrack"),cu(this,"ssrc",{audio:0,video:0,auxiliary:0}),cu(this,"_isSDPExchanging",!1),this.flag=e.flag,this.remoteAudioTrack=e.remoteAudioTrack||new kv(this._room,this),this.remoteVideoTrack=e.remoteVideoTrack||new qv(this._room,this),this.remoteAuxiliaryTrack=e.remoteAuxiliaryTrack||new Xv(this._room,this)}get videoCodec(){var e,t;let n=null==(t=null==(e=this._peerConnection)?void 0:e.remoteDescription)?void 0:t.sdp;return n?n.includes("H264")?"h264":"vp8":"h264"}get subscribeState(){let e={audio:!1,video:!1,auxiliary:!1,smallVideo:!1};return this.remoteVideoTrack.isSubscribed&&(8&this.remoteVideoTrack.mediaType?e.smallVideo=!0:e.video=!0),this.remoteAudioTrack.isSubscribed&&(e.audio=!0),this.remoteAuxiliaryTrack.isSubscribed&&(e.auxiliary=!0),e}get muteState(){return rm(this.flag,this.userId)}get flag(){return this._flag}set flag(e){var t,n,i;e!==this._flag&&(this._flag=e,null==(t=this.remoteAudioTrack)||t.onFlagChanged(),null==(n=this.remoteVideoTrack)||n.onFlagChanged(),null==(i=this.remoteAuxiliaryTrack)||i.onFlagChanged())}get hasMainStream(){return this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall}get hasAuxStream(){return this.muteState.hasAuxiliary}get isMainStreamSubscribed(){return(this.subscribeState.audio||this.subscribeState.video||this.subscribeState.smallVideo)&&(this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall)}get isAuxStreamSubscribed(){return this.subscribeState.auxiliary&&this.muteState.hasAuxiliary}get isSmallStreamSubscribed(){return this.subscribeState.smallVideo&&this.muteState.hasSmall}get isBigStreamSubscribed(){return this.subscribeState.video&&this.muteState.hasVideo}isStreamUnpublished(e){return e===ld.MAIN?!this.muteState.hasAudio&&!this.muteState.hasVideo:!this.muteState.hasAuxiliary}initialize(){super.initialize(),this.installEvents(),this._peerConnection.ontrack=this.onTrack.bind(this)}close(e){super.close(e),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.remoteAudioTrack.close(),this.remoteVideoTrack.close(),this.remoteAuxiliaryTrack.close(),this.uninstallEvents()}installEvents(){}uninstallEvents(){this._emitter.removeAllListeners()}emitConnectionStateChangedEvent(e){var t,n;let i=this._currentState,r=super.emitConnectionStateChangedEvent(e);return r&&i!==e&&(null==(t=this.remoteVideoTrack)||t.emit("connection-state-changed",{prevState:i,state:e}),null==(n=this.remoteAuxiliaryTrack)||n.emit("connection-state-changed",{prevState:i,state:e})),r}onTrack(e){let t=e.streams[0],{track:n}=e,i=t.id===vd?ld.MAIN:ld.AUXILIARY;this._log.debug(`ontrack ${i} ${n.kind}`);let r=ld.AUDIO;n.kind===ld.VIDEO&&(r=i===ld.MAIN?ld.VIDEO:ld.AUXILIARY);let o=this.remoteAudioTrack;r===ld.VIDEO?o=this.remoteVideoTrack:r===ld.AUXILIARY&&(o=this.remoteAuxiliaryTrack),o.setInputMediaStreamTrack(n)}addRRTRLine(e){let t=e.split("\r\n"),n=new Map;t.forEach(((e,i)=>{/^a=rtcp-fb:/.test(e)&&t[i+1]&&!/^a=rtcp-fb:/.test(t[i+1])&&n.set(i+1,`${e.match(/^a=rtcp-fb:\d+/)[0]} rrtr`)}));let i=[...n];for(let e=0;e<i.length;e++){let[n,r]=i[e];t.splice(n+e,0,r)}return t.join("\r\n")}addSPSDescription(e){let t=sb(e);return t.media.forEach((e=>{e.type===ld.VIDEO&&e.fmtp.forEach((e=>{e.config+=";sps-pps-idr-in-keyframe=1"}))})),lb(t)}removeSDESDescription(e){let t=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"],n=sb(e);return n.media.forEach((e=>{!e.ext||(e.ext=e.ext.filter((e=>!t.includes(e.uri))))})),lb(n)}isSubscriptionStateNotChanged(e){return JSON.stringify(e)===JSON.stringify(this.subscribeState)}subscribe(e,t){return du(this,null,(function*(){var n,i;try{if(((null==(n=this._peerConnection)?void 0:n.connectionState)===Md.NEW||(null==(i=this._peerConnection)?void 0:i.connectionState)===Md.CONNECTING)&&(yield this.waitForPeerConnectionConnected()),this.isSubscriptionStateNotChanged(e))return void(this._peerConnection||(this.initialize(),yield this.connect(e)));if(this._log.info(`subscribe ${t} ${JSON.stringify(e)}`),this._peerConnection||this._isSDPExchanging){let t="subscribe_change";Object.values(e).find((e=>!0===e))||(t="unsubscribe"),yield this.sendSubscription(t,e)}else this.initialize(),yield this.connect(e)}catch(e){throw this._room.isJoined&&this.isStreamUnpublished(t)?(this._log.warn(`${e.message} ${JSON.stringify(this.muteState)}`),new Au({code:Tu.REMOTE_STREAM_NOT_EXIST,message:`remote user ${this.userId} unpublished stream`})):e}}))}unsubscribe(e){return du(this,arguments,(function*({remoteTracks:e,streamType:t}){if("CONNECTED"===this._currentState&&("main"===t&&!this.isMainStreamSubscribed||"auxiliary"===t&&!this.isAuxStreamSubscribed))return void this._log.info(`${t} stream already unsubscribed`);let n=iu({},this.subscribeState);e.forEach((e=>{switch(e.mediaType){case 1:n.audio=!1;break;case 4:n.video=!1;break;case 8:n.smallVideo=!1;break;case 2:n.auxiliary=!1}}));let i="subscribe_change";Object.values(n).find((e=>!0===e))||(i="unsubscribe"),this._log.info(`${"unsubscribe"===i?i:"subscribe"} ${t} [${cb(n)}]`),yield this.sendSubscription(i,n),"unsubscribe"===i&&(this.closePeerConnection(),this.emitConnectionStateChangedEvent("DISCONNECTED"))}))}sendSubscription(e,t=this.subscribeState){let n={srcTinyId:this.tinyId,srcUserId:this.userId},i=YE,r=$E.UNSUBSCRIBE_RESULT;return"subscribe_change"===e&&(n={audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,srcTinyId:this.tinyId},i=JE,r=$E.SUBSCRIBE_CHANGE_RESULT),this._signalChannel.sendWaitForResponse({command:i,data:n,responseCommand:r,timeout:1e4}).then((({data:t})=>{if(0!==t.code){let n=new Au({code:t.code,message:nf({key:fh.ERROR_MESSAGE,data:{type:e,message:t.message}})});throw this._log.error(n),n}}))}connect(){return du(this,arguments,(function*(e=this.subscribeState){try{yield this.exchangeSDP(e),yield this.waitForPeerConnectionConnected()}catch(e){throw this.closePeerConnection(!0),e}}))}exchangeSDP(e){return du(this,null,(function*(){try{this._isSDPExchanging=!0,yield this.createOffer(),this._log.info("createOffer success, sending offer");let{type:t,sdp:n}=this._peerConnection.localDescription,i={type:t,sdp:n,srcUserId:this.userId,srcTinyId:this.tinyId,audio:e.audio,bigVideo:e.video,auxVideo:e.auxiliary,smallVideo:e.smallVideo},r=yield this._signalChannel.sendWaitForResponse({command:"subscribe",commandDesc:"exchange sdp",data:i,responseCommand:$E.SUBSCRIBE_RESULT,timeout:Fd});if(!this._peerConnection){let e=new Au({code:Tu.INVALID_OPERATION,message:nf({key:fh.CONNECTION_CLOSED})});throw this._log.warn(e),e}yield this.onSubscribeResult(r),this._isSDPExchanging=!1}catch(e){throw this._isSDPExchanging=!1,e}}))}createOffer(){return du(this,null,(function*(){let e={voiceActivityDetection:!1};ig()&&this._sdpSemantics===Bd?(this._peerConnection.addTransceiver(ld.AUDIO,{direction:cd.RECVONLY}),this._peerConnection.addTransceiver(ld.VIDEO,{direction:cd.RECVONLY}),this._peerConnection.addTransceiver(ld.VIDEO,{direction:cd.RECVONLY})):(e.offerToReceiveAudio=!0,e.offerToReceiveVideo=!0);let t=yield this._peerConnection.createOffer(e);if(t.sdp){let{isH264DecodeSupported:e}=yield Hm();e||(this._log.warn("remove h264 desc from sdp"),t.sdp=function(e){let t=sb(e);return t.media.forEach((e=>{var t,n;if(e.type===ld.VIDEO){let i=new Set;e.rtp.forEach((({payload:e,codec:t})=>"H264"===t&&i.add(e))),e.fmtp.forEach((({payload:e,config:t})=>{let n=t.match(/apt=(\d+)/);n&&n[1]&&i.has(Number(n[1]))&&i.add(e)}));let r=({payload:e})=>!i.has(e);e.rtp=e.rtp.filter(r),e.rtcpFb=null==(t=e.rtcpFb)?void 0:t.filter(r),e.fmtp=e.fmtp.filter(r),e.payloads=null==(n=e.payloads)?void 0:n.split(" ").filter((e=>!i.has(Number(e)))).join(" ")}})),lb(t)}(t.sdp)),t.sdp=this.addRRTRLine(t.sdp),t.sdp=this.addSPSDescription(t.sdp),t.sdp=function(e){let t=sb(e);return t.media.forEach((e=>{e.type===ld.AUDIO&&e.fmtp.forEach((e=>{e.config+=";sprop-stereo=1;stereo=1"}))})),lb(t)}(t.sdp),this._sdpSemantics===Bd&&(t.sdp=this.removeSDESDescription(t.sdp))}yield this._peerConnection.setLocalDescription(t)}))}onSubscribeResult(e){return du(this,null,(function*(){let{code:t,message:n=""}=e&&e.data||{},{type:i,sdp:r}=e&&e.data&&e.data.data||{};if(t===zd)throw new Au({code:Tu.NOT_SUPPORTED_H264,message:nf({key:fh.NOT_SUPPORTED_H264DECODE})});try{if(0!==t)throw new Au({code:t,message:nf({key:fh.EXCHANGE_SDP_FAILED,data:{errMsg:n}})});this._log.debug(`accept remote answer: ${r}`),yield this._peerConnection.setRemoteDescription({type:i,sdp:r}),this._sei&&(this._sei.handleEncodedStreams(),this._sei.onSEIMessage=e=>{this._emitter.emit("sei-message",ru(iu({},e),{userId:this.userId}))}),this.updateSSRC(r)}catch(e){throw this._log.error(e),e}}))}updateSSRC(e){try{sb(e).media.forEach((e=>{if(e.ssrcs)if(e.type===ld.AUDIO){let t=e.ssrcs.find((e=>{var t;return null==(t=e.value)?void 0:t.includes(vd)}));t&&(this.ssrc.audio=Number(t.id))}else{let t=e.ssrcs.find((e=>{var t;return null==(t=e.value)?void 0:t.includes(vd)})),n=e.ssrcs.find((e=>{var t;return null==(t=e.value)?void 0:t.includes(yd)}));t&&(this.ssrc.video=Number(t.id)),n&&(this.ssrc.auxiliary=Number(n.id))}}))}catch(e){}}getMainStreamVideoTrackId(){return this.remoteVideoTrack&&this.remoteVideoTrack.mediaTrack?this.remoteVideoTrack.mediaTrack.id:""}getAuxStreamVideoTrackId(){return this.remoteAuxiliaryTrack&&this.remoteAuxiliaryTrack.mediaTrack?this.remoteAuxiliaryTrack.mediaTrack.id:""}reconnect(){return du(this,null,(function*(){if(!(uu(ub.prototype,this,"beforeReconnect").call(this)<0))try{this.closePeerConnection(),this.initialize(),yield this.connect(),this.stopReconnection(),this._log.warn("reconnect() success")}catch(e){let t=Lf(this._reconnectionCount);this._log.warn(`reconnect() timeout, try again after ${t/1e3}s`),this._reconnectionTimer=setTimeout((()=>{this.clearReconnectionTimer(),this.reconnect()}),t)}}))}getIsReconnecting(){return this._isReconnecting}clearReconnectionTimer(){-1!==this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}getCurrentState(){return this._currentState}setDelay({audioDelay:e,videoDelay:t}){this.remoteAudioTrack.stat.end2EndDelay=e,this.remoteVideoTrack.stat.end2EndDelay=t}},db=ub;lu([lv((e=>function(...t){return new Promise(((n,i)=>{let r=e=>{this._emitter.off("closed",r),i(new Au({code:Tu.API_CALL_ABORTED,message:nf({key:fh.CONNECTION_ABORTED,data:e})}))};this._emitter.on("closed",r),e.apply(this,t).then(n,i).finally((()=>{this._emitter.off("closed",r)}))}))}))],db.prototype,"subscribe",1),lu([sv(ob.prototype.afterConnect),av(ob.prototype.beforeConnect)],db.prototype,"connect",1);var hb=db,pb={voiceActivityDetection:!1},fb=class extends ob{constructor(e){super(ru(iu({},e),{isUplink:!0})),cu(this,"localMainAudioTrack",null),cu(this,"localMainVideoTrack",null),cu(this,"localAuxAudioTrack",null),cu(this,"localAuxVideoTrack",null),cu(this,"ssrc",{audio:0,video:0,small:0,auxiliary:0}),cu(this,"_isPublishingAux",!1),cu(this,"_publishingLocalAudioTrack"),cu(this,"_publishingLocalVideoTrack"),cu(this,"_mediaSettings",{videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0}),cu(this,"flag",0)}get videoCodec(){return this._mediaSettings.videoCodec.toLowerCase()||"h264"}get isMainStreamPublished(){return!(!this.localMainAudioTrack&&!this.localMainVideoTrack)}get isAuxStreamPublished(){return!(!this.localAuxVideoTrack&&!this.localAuxAudioTrack)}get publishState(){var e,t,n,i;let r={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this._peerConnection){let o=this._peerConnection.getSenders();o&&(ng()?(r.audio=!(null==(e=o[0])||!e.track),r.bigVideo=!(null==(t=o[1])||!t.track),r.smallVideo=!(null==(n=o[2])||!n.track),r.auxVideo=!(null==(i=o[3])||!i.track)):o.forEach((e=>{e.track&&(e.track.kind===ld.AUDIO?r.audio=!0:(r.bigVideo=!0,this._room.videoManager.hasSmall&&(r.smallVideo=!0)))})))}return r}initialize(){super.initialize(),this.installEvents()}reset(){this._isReconnecting&&this.stopReconnection(),this.closePeerConnection(),this.uninstallEvents()}close(e){super.close(e),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED")}installEvents(){this._emitter.listeners("connection-state-changed").includes(this.handleConnectionStateChange)||this._emitter.on("connection-state-changed",this.handleConnectionStateChange,this)}uninstallEvents(){this._emitter.off("connection-state-changed",this.handleConnectionStateChange,this)}emitConnectionStateChangedEvent(e,t){var n,i,r;let o=this._currentState,a=super.emitConnectionStateChangedEvent(e);return a&&o!==e&&(t?t.emit("connection-state-changed",{prevState:o,state:e}):(null==(n=this.localMainVideoTrack)||n.emit("connection-state-changed",{prevState:o,state:e}),null==(i=this.localAuxVideoTrack)||i.emit("connection-state-changed",{prevState:o,state:e}),null==(r=this._publishingLocalVideoTrack)||r.emit("connection-state-changed",{prevState:o,state:e}))),a}publish(e){return du(this,arguments,(function*({localAudioTrack:e,localVideoTrack:t,isAuxiliary:n}){var i;let r;this._peerConnection||this.initialize(),e&&(this._publishingLocalAudioTrack=e),t&&(this._publishingLocalVideoTrack=t),this._isPublishingAux=n,t&&!n&&t.small&&(r=this._room.videoManager.smallTrack),this.sendMediaSettings(),ig()?yield this.publishByTransceiver({localAudioTrack:e,localVideoTrack:t,smallTrack:r,isAuxiliary:n}):yield this.publishByAddTrack({localAudioTrack:e,localVideoTrack:t,smallTrack:r}),this._publishingLocalAudioTrack=null,this._publishingLocalVideoTrack=null,this._isPublishingAux=!1,n?(t&&(this.localAuxVideoTrack=t),e&&(this.localAuxAudioTrack=e)):(t&&(this.localMainVideoTrack=t),e&&(this.localMainAudioTrack=e)),null==(i=this._sei)||i.handleEncodedStreams(),this.installTrackMuteEvents(e,t),this.sendMutedFlag()}))}publishByTransceiver(e){return du(this,arguments,(function*({localAudioTrack:e,localVideoTrack:t,smallTrack:n,isAuxiliary:i}){this._log.info("publish by transceiver");let r=new MediaStream,o=null==t?void 0:t.outMediaTrack,a=null==e?void 0:e.outMediaTrack;a&&r.addTrack(a),o&&r.addTrack(o);let s=this._peerConnection.getTransceivers();if(0===s.length)this._peerConnection.addTransceiver(a||ld.AUDIO,{direction:cd.SENDONLY,streams:[r]}),this._peerConnection.addTransceiver(i?ld.VIDEO:o||ld.VIDEO,{direction:cd.SENDONLY,streams:[r]}),this._peerConnection.addTransceiver(n||ld.VIDEO,{direction:cd.SENDONLY,streams:[r]}),this._peerConnection.addTransceiver(i&&o||ld.VIDEO,{direction:cd.SENDONLY,streams:[r]}),yield this.connect();else{let r=[];if(a&&(s[0].sender.track||r.push(0),yield s[0].sender.replaceTrack(a),yield this.setBandwidth({bandwidth:(null==e?void 0:e.profile.bitrate)||40,type:ld.AUDIO})),o){let e=i?3:1;yield s[e].sender.replaceTrack(o),yield this.setBandwidth({bandwidth:t.profile.bitrate,type:ld.VIDEO,videoType:i?ld.AUXILIARY:ld.BIG}),r.push(e),n&&(yield s[2].sender.replaceTrack(n),yield this.setBandwidth({bandwidth:t.small.bitrate,type:ld.VIDEO,videoType:ld.SMALL}),r.push(2))}yield this.setTransceiverDirection(cd.SENDONLY,r),yield this.doPublishChange(),null==t||t.emit("connection-state-changed",{prevState:"DISCONNECTED",state:"CONNECTING"}),null==t||t.emit("connection-state-changed",{prevState:"CONNECTING",state:"CONNECTED"})}}))}publishByAddTrack(e){return du(this,arguments,(function*({localAudioTrack:e,localVideoTrack:t,smallTrack:n}){this._log.info("publish by addtrack");let i=null==t?void 0:t.outMediaTrack,r=null==e?void 0:e.outMediaTrack;if(this._peerConnection&&"new"!==this._peerConnection.connectionState)return e&&r&&(yield this.addTrack(e)),void(i&&(yield this.addTrack(t)));let o=new MediaStream;if(r&&o.addTrack(r),i&&o.addTrack(i),r&&this._peerConnection.addTrack(r,o),i&&(this._peerConnection.addTrack(i,o),n)){let e=new MediaStream;e.addTrack(n),this._peerConnection.addTrack(n,e)}yield this.connect()}))}enableSmall(e){return du(this,null,(function*(){let t=this._peerConnection.getTransceivers();e?this._room.videoManager.smallTrack&&(yield t[2].sender.replaceTrack(this._room.videoManager.smallTrack),yield this.setTransceiverDirection(cd.SENDONLY,[2])):(yield t[2].sender.replaceTrack(null),yield this.setTransceiverDirection(cd.INACTIVE,[2])),this.updateMediaSettings(),yield this.doPublishChange()}))}installTrackMuteEvents(...e){e.forEach((e=>{e&&(null==e||e.on("mute",this.sendMutedFlag,this),null==e||e.on("unmute",this.sendMutedFlag,this))}))}uninstallTrackMuteEvents(...e){e.forEach((e=>{e&&(null==e||e.off("mute",this.sendMutedFlag,this),null==e||e.off("unmute",this.sendMutedFlag,this))}))}unpublish(e){return du(this,arguments,(function*({localAudioTrack:e,localVideoTrack:t}){if(!ng())return e&&e.outMediaTrack&&!t&&this.localMainVideoTrack?(yield this.removeTrack(e),void(this.localMainAudioTrack=null)):t&&t.outMediaTrack&&!e&&this.localMainAudioTrack?(yield this.removeTrack(t),void(this.localMainVideoTrack=null)):(yield this.doUnpublish(),this.uninstallTrackMuteEvents(e,t),void this.emitConnectionStateChangedEvent("DISCONNECTED",t));let n=t&&t===this.localAuxVideoTrack,i=null==t?void 0:t.outMediaTrack,r=this._peerConnection.getSenders(),o=[];e&&(yield r[0].replaceTrack(null),o.push(0),n?this.localAuxAudioTrack=null:this.localMainAudioTrack=null),i&&(n?(yield r[3].replaceTrack(null),this.localAuxVideoTrack=null,this._mediaSettings=ru(iu({},this._mediaSettings),{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),o.push(3)):(yield r[1].replaceTrack(null),yield r[2].replaceTrack(null),this.localMainVideoTrack=null,this._mediaSettings=ru(iu({},this._mediaSettings),{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),o.push(1,2))),this.isMainStreamPublished||this.isAuxStreamPublished?(yield this.setTransceiverDirection(cd.INACTIVE,o),yield this.doPublishChange(!1)):yield this.doUnpublish(),this.uninstallTrackMuteEvents(e,t),null==t||t.emit("connection-state-changed",{prevState:this._currentState,state:"DISCONNECTED"})}))}doPublishChange(e=!0){return du(this,null,(function*(){let t={state:this.publishState,constraintConfig:this._mediaSettings},n=yield this._signalChannel.sendWaitForResponse({command:qE,data:t,responseCommand:$E.PUBLISH_STATE_CHANGE_RESULT,enableLog:e});this.checkPublishResultCode(n.data.code,n.data.message)}))}doUnpublish(e=!1){return this._signalChannel.sendWaitForResponse({command:XE,commandDesc:"unpublish",responseCommand:$E.UNPUBLISH_RESULT,enableLog:e}).catch((e=>{if(e.getCode()===Tu.API_CALL_TIMEOUT)return Promise.resolve();throw e}))}updateMediaSettings(){let{detail:{isH264EncodeSupported:e,isVp8EncodeSupported:t}}=this._room.checkSystemResult;e?this._mediaSettings.videoCodec="H264":t&&(this._mediaSettings.videoCodec="VP8");let n=this._publishingLocalAudioTrack||this.localMainAudioTrack||this.localAuxAudioTrack,{localMainVideoTrack:i,localAuxVideoTrack:r}=this;if(this._publishingLocalVideoTrack&&(this._isPublishingAux?r=this._publishingLocalVideoTrack:i=this._publishingLocalVideoTrack),lg){if(n&&n.outMediaTrack){let e=n.outMediaTrack.getSettings();this._mediaSettings.audioChannel=e.channelCount||1,this._mediaSettings.audioBps=1e3*n.profile.bitrate,this._mediaSettings.audioFs=e.sampleRate||0}if(i&&i.outMediaTrack){let e=i.outMediaTrack.getSettings();this._mediaSettings.videoWidth=e.width||0,this._mediaSettings.videoHeight=e.height||0,this._mediaSettings.videoFps=e.frameRate||0,this._mediaSettings.videoBps=1e3*i.profile.bitrate,i.small&&(this._mediaSettings.smallVideoWidth=i.small.width,this._mediaSettings.smallVideoHeight=i.small.height,this._mediaSettings.smallVideoFps=i.small.frameRate,this._mediaSettings.smallVideoBps=1e3*i.small.bitrate)}if(r&&r.outMediaTrack){let e=r.outMediaTrack.getSettings();this._mediaSettings.auxVideoWidth=e.width||0,this._mediaSettings.auxVideoHeight=e.height||0,this._mediaSettings.auxVideoFps=e.frameRate||0,this._mediaSettings.auxVideoBps=1e3*r.profile.bitrate}}else n&&n.outMediaTrack&&(this._mediaSettings.audioChannel=n.profile.channelCount,this._mediaSettings.audioBps=1e3*n.profile.bitrate,this._mediaSettings.audioFs=n.profile.sampleRate),i&&i.outMediaTrack&&(this._mediaSettings.videoWidth=i.profile.width,this._mediaSettings.videoHeight=i.profile.height,this._mediaSettings.videoFps=i.profile.frameRate,this._mediaSettings.videoBps=1e3*i.profile.bitrate);this._log.info(`updateMediaSettings: ${JSON.stringify(this._mediaSettings)}`)}sendMediaSettings(){this.updateMediaSettings(),this._signalChannel.sendWaitForResponse({command:KE,data:this._mediaSettings,responseCommand:$E.UPDATE_CONSTRAINT_CONFIG_RES}).then((e=>{0!==e.data.code&&this._log.warn(e.data.message)})).catch((()=>{}))}addTrack(e){return du(this,null,(function*(){var t;if(!this._peerConnection)return;let n=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info(`is adding ${e.kind} track to current published local ${n?ld.AUXILIARY:ld.MAIN} stream`),null==(t=this._sei)||t.handleEncodedStreams(),ig()?yield this.addTrackByTransceiver(e,n):yield this.addTrackBySender(e)}))}addTrackByTransceiver(e,t){return du(this,null,(function*(){var n;if(!e.mediaTrack)return;let i=this._peerConnection.getTransceivers();if(e.kind===ld.AUDIO)yield i[0].sender.replaceTrack(e.outMediaTrack);else{let r=t?3:1;yield i[r].sender.replaceTrack(e.outMediaTrack),1===r&&(null==(n=this.localMainVideoTrack)?void 0:n.small)&&(yield i[2].sender.replaceTrack(this._room.videoManager.smallTrack)),i[r].direction===cd.INACTIVE&&(yield this.setTransceiverDirection(cd.SENDONLY,[r]))}this.updateMediaSettings(),yield this.doPublishChange()}))}addTrackBySender(e){return du(this,null,(function*(){if(!e.outMediaTrack)return;let t=e.outMediaTrack;ng()&&this._peerConnection.getTransceivers().findIndex((e=>"stopped"===e.direction))>=0&&(this._log.warn("transceiver is stopping, negotiate sdp first"),yield this.updateOffer("remove",t));let n=this._peerConnection.getSenders().find((e=>e.track&&e.track.kind===t.kind));if(n&&n.track){this._log.warn("sender already exists, remove sender first");let e=n.track;this.removeSender(n),yield this.updateOffer("remove",e)}if(t&&this._peerConnection.addTrack(t,new MediaStream([t])),t.kind===ld.VIDEO&&e instanceof Sv&&e.small){let e=new MediaStream,{smallTrack:t}=this._room.videoManager;e.addTrack(t),this._peerConnection.addTrack(t,e)}yield this.updateOffer("add",t)}))}isNeedToResetOfferOrder(){if(this._sdpSemantics===Hd||!this._peerConnection||!this._peerConnection.localDescription)return!1;let{sdp:e}=this._peerConnection.localDescription,t=sb(e);for(let e=0;e<t.media.length;e++)if(0===Number(t.media[e].mid)&&t.media[e].type===ld.VIDEO)return!0;return!1}removeSender(e){let t=null;ng()&&(t=this._peerConnection.getTransceivers().find((t=>t.sender&&t.sender.track===e.track))),this._peerConnection.removeTrack(e),t&&Vf(t.stop)&&(this._log.info("stop transceiver"),t.stop())}removeTrack(e){return du(this,null,(function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info(`is removing ${e.kind} track from current published local ${t?ld.AUXILIARY:ld.MAIN} stream`),ig()?yield this.removeTrackByTransceiver(e,t):yield this.removeTrackBySender(e)}))}removeTrackByTransceiver(e,t){return du(this,null,(function*(){if(!e.outMediaTrack)return;let n=this._peerConnection.getTransceivers();if(e.kind===ld.AUDIO)yield n[0].sender.replaceTrack(null);else{let i=t?3:1;yield n[i].sender.replaceTrack(null),1===i&&e.small&&(yield n[2].sender.replaceTrack(null)),yield this.setTransceiverDirection(cd.INACTIVE,[i])}this.updateMediaSettings(),yield this.doPublishChange()}))}setTransceiverDirection(e,t){return du(this,null,(function*(){if(!Nh)return;let n=!1,i=!1;this._log.info(`setting transceiver ${t.join(",")} direction to ${e}`);let r=this._peerConnection.getTransceivers();if(t.forEach((t=>{r[t].direction!==e&&(r[t].direction=e,n=!0)})),n){this._log.info("updating offer");let e=yield this._peerConnection.createOffer();yield this._peerConnection.setLocalDescription(e)}let o=-1,a=this._peerConnection.remoteDescription.sdp.split("\r\n").map((n=>{if(n.match(new RegExp(`a=(${cd.INACTIVE}|${cd.RECVONLY}|${cd.SENDONLY})`))&&o++,t.includes(o)){if(e===cd.INACTIVE&&n.includes(`a=${cd.RECVONLY}`))return i=!0,`a=${e}`;if(e===cd.SENDONLY&&n.includes(`a=${cd.INACTIVE}`))return i=!0,`a=${cd.RECVONLY}`}return n})).join("\r\n");i&&(this._log.info("updating answer"),yield this._peerConnection.setRemoteDescription({type:"answer",sdp:a}))}))}removeTrackBySender(e){return du(this,null,(function*(){if(!e.outMediaTrack)return;if(e.kind===ld.VIDEO&&this.isNeedToResetOfferOrder()&&this.localMainAudioTrack)return this.reset(),this.initialize(),void(yield this.publish({localAudioTrack:this.localMainAudioTrack,isAuxiliary:!1}));let t=this._peerConnection.getSenders().find((t=>t.track===e.outMediaTrack));t&&(this.removeSender(t),e.kind===ld.VIDEO&&e.small&&this._peerConnection.getSenders().forEach((e=>{e.track&&e.track.kind===ld.VIDEO&&this.removeSender(e)}))),yield this.updateOffer("remove",e.outMediaTrack)}))}replaceTrack(e){return du(this,null,(function*(){var t;let n,i=null==(t=this._peerConnection)?void 0:t.getSenders();if(!i||0===i.length||!e.mediaTrack)return!1;if(n=ig()?e.kind===ld.AUDIO?i[0]:i[1]:i.find((t=>t.track&&t.track.kind===e.kind)),!n)return!1;let r=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;return this._log.info(`is replacing ${e.kind} track on ${r?ld.AUXILIARY:ld.MAIN} stream`),e.kind===ld.AUDIO?yield n.replaceTrack(e.outMediaTrack):e.kind===ld.VIDEO&&(r?i[3]&&(yield i[3].replaceTrack(e.outMediaTrack)):yield n.replaceTrack(e.outMediaTrack)),!0}))}updateOffer(e,t){return du(this,null,(function*(){try{let n=yield this._peerConnection.createOffer(pb);Nh&&n.sdp&&(n.sdp=this.setSDPDirection(n.sdp,"sendrecv")),yield this._peerConnection.setLocalDescription(n);let i=this.updateMediaSettings(),r={action:e,trackId:t.id,kind:t.kind===ld.VIDEO?"bigVideo":t.kind,type:"offer",sdp:this._peerConnection.localDescription.sdp,constraintConfig:i,state:this.publishState};this._log.info("createOffer success, sending updated offer to remote server"),this._log.debug(`updatedOffer: ${r.sdp}`);let o=yield this._signalChannel.sendWaitForResponse({command:"publish_change",data:r,responseCommand:$E.UPDATE_OFFER_RESULT,timeout:Vd,commandDesc:"update offer"}),{code:a,message:s}=o.data;0!==a&&this.checkPublishResultCode(a,s),yield this.acceptAnswer(o.data.data),n.sdp&&this.updateSSRC(n.sdp)}catch(e){throw this._log.error(e),e}}))}setBandwidth(e){return du(this,arguments,(function*({bandwidth:e,type:t,videoType:n,sdp:i}){if(!sg())return i?t===ld.VIDEO?this.updateVideoBandwidthRestriction(i,e,n):this.updateAudioBandwidthRestriction(i,e):void 0;let r,o=this._peerConnection.getSenders();if(ig()){let e=0;t===ld.VIDEO&&(e=n===ld.SMALL?2:n===ld.AUXILIARY?3:1),r=o[e]}else r=o.find((e=>e.track&&e.track.kind===t));if(r){let o=r.getParameters();(!o.encodings||0===o.encodings.length)&&(o.encodings=[{}]),o.encodings[0].maxBitrate=1e3*e;try{return yield r.setParameters(o),this._log.info(`${n||""}${t} bandwidth ${e} kbps`),i}catch(r){if(this._log.info(`failed to set bandwidth by setting maxBitrate: ${r}`),i)return t===ld.VIDEO?this.updateVideoBandwidthRestriction(i,e,n):this.updateAudioBandwidthRestriction(i,e)}}return i}))}updateVideoBandwidthRestriction(e,t,n){let i="AS";Nh&&(i="TIAS",t*=1e3);let r=0,o=-1;return n===ld.SMALL?r=1:n===ld.AUXILIARY&&(r=2),e.replace(/m=video (.*)\r\nc=IN (.*)\r\n/g,(e=>(o+=1,o===r?`${e}b=${i}:${t}\r\n`:e)))}updateAudioBandwidthRestriction(e,t){let n="AS";return Nh&&(n="TIAS",t*=1e3),e.replace(/m=audio (.*)\r\nc=IN (.*)\r\n/,`m=audio $1\r\nc=IN $2\r\nb=${n}:${t}\r\n`)}removeBandwidthRestriction(e){return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}removeVideoOrientation(e){return e.replace(/urn:3gpp:video-orientation/,"")}connect(){return du(this,null,(function*(){try{yield this.exchangeSDP(),yield this.waitForPeerConnectionConnected()}catch(e){throw this.closePeerConnection(!0),this.uninstallEvents(),e}}))}exchangeSDP(){return du(this,null,(function*(){try{yield this.createOffer(),this._log.info("createOffer success, sending offer to remote server"),yield this.doExchangeSDP()}catch(e){throw e}}))}createOffer(){return du(this,null,(function*(){try{let e=yield this._peerConnection.createOffer(pb);yield this._peerConnection.setLocalDescription(e),e.sdp&&this.updateSSRC(e.sdp)}catch(e){throw e}}))}doExchangeSDP(){let e={command:"publish",responseCommand:$E.PUBLISH_RESULT,data:{type:this._peerConnection.localDescription.type,sdp:this.removeVideoOrientation(this._peerConnection.localDescription.sdp),screen:this.localMainVideoTrack instanceof Av||this.localAuxVideoTrack instanceof Av,state:this.publishState,constraintConfig:this._mediaSettings},enableLog:!1};return this._log.debug(`sending sdp offer: ${e.data.sdp}`),this._signalChannel.sendWaitForResponse(e).then((e=>{let{code:t,message:n,data:i}=e.data;return 0===t?this.acceptAnswer(i):this.checkPublishResultCode(t,n)}))}setSDPDirection(e,t,n="all"){let i=sb(e);return i.media.forEach((e=>{("all"===n||e.type===n)&&(e.direction=t)})),lb(i)}acceptAnswer(e){return du(this,null,(function*(){var t,n,i,r,o;try{let a;if(this._publishingLocalAudioTrack||this._publishingLocalVideoTrack||this.isMainStreamPublished){let e=(null==(t=this._publishingLocalVideoTrack)?void 0:t.profile.bitrate)||(null==(n=this.localMainVideoTrack)?void 0:n.profile.bitrate),o=(null==(i=this._publishingLocalAudioTrack)?void 0:i.profile.bitrate)||(null==(r=this.localMainAudioTrack)?void 0:r.profile.bitrate);if(e){let t=this._isPublishingAux?ld.AUXILIARY:ld.BIG;a=yield this.setBandwidth({bandwidth:e,type:ld.VIDEO,sdp:a,videoType:t})}o&&(a=yield this.setBandwidth({bandwidth:o,type:ld.AUDIO,sdp:a}))}if(a=this.removeVideoOrientation(e.sdp),null!=(o=this._publishingLocalVideoTrack)&&o.small){let{smallStreamConfig:e}=this._room;a=yield this.setBandwidth({bandwidth:this._publishingLocalVideoTrack.small.bitrate||e.bitrate,type:ld.VIDEO,videoType:ld.SMALL,sdp:a})}let s={type:e.type,sdp:a};yield this._peerConnection.setRemoteDescription(s),this._log.debug(`accepted answer: ${a}`)}catch(e){throw this._log.error(`failed to accept remote answer ${e}`),e}}))}sendMutedFlag(e){var t,n,i;if(e===this.localAuxAudioTrack||e===this.localAuxVideoTrack)return;let r={audio:!(null==(t=this.localMainAudioTrack)||!t.muted),bigVideo:!(null==(n=this.localMainVideoTrack)||!n.muted),auxVideo:!(null==(i=this.localAuxVideoTrack)||!i.muted)};this._log.info(`send muted state: ${JSON.stringify(r)}`),this._signalChannel.send(WE,r)}getIsReconnecting(){return this._isReconnecting}reconnect(){return du(this,null,(function*(){if(!(uu(fb.prototype,this,"beforeReconnect").call(this)<0))try{yield this._signalChannel.sendWaitForResponse({command:XE,responseCommand:$E.UNPUBLISH_RESULT,enableLog:!1}),this.closePeerConnection(),this.initialize(),this.isMainStreamPublished&&(yield this.publish({localAudioTrack:this.localMainAudioTrack,localVideoTrack:this.localMainVideoTrack,isAuxiliary:!1})),this.isAuxStreamPublished&&(yield this.publish({localAudioTrack:this.localAuxAudioTrack,localVideoTrack:this.localAuxVideoTrack,isAuxiliary:!0})),this._log.warn("reconnect() uplink reconnect successfully"),this.stopReconnection()}catch(e){let t=Lf(this._reconnectionCount);this._log.warn(`reconnect() timeout, try again after ${t/1e3}s`),this._reconnectionTimer=setTimeout((()=>{this.clearReconnectionTimer(),this.reconnect()}),t)}}))}handleConnectionStateChange(e){"CONNECTED"===e.state&&(this.localMainVideoTrack||this._publishingLocalVideoTrack&&!this._isPublishingAux)&&af.emit(xm.SEND_FIRST_VIDEO_FRAME,{room:this._room})}updateSSRC(e){try{sb(e).media.forEach(((e,t)=>{if(e.type===ld.AUDIO){let t=e.ssrcs&&e.ssrcs[0];t&&(this.ssrc.audio=Number(t.id))}else{if(this._sdpSemantics===Hd&&e.ssrcGroups)return void e.ssrcGroups.forEach(((e,t)=>{let n=Number(e.ssrcs.split(" ")[0]);0===t?this.ssrc.video=n:1===t&&(this.ssrc.small=n)}));let n=e.ssrcs&&e.ssrcs[0];if(!n)return;switch(t){case 1:this.ssrc.video=Number(n.id);break;case 2:this.ssrc.small=Number(n.id);break;case 3:this.ssrc.auxiliary=Number(n.id)}}}))}catch(e){}}getVideoTrackId(e=ld.VIDEO){if(this._peerConnection){let t=this._peerConnection.getSenders();if(e===ld.AUXILIARY&&t[3]&&t[3].track)return t[3].track.id;if(e===ld.VIDEO&&t[1]&&t[1].track)return t[1].track.id}if(this.localMainVideoTrack&&e===ld.VIDEO){let e=this.localMainVideoTrack.mediaTrack;if(e)return e.id}if(this.localAuxVideoTrack&&e===ld.AUXILIARY){let e=this.localAuxVideoTrack.mediaTrack;if(e)return e.id}return""}getSSRC(){return this.ssrc}checkPublishResultCode(e,t){if(0!==e)throw e===zd?(this._log.error(mh.NOT_SUPPORTED_H264ENCODE),new Au({code:Tu.NOT_SUPPORTED_H264,message:nf({key:fh.NOT_SUPPORTED_H264ENCODE})})):new Au({code:Tu.UNKNOWN,message:nf({key:fh.SIGNAL_RESPONSE_FAILED,data:{signalResponse:$E.PUBLISH_RESULT,code:e,message:t}})})}sendSEI(e,t){var n;null==(n=this._sei)||n.push(e,t)}},mb=fb;lu([lv((e=>function(...t){return new Promise(((n,i)=>{let r=e=>{this._emitter.off("closed",r),i(new Au({code:Tu.API_CALL_ABORTED,message:nf({key:fh.CONNECTION_ABORTED,data:e})}))};this._emitter.on("closed",r),e.apply(this,t).then(n,i).finally((()=>{this._emitter.off("closed",r)}))}))}))],mb.prototype,"publish",1),lu([sv(ob.prototype.afterConnect),av(ob.prototype.beforeConnect)],mb.prototype,"connect",1);var gb=mb,_b=su(hu()),vb=class extends _b.default{constructor({signalChannel:e,room:t}){super(),cu(this,"_room"),cu(this,"_signalChannel"),cu(this,"_log"),cu(this,"_uplinkRTT",0),cu(this,"_uplinkLoss",0),cu(this,"_downlinkRTT",0),cu(this,"_downlinkLoss",0),cu(this,"_downlinkPrevStatMap",new Map),cu(this,"_downlinkLossAndRTTMap",new Map),cu(this,"_interval",-1),cu(this,"_uplinkNetworkQuality",0),cu(this,"_downlinkNetworkQuality",0),this._room=t,this._signalChannel=e,this._log=wm.createLogger({id:"q",userId:this._room.userId,sdkAppId:this._room.sdkAppId}),this.initialize()}get uplinkNetworkQuality(){return this._uplinkNetworkQuality}set uplinkNetworkQuality(e){e!==this._uplinkNetworkQuality&&this._log.info(`uplink ${this.uplinkNetworkQuality} -> ${e}, rtt: ${this._uplinkRTT}, loss: ${this._uplinkLoss}`),this._uplinkNetworkQuality=e}get downlinkNetworkQuality(){return this._downlinkNetworkQuality}set downlinkNetworkQuality(e){if(e!==this._downlinkNetworkQuality){let{rtt:t,loss:n}=this.getAverageLossAndRTT([...this._downlinkLossAndRTTMap.values()]);this._log.info(`downlink ${this.downlinkNetworkQuality} -> ${e}, rtt: ${t}, loss: ${n}`)}this._downlinkNetworkQuality=e}initialize(){this._signalChannel.on($E.UPLINK_NETWORK_STATS,(e=>{this.handleUplinkNetworkQuality(e)})),this._signalChannel.on("2",this.handleSignalConnectionStateChange.bind(this)),this.start()}handleUplinkNetworkQuality(e){var t,n;if(0!==e.data.code)return;let i=e.data.data;if(i.delay&&this.updateDelay(i.delay),!this._room.uplinkConnection)return this.uplinkNetworkQuality=0,this._uplinkLoss=0,void(this._uplinkRTT=0);let r=null==(n=null==(t=this._room)?void 0:t.uplinkConnection)?void 0:n.getPeerConnection();if(r&&this.isPeerConnectionDisconnected(r))return this.uplinkNetworkQuality=6,this._uplinkLoss=0,void(this._uplinkRTT=0);let o=i.expectAudPkg+i.expectVidPkg,a=i.recvAudPkg+i.recvVidPkg,s=o-a;0===o&&0===a||(this._uplinkLoss=s<=0?0:Math.round(s/o*100),this._uplinkRTT=i.rtt,this.uplinkNetworkQuality=this.getNetworkQuality(this._uplinkLoss,this._uplinkRTT))}handleDownlinkNetworkQuality(){return du(this,null,(function*(){if(0===this._room.remotePublishedUserMap.size)return void(this.downlinkNetworkQuality=0);let e=[...this._room.remotePublishedUserMap.values()],t=e.filter((e=>{var t;return(null==(t=e.getPeerConnection())?void 0:t.connectionState)===Md.CONNECTED}));if(e.filter((e=>this.isPeerConnectionDisconnected(e.getPeerConnection()))).length===e.length)return void(this.downlinkNetworkQuality=6);for(let e=0;e<t.length;e++){let n=t[e].getPeerConnection();if(!n)return;let{rtt:i,totalPacketsLost:r,totalPacketsReceived:o}=yield this.getStat(n);if(!this._downlinkPrevStatMap.has(n)){this._downlinkPrevStatMap.set(n,{totalPacketsLost:r,totalPacketsReceived:o});continue}let a=0,s=this._downlinkPrevStatMap.get(n),l=r-s.totalPacketsLost,c=o-s.totalPacketsReceived;a=l<=0||c<0?0:Math.round(l/(l+c)*100),this._downlinkPrevStatMap.set(n,{totalPacketsLost:r,totalPacketsReceived:o}),this._downlinkLossAndRTTMap.set(n,{rtt:i,loss:a,userId:t[e].getUserId(),audioDelay:t[e].remoteAudioTrack.stat.end2EndDelay,videoDelay:t[e].remoteVideoTrack.stat.end2EndDelay})}if([...this._downlinkPrevStatMap.keys()].forEach((e=>{this.isPeerConnectionDisconnected(e)&&(this._downlinkPrevStatMap.delete(e),this._downlinkLossAndRTTMap.delete(e))})),0===this._downlinkLossAndRTTMap.size)return;let{rtt:n,loss:i}=this.getAverageLossAndRTT([...this._downlinkLossAndRTTMap.values()]);this._downlinkRTT=n,this._downlinkLoss=i,this.downlinkNetworkQuality=this.getNetworkQuality(i,n)}))}getStat(e){return du(this,null,(function*(){let t={rtt:0,totalPacketsLost:0,totalPacketsReceived:0};if(!e||!eg())return t;let n=e.getReceivers();try{for(let e=0;e<n.length;e++)(yield n[e].getStats()).forEach((e=>{"candidate-pair"===e.type&&Hf(e.currentRoundTripTime)&&(t.rtt=Math.round(1e3*e.currentRoundTripTime)),"inbound-rtp"===e.type&&(e.mediaType===ld.AUDIO||e.mediaType===ld.VIDEO)&&(t.totalPacketsLost+=e.packetsLost,t.totalPacketsReceived+=e.packetsReceived)}));return t}catch(e){return t}}))}getAverageLossAndRTT(e){let t={rtt:0,loss:0};return Array.isArray(e)&&e.length>0&&(e.forEach((e=>{t.rtt+=e.rtt,t.loss+=e.loss})),Object.keys(t).forEach((n=>{t[n]=Math.round(t[n]/e.length)}))),t}getNetworkQuality(e,t){return e>50||t>500?5:e>30||t>350?4:e>20||t>200?3:e>10||t>100?2:e>=0||t>=0?1:0}handleSignalConnectionStateChange(e){"DISCONNECTED"===e.state?(this._uplinkRTT=0,this._uplinkLoss=0,this.uplinkNetworkQuality=6):"CONNECTED"===e.state&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}handleUplinkConnectionStateChange({state:e}){"DISCONNECTED"===e?(this._uplinkLoss=0,this._uplinkRTT=0,this.uplinkNetworkQuality=6):"CONNECTED"===e&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}isPeerConnectionDisconnected(e){return!(!e||e.connectionState!==Md.DISCONNECTED&&e.connectionState!==Md.FAILED&&e.connectionState!==Md.CLOSED)}setUplinkConnection(e){this._room.uplinkConnection=e,this._room.uplinkConnection?this._room.uplinkConnection.on("connection-state-changed",this.handleUplinkConnectionStateChange.bind(this)):(this.uplinkNetworkQuality=0,this._uplinkRTT=0,this._uplinkLoss=0)}start(){-1===this._interval?(this._log.debug("start network quality calculating"),this._interval=kg.run(ah,(()=>{this.handleDownlinkNetworkQuality();let e=[...this._downlinkLossAndRTTMap.values()];af.emit(xm.NETWORK_QUALITY,{room:this._room,uplink:{rtt:this._uplinkRTT,loss:this._uplinkLoss},downlinks:e}),this.emit(vb.EVENT_NETWORK_QUALITY,{uplinkNetworkQuality:this.uplinkNetworkQuality,downlinkNetworkQuality:this.downlinkNetworkQuality,uplinkRTT:this._uplinkRTT,uplinkLoss:this._uplinkLoss,downlinkRTT:this._downlinkRTT,downlinkLoss:this._downlinkLoss,downlinkInfo:e})}),{delay:2e3})):this._log.info("network quality calculating is already started")}stop(){this._log.debug("stopped"),-1!==this._interval&&(kg.clearTask(this._interval),this._interval=-1),this._downlinkLossAndRTTMap.clear(),this._downlinkPrevStatMap.clear()}updateDelay(e){let{tinyIdToUserIdMap:t}=this._room;e.forEach((({srcTinyId:e,videoDelay:n,audioDelay:i})=>{let r=t.get(e);if(r){let e=this._room.remotePublishedUserMap.get(r);null==e||e.setDelay({videoDelay:n,audioDelay:i})}}))}},yb=vb;cu(yb,"EVENT_NETWORK_QUALITY","0");var Eb=class{constructor(e){this._signalInfo={tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0},this._eventMap=new Map,this._captureCostSum=0,this._captureCostCount=0,this._frameWorkType=e.frameWorkType||30,this._component=e.component||0,this.connectionType=e.connectionType||1,this._language=e.language||0,this._room=e.room,this._keyPrefix="key_point",this._log=wm.createLogger({id:"kpm",userId:this._room.userId,sdkAppId:this._room.sdkAppId}),Object.getOwnPropertyNames(this.__proto__).forEach((e=>{e.startsWith("handle")&&Vf(this[e])&&(this[e]=function({fn:e,context:t}){return function(...n){try{let i=e.apply(t,n);return qf(i)?i.catch((t=>wm.error(`${e.name}() error observed ${t}`))):i}catch(t){wm.error(`${e.name}() error observed ${t}`)}}}({fn:this[e],context:this}))})),this.initData(),this.installEvents()}initData(){this._firstPublishedUserList=[],this._networkQuality={totalUplinkRTT:0,totalUplinkLoss:0,count:0,totalDownlinkRTTAndLossMap:new Map},this._basicInfo={string_sdk_version:Nu,uint32_os_type:15,string_device_name:"",string_http_user_agent:navigator.userAgent,string_os_version:"",uint32_avg_rtt:0,uint32_avg_up_loss:0,uint32_scene:"live"===this._room.scene?1:0,uint32_joining_duration:0,uint32_networkType:0,uint32_framework:this._frameWorkType,uint32_component:this._component,uint32_connection_type:this.connectionType,uint32_caller_coding_language:this._language,string_domain:location.hostname},this._pathJoinRoom={uint64_start_time:0,uint64_send_request_acc_ip_cmd_start_time:0,uint64_send_request_acc_ip_cmd_end_time:0,uint64_send_request_enter_room_cmd_start_time:0,uint64_send_request_enter_room_cmd_end_time:0,uint64_send_first_video_frame_time:0,uint64_recv_userlist_time:0,uint64_end_time:0,int32_send_request_acc_ip_cmd_ret:0,int32_send_request_enter_room_cmd_ret:0,int32_end_ret:0},this._pathLeaveRoom={uint64_start_time:0,uint64_send_request_exit_room_cmd_start_time:0,uint64_send_request_exit_room_cmd_end_time:0,uint64_end_time:0,int32_send_request_exit_room_cmd_ret:0,int32_end_ret:0},this._localStreamStat={totalVideoBitrate:0,totalVideoFPS:0,totalVideoHeight:0,totalVideoWidth:0,totalAudioLevel:0,videoCount:0,audioLevelCount:0,publishStartTime:0,statsToReport:{uint32_audio_capture_db:0,uint32_video_big_capture_fps:0,uint32_video_big_bitrate:0,uint32_video_big_resolution:0}},this._pathMainVideoMap=new Map,this._pathMainAudioMap=new Map,this._pathAuxiliaryMap=new Map,this._remoteStreamStatMap=new Map,qp().then((e=>{this._basicInfo.string_os_version=Kp(),this._basicInfo.string_device_name=e&&e.mobile?e.model:this._basicInfo.string_os_version}))}addEvent(e,t){return this._eventMap.set(e,t),af.on(e,t),this}installEvents(){this.handleUnload=this.handleUnload.bind(this),window.addEventListener("pagehide",this.handleUnload),this._room.once("banned",(()=>this.handleLeaveSuccess({room:this._room,roomId:this._room.roomId}))),this.addEvent(xm.JOIN_START,this.handleJoinStart).addEvent(xm.JOIN_SCHEDULE_SUCCESS,this.handleJoinScheduleSuccess).addEvent(xm.JOIN_SIGNAL_CONNECTION_START,this.handleSignalConnectionStart).addEvent(xm.JOIN_SIGNAL_CONNECTION_END,this.handleSignalConnectionEnd).addEvent(xm.JOIN_SEND_CMD,this.handleJoinSendCMD).addEvent(xm.JOIN_RECEIVED_CMD_RES,this.handleJoinReceivedCMDResponce).addEvent(xm.JOIN_SUCCESS,this.handleJoinSuccess).addEvent(xm.JOIN_FAILED,this.handleJoinFailed).addEvent(xm.LEAVE_START,this.handleLeaveStart).addEvent(xm.LEAVE_SUCCESS,this.handleLeaveSuccess).addEvent(xm.LEAVE_SEND_CMD,this.handleLeaveSendCMD).addEvent(xm.LOCAL_TRACK_CAPTURE_START,this.handleTrackCaptureStart).addEvent(xm.LOCAL_TRACK_CAPTURE_SUCCESS,this.handleTrackCaptureSuccess).addEvent(xm.LOCAL_TRACK_CAPTURE_FAILED,this.handleTrackCaptureFailed).addEvent(xm.PUBLISH_START,this.handlePublishStart).addEvent(xm.SEND_FIRST_VIDEO_FRAME,this.handleSendFirstVideoFrame).addEvent(xm.SUBSCRIBE_START,this.handleSubscribeStart).addEvent(xm.SUBSCRIBE_SUCCESS,this.handleSubscribed).addEvent(xm.PLAY_TRACK_START,this.handlePlayStart).addEvent(xm.VIDEO_LOADED_DATA,this.handleVideoLoadedData).addEvent(xm.PLAYER_STATE_CHANGED,(({track:e,state:t,type:n})=>{!Wf(e)||!this.hitTest(e.room)||"PLAYING"===t&&(n===ld.AUDIO?this.handleAudioPlaying(e):this.handleVideoPlaying(e))})).addEvent(xm.NETWORK_QUALITY,this.handleNetworkQuality).addEvent(xm.HEARTBEAT_REPORT,this.handleHeartbeatStats).addEvent(xm.RECEIVED_PUBLISHED_USER_LIST,this.handleReceivedPublishUserList).addEvent(xm.REMOTE_PUBLISH_STATE_CHANGED,(({room:e,prevMuteState:t,muteState:n})=>{if(!this.hitTest(e))return;let i=t.hasAudio||t.hasVideo||t.hasSmall,r=t.hasAuxiliary,o=n.hasAudio||n.hasVideo||n.hasSmall,a=n.hasAuxiliary;!i&&o&&this.handleRemoteStreamAdded(n.userId,"main"),!r&&a&&this.handleRemoteStreamAdded(n.userId,"auxiliary")})).addEvent(xm.SINGLE_CONNECTION_STAT,(({room:e,stat:t})=>{this.hitTest(e)&&(this._pathJoinRoom.int32_ice_cost=t.ice,this._pathJoinRoom.int32_dtls_cost=t.dtls,this._pathJoinRoom.int32_peer_connection_cost=t.peerConnection)}))}uninstallEvents(){window.removeEventListener("unload",this.handleUnload),this._eventMap.forEach(((e,t)=>af.off(t,e))),this._eventMap.clear()}destroy(){this.uninstallEvents(),kg.clearTask(this._intervalId)}handleUnload(){this._room.isJoined&&this.handleLeaveSuccess({room:this._room,roomId:this._room.roomId})}handleJoinStart(e){this.hitTest(e.room)&&(0===this._pathJoinRoom.uint64_start_time&&(this._pathJoinRoom.uint64_start_time=Date.now()),e.params&&(Ff(e.params.frameWorkType)||(this._frameWorkType=e.params.frameWorkType,this._basicInfo.uint32_framework=this._frameWorkType),Ff(e.params.component)||(this._component=e.params.component,this._basicInfo.uint32_component=this._component),Ff(e.params.language)||(this._language=e.params.language,this._basicInfo.uint32_caller_coding_language=this._language)))}handleJoinScheduleSuccess({room:e,detailCost:t}){if(this.hitTest(e)&&t){let{totalCost:e,local:n,dns:i,tcp:r,tls:o,request:a,response:s}=t;this._pathJoinRoom.int32_schedule_cost=e,this._pathJoinRoom.int32_schedule_local=n,this._pathJoinRoom.int32_schedule_dns=i,this._pathJoinRoom.int32_schedule_tcp=r,this._pathJoinRoom.int32_schedule_tls=o,this._pathJoinRoom.int32_schedule_request=a,this._pathJoinRoom.int32_schedule_response=s}}handleSignalConnectionStart({room:e}){this.hitTest(e)&&0===this._pathJoinRoom.uint64_send_request_acc_ip_cmd_start_time&&(this._pathJoinRoom.uint64_send_request_acc_ip_cmd_start_time=Date.now())}handleSignalConnectionEnd({room:e,error:t}){this.hitTest(e)&&0===this._pathJoinRoom.uint64_send_request_acc_ip_cmd_end_time&&(this._pathJoinRoom.uint64_send_request_acc_ip_cmd_end_time=Date.now(),t&&(this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret=t instanceof Au?Number(t.getExtraCode()||t.getCode()):Tu.UNKNOWN,this._pathJoinRoom.int32_end_ret=this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret))}handleJoinSendCMD(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_send_request_enter_room_cmd_start_time&&(this._pathJoinRoom.uint64_send_request_enter_room_cmd_start_time=Date.now())}handleJoinReceivedCMDResponce(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_send_request_enter_room_cmd_end_time&&(this._pathJoinRoom.uint64_send_request_enter_room_cmd_end_time=Date.now(),this._pathJoinRoom.int32_send_request_enter_room_cmd_ret=e.code,0!==e.code&&(this._pathJoinRoom.int32_end_ret=this._pathJoinRoom.int32_send_request_enter_room_cmd_ret))}handleJoinSuccess(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_end_time&&(this._pathJoinRoom.uint64_end_time=Date.now(),this._pathJoinRoom.int32_end_ret=0,this._signalInfo=e.room.getSignalInfo())}handleJoinFailed({room:e,error:t}){this.hitTest(e)&&(this._pathJoinRoom.uint64_end_time=Date.now(),0===this._pathJoinRoom.int32_end_ret&&(this._pathJoinRoom.int32_end_ret=t.code||this._pathJoinRoom.int32_send_request_enter_room_cmd_ret||this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret),setTimeout((()=>{this.report()})))}handleReceivedPublishUserList(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_recv_userlist_time&&(this._pathJoinRoom.uint64_recv_userlist_time=Date.now(),this._firstPublishedUserList=e.publishedUserList||[])}handleSendFirstVideoFrame({room:e}){!this.hitTest(e)||0===this._pathJoinRoom.uint64_send_first_video_frame_time&&0!==this._pathJoinRoom.uint64_start_time&&(this._pathJoinRoom.uint64_send_first_video_frame_time=Date.now())}handleLeaveStart(e){this.hitTest(e.room)&&(this._pathLeaveRoom.uint64_start_time=Date.now())}handleLeaveSuccess(e){this.hitTest(e.room)&&0===this._pathLeaveRoom.uint64_end_time&&(this._pathLeaveRoom.uint64_end_time=Date.now(),0!==this._pathJoinRoom.uint64_end_time?this._basicInfo.uint32_joining_duration=this._pathLeaveRoom.uint64_end_time-this._pathJoinRoom.uint64_end_time:this._log.warn("pathJoinRoom endTime is 0"),this.report())}handleLeaveSendCMD(e){this.hitTest(e.room)&&(this._pathLeaveRoom.uint64_send_request_exit_room_cmd_start_time=Date.now(),this._pathLeaveRoom.uint64_send_request_exit_room_cmd_end_time=Date.now())}handleRemoteStreamAdded(e,t){var n;let i=`${e}_${t}`;if(!this._remoteStreamStatMap.has(i)){let r={userId:e,totalVideoFPS:0,totalVideoBitrate:0,totalAudioLevel:0,totalAudioBitrate:0,totalLoss:0,audioCount:0,audioLevelCount:0,videoCount:0,networkQualityCount:0,streamAddedTime:Date.now(),subscribeStartTime:0,subscribedTime:0,playStreamTime:0,statsToReport:ru(iu({},Sb),{msg_user_info:new Tb({userId:e,tinyId:null==(n=this._room.remotePublishedUserMap.get(e))?void 0:n.tinyId,role:20})})};r.statsToReport.uint32_stream_type="main"===t?2:7,this._remoteStreamStatMap.set(i,r)}}handleSubscribeStart({room:e,remotePublishedUser:t,streamType:n,subscribeState:i}){if(!this.hitTest(e))return;let{userId:r,tinyId:o,role:a}=t,s=new Tb({userId:r,tinyId:o,role:"anchor"===a?20:21}),l=Date.now(),c=`${r}_${n}`,u=this._remoteStreamStatMap.get(c);u&&0===u.subscribeStartTime&&(u.subscribeStartTime=l),"main"===n?(t.muteState.hasVideo&&(i.video||i.smallVideo)&&!this._pathMainVideoMap.has(c)&&this._pathMainVideoMap.set(c,{statsToReport:{msg_user_info:s,uint64_start_enter_time:this._pathJoinRoom.uint64_start_time,uint64_render_first_frame_time:0,uint64_combine_first_frame_time:0},userId:r,sendSubscribeCMDTime:l}),t.muteState.hasAudio&&i.audio&&!this._pathMainAudioMap.has(c)&&this._pathMainAudioMap.set(c,{statsToReport:{msg_user_info:s,uint64_start_enter_time:this._pathJoinRoom.uint64_start_time,uint64_play_first_frame_time:0},userId:r,sendSubscribeCMDTime:l})):t.muteState.hasAuxiliary&&i.auxiliary&&!this._pathAuxiliaryMap.has(c)&&this._pathAuxiliaryMap.set(c,{sendSubscribeCMDTime:l})}handleSubscribed({room:e,remotePublishedUser:t,streamType:n}){if(this.hitTest(e)){let e=`${t.userId}_${n}`,i=this._remoteStreamStatMap.get(e);i&&0===i.subscribedTime&&(i.subscribedTime=Date.now())}}handlePlayStart({track:e}){if(!Wf(e)||!this.hitTest(e.room))return;let t=`${e.userId}_${e.streamType}`,n=this._remoteStreamStatMap.get(t);0===(null==n?void 0:n.playStreamTime)&&(n.playStreamTime=Date.now())}handleVideoLoadedData({track:e}){if(!Wf(e)||!this.hitTest(e.room))return;let t=`${e.userId}_${e.streamType}`,n=this._pathMainVideoMap.get(t);n&&0===n.statsToReport.uint64_combine_first_frame_time&&(n.statsToReport.uint64_combine_first_frame_time=Date.now())}handleVideoPlaying(e){let t=`${e.userId}_${e.streamType}`,n=Date.now(),i=this._pathMainVideoMap.get(t),r=this._remoteStreamStatMap.get(t);if(i&&(0===i.statsToReport.uint64_render_first_frame_time&&(i.statsToReport.uint64_render_first_frame_time=n),r)){let{statsToReport:e,playStreamTime:t,subscribedTime:o}=r;0===e.uint32_video_render_first&&t-o<=100&&(e.uint32_video_render_first=n-i.sendSubscribeCMDTime)}let o=this._pathAuxiliaryMap.get(t);if(o&&r){let{statsToReport:e,playStreamTime:t,subscribedTime:i}=r;0===e.uint32_video_render_first&&t-i<=100&&(e.uint32_video_render_first=n-o.sendSubscribeCMDTime)}}handleAudioPlaying(e){let t=`${e.userId}_${e.streamType}`,n=this._pathMainAudioMap.get(t);n&&0===n.statsToReport.uint64_play_first_frame_time&&(n.statsToReport.uint64_play_first_frame_time=Date.now())}handleNetworkQuality(e){this.hitTest(e.room)&&(this._networkQuality.totalUplinkLoss+=e.uplink.loss,this._networkQuality.totalUplinkRTT+=e.uplink.rtt,this._networkQuality.count++,e.downlinks.forEach((({rtt:e,loss:t,userId:n,videoDelay:i,audioDelay:r})=>{let o=this._networkQuality.totalDownlinkRTTAndLossMap.get(n);if(o)o.totalRTT+=e,o.totalLoss+=t,i&&(o.totalVideoDelay=(o.totalVideoDelay||0)+i,o.videoDelayCount=(o.videoDelayCount||0)+1),r&&(o.totalAudioDelay=(o.totalAudioDelay||0)+r,o.audioDelayCount=(o.audioDelayCount||0)+1),o.count++;else{let o,a,s,l;i&&(a=i,s=1),r&&(o=r,l=1),this._networkQuality.totalDownlinkRTTAndLossMap.set(n,{totalRTT:e,totalLoss:t,count:1,totalAudioDelay:o,totalVideoDelay:a,audioDelayCount:l,videoDelayCount:s})}})))}handleHeartbeatStats(e){if(this.hitTest(e.room)){let{msg_device_info:t,msg_up_stream_info:n,msg_down_stream_info:i}=e.report;if(n.msg_video_status[0]){let{uint32_video_codec_bitrate:e,uint32_video_enc_fps:t,uint32_video_width:i,uint32_video_height:r}=n.msg_video_status[0];this._localStreamStat.totalVideoBitrate+=e,this._localStreamStat.totalVideoFPS+=t,this._localStreamStat.totalVideoWidth+=i,this._localStreamStat.totalVideoHeight+=r,this._localStreamStat.videoCount++}if(n.msg_audio_status){let{uint32_audio_level:e}=n.msg_audio_status;Math.floor(e/ph*100)>0&&(this._localStreamStat.totalAudioLevel+=e/ph,this._localStreamStat.audioLevelCount++)}i.forEach((e=>{let{msg_user_info:t,msg_audio_status:n,msg_video_status:i}=e,r=t.str_identifier,o=this._room.remotePublishedUserMap.get(r);if(i.forEach((e=>{let t=2===e.uint32_video_stream_type,n=7===e.uint32_video_stream_type,i=`${r}_${t?"main":"auxiliary"}`,a=this._remoteStreamStatMap.get(i);if(a&&(t&&(null==o?void 0:o.remoteVideoTrack.isSubscribed)||n&&(null==o?void 0:o.remoteAuxiliaryTrack))){a.totalVideoFPS+=e.uint32_video_receive_fps,a.totalVideoBitrate+=e.uint32_video_codec_bitrate,a.videoCount++,0===a.statsToReport.uint32_video_width&&(a.statsToReport.uint32_video_width=e.uint32_video_width),0===a.statsToReport.uint32_video_height&&(a.statsToReport.uint32_video_height=e.uint32_video_height);let n=t?o.remoteVideoTrack:o.remoteAuxiliaryTrack;n.stat.jitterBufferDelay&&(a.videoJitterBufferDelay=n.stat.jitterBufferDelay),n.stat.framesReceived&&(a.statsToReport.uint32_video_consume_render_rate=Math.floor(n.stat.framesDecoded/n.stat.framesReceived*tu(10,6)))}})),n){let e=`${r}_main`,t=this._remoteStreamStatMap.get(e);this._remoteStreamStatMap.has(e)&&t&&(null==o?void 0:o.remoteAudioTrack.isSubscribed)&&(t.totalAudioBitrate+=n.uint32_audio_codec_bitrate,t.audioCount++,o.remoteAudioTrack.stat.jitterBufferDelay&&(t.audioJitterBufferDelay=o.remoteAudioTrack.stat.jitterBufferDelay),Math.floor(n.uint32_audio_level/ph*100)>0&&(t.totalAudioLevel+=n.uint32_audio_level/ph,t.audioLevelCount++))}})),t.uint32_audio_capture_cost&&(this._captureCostSum+=t.uint32_audio_capture_cost,this._captureCostCount+=1,this._captureCostCount>=100&&(this._basicInfo.uint32_audio_capture_cost=Math.floor(this._captureCostSum/this._captureCostCount),this._captureCostSum=0,this._captureCostCount=0))}}handlePublishStart({room:e}){this.hitTest(e)&&0===this._localStreamStat.publishStartTime&&(this._localStreamStat.publishStartTime=Date.now())}handleTrackCaptureStart({track:e}){1===e.mediaType&&!this._pathJoinRoom.uint64_init_audio_start_time&&(this._pathJoinRoom.uint64_init_audio_start_time=Date.now()),4===e.mediaType&&!this._pathJoinRoom.uint64_init_camera_start_time&&(this._pathJoinRoom.uint64_init_camera_start_time=Date.now())}handleTrackCaptureSuccess({track:e}){1===e.mediaType&&!this._pathJoinRoom.uint64_init_audio_end_time&&(this._pathJoinRoom.int32_init_audio_ret=0,this._pathJoinRoom.uint64_init_audio_end_time=Date.now()),4===e.mediaType&&!this._pathJoinRoom.uint64_init_camera_end_time&&(this._pathJoinRoom.int32_init_camera_ret=0,this._pathJoinRoom.uint64_init_camera_end_time=Date.now())}handleTrackCaptureFailed({track:e,error:t}){let n={NotFoundError:1,NotAllowedError:2,NotReadableError:3,OverConstrainedError:4,AbortError:5,InvalidStateError:6,SecurityError:7,TypeError:8}[t.name]||(t instanceof Au?t.getExtraCode()||t.getCode():Tu.UNKNOWN);1===e.mediaType&&!this._pathJoinRoom.uint64_init_audio_end_time&&(this._pathJoinRoom.int32_init_audio_ret=n,this._pathJoinRoom.uint64_init_audio_end_time=Date.now()),4===e.mediaType&&!this._pathJoinRoom.uint64_init_camera_end_time&&(this._pathJoinRoom.int32_init_camera_ret=n,this._pathJoinRoom.uint64_init_camera_end_time=Date.now())}hasVideoFlag(e){return this._firstPublishedUserList.findIndex((t=>t.userId===e&&t.flag&hd))>=0}hasAudioFlag(e){return this._firstPublishedUserList.findIndex((t=>t.userId===e&&t.flag&md))>=0}hasAuxFlag(e){return this._firstPublishedUserList.findIndex((t=>t.userId===e&&t.flag&fd))>=0}hitTest(e){return e===this._room}prepareReport(){if(this._captureCostCount>0&&!this._basicInfo.uint32_audio_capture_cost&&(this._basicInfo.uint32_audio_capture_cost=Math.floor(this._captureCostSum/this._captureCostCount),this._captureCostSum=0,this._captureCostCount=0),this._networkQuality.count>0&&(this._basicInfo.uint32_avg_rtt=Math.floor(this._networkQuality.totalUplinkRTT/this._networkQuality.count),this._basicInfo.uint32_avg_up_loss=Math.floor(this._networkQuality.totalUplinkLoss/this._networkQuality.count)),this._localStreamStat.videoCount>0){this._localStreamStat.statsToReport.uint32_video_big_capture_fps=Math.floor(this._localStreamStat.totalVideoFPS/this._localStreamStat.videoCount),this._localStreamStat.statsToReport.uint32_video_big_bitrate=Math.floor(this._localStreamStat.totalVideoBitrate/this._localStreamStat.videoCount);let e=Math.floor(this._localStreamStat.totalVideoWidth/this._localStreamStat.videoCount),t=Math.floor(this._localStreamStat.totalVideoHeight/this._localStreamStat.videoCount);this._localStreamStat.statsToReport.uint32_video_big_resolution=e<<16|t}this._localStreamStat.audioLevelCount>0&&(this._localStreamStat.statsToReport.uint32_audio_capture_db=Math.floor(this._localStreamStat.totalAudioLevel/this._localStreamStat.audioLevelCount*100)),this._remoteStreamStatMap.forEach(((e,t)=>{let{userId:n}=e,i=this._networkQuality.totalDownlinkRTTAndLossMap.get(n);if(i){let{totalLoss:t,count:n,audioDelayCount:r,videoDelayCount:o,totalAudioDelay:a,totalVideoDelay:s}=i;e.statsToReport.uint32_avg_down_loss=Math.floor(t/n),r&&a&&(e.statsToReport.uint32_audio_network_p2p_delay=Math.floor(a/r),e.audioJitterBufferDelay&&(e.statsToReport.uint32_p2p_delay=Math.floor(e.statsToReport.uint32_audio_network_p2p_delay+e.audioJitterBufferDelay))),o&&s&&(e.statsToReport.uint32_video_network_p2p_delay=Math.floor(s/o))}e.videoCount>0&&(e.statsToReport.uint32_video_avg_fps=Math.floor(e.totalVideoFPS/e.videoCount),e.statsToReport.uint32_video_avg_bitrate=Math.floor(e.totalVideoBitrate/e.videoCount)),e.audioCount>0&&(e.statsToReport.uint32_audio_recv_bitrate=e.statsToReport.uint32_audio_bitrate=Math.floor(e.totalAudioBitrate/e.audioCount)),e.audioLevelCount>0&&(e.statsToReport.uint32_audio_play_db=Math.floor(e.totalAudioLevel/e.audioLevelCount*100));let{callDurationCalculator:r}=this._room;r&&(e.statsToReport.uint32_audio_play_time=r.getDuration(t,ld.AUDIO),e.statsToReport.uint32_video_play_time=r.getDuration(t,ld.VIDEO)),e.statsToReport.uint32_video_render_first=Math.min(e.statsToReport.uint32_video_render_first,bb);let{badCaseDetector:o}=this._room,{dataFreeze:a,count:s}=o.getDataFreezeDuration(t),{renderFreeze:l}=o.getRenderFreezeDuration(t);e.statsToReport.uint32_video_block_count=s,e.statsToReport.uint32_video_block_time=Math.min(a,e.statsToReport.uint32_video_play_time),e.statsToReport.uint32_video_external_block_time=Math.min(l,e.statsToReport.uint32_video_play_time),o.isBlackStream(t)&&0===e.statsToReport.uint32_video_avg_fps?e.statsToReport.uint32_video_black_screen_subjective=1:e.statsToReport.uint32_video_black_screen_subjective=0,(0===e.subscribeStartTime||e.subscribeStartTime-e.streamAddedTime>100||0===e.playStreamTime)&&(this._pathMainAudioMap.delete(t),this._pathMainVideoMap.delete(t),e.statsToReport.uint32_video_render_first=0)})),this._pathMainAudioMap.forEach(((e,t)=>{this.hasAudioFlag(e.userId)?e.statsToReport.uint64_play_first_frame_time-e.statsToReport.uint64_start_enter_time>bb&&(e.statsToReport.uint64_play_first_frame_time=e.statsToReport.uint64_start_enter_time+bb):this._pathMainAudioMap.delete(t)})),this._pathMainVideoMap.forEach(((e,t)=>{this.hasVideoFlag(e.userId)?e.statsToReport.uint64_render_first_frame_time-e.statsToReport.uint64_start_enter_time>bb&&(e.statsToReport.uint64_render_first_frame_time=e.statsToReport.uint64_start_enter_time+bb):this._pathMainVideoMap.delete(t)})),this._pathJoinRoom.uint64_end_time-this._pathJoinRoom.uint64_start_time>bb&&(this._pathJoinRoom.uint64_end_time=this._pathJoinRoom.uint64_start_time+bb)}getReportData(){this._basicInfo.uint32_networkType=wf();let e={uint32_sdk_app_id:Number(this._room.sdkAppId),msg_user_info:new Tb({userId:this._room.userId,tinyId:this._room.tinyId,role:"anchor"===this._room.role?20:21}),msg_basic_info:this._basicInfo,uint32_acc_ip:am(this._signalInfo.relayIp),uint32_client_ip:am(this._signalInfo.clientIp,!1),uint32_acc_port:this._signalInfo.relayPort||0,uint64_timestamp:Date.now(),uint32_seq:Math.floor(Math.random()*tu(2,31)),msg_path_enter_room:this._pathJoinRoom,msg_path_exit_room:this._pathLeaveRoom,msg_path_recv_video:[...this._pathMainVideoMap.values()].map((e=>e.statsToReport)),msg_quality_statistics:[...this._remoteStreamStatMap.values()].map((e=>e.statsToReport)),str_room_name:String(this._room.roomId||0),msg_path_recv_audio:[...this._pathMainAudioMap.values()].map((e=>e.statsToReport)),uint32_info_client_ip:am(this._signalInfo.clientIp,!1),error_code:[],msg_local_statistics:this._localStreamStat.statsToReport};return ym(e),e}report(){return du(this,null,(function*(){try{this.prepareReport();let e=this.getReportData();yield this.upload(e),this.initData()}catch(e){this._log.warn(e)}}))}upload(e){return du(this,null,(function*(){if(0===e.msg_path_enter_room.uint64_start_time)return;let t=Number(this._room.sdkAppId),n=yield hh(e),i=n instanceof ArrayBuffer,r=`${bf(t,Ku.KEY_POINT)}&gzip=${+i}`,o=!1;navigator.sendBeacon&&(o=navigator.sendBeacon(r,n)),o||dh({url:r,body:n}),this.uploadKVStat(Kg),this.uploadKVStat(Jg)}))}setConnectionType(e){this.connectionType=e,this._basicInfo.uint32_connection_type=e}uploadKVStat(e){return du(this,null,(function*(){let t=e.getReportData();if(0===t.stats_count.length&&0===t.stats_distribution.length)return;t.msg_sdk_basic_info=ru(iu({},t.msg_sdk_basic_info),{bytes_device_name:this._basicInfo.string_device_name||"",bytes_os_version:this._basicInfo.string_os_version||"",uint32_framework:this._frameWorkType,uint32_network_type:this._basicInfo.uint32_networkType||0}),this._log.debug(t);let n=yield hh(t),i=`${bf(+this._room.sdkAppId,Ku.KV_STAT)}&gzip=${+(n instanceof ArrayBuffer)}`,r=!1;navigator.sendBeacon&&(r=navigator.sendBeacon(i,n)),r||dh({url:i,body:n})}))}};lu([Vg({settings:{timeout:500,retries:3}})],Eb.prototype,"upload",1);var bb=5e3,Sb={msg_user_info:null,uint32_video_avg_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_avg_bitrate:0,uint32_video_block_time:0,uint32_video_play_time:0,uint32_audio_block_time:0,uint32_audio_play_time:0,uint32_audio_play_db:0,uint32_avg_down_loss:0,uint32_stream_type:0,uint32_video_render_first:0,uint32_video_block_count:0,uint32_audio_block_count:0,uint32_audio_bitrate:0,uint32_video_black_screen_subjective:0,uint32_audio_recv_bitrate:0,uint32_video_external_block_time:0,uint32_video_consume_render_rate:0},Tb=class{constructor(e){this.str_identifier=String(e.userId),this.str_tinyid=String(e.tinyId||0),this.uint32_role=e.role}},xb=Eb,Ab=class{constructor(){cu(this,"_startTime"),cu(this,"_endTime"),this._startTime=0,this._endTime=0,this.start()}start(){0===this._startTime&&(this._startTime=Qf())}stop(){0===this._endTime&&(this._endTime=Qf())}getDuration(){return 0===this._endTime?Qf()-this._startTime:this._endTime-this._startTime}get endTime(){return this._endTime}},wb=su(hu(),1),Ib=[1,0,0,0,1,1,0,1],Rb=class extends Ov{constructor(e){if(super(e,{useDefaultProgram:!0,useFbo:!0,create2d:!0,name:"mirror"}),e instanceof $v)try{this.setTexBuffer(Ib)}catch(t){e.destroy(t)}}draw2d(e,t,n,i,r){if(this.ctx2d){this.ctx2d.save(),this.ctx2d.scale(-1,1),this.ctx2d.translate(-this.width,0);let o=super.draw2d(e,t,n,i,r);return this.ctx2d.restore(),o}return!1}render(e){var t;return!(null==(t=this.input)||!t.requestFrame(e)||(this.useProgram(),this.useBufferFrame(),this.useInputTexture(),this.draw(),0))}},Cb=class extends Ov{constructor(e){super(e,{useDefaultProgram:!0,useFbo:!0,name:"mix",create2d:!0}),cu(this,"inputs",[])}addInput(e,t){if(this.inputs[t.zIndex])throw new Error("input already exists");let n=new class{constructor(e,t){this.node=e,this.layout=t,cu(this,"positionBuffer")}get x(){return this.layout.x||this.node.x}get y(){return this.layout.y||this.node.y}get width(){return this.layout.width||this.node.width}get height(){return this.layout.height||this.node.height}get right(){return this.x+this.width}get bottom(){return this.y+this.height}}(e,t);this.inputs[t.zIndex]=n}resize(e,t){let n=this.inputs.reduce(((e,t)=>t?Object.assign(e,{width:Math.max(e.width,t.right),height:Math.max(e.height,t.bottom)}):e),{width:0,height:0});super.resize(n.width,n.height),this.context instanceof $v&&this.inputs.forEach((e=>{if(e){let t=this.layout2texCoords(e);e.positionBuffer?this.changeBufferData(e.positionBuffer,t):e.positionBuffer=this.createBuffer(t)}}))}connect(e,...t){return super.connect(e,...t),this.resize(0,0),e}removeInput(e){this.inputs[this.inputs.findIndex((t=>(null==t?void 0:t.node)===e))]=void 0}render(e){let t=this.context.ctx;if(t.clearColor(0,0,0,0),!this.inputs.reduce(((t,n)=>(!n||!n.node.requestFrame(e))&&t),!0)&&t){this.useProgram(),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.useBufferFrame();for(let e=0;e<this.inputs.length;e++){let t=this.inputs[e];t&&(t.node.useTexture(),this.draw(t.positionBuffer))}return!0}return!1}render2d(e){if(!this.inputs.reduce(((t,n)=>(!n||!n.node.requestFrame(e))&&t),!0)&&this.ctx2d){this.ctx2d.clearRect(0,0,this.width,this.height);for(let e=0;e<this.inputs.length;e++){let t=this.inputs[e];t&&this.draw2d(t.node.image,t.x,t.y,t.width,t.height)}return!0}return!1}getInfo(){let{totalFrames:e,x:t,y:n,width:i,height:r,name:o}=this,a=Date.now(),s=(e-this.lastInfo.totalFrames)/((a-this.lastInfo.timestamp)/1e3)>>0;return this.lastInfo={totalFrames:e,x:t,y:n,width:i,height:r,timestamp:a,fps:s,name:o},iu({parent:this.inputs.filter((e=>e)).map((e=>e.node.getInfo()))},this.lastInfo)}close(){super.close(),this.inputs.forEach((e=>{var t,n;if(e&&(null==(t=e.node)||t.disconnect(),e.positionBuffer&&this.context instanceof $v))try{null==(n=this.context.ctx)||n.deleteBuffer(e.positionBuffer)}catch(e){}}))}},Mb=class extends zv{constructor(e,t){super(e,t.input,{name:"vb",create2d:!1,useDefaultProgram:!1,useFbo:!1,createTexture:!0,logger:e.log}),cu(this,"ready",!1),cu(this,"_bgTexture"),cu(this,"_waterMarkTexture"),cu(this,"_lastMaskTexture"),cu(this,"_lastMaskFbo"),cu(this,"_textureValid",!1),cu(this,"_selfieTextureValid",!1),cu(this,"_selfieSegmentation"),cu(this,"wasm"),cu(this,"_prePrograme"),cu(this,"_segmentationMask"),cu(this,"_weixin",!1),t.selfieSegmentation&&(this._selfieSegmentation=t.selfieSegmentation,this._selfieSegmentation.onResults=this.onPredict.bind(this)),this.init(t).catch((()=>this.context.destroy(new Error("selfie_segmentation init faild"))))}init(e){return du(this,null,(function*(){var t,n;let i=e.Wasm,r=this.context.ctx;if(this.wasm=new i.AllIn1(r),this.wasm.blurRadius=e.blurRadius||3,this.wasm.mirror=!!e.mirror,this.wasm.vbMode="blur"===e.bg?1:e.bg instanceof HTMLImageElement?2:"green"===e.bg?3:0,e.waterMark){let{x:t,y:n,width:i,height:r}=e.waterMark;this.wasm.setWaterMark(t,n,i,r)}if(e.beautyParams){let{beauty:i,brightness:r,ruddy:o}=e.beautyParams;this.wasm.setBeauty(i,r,o,null==(t=this.context._canvas)?void 0:t.width,null==(n=this.context._canvas)?void 0:n.height)}if(this.program=this.wasm.init(),this.useProgram(),this.setAttributes(this.positionBuffer,this.texCoordBuffer),r.uniform1i(r.getUniformLocation(this.program,"mask"),1),e.bg instanceof HTMLImageElement&&(r.uniform1i(r.getUniformLocation(this.program,"bg"),2),this._bgTexture=this.createTexture(e.bg)),e.waterMark&&(r.uniform1i(r.getUniformLocation(this.program,"waterMark"),3),this._waterMarkTexture=this.createTexture(e.waterMark.image)),r.uniform1i(r.getUniformLocation(this.program,"lastMask"),4),this._weixin){let e=this.context.createShader(r.FRAGMENT_SHADER,"#version 300 es\nprecision highp float;\nuniform sampler2D u_texture;\nuniform sampler2D mask;\n\nin vec2 v_texCoord;\nout vec4 outColor;\nvoid main() {\n  outColor = vec4(texture(u_texture, v_texCoord).rgb, texture(mask, v_texCoord).a);\n}"),t=this.context.createShader(r.VERTEX_SHADER,"#version 300 es\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_texCoord;\nvoid main() {\n  gl_Position = vec4(a_position.x, a_position.y, 0, 1);\n  v_texCoord = a_texCoord;\n}");this._prePrograme=this.context.createProgram(t,e),r.useProgram(this._prePrograme),this.setAttributes(this.positionBuffer,this.texCoordBuffer),r.uniform1i(r.getUniformLocation(this._prePrograme,"mask"),1)}this.ready=!0}))}onPredict(e){var t;let n=this.context.ctx;this._weixin&&(this._lastMaskTexture||(this._lastMaskTexture=this.createTexture(this.image),this._lastMaskFbo=this.createFramebuffer(this._lastMaskTexture))),this.useProgram(),this._weixin?this.useTexture():null==this||this._selfieSegmentation.bindTexture(),n.activeTexture(n.TEXTURE1),null==(t=this._selfieSegmentation)||t.bindTexture2d(e),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,this._bgTexture||null),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,this._waterMarkTexture||null),this.useBufferFrame(),n.drawArrays(n.TRIANGLE_STRIP,0,4),this._segmentationMask=e,this.totalFrames++}render(e){var t,n,i;let r=this.context.ctx;if("function"==typeof this.image.getVideoPlaybackQuality&&!Dp){let e=this.image.getVideoPlaybackQuality().totalVideoFrames;if(this._totalFrames===e)return!1;this._totalFrames=e,this.dropFrames=this._totalFrames-this.totalFrames}let{videoWidth:o,videoHeight:a}=this.image;this.image.width=o,this.image.height=a;let s=!1;if(this.totalFrames)this._weixin?this.useTexture():null==this||this._selfieSegmentation.bindTexture(),s=this._selfieTextureValid,this._selfieTextureValid=!0;else{if(!this.program)return!1;this.useTexture(),s=this._textureValid,this._textureValid=!0}return this.width===o&&this.height===a&&s?r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.image):(this.resize(o,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.image)),this.ready&&(this._weixin&&(r.useProgram(this._prePrograme),this.useTexture(),this._segmentationMask&&(r.activeTexture(r.TEXTURE1),null==(t=this._selfieSegmentation)||t.bindTexture2d(this._segmentationMask),r.bindFramebuffer(r.FRAMEBUFFER,this._lastMaskFbo||null)),r.drawArrays(r.TRIANGLE_STRIP,0,4),null==(n=this._selfieSegmentation)||n.bindTexture(),this._segmentationMask?r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,0,0,o,a):r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,o,a,0)),null==(i=this._selfieSegmentation)||i.send(o,a)),this.totalFrames||(r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,this._bgTexture||null),r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,this._waterMarkTexture||null),r.drawArrays(r.TRIANGLE_STRIP,0,4)),!1}close(){var e;super.close();let t=this.context.ctx;this._bgTexture&&t.deleteTexture(this._bgTexture),this._waterMarkTexture&&t.deleteTexture(this._waterMarkTexture),this._lastMaskTexture&&t.deleteTexture(this._lastMaskTexture),this._lastMaskFbo&&t.deleteFramebuffer(this._lastMaskFbo),this._prePrograme&&t.deleteProgram(this._prePrograme),null==(e=this.wasm)||e.close()}},kb=class extends wb.EventEmitter{constructor(e){super(),this.room=e,cu(this,"videoContext"),cu(this,"_glVideoContext"),cu(this,"_2dVideoContext"),cu(this,"destination"),cu(this,"smallVideoContext"),cu(this,"smallDestination"),cu(this,"smallTrackSource"),cu(this,"smallImageSource"),cu(this,"_isMirror",!1),cu(this,"cameraTrack"),cu(this,"cameraNode"),cu(this,"mirrorNode"),cu(this,"mixNode"),cu(this,"screenTrack"),cu(this,"screenNode"),cu(this,"selfModel",!1),cu(this,"blurRadius",3),cu(this,"arTrack"),cu(this,"Wasm"),cu(this,"waterMarkNode"),cu(this,"_waterMarkOption"),cu(this,"watermarkImageList",[]),cu(this,"_beautyParams"),cu(this,"isUsingArTrack",!1),cu(this,"_isMixScreen",!1),cu(this,"_virtualBackground"),cu(this,"virtualBackgroundInstance"),cu(this,"_bgAssetPath"),cu(this,"log",wm.createLogger({id:"vm"})),cu(this,"_checkId",0),cu(this,"_use2d",!1),cu(this,"_autoSwitchRenderMode",!0),cu(this,"_selfieSegmentation"),cu(this,"_seiEncodeProcessor"),cu(this,"_seiDecodeProcessor"),e&&(this.log.setUserId(e.userId),this.log.setSdkAppId(e.sdkAppId)),this.smallVideoContext=new Wv({frameRate:15,logger:this.log,name:"s"}),this.enablePrintDetail()}get _hasVirtualBg(){return!!this._virtualBackground}get _hasWaterMark(){return this.watermarkImageList.length>0}get renderMode(){return this._autoSwitchRenderMode?"auto":this._use2d?"2d":"webgl"}set renderMode(e){if(this._autoSwitchRenderMode="auto"===e,this._autoSwitchRenderMode)return;let t="2d"===e;this._use2d!==t&&(this._use2d=t,this.clear(),this.videoContext=this._use2d?this.get2dVideoContext():this.getGlVideoContext(),this.update())}get2dVideoContext(){return this._2dVideoContext?this._2dVideoContext.destroy():this._2dVideoContext=new Wv({frameRate:15,logger:this.log,name:"m"}),this._2dVideoContext.create({alpha:this._hasWaterMark||this._hasVirtualBg}),this.sendCreateResult("videoCtx2d",this._2dVideoContext.ctx?void 0:new Error("create 2d context failed")),this._2dVideoContext}getGlVideoContext(){if(this._glVideoContext){if(this._glVideoContext.available)return this._glVideoContext}else this._glVideoContext=new $v({frameRate:15,logger:this.log,name:"m"});try{this._glVideoContext.create(),this.sendCreateResult(),this._glVideoContext.on("unavailable",((e,t)=>{this.emit("error",{reason:e,error:t}),this.log.warn("video context unavailable",e,t),this.sendCreateResult("videoCtxGl",t||new Error(e)),this.update()}))}catch(e){this.emit("error",{reason:"create",error:e}),this.sendCreateResult("videoCtxGl",e)}return this._glVideoContext}enablePrintDetail(e=2e3){this._checkId=kg.run(lh,(()=>{this.destination&&this.log.debug(this.destination.getInfo())}),{delay:e})}destroy(){var e,t;null==(e=this._2dVideoContext)||e.destroy(),null==(t=this._glVideoContext)||t.destroy(),this.smallVideoContext.destroy(),kg.clearTask(this._checkId)}get needAlpha(){return this._hasWaterMark||this._hasVirtualBg}get active(){return(Dp||this._isMixScreen||this._isMirror||this._hasWaterMark||this._hasVirtualBg||this._beautyParams)&&this.checkOrCreateVideoContext()}sendCreateResult(e="videoCtxGl",t){let n="videoCtxGl"===e?512700:512701;t?Kg.addFailedEvent({key:n,error:t}):Kg.addSuccessEvent({key:n})}checkOrCreateVideoContext(){let e=this._use2d;if(this._autoSwitchRenderMode&&(this._use2d=!this._hasVirtualBg),this.videoContext)if(this.videoContext.available){let t=!this.videoContext.hasAlpha&&this.needAlpha;if(this._autoSwitchRenderMode&&e===this._hasVirtualBg)this.clear();else{if(!t)return!0;if(!this._use2d)return!0;this.clear()}}else this.clear(),this._use2d=!0;return this.videoContext=this._use2d?this.get2dVideoContext():this.getGlVideoContext(),this.videoContext.available}get smallTrack(){var e;return null==(e=this.smallDestination)?void 0:e.videoTrack}get hasSmall(){return!!this.smallTrack}get initialTrack(){var e;return null==(e=this.cameraTrack)?void 0:e.mediaTrack}initVirtualBackground(e){return this._selfieSegmentation=e,this._selfieSegmentation.changeModel()}_setMainOutput(e){var t;try{let n=this.cameraTrack,{small:i,settings:r,player:o}=n;i?(this.smallVideoContext.available||(this.smallVideoContext.create({alpha:!1}),this.smallDestination=new Fv(this.smallVideoContext,i)),this.smallVideoContext.frameRate=i.frameRate,this.smallDestination.resolution=i,e?(this.smallTrackSource&&(this.smallTrackSource.close(),delete this.smallTrackSource),this.smallImageSource?this.smallImageSource.image=e:(this.smallImageSource=this.smallVideoContext.createVideoImageSource(e),this.smallImageSource.connect(this.smallDestination))):(this.smallImageSource&&(this.smallImageSource.close(),delete this.smallImageSource),this.smallTrackSource?this.smallTrackSource.replaceTrack(this.initialTrack):(this.smallTrackSource=this.smallVideoContext.createVideoTrackSource(this.initialTrack,"smallTrackSource"),this.smallTrackSource.width=r.width,this.smallTrackSource.height=r.height,this.smallTrackSource.connect(this.smallDestination)))):this.smallVideoContext.available&&(this.smallVideoContext.destroy(),delete this.smallDestination,delete this.smallTrackSource,delete this.smallImageSource),Dp&&o.setCanvas(e);let a=e&&(null==(t=this.destination)?void 0:t.videoTrack)||this.initialTrack;return this.isUsingArTrack&&this.arTrack&&(this.emit("output-track-changed"),a=this.arTrack),this._selfieSegmentation&&e&&!this._use2d&&(this._selfieSegmentation._glName||this._selfieSegmentation.setCanvas(e)),this.log.info(`set main output ${a?a.label:"no output track"}`),n.setOutputMediaStreamTrack(a)}catch(e){this.log.error("set main output failed",e)}}update(){return du(this,null,(function*(){var e,t;if(!this.cameraTrack||!this.cameraTrack.mediaTrack)return;if(!this.active)return this.cameraNode&&this.clear(),this._setMainOutput();let{settings:n,profile:i}=this.cameraTrack;if(this._use2d||!this._virtualBackground&&!this._beautyParams?(this.destination||(this.destination=this.videoContext.createVideoTrackDestination({name:"mainDestination",logger:this.log})),this.cameraNode?this.cameraNode.replaceTrack(this.initialTrack):(this.cameraNode=this.videoContext.createVideoTrackSource(this.initialTrack,"cameraNodeSource"),this.cameraNode.resize(n.width,n.height))):(this.cameraNode&&this.cameraNode.close(),this.destination||(this.destination=new Vv(this.videoContext,{name:"mainDestination",logger:this.log})),this.cameraNode=new Mb(this.videoContext,{input:this.cameraTrack.mediaTrack,mirror:this._isMirror,bg:this._virtualBackground,selfModel:this.selfModel,waterMark:this._waterMarkOption,beautyParams:this._beautyParams,useTflite:!0,blurRadius:this.blurRadius,assetPath:this._bgAssetPath,selfieSegmentation:this._selfieSegmentation,Wasm:this.Wasm}),this.cameraNode.connect(this.destination)),this.videoContext.frameRate=i.frameRate,this._use2d){let n=this.cameraNode;n.disconnect(),this._isMirror&&(this.mirrorNode||(this.mirrorNode=new Rb(this.videoContext)),n=n.connect(this.mirrorNode),n.disconnect(),this.log.info("start mirror")),this.mixNode&&this.mixNode.close(),delete this.mixNode,(this._isMixScreen||this._hasWaterMark)&&(this.mixNode=new Cb(this.videoContext),n.connect(this.mixNode,{zIndex:1}),this._hasWaterMark&&!this.waterMarkNode&&this._waterMarkOption&&(this.waterMarkNode=this.videoContext.createVideoImageSource(this._waterMarkOption.image,{autoResize:!1,logger:this.log}),this.waterMarkNode.resize(this._waterMarkOption.width,this._waterMarkOption.height),this.waterMarkNode.x=this._waterMarkOption.x,this.waterMarkNode.y=this._waterMarkOption.y),null==(e=this.waterMarkNode)||e.connect(this.mixNode,{zIndex:2}),this._isMixScreen&&this.screenTrack&&!this.screenNode&&(this.screenNode=this.videoContext.createVideoTrackSource(this.screenTrack.mediaTrack,"screenNodeSource")),null==(t=this.screenNode)||t.connect(this.mixNode,{zIndex:0}),n=this.mixNode,this.log.info("start mix",`${this.mixNode.width}x${this.mixNode.height}`)),n.connect(this.destination)}return this.log.info("update "+(this._use2d?"2d":"webgl")),this._setMainOutput(this.videoContext._canvas)}))}changeInput(e){var t,n,i,r;if(e instanceof Av)return this.log.info("change screen input",null==(t=e.mediaTrack)?void 0:t.label),this.setScreenTrack(e);if(e instanceof Sv)return this.log.info("change video input",null==(n=e.mediaTrack)?void 0:n.label),this.setCameraTrack(e);if(e instanceof qv){this.log.info("change remote input",null==(i=e.mediaTrack)?void 0:i.label);let t=e.mediaTrack;return this._seiDecodeProcessor&&(e.pipeline[1]=this._seiDecodeProcessor),e.setOutputMediaStreamTrack(t)}this.log.warn("change unknown input",null==(r=e.mediaTrack)?void 0:r.label)}configPipeline(e){e instanceof qv&&this._seiDecodeProcessor&&(e.pipeline[1]=this._seiDecodeProcessor)}removeInput(e){var t;e instanceof Av?(null==(t=this.screenNode)||t.close(),delete this.screenNode,delete this.screenTrack,this.update()):e instanceof Sv?(this.clear(),delete this.cameraTrack,this.smallImageSource&&(this.smallImageSource.close(),delete this.smallImageSource),this.smallTrackSource&&(this.smallTrackSource.close(),delete this.smallTrackSource)):e instanceof qv&&e.source&&e.source.context.destroy()}setCameraTrack(e){return du(this,null,(function*(){this.cameraTrack=e,this._seiEncodeProcessor&&(this.cameraTrack.pipeline[0]=this._seiEncodeProcessor),this.update()}))}setScreenTrack(e){return this.screenTrack=e,this._seiEncodeProcessor&&(this.screenTrack.pipeline[0]=this._seiEncodeProcessor),this._isMixScreen&&(this.screenNode?this.screenNode.replaceTrack(e.mediaTrack):this.update()),e.setOutputMediaStreamTrack(e.mediaTrack)}getWatermarkImage(e,t){return du(this,null,(function*(){let n=document.createElement("canvas");t&&e&&(n.height=t,n.width=e);let i=n.getContext("2d");if(!i)throw new Au({code:Tu.NOT_SUPPORTED,message:"Make image failed because of canvas context is null"});return this.watermarkImageList.sort(((e,t)=>e.zIndex-t.zIndex)),this.watermarkImageList.forEach((({image:e,x:t,y:n,width:r,height:o})=>{i.drawImage(e,t,n,r,o)})),_m(n.toDataURL())}))}pushWaterMarkImageList(e){let{type:t}=e;this.watermarkImageList.some((t=>t.imageUrl===e.imageUrl&&t.height===e.height&&t.width===e.width&&t.x===e.x&&t.y===e.y&&t.type===e.type&&t.zIndex===e.zIndex))||(("mute"===t||"watermark"===t)&&(this.watermarkImageList=this.watermarkImageList.filter((e=>e.type!==t))),this.watermarkImageList.push(e))}setBeautyParams(e){return du(this,null,(function*(){this._beautyParams=e,this.update()}))}stopBeauty(){return du(this,null,(function*(){this._beautyParams=void 0,this.update()}))}setWatermark(e){return du(this,null,(function*(){let t;try{t=yield _m((null==e?void 0:e.imageElement)||e.imageUrl)}catch(t){throw new Au({code:Tu.INVALID_PARAMETER,message:`load image failed, url: ${e.imageUrl}`})}let{x:n=0,y:i=0,width:r=t.width,height:o=t.height,type:a="watermark",zIndex:s=2}=e;this.pushWaterMarkImageList({x:n,y:i,width:r,height:o,image:t,zIndex:s,type:a,imageUrl:e.imageUrl}),yield this.freshWatermark(),this.log.info("set watermark",JSON.stringify(this.watermarkImageList))}))}deleteWatermark(e="watermark"){return du(this,null,(function*(){this.watermarkImageList=this.watermarkImageList.filter((t=>t.type!==e)),this.log.info("delete watermark",e,JSON.stringify(this.watermarkImageList)),yield this.freshWatermark()}))}freshWatermark(){return du(this,null,(function*(){var e,t,n;null==(e=this.waterMarkNode)||e.close(),delete this.waterMarkNode,delete this._waterMarkOption;let i=yield this.getWatermarkImage(null==(t=this.cameraTrack)?void 0:t.settings.width,null==(n=this.cameraTrack)?void 0:n.settings.height);this._waterMarkOption={x:0,y:0,width:i.width,height:i.height,image:i},this.update()}))}setVirtualBackground(e){return du(this,null,(function*(){if(e){if(this._use2d&&!this._autoSwitchRenderMode)return Promise.reject(new Error("not support virtual background in 2d mode"));this._bgAssetPath=e.assetPath,"image"===e.type?this._virtualBackground=yield _m(e.imageUrl):(this.blurRadius=e.blurLevel||this.blurRadius||3,this._virtualBackground=e.type)}else this._virtualBackground=void 0;this.log.info(`${this._virtualBackground?"start":"stop"} virtual background, ${(null==e?void 0:e.type)||""}, ${this.blurRadius||""}`),this.update()}))}get mixScreen(){return this._isMixScreen}set mixScreen(e){var t;this._isMixScreen=e,this._isMixScreen||(null==(t=this.screenNode)||t.close(),delete this.screenNode),this.update()}set mirror(e){var t;this._isMirror!==e&&(this._isMirror=e,this._isMirror||(null==(t=this.mirrorNode)||t.close(),delete this.mirrorNode),this.update())}get mirror(){return this._isMirror}enableAr(e){this.arTrack=e,this.isUsingArTrack=!0,this.update()}updateAr(){return du(this,null,(function*(){var e;null==(e=this.cameraTrack)||!e.mediaTrack||(yield this.virtualBackgroundInstance.ar.updateInputTrack(this.cameraTrack.mediaTrack.clone()))}))}disableAr(){var e;this.isUsingArTrack=!1,null==(e=this.arTrack)||e.stop(),this.arTrack=void 0,this.update()}clear(){var e;null==(e=this.videoContext)||e.disconnect(),delete this.destination,delete this.cameraNode,delete this.mirrorNode,delete this.screenNode,delete this.waterMarkNode}enableSEI(e,t){this._seiEncodeProcessor=e,this._seiDecodeProcessor=t,this.cameraTrack&&(this.cameraTrack.pipeline[0]=this._seiEncodeProcessor),this.screenTrack&&(this.screenTrack.pipeline[0]=this._seiEncodeProcessor)}disableSEI(){delete this._seiEncodeProcessor,delete this._seiDecodeProcessor,this.cameraTrack&&(this.cameraTrack.pipeline[0]=void 0),this.screenTrack&&(this.screenTrack.pipeline[0]=void 0)}},Nb=0,Db=class extends wg{constructor(e){super("room"),this.seq=++Nb,this.role="anchor",this.joinParams=null,this.localTracks=new Set,this.enableAutoPlayDialog=!0,this.autoReceiveAudio=!0,this.autoReceiveVideo=!0,this.scheduleResult={domains:null,iceServers:null,iceTransportPolicy:null,trtcAutoConf:null},this._isUsingCachedSchedule=!1,this._log=wm.createLogger({id:`r${this.seq}`}),this._joinedTimestamp=0,this.isDestroyed=!1,this.useStringRoomId=!!e.useStringRoomId,zf(e.autoReceiveAudio)&&(this.autoReceiveAudio=e.autoReceiveAudio),zf(e.autoReceiveVideo)&&(this.autoReceiveVideo=e.autoReceiveVideo),zf(e.enableAutoPlayDialog)&&(this.enableAutoPlayDialog=e.enableAutoPlayDialog),this._sdkType=e.sdkType,this.keyPointManager=new xb({room:this,frameWorkType:e.frameWorkType,component:e.component,language:e.language}),this.callDurationCalculator=new class{constructor(e){cu(this,"_room",null),cu(this,"_durationMap"),cu(this,"_eventMap",new Map),this._room=e.room,this._durationMap=new Map,this.installEvents()}installEvents(){this._eventMap.set(xm.SUBSCRIBE_SUCCESS,this.handleSubscribed).set(xm.UNSUBSCRIBE_SUCCESS,this.handleStreamStopped).set(xm.REMOTE_PUBLISH_STATE_CHANGED,(({room:e,prevMuteState:t,muteState:n})=>{var i;let{userId:r}=n;if(!this.hitTest(e))return;t.hasAudio&&!n.hasAudio&&this.stopDurationItem(`${r}_main`,ld.AUDIO),t.hasVideo&&!n.hasVideo&&this.stopDurationItem(`${r}_main`,ld.VIDEO),t.hasAuxiliary&&!n.hasAuxiliary&&this.stopDurationItem(`${r}_auxiliary`,ld.VIDEO);let o=null==(i=this._room)?void 0:i.remotePublishedUserMap.get(r);!o||(!t.hasAudio&&n.hasAudio&&o.remoteAudioTrack.isSubscribed&&this.addDuractionItem(r,ld.AUDIO,"main"),!t.hasVideo&&n.hasVideo&&o.remoteVideoTrack.isSubscribed&&this.addDuractionItem(r,ld.VIDEO,"main"),!t.hasAuxiliary&&n.hasAuxiliary&&o.remoteAuxiliaryTrack.isSubscribed&&this.addDuractionItem(r,ld.VIDEO,"auxiliary"))})),this._eventMap.forEach(((e,t)=>af.on(t,e,this)))}uninstallEvents(){this._eventMap.forEach(((e,t)=>af.off(t,e,this))),this._eventMap.clear()}handleSubscribed({room:e,streamType:t,remotePublishedUser:n}){if(!this.hitTest(e))return;let{userId:i}=n,r=`${i}_${t}`;if(n.muteState.hasAudio&&"main"===t)if(n.remoteAudioTrack.isSubscribed){let e=new Ab,n=this._durationMap.get(r);n?this.isRecording(n.audio)||n.audio.push(e):this._durationMap.set(r,{userId:i,type:t,audio:[e],video:[]})}else this.stopDurationItem(r,ld.AUDIO);if(n.muteState.hasVideo||n.muteState.hasAuxiliary)if(n.remoteVideoTrack.isSubscribed||n.remoteAuxiliaryTrack.isSubscribed){let e=new Ab,n=this._durationMap.get(r);n?this.isRecording(n.video)||n.video.push(e):this._durationMap.set(r,{userId:i,type:t,audio:[],video:[e]})}else this.stopDurationItem(r,ld.VIDEO)}handleStreamStopped({room:e,streamType:t,remotePublishedUser:n}){if(!this.hitTest(e))return;let{userId:i}=n,r=`${i}_${t}`;this.stopDurationItem(r,ld.AUDIO),this.stopDurationItem(r,ld.VIDEO)}isRecording(e){return e.findIndex((e=>0===e.endTime))>=0}addDuractionItem(e,t,n){let i=`${e}_${n}`,r=new Ab,o=this._durationMap.get(i);o?this.isRecording(o[t])||o[t].push(r):this._durationMap.set(i,{userId:e,type:n,audio:t===ld.AUDIO?[r]:[],video:t===ld.AUDIO?[]:[r]})}stopDurationItem(e,t){if(this._durationMap.has(e)){let n=this._durationMap.get(e)[t].find((e=>0===e.endTime));n&&n.stop()}}hitTest(e){return this._room===e}getDuration(e,t){return this._durationMap.has(e)?this._durationMap.get(e)[t].reduce(((e,t)=>e+t.getDuration()),0):0}getDurationMap(){return this._durationMap}reset(){this._durationMap.clear()}destroy(){this._room=null,this.uninstallEvents()}}({room:this}),this.badCaseDetector=new class{constructor(e){cu(this,"_room"),cu(this,"_renderFreezeMap",new Map),cu(this,"_isVideoPlayingEventFiredMap",new Map),cu(this,"_dataFreezeMap",new Map),cu(this,"_monitorFreezeData",new Map),cu(this,"_eventMap",new Map),this._room=e.room,this.installEvents()}installEvents(){this._eventMap.set(xm.LEAVE_SUCCESS,(({room:e})=>{this.hitTest(e)&&this.stop()})).set(xm.PLAY_TRACK_START,this.onPlayTrackStart).set(xm.UNSUBSCRIBE_SUCCESS,(({room:e,streamType:t,remotePublishedUser:n})=>{if(!this.hitTest(e))return;let{userId:i}=n,r=`${i}_${t}`;this.stopDataFreeze({key:r,userId:i,type:t})})).set(xm.REMOTE_PUBLISH_STATE_CHANGED,(({room:e,prevMuteState:t,muteState:n})=>{if(!this.hitTest(e))return;let{userId:i}=n;if(t.hasVideo&&!n.hasVideo){let e="main",t=`${n.userId}_${e}`;this.stopDataFreeze({key:t,userId:i,type:e})}if(t.hasAuxiliary&&!n.hasAuxiliary){let e="auxiliary",t=`${n.userId}_${e}`;this.stopDataFreeze({key:t,userId:i,type:e})}})).set(xm.PLAYER_STATE_CHANGED,(({track:e,state:t,reason:n,type:i})=>{if(Wf(e)&&this.hitTest(e.room)&&i===ld.VIDEO){if("PLAYING"===t){let t=`${e.userId}_${e.streamType}`;this._isVideoPlayingEventFiredMap.set(t,!0)}n===ld.MUTE?this.onVideoTrackMuted(e):n===ld.UNMUTE&&this.onVideoTrackUnmuted(e)}})).set(xm.HEARTBEAT_REPORT,this.onHearBeatReport),this._eventMap.forEach(((e,t)=>af.on(t,e,this)))}uninstallEvents(){this._eventMap.forEach(((e,t)=>af.off(t,e,this))),this._eventMap.clear()}stop(){this._renderFreezeMap.clear(),this._dataFreezeMap.clear(),this._isVideoPlayingEventFiredMap.clear()}onVideoTrackMuted(e){if(!e.isSubscribed)return;let{userId:t,streamType:n}=e,i=`${t}_${n}`,r=this._dataFreezeMap.get(i),o=new Ab;r?r.durationItemList.push(o):this._dataFreezeMap.set(i,{userId:t,type:n,durationItemList:[o],isFreezing(){let e=this.durationItemList[this.durationItemList.length-1];return e&&0===e.endTime}})}onVideoTrackUnmuted(e){if(!e.isSubscribed)return;let{userId:t,streamType:n}=e,i=`${t}_${n}`;this.stopDataFreeze({key:i,userId:t,type:n})}onHearBeatReport({room:e,report:t}){!this.hitTest(e)||t.msg_down_stream_info.forEach((e=>{let t=this._room.remotePublishedUserMap.get(e.msg_user_info.str_identifier);if(!t)return;let{userId:n,muteState:i}=t;e.msg_video_status.forEach((e=>{2===e.uint32_video_stream_type&&i.hasVideo&&!i.videoMuted&&t.remoteVideoTrack.isSubscribed&&this.handleRenderFreeze({userId:n,fps:e.uint32_video_dec_fps,type:"main"}),7===e.uint32_video_stream_type&&i.hasAuxiliary&&t.remoteAuxiliaryTrack.isSubscribed&&this.handleRenderFreeze({userId:n,fps:e.uint32_video_dec_fps,type:"auxiliary"})}))}))}stopDataFreeze({key:e,userId:t,type:n}){let i=this._dataFreezeMap.get(e);if(!i||!i.isFreezing())return;let r=i.durationItemList[i.durationItemList.length-1];r.stop();let o=r.getDuration();o>Gd?this._monitorFreezeData.set(e,{userId:t,type:n,duration:o}):i.durationItemList.pop()}getTotalDuration(e){return e.reduce(((e,t)=>{let n=t.getDuration();return e+Math.min(n,5e3)}),0)}handleRenderFreeze(e){return du(this,arguments,(function*({userId:e,fps:t,type:n}){let i=`${e}_${n}`,r=this._renderFreezeMap.get(i);if(t<=2){let t=Qf();r&&!r.isFreeze&&(r.freezeTimeline.push({startTime:t,endTime:0}),r.isFreeze=!0),r||this._renderFreezeMap.set(i,{userId:e,type:n,isFreeze:!0,freezeTimeline:[{startTime:t,endTime:0}],renderFreezeTotal:0})}else if(r&&r.isFreeze){r.isFreeze=!1;let e=r.freezeTimeline.pop();if(e){e.endTime=Qf();let t=e.endTime-e.startTime;r.freezeTimeline.push(e),r.renderFreezeTotal+=Math.min(5e3,t)}}}))}onPlayTrackStart({track:e}){if(!Wf(e)||!this.hitTest(e.room)||e.kind!==ld.VIDEO||e.hasFlag)return;let t=`${e.userId}_${e.streamType}`;this._isVideoPlayingEventFiredMap.has(t)||this._isVideoPlayingEventFiredMap.set(t,!1)}getDataFreezeDuration(e){let t={dataFreeze:0,count:0},n=this._dataFreezeMap.get(e);if(n){if(n.isFreezing()){let e=n.durationItemList[n.durationItemList.length-1];e.stop(),e.getDuration()<Gd&&n.durationItemList.pop()}t.dataFreeze=this.getTotalDuration(n.durationItemList),t.count=n.durationItemList.length}return t}getRenderFreezeDuration(e){let t=this._renderFreezeMap.get(e),n=0,i=0;if(t)if(t.isFreeze){let e=Qf()-t.freezeTimeline[t.freezeTimeline.length-1].startTime;n=t.renderFreezeTotal+Math.min(e,5e3),i=t.freezeTimeline.length}else n=t.renderFreezeTotal;return{renderFreeze:n,count:i}}getMonitorFreeze(){return this._monitorFreezeData}isBlackStream(e){return!!this._isVideoPlayingEventFiredMap.has(e)&&!this._isVideoPlayingEventFiredMap.get(e)}resetMonitor(){this._monitorFreezeData.clear()}hitTest(e){return e===this._room}destroy(){this.uninstallEvents()}}({room:this}),this.audioManager=new Iv(this),this.videoManager=new kb(this)}get isMainStreamPublished(){for(let e of this.localTracks)if(4&e.mediaType)return!0;return!1}get isAuxStreamPublished(){for(let e of this.localTracks)if(2&e.mediaType)return!0;return!1}get hasAuxStream(){for(let e of this.remotePublishedUserMap.values())if(e.muteState.hasAuxiliary)return!0;return this.isAuxStreamPublished}get localMainVideoTrack(){for(let e of this.localTracks)if(4&e.mediaType)return e;return null}get localAuxVideoTrack(){for(let e of this.localTracks)if(2&e.mediaType)return e;return null}getLogger(){return this._log}get isJoining(){return"joining"===this.state.toString()}get isJoined(){return"joined"===this.state}get isLeft(){return"left"===this.state}addTrack(e){return du(this,null,(function*(){return this.publish(e)}))}removeTrack(e){return du(this,null,(function*(){return this.unpublish(e)}))}replaceTrack(e){return du(this,null,(function*(){}))}setEncodedDataProcessingListener(e){throw new Error("Method not implemented.")}enableAIVoice(e){throw new Error("Method not implemented.")}setProxyServer(e){if(Bf(e))e.startsWith("wss://")?this.proxy_ws=e:e.startsWith("https://")&&(this.proxy_wt=e);else if(Of(e)){let{websocketProxy:t,webtransportProxy:n,loggerProxy:i,scheduleProxy:r,unifiedProxy:o}=e;this.proxy_ws=t,this.proxy_wt=n,this.proxy_unified=o,o?(pf([o,o]),Hu(`https://${o}`)):(i&&Hu(i),r&&pf(r))}af.once(xm.JOIN_RECEIVED_CMD_RES,(()=>this.sendAbilityStatus({sched_domain:hf.main,sched_back_domain:hf.backup,signal_domain:this.proxy_ws||this.proxy_wt||""})))}getRemoteAudioStats(){return du(this,null,(function*(){let e={};return this.remotePublishedUserMap.forEach((t=>{e[t.userId]=t.remoteAudioTrack.stat})),e}))}getTransportStats(){return du(this,null,(function*(){var e;let t={rtt:(null==(e=this.quality)?void 0:e.uplinkRTT)||0,downlinksRTT:{}};if(this.quality)for(let e of this.quality.downlinkInfo)t.downlinksRTT[e.userId]=e.rtt;return t}))}getRemoteVideoStats(){return du(this,arguments,(function*(e="main"){let t={};return this.remotePublishedUserMap.forEach((n=>{let i="auxiliary"===e?n.remoteAuxiliaryTrack:n.remoteVideoTrack;t[n.userId]=i.stat})),t}))}checkDestroy(){if(this.isDestroyed)throw new Au({code:Tu.INVALID_OPERATION,message:nf({key:fh.CLIENT_DESTROYED,data:{funName:"join"}})})}destroy(){if(this.isJoined)throw this._log.warn(mh.INVALID_DESTROY),new Au({code:Tu.INVALID_OPERATION,message:nf({key:fh.INVALID_DESTROY})});this._log.info("destroy room"),this.audioManager.destroy(),this.videoManager.destroy(),this.keyPointManager.destroy(),this.callDurationCalculator.destroy(),this.badCaseDetector.destroy(),this.isDestroyed=!0,af.emit(xm.ROOM_DESTROY,{room:this})}schedule(e,t){return du(this,null,(function*(){var n,i;let r=Qf();try{let{isCached:o,result:a,detailCost:s}=yield function(e){return du(this,arguments,(function*({userId:e,sdkAppId:t,useStringRoomId:n,roomId:i,userSig:r,version:o,frameWorkType:a,role:s,latencyLevel:l}){if(!uf&&cf)return{isCached:!0,result:cf};let c={delta:0,count:[1,1],msg:[],detail:[]};try{let u=new FormData;u.append("userId",String(e)),u.append("sdkAppId",String(t)),u.append("isStrGroupId",String(n)),u.append("groupId",String(i)),u.append("sdkVersion",o),u.append("userSig",String(r)),s&&u.append("role",String(s)),l&&u.append("latencyLevel",String(l)),a&&u.append("frameWorkType",String(a));let d=Qf(),h=yield function(e,t,n){return new Promise(((i,r)=>{let o=null;Kf([vf((e=>t.count[0]=e+1),(({error:e,retry:i,retriedCount:r,retryFuncArgs:a})=>{t.msg[0]=e.message,o||(r>=2&&(a[0]=ff(n,ld.MAIN,!0)),i())}))(ff(n,ld.MAIN),e,{get timeout(){return 1e3*Pf(2+t.count[0])}}),vf((e=>t.count[1]=e+1),(({error:e,retry:i,retriedCount:r,retryFuncArgs:a})=>{t.msg[1]=e.message,o||(r>=2&&(a[0]=ff(n,ld.BACKUP,!0)),i())}))(ff(n,ld.BACKUP),e,{get timeout(){return 1e3*Pf(2+t.count[1])}})]).then((e=>{o=e,i(o)})).catch(r)}))}(u,c,t);h.config&&(h.config.loggerDomain&&Hu(h.config.loggerDomain),zf(h.config.scheduleCache)&&df(!h.config.scheduleCache)),c.delta=Qf()-d;let p=function(e,t,n){let i={totalCost:0,local:0,dns:0,tcp:0,tls:0,request:0,response:0};try{let r=performance.getEntriesByType("resource"),o=ff(e,ld.MAIN),a=ff(e,ld.BACKUP);for(let e of r)if(e.startTime>=n&&(e.name===o||e.name===a)&&e.transferSize>0){let n=e.name===o?ld.MAIN:ld.BACKUP,r=Math.round(e.duration),a=Math.round(e.domainLookupStart-e.startTime),s=e.redirectStart>0?Math.round(e.redirectEnd-e.redirectStart):0,l=e.fetchStart>0?Math.round(e.domainLookupStart-e.fetchStart):0,c=Math.round(e.domainLookupEnd-e.domainLookupStart),u=Math.round(e.requestStart-e.secureConnectionStart),d=Math.round(e.secureConnectionStart-e.connectStart),h=Math.round(e.responseStart-e.requestStart),p=Math.round(e.responseEnd-e.responseStart),f=[c,u,d,h,p];lf.uploadEvent({log:`stat-schedule-net:${r}(${a}(${s}->${l})->${f.join("->")}) ${n}`,userId:t}),i=ru(iu({},i),{totalCost:r,local:a,dns:c,tcp:d,tls:u,request:h,response:p});break}}catch(e){wm.error("getScheduleDetailCost error",e)}return i}(Number(t),e,d);return cf=h,{isCached:!1,result:h,detailCost:p}}catch(e){let t=Gf(e)?e[0]:e,n=Hf(t.code)?t.code:0,i="schedule failed"+(t.message?`: ${t.message}`:""),r=new Au({code:Tu.SCHEDULE_FAILED,extraCode:n,message:nf({key:fh.JOIN_ROOM_FAILED,data:{error:i,code:n}})});throw wm.error(i,n),r}}))}({userId:this.userId,sdkAppId:this.sdkAppId,roomId:this.useStringRoomId?e.strRoomId:e.roomId,useStringRoomId:this.useStringRoomId,version:Nu,userSig:this.userSig,role:"live"===this.scene?e.role:void 0,frameWorkType:t,latencyLevel:e.latencyLevel});this._isUsingCachedSchedule=o,this._log.info(`schedule cache:${+o} ${pm(a,{keysToExclude:["username","credential"]})}`),o&&af.once(xm.JOIN_RECEIVED_CMD_RES,(()=>this.sendAbilityStatus({scheduleCache:1}))),this.scheduleResult=iu(iu({},this.scheduleResult),a),Hf(null==(n=a.config)?void 0:n.retryCount)&&Nd(a.config.retryCount),Bf(null==(i=a.config)?void 0:i.loggerDomain)&&Hu(a.config.loggerDomain),af.emit(xm.JOIN_SCHEDULE_SUCCESS,{room:this,schedule:this.scheduleResult,detailCost:s}),Kg.addSuccessEvent({key:521700,cost:Qf()-r,split:50})}catch(e){throw Kg.addFailedEvent({key:521700,error:e}),e}}))}},Ob=su(hu(),1),Pb=Symbol("instance"),Lb=(Symbol("abortCtrl"),Symbol("cacheResult")),Ub=class{constructor(e,t,n){this.oldState=e,this.newState=t,this.action=n,this.aborted=!1}abort(e){this.aborted=!0,zb.call(e,this.oldState,new Error(`action '${this.action}' aborted`))}toString(){return`${this.action}ing`}},Vb=class extends Error{constructor(e,t,n){super(t),this.state=e,this.message=t,this.cause=n}},Fb=new Map;function Bb(e,t,n={}){return(i,r,o)=>{let a=n.action||r;if(!n.context){let n=Fb.get(i)||[];Fb.has(i)||Fb.set(i,n),n.push({from:e,to:t,action:a})}let s=o.value;o.value=function(...i){let r=this;if(n.context&&(r=jb.get("function"==typeof n.context?n.context.call(this,...i):n.context)),r.state===t)return r[Lb];r.state instanceof Ub&&r.state.action==n.abortAction&&r.state.abort(r);let o=null;if(Array.isArray(e)?0==e.length?r.state instanceof Ub&&r.state.abort(r):("string"!=typeof r.state||!e.includes(r.state))&&(o=new Vb(r._state,`${r.name} ${a} to ${t} failed: current state ${r._state} not in from config`)):e!==r.state&&(o=new Vb(r._state,`${r.name} ${a} to ${t} failed: current state ${r._state} not from ${e}`)),o){if(!n.fail){if(n.ignoreError)return o;throw o}n.fail.call(this,o)}let l=r.state,c=new Ub(l,t,a);zb.call(r,c);let u=e=>{var i;return r[Lb]=e,c.aborted||(zb.call(r,t),null===(i=n.success)||void 0===i||i.call(this,r[Lb])),e},d=e=>{let t=e instanceof Error?e.message:String(e);if(zb.call(r,l,e),!n.fail){if(n.ignoreError)return e;throw e}n.fail.call(this,new Vb(r._state,`action '${a}' failed :${t}`,e instanceof Error?e:new Error(t)))};try{let e=s.apply(this,i);return function(e){return"object"==typeof e&&e&&"then"in e}(e)?e.then(u).catch(d):u(e)}catch(e){d(e)}}}}var Hb="undefined"!=typeof window&&window.__AFSM__?(e,t)=>{window.dispatchEvent(new CustomEvent(e,{detail:t}))}:"undefined"!=typeof importScripts?(e,t)=>{postMessage({type:e,payload:t})}:()=>{};function zb(e,t){let n=this._state;this._state=e;let i=e.toString();e&&this.emit(i,n),this.emit(jb.STATECHANGED,e,n,t),this.updateDevTools({value:e,old:n,err:t instanceof Error?t.message:String(t)})}var jb=class extends Ob.default{constructor(e,t,n){super(),this.name=e,this.groupName=t,this._state=jb.INIT,e||(e=Date.now().toString(36)),n?Object.setPrototypeOf(this,n):n=Object.getPrototypeOf(this),t||(this.groupName=this.constructor.name);let i=n[Pb];i?this.name=i.name+"-"+i.count++:n[Pb]={name:this.name,count:0},this.updateDevTools({diagram:this.stateDiagram})}get stateDiagram(){let e=Object.getPrototypeOf(this),t=Fb.get(e)||[],n=new Set,i=[],r=[],o=new Set,a=Object.getPrototypeOf(e);Fb.has(a)&&(a.stateDiagram.forEach((e=>n.add(e))),a.allStates.forEach((e=>o.add(e)))),t.forEach((({from:e,to:t,action:n})=>{"string"==typeof e?i.push({from:e,to:t,action:n}):e.length?e.forEach((e=>{i.push({from:e,to:t,action:n})})):r.push({to:t,action:n})})),i.forEach((({from:e,to:t,action:i})=>{o.add(e),o.add(t),o.add(i+"ing"),n.add(`${e} --\x3e ${i}ing : ${i}`),n.add(`${i}ing --\x3e ${t} : ${i} `),n.add(`${i}ing --\x3e ${e} : ${i} `)})),r.forEach((({to:e,action:t})=>{n.add(`${t}ing --\x3e ${e} : ${t} `),o.forEach((i=>{i!==e&&n.add(`${i} --\x3e ${t}ing : ${t}`)}))}));let s=[...n];return Object.defineProperties(e,{stateDiagram:{value:s},allStates:{value:o}}),s}static get(e){let t;return"string"==typeof e?(t=jb.instances.get(e),t||jb.instances.set(e,t=new jb(e,void 0,Object.create(jb.prototype)))):(t=jb.instances2.get(e),t||jb.instances2.set(e,t=new jb(e.constructor.name,void 0,Object.create(jb.prototype)))),t}static getState(e){var t;return null===(t=jb.get(e))||void 0===t?void 0:t.state}updateDevTools(e={}){Hb(jb.UPDATEAFSM,Object.assign({name:this.name,group:this.groupName},e))}get state(){return this._state}set state(e){zb.call(this,e)}};jb.STATECHANGED="stateChanged",jb.UPDATEAFSM="updateAFSM",jb.INIT="[*]",jb.ON="on",jb.OFF="off",jb.instances=new Map,jb.instances2=new WeakMap;var Gb=su(hu()),$b=su(Eu());function Wb(e){var t;let n=[];for(let i=0;i<e.rtp.length;i++){if(["rtx","red","ulpfec"].includes(e.rtp[i].codec))continue;let r=e.fmtp.filter((t=>t.payload===e.rtp[i].payload))[0];n.push({payload:e.rtp[i].payload,codec:e.rtp[i].codec,fmtp:r?r.config:"",rate:e.rtp[i].rate,rtx:"rtx"===(null==(t=e.rtp[i+1])?void 0:t.codec)?e.rtp[i+1].payload:0,rtcpFb:((null==e?void 0:e.rtcpFb)||[]).filter((t=>t.payload===e.rtp[i].payload)).map((({type:e,subtype:t})=>({id:e,params:t?[t]:[]})))})}return n}var qb=(e,t)=>du(void 0,null,(function*(){var n;let i=sb(e),r={ice:{ufrag:"",password:""},dtls:{hash:"",fingerprint:"",setup:""},audio:{codecs:[],extensions:[]},video:{codecs:[],decoders:[],extensions:[]},useDataChannel:!1};r.ice.ufrag=String(i.media[0].iceUfrag),r.ice.password=i.media[0].icePwd||"",i.fingerprint&&(r.dtls.hash=i.fingerprint.type,r.dtls.fingerprint=i.fingerprint.hash,r.dtls.setup=i.setup||""),i.media[0].fingerprint&&(r.dtls.hash=i.media[0].fingerprint.type,r.dtls.fingerprint=i.media[0].fingerprint.hash),r.dtls.setup=i.media[0].setup||"";let o=i.media[0],a=i.media[1];o.ext&&(r.audio.extensions=o.ext.map((e=>({id:e.value,uri:e.uri})))),a.ext&&(r.video.extensions=a.ext.map((e=>({id:e.value,uri:e.uri}))));let s={codec:o.rtp[0].codec,fmtp:o.fmtp[0].config,payload:o.fmtp[0].payload,rate:o.rtp[0].rate,channel:o.rtp[0].encoding,rtcpFb:[],rtx:0};null==(n=o.rtcpFb)||n.forEach((({payload:e,type:t,subtype:n})=>{if(e===s.payload){let e={id:t,params:[]};n&&e.params.push(n),s.rtcpFb.push(e)}})),r.audio.codecs.push(s);let l=["h264","vp8"];return t&&l.shift(),r.video.codecs=[...Wb(a)].filter((e=>l.includes(e.codec.toLocaleLowerCase()))),r.video.decoders=(yield function(){return du(this,null,(function*(){let e=new RTCPeerConnection;e.addTransceiver(ld.VIDEO,{direction:ld.TRANSCEIVER_DIRECTION_RECVONLY});let t=yield e.createOffer();if(!t.sdp)return[];let n=Wb(sb(t.sdp).media[0]);return e.close(),n}))}()).filter((e=>["h264","vp8"].includes(e.codec.toLocaleLowerCase()))),r})),Xb=({serverAbility:e,clientAbility:t,offerSDP:n,enableCustomMessage:i})=>{let r=sb(n),o={extmapAllowMixed:"extmap-allow-mixed",groups:r.groups,icelite:"ice-lite",media:[],msidSemantic:{semantic:"",token:"WMS"},name:"-",origin:{address:"127.0.0.1",username:"-",sessionId:String(Date.now()),sessionVersion:1,netType:"IN",ipVer:4},timing:{start:0,stop:0},version:0},a={candidates:e.candidates.map((e=>({component:1,foundation:"1",generation:0,ip:e.ip,port:e.port,priority:e.priority,transport:e.foundation,type:e.type}))),connection:{version:4,ip:"0.0.0.0"},direction:ld.TRANSCEIVER_DIRECTION_RECVONLY,ext:e.audio.extensions.map((e=>({value:e.id,uri:e.uri}))),fingerprint:{type:e.dtls.hash,hash:e.dtls.fingerprint},fmtp:[{payload:e.audio.codecs[0].payload,config:e.audio.codecs[0].fmtp}],icePwd:e.ice.password,iceUfrag:e.ice.ufrag,mid:"0",payloads:String(e.audio.codecs[0].payload),port:r.media[0].port,protocol:r.media[0].protocol,type:ld.AUDIO,setup:e.dtls.setup,rtcpFb:e.audio.codecs[0].rtcpfb.map((t=>({payload:e.audio.codecs[0].payload,type:t.id,subtype:t.params[0]}))),rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",rtp:[{payload:e.audio.codecs[0].payload,codec:e.audio.codecs[0].codec,rate:e.audio.codecs[0].rate,encoding:e.audio.codecs[0].channels}]};return o.media.push(a),[1,2,3].forEach((n=>{o.media.push(Yb({mid:n,serverAbility:e,clientAbility:t,parsedOffer:r}))})),i&&o.media.push(r.media.find((e=>"dc"===e.mid))),lb(o)},Yb=({mid:e,serverAbility:t,clientAbility:n,parsedOffer:i,isDownlink:r=!1})=>{let o={candidates:t.candidates.map((e=>({component:1,foundation:"1",generation:0,ip:e.ip,port:e.port,priority:e.priority,transport:e.foundation,type:e.type}))),connection:{version:4,ip:"0.0.0.0"},direction:ld.TRANSCEIVER_DIRECTION_RECVONLY,ext:t.video.extensions.map((e=>({value:e.id,uri:e.uri}))),fingerprint:{type:t.dtls.hash,hash:t.dtls.fingerprint},fmtp:[],icePwd:t.ice.password,iceUfrag:t.ice.ufrag,mid:String(e),payloads:"",port:i.media[0].port,protocol:i.media[0].protocol,type:ld.VIDEO,setup:t.dtls.setup,rtcpFb:[],rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",rtp:[]};if(r)(t.video.decoders||t.video.codecs).forEach((e=>{Jb(o,e)}));else{let e=t.video.codecs.findIndex((e=>e.codec.toLowerCase()===(t.useVp8?"vp8":"h264"))),i=t.video.codecs[e]||n.video.codecs[0];Jb(o,i)}return o},Jb=(e,t)=>{e.payloads=`${e.payloads} ${t.payload}`.trim(),e.fmtp.push({payload:t.payload,config:t.fmtp}),e.rtcpFb=[...e.rtcpFb||[],...(t.rtcpfb||t.rtcpFb).map((e=>({payload:t.payload,type:e.id,subtype:e.params[0]})))],e.rtp.push({payload:t.payload,codec:t.codec.toUpperCase(),rate:t.rate}),t.rtx&&(e.payloads=`${e.payloads} ${t.rtx}`,e.fmtp.push({payload:t.rtx,config:`apt=${t.payload}`}),e.rtp.push({payload:t.rtx,codec:"rtx",rate:t.rate}))},Kb=(e,t,n)=>{let i=$b.default.parse(e);return i.media.forEach(((e,r)=>{var o;(e.type===ld.AUDIO||e.type===ld.VIDEO)&&(function(e){if(!e.rtcpFb)return;let t=[];e.rtcpFb.forEach(((n,i)=>{var r;t.push(n),e.rtcpFb&&(null==(r=e.rtcpFb[i+1])?void 0:r.payload)!==n.payload&&"rrtr"!==n.type&&t.push({payload:n.payload,type:"rrtr"})})),e.rtcpFb=t}(e),function(e){e.type===ld.VIDEO&&e.fmtp&&e.fmtp.forEach((e=>{e.config.includes("apt")||(e.config+=";sps-pps-idr-in-keyframe=1")}))}(e),function(e){e.type===ld.AUDIO&&e.fmtp&&e.fmtp.forEach((e=>{e.config+=";sprop-stereo=1;stereo=1"}))}(e),function(e){let t=new Set(["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"]);e.ext&&(e.ext=e.ext.filter((e=>!t.has(e.uri))))}(e),e.type===ld.VIDEO&&(r<4?(e.payloads="",e.fmtp=[],e.rtp=[],e.rtcpFb=[],t.video.codecs.forEach((t=>Jb(e,t)))):n&&(e.payloads="",e.fmtp=[],e.rtp=[],e.rtcpFb=[],(n.video.decoders||n.video.codecs).forEach((t=>Jb(e,t)))))),(null==(o=e.payloads)?void 0:o.includes("datachannel"))&&i.groups&&e.mid&&(i.groups[0].mids=i.groups[0].mids.replace(e.mid,"dc"),e.mid="dc")})),$b.default.write(i)},Qb=su(hu()),Zb=class extends Qb.EventEmitter{constructor(e){super(),this.room=e,cu(this,"mainFpsHealth",1),cu(this,"mainBitrateHealth",1),cu(this,"badMainBitrateHealthCount",0),cu(this,"lastEmitBadHealthTime",0),cu(this,"log"),!Rh&&Ip&&af.on("262",this.onVideoCodecChanged,this),this.log=e.getLogger().createChild({id:"h-d"})}onVideoCodecChanged({remoteUserId:e,streamType:t,isHWCodec:n,codec:i}){if(!e&&7!==t&&"h264"===i){if(!n)return void this.room.off("heartbeat-report",this.onHeartbeatReport,this);this.room.listeners("heartbeat-report").includes(this.onHeartbeatReport)||this.room.on("heartbeat-report",this.onHeartbeatReport,this)}}onHeartbeatReport(e){Date.now()-this.lastEmitBadHealthTime<3e4||(e.msg_up_stream_info.msg_video_status.forEach((e=>{if(e.uint32_video_enc_fps&&e.uint32_video_capture_fps){let t=e.uint32_video_enc_fps/e.uint32_video_capture_fps;2===e.uint32_video_stream_type&&(this.mainFpsHealth=t)}if(e.uint32_video_codec_bitrate&&2===e.uint32_video_stream_type){let{localMainVideoTrack:t}=this.room;t&&(this.mainBitrateHealth=e.uint32_video_codec_bitrate/1e3/t.profile.bitrate)}})),this.log.debug(`mainBitrateHealth: ${this.mainBitrateHealth} mainFpsHealth: ${this.mainFpsHealth}`),this.mainBitrateHealth>.5&&(this.badMainBitrateHealthCount=0),this.mainFpsHealth>.9&&this.mainBitrateHealth<.5&&(this.badMainBitrateHealthCount++,this.badMainBitrateHealthCount>3&&(this.badMainBitrateHealthCount=0,this.lastEmitBadHealthTime=Date.now(),this.log.warn(`bad main bitrate health: ${this.mainBitrateHealth}`),this.emit("1",{isAux:!1}))))}destroy(){af.off("262",this.onVideoCodecChanged,this),this.room.off("heartbeat-report",this.onHeartbeatReport,this)}};cu(Zb,"EVENT_BAD_HEALTH","bad_health");var eS,tS=Zb,nS=((eS=nS||{}).TRACK="track",eS.DATA_CHANNEL_MESSAGE="data_channel_msg",eS[eS.CONNECTION_STATE_CHANGED="connection-state-changed"]="CONNECTION_STATE_CHANGED",eS[eS.FIREWALL_RESTRICTION="firewall-restriction"]="FIREWALL_RESTRICTION",eS.RECONNECTED="spc-reconnected",eS.RECONNECT_FAILED="spc-reconnect-failed",eS.ERROR="error",eS.SEI_MESSAGE="sei-message",eS),iS=0,rS=!1,oS=new Set,aS=1,sS=class extends Gb.default{constructor({signalChannel:e,room:t,enableCustomMessage:n}){super(),cu(this,"stat",{iceStartTime:0,iceEndTime:0,dtlsStartTime:0,dtlsEndTime:0,peerConnectionStartTime:0,peerConnectionEndTime:0}),cu(this,"currentState","DISCONNECTED"),cu(this,"_room"),cu(this,"_signalChannel"),cu(this,"_peerConnection",null),cu(this,"_datachannel",null),cu(this,"_enableCustomMessage"),cu(this,"_log"),cu(this,"_downlinkMIDMap",new Map),cu(this,"_downlinkMIDUserIDMap",new Map),cu(this,"_reconnectionTimer",-1),cu(this,"reconnectionCount",0),cu(this,"clientAbility"),cu(this,"_serverAbility",null),cu(this,"addDownlinkQueue",new Set),cu(this,"removeDownlinkQueue",new Set),cu(this,"_parsedAnswer",null),cu(this,"_updateSDPPromise",null),cu(this,"_waitForPCConnectedPromise"),cu(this,"_waitForPCConnectedPromiseReject",null),cu(this,"_isSDPLogged",!1),cu(this,"abortMap",new Map),cu(this,"enableInsertableStreams",!1),this._room=t,this._enableCustomMessage=n,this._signalChannel=e,this._log=wm.createLogger({id:"spc"+aS++,userId:this._room.userId,sdkAppId:this._room.sdkAppId}),this._room.enableSEI&&ug&&(this.enableInsertableStreams=!0),this._room.healthDetector.on("1",(({isAux:e})=>{this.useHWEncoder(!1,e?7:2)}))}get isH264EncodeSupported(){let e=this._room.checkSystemResult.detail.isH264EncodeSupported;return this._serverAbility&&(e=e&&!!this._serverAbility.video.codecs.find((e=>"h264"===e.codec.toLowerCase()))),e}addAbortController(e,t){var n;null==(n=this.abortMap.get(e))||n.abort("destory"),this.abortMap.set(e,t)}get isVP8EncodeSupported(){let e=this._room.checkSystemResult.detail.isVp8EncodeSupported;return this._serverAbility&&(e=e&&this._serverAbility.useVp8),e}get videoCodec(){var e;return null!=(e=this._serverAbility)&&e.useVp8?"vp8":"h264"}get downlinkVideoCodec(){var e;return null!=(e=this._serverAbility)&&e.video.decoders.find((e=>"h264"===e.codec.toLowerCase()))?"h264":"vp8"}get isUsingH264(){return"h264"===this.videoCodec}get is42001fSupported(){return!!this.clientAbility&&!!this.clientAbility.video.codecs.find((e=>e.fmtp.includes("42001f")))}get uplinkSSRC(){return this._peerConnection&&this._peerConnection.localDescription?(e=>{let t=sb(e),n={audioSsrc:0,audioRtxSsrc:0,bigVideoSsrc:0,bigVideoRtxSsrc:0,smallVideoSsrc:0,smallVideoRtxSsrc:0,auxVideoSsrc:0,auxVideoRtxSsrc:0};return t.media.forEach(((e,t)=>{var i;if(e.ssrcs&&!Ff(e.ssrcs[0].id)){let r=Number(e.ssrcs[0].id),o=Number(null==(i=e.ssrcs.filter((e=>"cname"===e.attribute))[1])?void 0:i.id);switch(t){case 0:n.audioSsrc=r;break;case 1:n.bigVideoSsrc=r,n.bigVideoRtxSsrc=o;break;case 2:n.smallVideoSsrc=r,n.smallVideoRtxSsrc=o;break;case 3:n.auxVideoSsrc=r,n.auxVideoRtxSsrc=o}}})),n})(this._peerConnection.localDescription.sdp):{audioSsrc:0,audioRtxSsrc:0,bigVideoSsrc:0,bigVideoRtxSsrc:0,smallVideoSsrc:0,smallVideoRtxSsrc:0,auxVideoSsrc:0,auxVideoRtxSsrc:0}}get isReconnecting(){return"RECONNECTING"===this.currentState||this._reconnectionTimer>0||this.reconnectionCount>0}get dtlsTransport(){if(!this._peerConnection)return null;let e=this._peerConnection.getSenders();return 0===e.length?null:e[0].transport}initialize(){return du(this,null,(function*(){var e;let t;try{this._peerConnection=new RTCPeerConnection({encodedInsertableStreams:this.enableInsertableStreams,offerExtmapAllowMixed:!0,iceServers:this._room.getIceServers(),iceTransportPolicy:this._room.getIceTransportPolicy(),sdpSemantics:this._room.sdpSemantics,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"}),this._peerConnection.oniceconnectionstatechange=()=>{if(!this._peerConnection)return;let e=this._peerConnection.iceConnectionState;this._log.debug(`ice state: ${e}`),"checking"===e&&0===this.stat.iceStartTime?this.stat.iceStartTime=Date.now():"connected"===e&&0===this.stat.iceEndTime&&(this.stat.iceEndTime=Date.now())},this._peerConnection.onconnectionstatechange=this.onConnectionStateChange.bind(this),this._peerConnection.ontrack=e=>this.emit("track",e),this._enableCustomMessage&&(this._datachannel=this._peerConnection.createDataChannel(`${this._room.userId}dc`),this._datachannel.binaryType="arraybuffer",this._datachannel.onopen=()=>{this._log.info("datachannel open")},this._datachannel.onclose=()=>{this._log.warn("datachannel close")},this._datachannel.onmessage=e=>{let t=new cS(e.data);this.emit("data_channel_msg",{data:t})},this._datachannel.onerror=e=>{this._log.warn("datachannel error",e)}),this._peerConnection.addTransceiver(ld.AUDIO,{direction:ld.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(ld.VIDEO,{direction:ld.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(ld.VIDEO,{direction:ld.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(ld.VIDEO,{direction:ld.TRANSCEIVER_DIRECTION_SENDONLY}),t=yield this._peerConnection.createOffer();let n=!this.isH264EncodeSupported;return Ff(null==(e=this._room.scheduleResult.config)?void 0:e.remove264FromSDP)||(n=n&&this._room.scheduleResult.config.remove264FromSDP),this.clientAbility=yield qb(t.sdp,n),yield this.setOffer(t),this.dtlsTransport&&(this.dtlsTransport.onstatechange=()=>{let{dtlsTransport:e}=this;!e||(this._log.debug(`dtls state: ${e.state}`),"connecting"===e.state&&0===this.stat.dtlsStartTime?this.stat.dtlsStartTime=Date.now():"connected"===e.state&&0===this.stat.dtlsEndTime&&(this.stat.dtlsEndTime=Date.now()))}),Kg.addSuccessEvent({key:521707}),this.clientAbility}catch(e){throw Kg.addFailedEvent({key:521707,error:e}),this._log.error(`initialize failed ${e} \noffer: ${null==t?void 0:t.sdp}`),e}}))}connect(e,t=!1){return du(this,null,(function*(){try{if("CONNECTED"===this.currentState)return;let n=Qf(),i={type:"answer",sdp:Xb({serverAbility:e,clientAbility:this.clientAbility,offerSDP:this._peerConnection.localDescription.sdp,enableCustomMessage:this._enableCustomMessage})};this._serverAbility=e,yield this.setAnswer(i),yield this.waitForPeerConnectionConnected(),t||Kg.addSuccessEvent({key:521703,cost:Qf()-n})}catch(t){let n=t instanceof Au&&t.code===Tu.API_CALL_ABORTED;throw n||this._log.error(`connect failed: ${t}`,e),this.reset(),!n&&!this.isReconnecting&&(Kg.addFailedEvent({key:521703,error:t}),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection()),t}}))}reconnect(){return du(this,null,(function*(){if(-1===this._reconnectionTimer){if(!this._signalChannel.isConnected)return this._log.warn("reconnect() wait signal channel is connected"),void this._signalChannel.once(zE,this.reconnect,this);try{this.reconnectionCount++,this._log.warn(`reconnect() trying [${this.reconnectionCount}]`),this.reset();let e=yield this.initialize(),t=yield this._signalChannel.sendWaitForResponse({command:"rebuild_pc",responseCommand:$E.REBUILD_PEER_CONNECTION_RES,data:{ability:e},enableLog:!1});if(0!==t.data.code)throw new Au({code:t.data.code,message:t.data.message});yield this.connect(t.data.data.ability,!0),Kg.addSuccessEvent({key:521704}),this._log.warn("reconnect() success"),this.stopReconnection(),af.emit(xm.SPC_RECONNECTED,{room:this._room}),this.emit("spc-reconnected")}catch(e){if(!this.isReconnecting)return;if(null!=e&&e.message.includes("timeout")){let e=Lf(this.reconnectionCount);this._log.warn(`reconnect() timeout, try again after ${e/1e3}s`),this._reconnectionTimer=window.setTimeout((()=>{this.clearReconnectionTimer(),this.reconnect()}),e)}else this._log.error(`reconnect() failed ${null==e?void 0:e.code} ${e}`),Kg.addFailedEvent({key:521704,error:e}),this.reconnectionCount>=Dd()&&this._log.warn(`SDK has tried reconnect for ${Dd()} times, but all failed, please check your network`),this.stopReconnection(),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.emit("error")}}else this._log.warn("reconnect() is reconnecting, ignore current reconnection")}))}getPeerConnection(){return this._peerConnection}startReconnection(){return du(this,null,(function*(){this._log.warn("start reconnect"),this._updateSDPPromise=null,this.emitConnectionStateChangedEvent("RECONNECTING"),yield this.reconnect()}))}stopReconnection(){this.isReconnecting&&(this._log.info("stop reconnect"),this.reconnectionCount=0,this.clearReconnectionTimer(),this._signalChannel.off(zE,this.reconnect,this))}checkPeerConnectionToReconnect(){var e;!this.isReconnecting&&(null==(e=this._peerConnection)?void 0:e.connectionState)===Md.CLOSED&&this.startReconnection()}clearReconnectionTimer(){-1!==this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}onConnectionStateChange(e){let t=this._peerConnection.iceConnectionState,n=this.getDTLSTransportState();this._log.info(`connectionState: ${e.target.connectionState} ICE: ${t} DTLS: ${n}`),e.target.connectionState===Md.CONNECTING&&(0===this.stat.peerConnectionStartTime&&(this.stat.peerConnectionStartTime=Date.now()),this.emitConnectionStateChangedEvent("CONNECTING")),(e.target.connectionState===Md.FAILED||e.target.connectionState===Md.CLOSED)&&(this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection()),(e.target.connectionState===Md.CONNECTED||e.target.connectionState===Md.COMPLETED)&&(0===this.stat.peerConnectionEndTime&&(this.stat.peerConnectionEndTime=Date.now()),af.emit(xm.SINGLE_CONNECTION_STAT,{room:this._room,stat:{ice:this.stat.iceEndTime-this.stat.iceStartTime,dtls:this.stat.dtlsEndTime-this.stat.dtlsStartTime,peerConnection:this.stat.peerConnectionEndTime-this.stat.peerConnectionStartTime}}),this.logSelectedCandidate(),this.emitConnectionStateChangedEvent("CONNECTED"))}getDTLSTransportState(){if(!this._peerConnection)return Cd;let e=null;return tg()&&0!==this._peerConnection.getSenders().length?(e=this._peerConnection.getSenders()[0].transport,eg()&&0!==this._peerConnection.getReceivers().length&&e?e.state:Cd):Cd}emitConnectionStateChangedEvent(e){e!==this.currentState&&("RECONNECTING"===this.currentState&&"CONNECTING"===e||(this.emit(nS.CONNECTION_STATE_CHANGED,{prevState:this.currentState,state:e}),this.currentState=e))}logSelectedCandidate(){return du(this,null,(function*(){if(!this._peerConnection)return;let e=yield this._peerConnection.getStats();for(let[t,n]of e)if(qm(n)){let t=e.get(n.localCandidateId),i=e.get(n.remoteCandidateId);t&&(this._log.info(`local candidate: ${t.candidateType} ${t.protocol}:${t.ip||t.address}:${t.port} ${t.networkType||""} ${"relay"===t.candidateType?`relayProtocol:${t.relayProtocol}`:""}`),t.networkType&&Af(t.networkType)),i&&this._log.info(`remote candidate: ${i.candidateType} ${i.protocol}:${i.ip||i.address}:${i.port}`);break}}))}waitForPeerConnectionConnected(){return this._waitForPCConnectedPromise||(this._waitForPCConnectedPromise=new Promise(((e,t)=>{if("CONNECTED"===this.currentState)return e();this._waitForPCConnectedPromiseReject=t;let n=t=>{"CONNECTED"===t.state&&(clearTimeout(o),r(),e())},i=({room:e})=>{e===this._room&&(clearTimeout(o),r(),t(new Au({code:Tu.API_CALL_ABORTED,message:nf({key:fh.CONNECTION_ABORTED,data:"leave room"})})))},r=()=>{af.off(xm.LEAVE_SUCCESS,i,this),this.off(nS.CONNECTION_STATE_CHANGED,n,this)},o=setTimeout((()=>{r();let e=new Au({code:Tu.API_CALL_TIMEOUT,message:"connection timeout"});var n;iS+=1,n=this._signalChannel.isConnected,iS>2&&!rS&&0===oS.size&&n&&(this._log.warn("firewall restriction"),rS=!0,this.emit(nS.FIREWALL_RESTRICTION)),t(e)}),Xd);af.on(xm.LEAVE_SUCCESS,i,this),this.on(nS.CONNECTION_STATE_CHANGED,n,this)})),this._waitForPCConnectedPromise=this._waitForPCConnectedPromise.finally((()=>{this._waitForPCConnectedPromise=null,this._waitForPCConnectedPromiseReject=null}))),this._waitForPCConnectedPromise}waitForReconnected(){return this.isReconnecting?new Promise(((e,t)=>{this.once("spc-reconnected",e),this.once("error",t)})):Promise.resolve()}addDownlink(e){return du(this,null,(function*(){if(this._log.info(`addDownlink(${e.userId}) trying`),this.isReconnecting&&(yield this.waitForReconnected()),this._updateSDPPromise&&(yield this._updateSDPPromise),this.updateLocalAndRemoteSDPConfig(e),0===this.addDownlinkQueue.size)try{yield this.updateSDP(),this._log.info(`addDownlink(${e.userId}) done`)}catch(t){this._log.error(`addDownlink(${e.userId}) failed ${t}`),yield this.startReconnection()}}))}updateLocalAndRemoteSDPConfig({ssrc:e,userId:t,tinyId:n}){if(!this._peerConnection)return;this._log.info(`updateLocalAndRemoteSDPConfig ${t} ${JSON.stringify(e)}`);let i=this._peerConnection.getTransceivers().filter((e=>"inactive"===e.direction)).slice(0,3).map((e=>(e.direction=ld.TRANSCEIVER_DIRECTION_RECVONLY,Number(e.mid))));this._parsedAnswer||(this._parsedAnswer=sb(this._peerConnection.remoteDescription.sdp));let r,o,a,s=this._parsedAnswer.media.filter((e=>{var t;return null==(t=e.ssrcs)?void 0:t.find((e=>{var t;return null==(t=e.value)?void 0:t.includes(n)}))}));if(3===s.length)r=s[0],o=s[1],a=s[2];else if(3===i.length)r=this._parsedAnswer.media.find((e=>Number(e.mid)===Number(i[0]))),o=this._parsedAnswer.media.find((e=>Number(e.mid)===Number(i[1]))),a=this._parsedAnswer.media.find((e=>Number(e.mid)===Number(i[2])));else if(0===i.length){this._peerConnection.addTransceiver(ld.AUDIO,{direction:ld.TRANSCEIVER_DIRECTION_RECVONLY}),this._peerConnection.addTransceiver(ld.VIDEO,{direction:ld.TRANSCEIVER_DIRECTION_RECVONLY}),this._peerConnection.addTransceiver(ld.VIDEO,{direction:ld.TRANSCEIVER_DIRECTION_RECVONLY}),r=JSON.parse(JSON.stringify(this._parsedAnswer.media[0]));let e=Yb({mid:1,serverAbility:this._serverAbility,clientAbility:this.clientAbility,parsedOffer:sb(this._peerConnection.localDescription.sdp),isDownlink:!0});o=JSON.parse(JSON.stringify(e)),a=JSON.parse(JSON.stringify(e)),r.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(r),o.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(o),a.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(a)}r.direction=ld.TRANSCEIVER_DIRECTION_SENDONLY;let l=`${n}-${e.audio}`;r.ssrcs=[{id:e.audio,attribute:"cname",value:`${l}`},{id:e.audio,attribute:"msid",value:`${l}-${ld.MAIN} ${l}-audio`}],o.direction=ld.TRANSCEIVER_DIRECTION_SENDONLY,o.ssrcs=[{id:e.video,attribute:"cname",value:`${l}`},{id:e.video,attribute:"msid",value:`${l}-${ld.MAIN} ${l}-bigvideo`},{id:e.videoRtx,attribute:"cname",value:`${l}`},{id:e.videoRtx,attribute:"msid",value:`${l}-${ld.MAIN} ${l}-bigvideo`}],o.ssrcGroups=[{semantics:"FID",ssrcs:`${e.video} ${e.videoRtx}`}],a.direction=ld.TRANSCEIVER_DIRECTION_SENDONLY;let c=`${l}-aux`;a.ssrcs=[{id:e.auxiliary,attribute:"cname",value:c},{id:e.auxiliary,attribute:"msid",value:`${c} ${l}-aux${ld.VIDEO}`},{id:e.auxiliaryRtx,attribute:"cname",value:`${c} ${l}-aux${ld.VIDEO}`},{id:e.auxiliaryRtx,attribute:"msid",value:`${c} ${l}-aux${ld.VIDEO}`}],a.ssrcGroups=[{semantics:"FID",ssrcs:`${e.auxiliary} ${e.auxiliaryRtx}`}],this._parsedAnswer.groups&&(this._parsedAnswer.groups[0].mids=this._parsedAnswer.media.map((e=>e.mid)).join(" ")),this._downlinkMIDMap.set(t,[r.mid,o.mid,a.mid]),this._downlinkMIDUserIDMap.set(r.mid,t),this._downlinkMIDUserIDMap.set(o.mid,t),this._downlinkMIDUserIDMap.set(a.mid,t)}removeDownlink(e){return du(this,null,(function*(){if(!this._downlinkMIDMap.has(e)||!this._peerConnection)return;this._log.info(`removeDownlink(${e}) trying`),this.isReconnecting&&(yield this.waitForReconnected()),this._updateSDPPromise&&(yield this._updateSDPPromise);let t=this._downlinkMIDMap.get(e),n=!1;this._peerConnection.getTransceivers().forEach((e=>{null!=t&&t.includes(Number(e.mid))&&(n=!0,e.direction="inactive")})),this._parsedAnswer||(this._parsedAnswer=sb(this._peerConnection.remoteDescription.sdp)),this._parsedAnswer.media.forEach((e=>{null!=t&&t.includes(Number(e.mid))&&(n=!0,e.direction="inactive",e.ssrcs=[],e.ssrcGroups=[])})),0===this.removeDownlinkQueue.size&&n&&(yield this.updateSDP()),this._downlinkMIDMap.delete(e),null==t||t.forEach((e=>this._downlinkMIDUserIDMap.delete(e))),this._log.info(`removeDownlink(${e}) done`)}))}setBandwidth(e){return du(this,null,(function*(){if(!this._peerConnection)return;let{audio:t,bigVideo:n,smallVideo:i,auxVideo:r}=e;try{if(sg()){let e=this._peerConnection.getSenders().slice(0,4);for(let o=0;o<e.length;o++){let a,s=e[o];0===o&&t?a=t:1===o&&n?a=n:2===o&&i?a=i:3===o&&r&&(a=r),a&&(yield this.setSenderMaxBitrate(s,a))}let o=!1;n&&e[1].track&&(o=this.setStartBitrate(1,n)),r&&e[3].track&&(o=this.setStartBitrate(3,r)||o),o&&(yield this.updateSDP())}else yield this.setBandwidthBySDP(e);this._log.info(`setBandwidth ${JSON.stringify(e)}`)}catch(e){this._log.error(`failed to set bandwidth: ${e}`)}}))}setStartBitrate(e,t){var n,i;return!(null==(n=this._peerConnection)||!n.remoteDescription||(this._parsedAnswer||(this._parsedAnswer=sb(this._peerConnection.remoteDescription.sdp)),null==(i=this._parsedAnswer.media[e])||!i.fmtp[0])||(this._parsedAnswer.media[e].fmtp[0].config+=`;x-google-start-bitrate=${t>5e3?5e3:t}`,0))}setSenderMaxBitrate(e,t){let n=e.getParameters();return(!n.encodings||0===n.encodings.length)&&(n.encodings=[{}]),"unlimited"===t?delete n.encodings[0].maxBitrate:n.encodings[0].maxBitrate=1e3*t,e.setParameters(n)}setBandwidthBySDP({audio:e,bigVideo:t,smallVideo:n,auxVideo:i}){if(!this._peerConnection||!this._peerConnection.localDescription)return;let r=sb(this._peerConnection.localDescription.sdp);this._parsedAnswer||(this._parsedAnswer=sb(this._peerConnection.remoteDescription.sdp));let o=Nh?"TIAS":"AS";e&&(r.media[0].bandwidth=[{type:o,limit:Nh?1e3*e:e}],this._parsedAnswer.media[0].bandwidth=[{type:o,limit:Nh?1e3*e:e}]),t&&(r.media[1].bandwidth=[{type:o,limit:Nh?1e3*t:t}],this._parsedAnswer.media[1].bandwidth=[{type:o,limit:Nh?1e3*t:t}]),n&&(r.media[2].bandwidth=[{type:o,limit:Nh?1e3*n:n}],this._parsedAnswer.media[2].bandwidth=[{type:o,limit:Nh?1e3*n:n}]),i&&(r.media[3].bandwidth=[{type:o,limit:Nh?1e3*i:i}],this._parsedAnswer.media[3].bandwidth=[{type:o,limit:Nh?1e3*i:i}]);let a={type:"offer",sdp:lb(r)};return this.updateSDP({localDescription:a})}setScaleResolutionDownBy(e,t){if(1===t)return;let n=e.getParameters();return(!n.encodings||0===n.encodings.length)&&(n.encodings=[{}]),n.encodings[0].scaleResolutionDownBy=t,e.setParameters(n)}updateSDP({localDescription:e}={}){if(!this._parsedAnswer)return Promise.resolve();let t=lb(this._parsedAnswer);return this._updateSDPPromise=new Promise(((n,i)=>du(this,null,(function*(){var r,o;try{!e&&this._peerConnection&&(this._log.info("creating offer"),e=yield this._peerConnection.createOffer()),e&&(yield this.setOffer(e)),yield this.setAnswer({type:"answer",sdp:t}),this._updateSDPPromise=null,n()}catch(n){this._log.error(n),!this._isSDPLogged&&this._peerConnection&&(this._log.warn(`current offer: ${this.filterSDPDirection(null==(r=this._peerConnection.localDescription)?void 0:r.sdp)} \nnext offer: ${this.filterSDPDirection(null==e?void 0:e.sdp)}`),this._log.warn(`current answer: ${this.filterSDPDirection(null==(o=this._peerConnection.remoteDescription)?void 0:o.sdp)} \nnext answer: ${this.filterSDPDirection(t)}`),this._log.warn(`offer: ${null==e?void 0:e.sdp}`),this._log.warn(`answer: ${t}`),this._log.warn(`transceivers: ${JSON.stringify(this._peerConnection.getTransceivers().map((({mid:e,currentDirection:t,direction:n,stopped:i})=>({mid:e,currentDirection:t,direction:n,stopped:i}))))}`),this._log.warn(`parsedAnswer: ${JSON.stringify(this._parsedAnswer)}`),this._isSDPLogged=!0),this._updateSDPPromise=null,i(n)}})))),this._updateSDPPromise}filterSDPDirection(e=""){return sb(e).media.map((e=>e.direction))}setOffer(e){return this._log.info("setting offer"),this._log.debug(e.sdp),this._peerConnection.setLocalDescription({type:"offer",sdp:Kb(e.sdp,this.clientAbility,this._serverAbility)})}setAnswer(e){return this._log.info("setting answer"),this._log.debug(e.sdp),this._peerConnection.setRemoteDescription(e)}useHWEncoder(e=!0,t){return du(this,null,(function*(){if(!this._peerConnection||!this._parsedAnswer||!this._serverAbility)return;let n=!1,i=[];Ff(t)?i=this._parsedAnswer.media.slice(1,4):2===t?i.push(this._parsedAnswer.media[1]):3===t?i.push(this._parsedAnswer.media[2]):7===t&&i.push(this._parsedAnswer.media[3]),i.forEach((t=>{var i;if(t.type===ld.VIDEO){let r;e&&this.is42001fSupported?r=this.clientAbility.video.codecs.find((e=>e.fmtp.includes("42001f"))):e||(r=this._serverAbility.video.codecs.find((e=>e.codec.toLowerCase()===(this._serverAbility.useVp8?"vp8":"h264")))),r&&(null==(i=t.payloads)||!i.includes(String(r.payload)))&&(t.fmtp=[],t.payloads="",t.rtp=[],t.rtcpFb=[],Jb(t,r),n=!0)}})),n&&(this._log.warn(`use ${e?"hw":"sw"} encoder`),yield this.setOffer(this._peerConnection.localDescription),yield this.setAnswer({type:"answer",sdp:lb(this._parsedAnswer)}))}))}sendDataChannelMessage(e){var t;null==(t=this._datachannel)||t.send(e)}reset(){var e;null==(e=this._peerConnection)||e.close(),this._waitForPCConnectedPromise=null,this._parsedAnswer=null}close(){this._log.info("close pc"),this.abortMap.forEach((e=>"function"==typeof e.abort&&e.abort("destroy"))),this.abortMap.clear(),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED"),this._downlinkMIDMap.clear(),this.stopReconnection(),this.removeAllListeners()}getReceiversByUserId(e){if(!this._peerConnection)return[];let t=this._peerConnection.getReceivers();return(this._downlinkMIDMap.get(e)||[]).map((e=>t[e]))}};lu([mv("reconnect")],sS.prototype,"startReconnection",1),lu([gv((e=>e.userId))],sS.prototype,"addDownlink",1),lu([gv((e=>e))],sS.prototype,"removeDownlink",1),lu([fv(!0)],sS.prototype,"updateSDP",1);var lS=class{constructor(e){cu(this,"tag"),cu(this,"len"),cu(this,"data");let t=new DataView(e);this.tag=t.getUint16(),this.len=t.getUint16(2),this.data=new Uint8Array(e).slice(4,4+this.len).buffer}},cS=class{constructor(e){cu(this,"tinyId"),cu(this,"data");let t=new DataView(e),n=0,i=[];for(;n<t.byteLength;){let r=t.getUint16(n+2),o=new lS(new Uint8Array(e).slice(n,n+2+2+r).buffer);i.push(o),n+=4+r}i.forEach((e=>{1===e.tag?this.tinyId=(new TextDecoder).decode(e.data):2===e.tag&&(this.data=e.data)}))}},uS=new Set;function dS(){let e=Math.floor(4294967296*Math.random());return uS.has(e)?dS():(uS.add(e),e)}var hS=su(hu()),pS=class extends hS.default{constructor(e){super(),cu(this,"userId"),cu(this,"tinyId"),cu(this,"_sdpSemantics"),cu(this,"_isUplink"),cu(this,"_room"),cu(this,"_log"),cu(this,"_currentState","DISCONNECTED"),cu(this,"_prevTime",-1),this.userId=e.userId,this.tinyId=e.tinyId,this._room=e.room,this._sdpSemantics=e.room.sdpSemantics,this._isUplink=e.isUplink,this._log=wm.createLogger({id:"n",userId:this._room.userId,remoteUserId:this._isUplink?void 0:this.userId,sdkAppId:this._room.sdkAppId,isLocal:this._isUplink})}get _peerConnection(){var e;return(null==(e=this.singlePC)?void 0:e.getPeerConnection())||null}get singlePC(){return this._room.singlePC}get _signalChannel(){return this._room.signalChannel}close(e){this._log.info("close connection"),this.emit("closed",e)}emitConnectionStateChangedEvent(e){return e!==this._currentState&&(af.emit(xm.PEER_CONNECTION_STATE_CHANGED,{room:this._room,prevState:this._currentState,state:e,remoteUserId:this._isUplink?void 0:this.userId}),this.emit("connection-state-changed",{prevState:this._currentState,state:e}),this._currentState=e,!0)}getPeerConnection(){return this._peerConnection}getRoom(){return this._room}getUserId(){return this.userId}getTinyId(){return this.tinyId}getCurrentState(){return this._currentState}get isH264(){var e,t;return!(null==(t=null==(e=this._peerConnection)?void 0:e.remoteDescription)||!t.sdp.includes("H264"))}},fS=class extends pS{constructor(e){super(ru(iu({},e),{isUplink:!0})),cu(this,"localMainAudioTrack",null),cu(this,"localMainVideoTrack",null),cu(this,"localAuxAudioTrack",null),cu(this,"localAuxVideoTrack",null),cu(this,"_isPublishingAux",!1),cu(this,"_publishingLocalAudioTrack"),cu(this,"_publishingLocalVideoTrack"),cu(this,"_mediaSettings",{videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0}),cu(this,"_flag",0),cu(this,"_checkPublishStateTimeoutId",-1),this.initialize()}get videoCodec(){var e;return(null==(e=this.singlePC)?void 0:e.videoCodec)||"h264"}get ssrc(){if(!this.singlePC)return{audio:0,video:0,videoRtx:0,small:0,smallRtx:0,auxiliary:0,auxiliaryRtx:0};let{audioSsrc:e,bigVideoSsrc:t,bigVideoRtxSsrc:n,smallVideoSsrc:i,smallVideoRtxSsrc:r,auxVideoSsrc:o,auxVideoRtxSsrc:a}=this.singlePC.uplinkSSRC;return{audio:e||0,video:t||0,videoRtx:n||0,small:i||0,smallRtx:r||0,auxiliary:o||0,auxiliaryRtx:a||0}}get flag(){return this._flag}set flag(e){this._flag!==e&&(this._flag=e,this.checkPublishState())}checkPublishState(e=!1){if(!e&&this._checkPublishStateTimeoutId>0)return;let{publishState:t,serverPublishState:n}=this,i=Object.keys(t).find((e=>t[e]!==n[e]));if(i){if(!e)return void(this._checkPublishStateTimeoutId=kg.run(ch,(()=>this.checkPublishState(!0)),{delay:1e4,count:1}));this._log.warn(`publish state not matched, ${i} local:${t[i]} server:${n[i]} ${Kp()} ${Xp()}`),Kg.addCount({key:521e3})}kg.clearTask(this._checkPublishStateTimeoutId),this._checkPublishStateTimeoutId=-1}get isMainStreamPublished(){return!(!this.localMainAudioTrack&&!this.localMainVideoTrack)}get isAuxStreamPublished(){return!(!this.localAuxVideoTrack&&!this.localAuxAudioTrack)}get publishState(){var e,t,n,i;let r={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this._peerConnection){let o=this._peerConnection.getSenders();o&&(ng()?(r.audio=!(null==(e=o[0])||!e.track),r.bigVideo=!(null==(t=o[1])||!t.track),r.smallVideo=!(null==(n=o[2])||!n.track),r.auxVideo=!(null==(i=o[3])||!i.track)):o.forEach((e=>{e.track&&(e.track.kind===ld.AUDIO?r.audio=!0:(r.bigVideo=!0,this._room.videoManager.hasSmall&&(r.smallVideo=!0)))})))}return r}get serverPublishState(){return{audio:!!(this.flag&md),bigVideo:!!(this.flag&hd),smallVideo:!!(this.flag&pd),auxVideo:!!(this.flag&fd)}}get muteState(){var e,t,n;return{audio:!(null==(e=this.localMainAudioTrack)||!e.muted),bigVideo:!(null==(t=this.localMainVideoTrack)||!t.muted),auxVideo:!(null==(n=this.localAuxVideoTrack)||!n.muted)}}initialize(){this.installEvents()}close(e){var t;let n=(null==(t=this._peerConnection)?void 0:t.getSenders())||[];for(let e of n)e.replaceTrack(null);super.close(e),this.uninstallTrackMuteEvents(this.localMainAudioTrack,this.localMainVideoTrack,this.localAuxVideoTrack),this.emitConnectionStateChangedEvent("DISCONNECTED")}installEvents(){var e,t;this.listeners("connection-state-changed").includes(this.handleConnectionStateChange)||this.on("connection-state-changed",this.handleConnectionStateChange,this),null!=(e=this.singlePC)&&e.listeners("spc-reconnected").includes(this.onSinglePCReconnected)||null==(t=this.singlePC)||t.on("spc-reconnected",this.onSinglePCReconnected,this)}uninstallEvents(){var e;this.off("connection-state-changed",this.handleConnectionStateChange,this),null==(e=this.singlePC)||e.off("spc-reconnected",this.onSinglePCReconnected,this)}emitConnectionStateChangedEvent(e,t){var n,i,r;let o=this._currentState,a=super.emitConnectionStateChangedEvent(e);return a&&o!==e&&(t?t.emit("connection-state-changed",{prevState:o,state:e}):(null==(n=this.localMainVideoTrack)||n.emit("connection-state-changed",{prevState:o,state:e}),null==(i=this.localAuxVideoTrack)||i.emit("connection-state-changed",{prevState:o,state:e}),null==(r=this._publishingLocalVideoTrack)||r.emit("connection-state-changed",{prevState:o,state:e}))),a}publish(e){return du(this,arguments,(function*({localAudioTrack:e,localVideoTrack:t,isAuxiliary:n}){var i,r,o,a,s,l,c;if(!this.singlePC)return;yield this.singlePC.waitForPeerConnectionConnected();let u,{publishState:d,muteState:h}=this;if(e&&(this._publishingLocalAudioTrack=e,d.audio=!0,h.audio=e.muted),t){if(!this.singlePC.isH264EncodeSupported&&!this.singlePC.isVP8EncodeSupported)throw new Au({code:Tu.NOT_SUPPORTED_H264,message:nf({key:fh.NOT_SUPPORTED_H264ENCODE})});Rh&&115===wp()&&t.profile.width*t.profile.height<=230400&&(this._log.warn("fallback video to 480p"),t.setProfile(ad["480p_2"]),yield t.applyProfile()),this._publishingLocalVideoTrack=t,n?(d.auxVideo=!0,h.auxVideo=t.muted):(d.bigVideo=!0,h.bigVideo=t.muted)}if(this._isPublishingAux=n,t&&!n&&t.small&&(u=this._room.videoManager.smallTrack,d.smallVideo=!0),yield this._signalChannel.sendWaitForResponseWithRetry({command:"publish/v2",responseCommand:$E.SPC_PUBLISH_RESULT,data:ru(iu({},this.singlePC.uplinkSSRC),{state:d,muteState:h}),retries:3}),yield this.publishByTransceiver({localAudioTrack:e,localVideoTrack:t,smallTrack:u,isAuxiliary:n}),this._publishingLocalAudioTrack=null,this._publishingLocalVideoTrack=null,this._isPublishingAux=!1,t){this[n?"localAuxVideoTrack":"localMainVideoTrack"]=t;let{scaleResolutionDownBy:e}=t;e>1&&(this._log.warn(`setScaleResolutionDownBy ${t.streamType} ${e}`),yield this.singlePC.setScaleResolutionDownBy(this._peerConnection.getSenders()[n?3:1],e))}e&&(this[n?"localAuxAudioTrack":"localMainAudioTrack"]=e),yield this.singlePC.setBandwidth({audio:(null==(i=this.localMainAudioTrack)?void 0:i.profile.bitrate)||(null==(r=this.localAuxAudioTrack)?void 0:r.profile.bitrate),bigVideo:null==(o=this.localMainVideoTrack)?void 0:o.profile.bitrate,smallVideo:null==(s=null==(a=this.localMainVideoTrack)?void 0:a.small)?void 0:s.bitrate,auxVideo:null==(l=this.localAuxVideoTrack)?void 0:l.profile.bitrate}),this.sendMediaSettings(),this.installTrackMuteEvents(e,t),!n&&(this._room.preferHW||(null==(c=this._room.scheduleResult.config)?void 0:c.preferHW))&&t&&t.profile.width*t.profile.height>=921600&&this.singlePC.useHWEncoder(!0,2)}))}publishByTransceiver({localAudioTrack:e,localVideoTrack:t,smallTrack:n,isAuxiliary:i}){if(!ig())return;this._log.info("publish by transceiver");let r=null==t?void 0:t.outMediaTrack,o=null==e?void 0:e.outMediaTrack,a=this._peerConnection.getTransceivers(),s=[],l=[],c=(e,t,n)=>{var i;let r=a[t].sender.replaceTrack(n);l.push(t),null!=(i=this.singlePC)&&i.enableInsertableStreams&&r.then((()=>this.createEncodedStreams(a[t].sender,e))),s.push(r)};o&&c(e.mediaType,0,o),r&&c(t.mediaType,i?3:1,r),n&&c(8,2,n);let u=this.setTransceiverDirection(cd.SENDONLY,l);return s.push(u),Promise.all(s)}getTrackByMediaType(e){switch(e){case 1:return this.localMainAudioTrack||this._publishingLocalAudioTrack;case 4:case 8:return this.localMainVideoTrack||this._publishingLocalVideoTrack;case 2:return this.localAuxVideoTrack||this._publishingLocalVideoTrack;default:throw new Error("mediaType error")}}createEncodedStreams(e,t){var n,i;if(this.singlePC.abortMap.has(e))return;let r=e.createEncodedStreams(),o=new AbortController;null==(n=this.singlePC)||n.addAbortController(e,o),(null!=(i=this.getTrackByMediaType(t))&&i.enableEncodeFrame?r.readable.pipeThrough(new TransformStream({transform:(e,n)=>{var i;return n.enqueue(null!=(i=this.singlePC)&&i.isUsingH264?this.getTrackByMediaType(t).encodeFrame(e,8===t):e)}}),o):r.readable).pipeTo(r.writable,o).catch((e=>{this._log.debug("encoded stream error",e),"destory"!==e&&this._log.warn(e)}))}enableSmall(e){return du(this,null,(function*(){if(!this.singlePC)return;let t=this._peerConnection.getTransceivers();e?this._room.videoManager.smallTrack&&(yield t[2].sender.replaceTrack(this._room.videoManager.smallTrack),yield this.setTransceiverDirection(cd.SENDONLY,[2])):(yield t[2].sender.replaceTrack(null),yield this.setTransceiverDirection(cd.INACTIVE,[2])),this.updateMediaSettings(),yield this.doPublishChange()}))}installTrackMuteEvents(...e){e.forEach((e=>{e&&(null==e||e.on("mute",this.sendMutedFlag,this),null==e||e.on("unmute",this.sendMutedFlag,this))}))}uninstallTrackMuteEvents(...e){e.forEach((e=>{e&&(null==e||e.off("mute",this.sendMutedFlag,this),null==e||e.off("unmute",this.sendMutedFlag,this))}))}unpublish(e){return du(this,arguments,(function*({localAudioTrack:e,localVideoTrack:t}){let n=t&&t===this.localAuxVideoTrack,i=null==t?void 0:t.outMediaTrack,r=this._peerConnection.getSenders(),o=[];e&&(yield r[0].replaceTrack(null),o.push(0),n?this.localAuxAudioTrack=null:this.localMainAudioTrack=null),i&&(n?(yield r[3].replaceTrack(null),this.localAuxVideoTrack=null,this._mediaSettings=ru(iu({},this._mediaSettings),{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),o.push(3)):(yield r[1].replaceTrack(null),yield r[2].replaceTrack(null),this.localMainVideoTrack=null,this._mediaSettings=ru(iu({},this._mediaSettings),{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),o.push(1,2))),this.isMainStreamPublished||this.isAuxStreamPublished?(yield this.setTransceiverDirection(cd.INACTIVE,o),yield this.doPublishChange(!1)):yield this.doUnpublish(),this.uninstallTrackMuteEvents(e,t),null==t||t.emit("connection-state-changed",{prevState:this._currentState,state:"DISCONNECTED"})}))}doPublishChange(e=!0){return du(this,null,(function*(){let t={state:this.publishState,constraintConfig:this._mediaSettings},n=yield this._signalChannel.sendWaitForResponseWithRetry({command:qE,data:t,responseCommand:$E.PUBLISH_STATE_CHANGE_RESULT,enableLog:e,retries:3});this.checkPublishResultCode(n.data.code,n.data.message)}))}doUnpublish(e=!1){return this._signalChannel.sendWaitForResponse({command:XE,commandDesc:"unpublish",responseCommand:$E.UNPUBLISH_RESULT,enableLog:e}).catch((e=>{if(e.getCode()===Tu.API_CALL_TIMEOUT)return Promise.resolve();throw e}))}updateMediaSettings(){let{detail:{isH264EncodeSupported:e,isVp8EncodeSupported:t}}=this._room.checkSystemResult;e?this._mediaSettings.videoCodec="H264":t&&(this._mediaSettings.videoCodec="VP8");let n=this._publishingLocalAudioTrack||this.localMainAudioTrack||this.localAuxAudioTrack,{localMainVideoTrack:i,localAuxVideoTrack:r}=this;if(this._publishingLocalVideoTrack&&(this._isPublishingAux?r=this._publishingLocalVideoTrack:i=this._publishingLocalVideoTrack),lg){if(n&&n.outMediaTrack){let e=n.outMediaTrack.getSettings();this._mediaSettings.audioChannel=e.channelCount||1,this._mediaSettings.audioBps=1e3*n.profile.bitrate,this._mediaSettings.audioFs=e.sampleRate||0}if(i&&i.outMediaTrack){let e=i.outMediaTrack.getSettings();this._mediaSettings.videoWidth=e.width||0,this._mediaSettings.videoHeight=e.height||0,this._mediaSettings.videoFps=e.frameRate||0,this._mediaSettings.videoBps=1e3*i.profile.bitrate,i.small&&(this._mediaSettings.smallVideoWidth=i.small.width,this._mediaSettings.smallVideoHeight=i.small.height,this._mediaSettings.smallVideoFps=i.small.frameRate,this._mediaSettings.smallVideoBps=1e3*i.small.bitrate)}if(r&&r.outMediaTrack){let e=r.outMediaTrack.getSettings();this._mediaSettings.auxVideoWidth=e.width||0,this._mediaSettings.auxVideoHeight=e.height||0,this._mediaSettings.auxVideoFps=e.frameRate||0,this._mediaSettings.auxVideoBps=1e3*r.profile.bitrate}}else n&&n.outMediaTrack&&(this._mediaSettings.audioChannel=n.profile.channelCount,this._mediaSettings.audioBps=1e3*n.profile.bitrate,this._mediaSettings.audioFs=n.profile.sampleRate),i&&i.outMediaTrack&&(this._mediaSettings.videoWidth=i.profile.width,this._mediaSettings.videoHeight=i.profile.height,this._mediaSettings.videoFps=i.profile.frameRate,this._mediaSettings.videoBps=1e3*i.profile.bitrate);this._log.info(`updateMediaSettings: ${JSON.stringify(this._mediaSettings)}`)}sendMediaSettings(){this.updateMediaSettings(),this._signalChannel.sendWaitForResponse({command:KE,data:this._mediaSettings,responseCommand:$E.UPDATE_CONSTRAINT_CONFIG_RES}).then((e=>{0!==e.data.code&&this._log.warn(e.data.message)})).catch((()=>{}))}addTrack(e){return du(this,null,(function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info(`is adding ${e.kind} track to current published local ${t?ld.AUXILIARY:ld.MAIN} stream`),ng()&&(yield this.addTrackByTransceiver(e,t))}))}addTrackByTransceiver(e,t){return du(this,null,(function*(){var n;if(!e.mediaTrack)return;let i=this._peerConnection.getTransceivers();if(e.kind===ld.AUDIO)yield i[0].sender.replaceTrack(e.outMediaTrack);else{let r=t?3:1;yield i[r].sender.replaceTrack(e.outMediaTrack),1===r&&(null==(n=this.localMainVideoTrack)?void 0:n.small)&&(yield i[2].sender.replaceTrack(this._room.videoManager.smallTrack)),i[r].direction===cd.INACTIVE&&(yield this.setTransceiverDirection(cd.SENDONLY,[r]))}this.updateMediaSettings(),yield this.doPublishChange()}))}removeTrack(e){return du(this,null,(function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info(`is removing ${e.kind} track from current published local ${t?ld.AUXILIARY:ld.MAIN} stream`),ng()&&(yield this.removeTrackByTransceiver(e,t))}))}removeTrackByTransceiver(e,t){return du(this,null,(function*(){if(!e.mediaTrack)return;let n=this._peerConnection.getTransceivers();if(e.kind===ld.AUDIO)yield n[0].sender.replaceTrack(null);else{let e=t?3:1;yield n[e].sender.replaceTrack(null),1===e&&this._room.videoManager.hasSmall&&(yield n[2].sender.replaceTrack(null)),yield this.setTransceiverDirection(cd.INACTIVE,[e])}this.updateMediaSettings(),yield this.doPublishChange()}))}setTransceiverDirection(e,t){return du(this,null,(function*(){if(!Nh)return;let n=!1,i=!1;this._log.info(`setting transceiver ${t.join(",")} direction to ${e}`);let r=this._peerConnection.getTransceivers();if(t.forEach((t=>{r[t].direction!==e&&(r[t].direction=e,n=!0)})),n){this._log.info("updating offer");let e=yield this._peerConnection.createOffer();yield this._peerConnection.setLocalDescription(e)}let o=-1,a=this._peerConnection.remoteDescription.sdp.split("\r\n").map((n=>{if(n.match(new RegExp(`a=(${cd.INACTIVE}|${cd.RECVONLY}|${cd.SENDONLY})`))&&o++,t.includes(o)){if(e===cd.INACTIVE&&n.includes(`a=${cd.RECVONLY}`))return i=!0,`a=${e}`;if(e===cd.SENDONLY&&n.includes(`a=${cd.INACTIVE}`))return i=!0,`a=${cd.RECVONLY}`}return n})).join("\r\n");i&&(this._log.info("updating answer"),yield this._peerConnection.setRemoteDescription({type:"answer",sdp:a}))}))}replaceTrack(e){return du(this,null,(function*(){var t;let n=null==(t=this._peerConnection)?void 0:t.getSenders(),i=e.outMediaTrack||e.mediaTrack;if(!n||0===n.length||!i||n.find((e=>e.track===i)))return!1;let r=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;return this._log.info(`is replacing ${i.kind} track ${i.id} on ${r?ld.AUXILIARY:ld.MAIN} stream`),i.kind===ld.AUDIO&&n[0]&&(yield n[0].replaceTrack(i)),i.kind===ld.VIDEO&&(!r&&n[1]&&(yield n[1].replaceTrack(i)),r&&n[3]&&(yield n[3].replaceTrack(i))),!0}))}setBandwidth(e){return du(this,arguments,(function*({bandwidth:e,type:t,videoType:n}){if(this.singlePC){let i={};t===ld.AUDIO?i.audio=e:"big"===n?i.bigVideo=e:"small"===n?i.smallVideo=e:i.auxVideo=e,yield this.singlePC.setBandwidth(i)}}))}sendMutedFlag(e){e===this.localAuxAudioTrack||e===this.localAuxVideoTrack||(this._log.info(`send muted state: ${JSON.stringify(this.muteState)}`),this._signalChannel.sendWaitForResponseWithRetry({command:WE,responseCommand:$E.MUTE_RESULT,data:this.muteState,retries:3}).catch((()=>{})))}handleConnectionStateChange(e){"CONNECTED"===e.state&&(this.localMainVideoTrack||this._publishingLocalVideoTrack&&!this._isPublishingAux)&&af.emit(xm.SEND_FIRST_VIDEO_FRAME,{room:this._room})}getVideoTrackId(e=ld.VIDEO){if(this._peerConnection){let t=this._peerConnection.getSenders();if(e===ld.AUXILIARY&&t[3]&&t[3].track)return t[3].track.id;if(e===ld.VIDEO&&t[1]&&t[1].track)return t[1].track.id}if(this.localMainVideoTrack&&e===ld.VIDEO){let e=this.localMainVideoTrack.mediaTrack;if(e)return e.id}if(this.localAuxVideoTrack&&e===ld.AUXILIARY){let e=this.localAuxVideoTrack.mediaTrack;if(e)return e.id}return""}getSSRC(){return this.ssrc}checkPublishResultCode(e,t){if(0!==e)throw e===zd?(this._log.error(mh.NOT_SUPPORTED_H264ENCODE),new Au({code:Tu.NOT_SUPPORTED_H264,message:nf({key:fh.NOT_SUPPORTED_H264ENCODE})})):new Au({code:Tu.UNKNOWN,message:nf({key:fh.SIGNAL_RESPONSE_FAILED,data:{signalResponse:$E.PUBLISH_RESULT,code:e,message:t}})})}onSinglePCReconnected(){return du(this,null,(function*(){this.isMainStreamPublished&&(this._log.warn("republish main stream"),yield this.publish({localAudioTrack:this.localMainAudioTrack,localVideoTrack:this.localMainVideoTrack,isAuxiliary:!1})),this.isAuxStreamPublished&&(this._log.warn("republish aux stream"),yield this.publish({localAudioTrack:this.localAuxAudioTrack,localVideoTrack:this.localAuxVideoTrack,isAuxiliary:!0}))}))}};function mS(e){return Object.keys(e).filter((t=>e[t]))}var gS=class extends pS{constructor(e){super(ru(iu({},e),{isUplink:!1})),cu(this,"_flag",0),cu(this,"role","anchor"),cu(this,"remoteAudioTrack"),cu(this,"remoteVideoTrack"),cu(this,"remoteAuxiliaryTrack"),cu(this,"ssrc",{audio:0,video:0,videoRtx:0,auxiliary:0,auxiliaryRtx:0}),this.flag=e.flag,this.remoteAudioTrack=new kv(this._room,this),this.remoteVideoTrack=new qv(this._room,this),this.remoteAuxiliaryTrack=new Xv(this._room,this),this.initialize()}get videoCodec(){var e;return(null==(e=this.singlePC)?void 0:e.downlinkVideoCodec)||"h264"}get subscribeState(){return{audio:this.remoteAudioTrack.isSubscribed||this.remoteAudioTrack.isSubscribing,video:this.remoteVideoTrack.isBig&&(this.remoteVideoTrack.isSubscribed||this.remoteVideoTrack.isSubscribing),smallVideo:this.remoteVideoTrack.isSmall&&(this.remoteVideoTrack.isSubscribed||this.remoteVideoTrack.isSubscribing),auxiliary:this.remoteAuxiliaryTrack.isSubscribed||this.remoteAuxiliaryTrack.isSubscribing}}get muteState(){return rm(this.flag,this.userId)}get flag(){return this._flag}set flag(e){var t,n,i;e!==this._flag&&(this._flag=e,null==(t=this.remoteAudioTrack)||t.onFlagChanged(),null==(n=this.remoteVideoTrack)||n.onFlagChanged(),null==(i=this.remoteAuxiliaryTrack)||i.onFlagChanged())}get hasMainStream(){return this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall}get hasAuxStream(){return this.muteState.hasAuxiliary}get isMainStreamSubscribed(){return(this.subscribeState.audio||this.subscribeState.video||this.subscribeState.smallVideo)&&(this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall)}get isAuxStreamSubscribed(){return this.subscribeState.auxiliary&&this.muteState.hasAuxiliary}get isSmallStreamSubscribed(){return this.subscribeState.smallVideo&&this.muteState.hasSmall}get isBigStreamSubscribed(){return this.subscribeState.video&&this.muteState.hasVideo}isStreamUnpublished(e){return e===ld.MAIN?!this.muteState.hasAudio&&!this.muteState.hasVideo:!this.muteState.hasAuxiliary}initialize(){this.installEvents()}close(e){super.close(e),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.remoteAudioTrack.close(),this.remoteVideoTrack.close(),this.remoteAuxiliaryTrack.close(),this.uninstallEvents(),this.removeDownlink()}installEvents(){!this.singlePC||(this.listeners("track").includes(this.onTrack)||this.singlePC.on("track",this.onTrack,this),this.listeners("spc-reconnected").includes(this.onSinglePCReconnected)||this.singlePC.on("spc-reconnected",this.onSinglePCReconnected,this))}uninstallEvents(){!this.singlePC||(this.singlePC.off("track",this.onTrack,this),this.singlePC.off("spc-reconnected",this.onSinglePCReconnected,this))}emitConnectionStateChangedEvent(e){var t,n;let i=this._currentState,r=super.emitConnectionStateChangedEvent(e);return r&&i!==e&&(null==(t=this.remoteVideoTrack)||t.emit("connection-state-changed",{prevState:i,state:e}),null==(n=this.remoteAuxiliaryTrack)||n.emit("connection-state-changed",{prevState:i,state:e})),r}onTrack(e){let t=e.streams[0],{track:n,receiver:i}=e;if(!t.id.includes(this.tinyId))return;let r=t.id.includes("aux")?"auxiliary":"main";this._log.debug(`ontrack ${r} ${n.kind}`);let o=ld.AUDIO;n.kind===ld.VIDEO&&(o=r===ld.MAIN?ld.VIDEO:ld.AUXILIARY);let a=this.remoteAudioTrack;o===ld.VIDEO?a=this.remoteVideoTrack:o===ld.AUXILIARY&&(a=this.remoteAuxiliaryTrack),this.singlePC.enableInsertableStreams&&this.createEncodedStreams(a,i),a.setInputMediaStreamTrack(n)}createEncodedStreams(e,t){if(!this.singlePC.abortMap.has(t)){let n=t.createEncodedStreams(),i=new AbortController,r={abortController:i,enqueue:t=>{var n;return null!=(n=this.singlePC)&&n.isUsingH264?e.decodeFrame(t):t}};(e.enableDecodeFrame?n.readable.pipeThrough(new TransformStream({transform:(e,t)=>t.enqueue(r.enqueue(e))})):n.readable).pipeTo(n.writable,i).catch((e=>{"destory"!==e&&this._log.warn(e)})),this.singlePC.addAbortController(t,i)}}subscribe(e,t){return du(this,null,(function*(){try{if(this._log.info(`subscribe ${t} ${mS(e)}`),this.hasSSRC){let t="subscribe_change";Object.values(e).find((e=>!0===e))||(t="unsubscribe"),yield this.sendSubscription(t,e)}else yield this.doSubscribe(e),this.checkTrackEnded(e)}catch(e){throw this._room.isJoined&&this.isStreamUnpublished(t)?(this._log.warn(`${e.message} ${JSON.stringify(this.muteState)}`),new Au({code:Tu.REMOTE_STREAM_NOT_EXIST,message:`remote user ${this.userId} unpublished stream`})):e}}))}checkTrackEnded(e){var t,n,i;if((e.audio&&"ended"===(null==(t=this.remoteAudioTrack.mediaTrack)?void 0:t.readyState)||e.video&&"ended"===(null==(n=this.remoteVideoTrack.mediaTrack)?void 0:n.readyState)||e.auxiliary&&"ended"===(null==(i=this.remoteAuxiliaryTrack.mediaTrack)?void 0:i.readState))&&this.singlePC&&!this.singlePC.isReconnecting){if(this._log.warn("remote track ended start spc reconnect"),Ip&&Mp<92)return;this.singlePC.startReconnection()}}unsubscribe(e){return du(this,arguments,(function*({remoteTracks:e,streamType:t}){var n;if("main"===t&&!this.isMainStreamSubscribed||"auxiliary"===t&&!this.isAuxStreamSubscribed)return void this._log.info(`${t} stream already unsubscribed`);let i=iu({},this.subscribeState);e.forEach((e=>{switch(e.mediaType){case 1:i.audio=!1;break;case 4:i.video=!1;break;case 8:i.smallVideo=!1;break;case 2:i.auxiliary=!1}}));let r="subscribe_change";Object.values(i).find((e=>!0===e))||(r="unsubscribe"),this._log.info(`${"unsubscribe"===r?r:"subscribe"} ${t} [${mS(i)}]`),"unsubscribe"===r&&(null==(n=this.singlePC)||n.removeDownlinkQueue.add(this.tinyId)),yield this.sendSubscription(r,i),"unsubscribe"===r&&(yield this.removeDownlink())}))}sendSubscription(e,t=this.subscribeState){let n={srcTinyId:this.tinyId,srcUserId:this.userId},i=YE,r=$E.UNSUBSCRIBE_RESULT;return"subscribe_change"===e&&(n={audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,srcTinyId:this.tinyId},i=JE,r=$E.SUBSCRIBE_CHANGE_RESULT),this._signalChannel.sendWaitForResponseWithRetry({command:i,data:n,responseCommand:r,timeout:1e4,retries:3}).then((({data:t})=>{if(0!==t.code){let n=new Au({code:t.code,message:nf({key:fh.ERROR_MESSAGE,data:{type:e,message:t.message}})});throw this._log.error(n),n}}))}getMainStreamVideoTrackId(){return this.remoteVideoTrack&&this.remoteVideoTrack.mediaTrack?this.remoteVideoTrack.mediaTrack.id:""}getAuxStreamVideoTrackId(){return this.remoteAuxiliaryTrack&&this.remoteAuxiliaryTrack.mediaTrack?this.remoteAuxiliaryTrack.mediaTrack.id:""}setDelay({audioDelay:e,videoDelay:t}){this.remoteAudioTrack.stat.end2EndDelay=e,this.remoteVideoTrack.stat.end2EndDelay=t}onSinglePCReconnected(){(this.ssrc.audio||this.ssrc.video||this.ssrc.auxiliary)&&(this._log.warn(`resubscribe ${JSON.stringify(this.subscribeState)}`),this.doSubscribe(this.subscribeState))}get hasSSRC(){return this.ssrc.audio&&this.ssrc.video&&this.ssrc.auxiliary}doSubscribe(){return du(this,arguments,(function*(e=this.subscribeState,t=!0){if(this.singlePC){this.singlePC.addDownlinkQueue.add(this.tinyId),yield this.singlePC.waitForPeerConnectionConnected();try{if(t||!this.hasSSRC){let t={audioSsrc:dS(),bigVideoSsrc:dS(),bigVideoRtxSsrc:dS(),auxVideoSsrc:dS(),auxVideoRtxSsrc:dS()},{audioSsrc:n,bigVideoSsrc:i,bigVideoRtxSsrc:r,auxVideoSsrc:o,auxVideoRtxSsrc:a}=t;this.ssrc={audio:n,video:i,videoRtx:r,auxiliary:o,auxiliaryRtx:a},this.singlePC.addDownlinkQueue.delete(this.tinyId),yield this.singlePC.addDownlink({userId:this.userId,tinyId:this.tinyId,ssrc:this.ssrc});try{let n=yield this._signalChannel.sendWaitForResponseWithRetry({command:"subscribe/v3",responseCommand:$E.SPC_SUBSCRIBE_RESULT,data:{srcUserId:this.userId,srcTinyId:this.tinyId,audio:e.audio,bigVideo:e.video,auxVideo:e.auxiliary,smallVideo:e.smallVideo,customData:!1,ssrc:t},retries:3,retryTimeout:0});if(0!==n.data.code)throw new Au({code:n.data.code,message:n.data.message})}catch(e){throw yield this.removeDownlink(),e}return}this.singlePC.addDownlinkQueue.delete(this.tinyId),yield this.singlePC.addDownlink({userId:this.userId,tinyId:this.tinyId,ssrc:this.ssrc})}finally{let e=this._room.scheduleResult.config;((null==e?void 0:e.jitterDelay)||(null==e?void 0:e.jitterDelayAux))&&this.setJitterBufferDelay({mainDelay:e.jitterDelay,auxDelay:e.jitterDelayAux})}}}))}removeDownlink(){return du(this,null,(function*(){if(!this.singlePC)return;this.ssrc={audio:0,video:0,videoRtx:0,auxiliary:0,auxiliaryRtx:0},this.singlePC.removeDownlinkQueue.delete(this.tinyId);let e=this._room.scheduleResult.config;((null==e?void 0:e.jitterDelay)||(null==e?void 0:e.jitterDelayAux))&&this.setJitterBufferDelay({mainDelay:0,auxDelay:0}),yield this.singlePC.removeDownlink(this.userId)}))}setJitterBufferDelay({mainDelay:e,auxDelay:t}){if(!this.singlePC||!this._peerConnection||Tm(e)&&Tm(t))return Promise.resolve();this._log.info(`set jitterBuffer main: ${e} aux: ${t}`);let n=this.singlePC.getReceiversByUserId(this.userId);return Hf(e)&&(this.remoteAudioTrack.jitterBufferDelay=e,this.remoteVideoTrack.jitterBufferDelay=e),Hf(t)&&(this.remoteAuxiliaryTrack.jitterBufferDelay=t,Tm(e)&&(this.remoteAudioTrack.jitterBufferDelay=t)),new Promise((i=>{this.doSetJitterBufferDelay({mainDelay:e,auxDelay:t,receivers:n,resolve:i})}))}doSetJitterBufferDelay({mainDelay:e,auxDelay:t,receivers:n,resolve:i}){let r=-1;try{if(0===e&&0===t)return n.forEach((e=>e.jitterBufferTarget=0)),i();if(n.forEach((n=>{var i;let r=n.track===this.remoteAuxiliaryTrack.outMediaTrack||Tm(e)&&n.track===this.remoteAudioTrack.outMediaTrack;if(r&&Tm(t)||!r&&Tm(e))return;let o=r?t||0:e,a=(n.jitterBufferTarget||0)+100;a>o||(n.jitterBufferTarget=a,this._log.debug(`set ${r?"aux ":""}${null==(i=null==n?void 0:n.track)?void 0:i.kind} jitterBuffer delay ${a} -> ${o}`))})),!n.find((n=>{let i=n.track===this.remoteAuxiliaryTrack.outMediaTrack?t||0:e;return n.jitterBufferTarget<i})))return this._log.info(`set jitterBuffer main: ${e} aux: ${t} done`),i();r=setTimeout((()=>{this.doSetJitterBufferDelay({mainDelay:e,auxDelay:t,receivers:n,resolve:i})}),1e3)}catch(e){this._log.warn(`set jitterBuffer delay error: ${e}`),clearTimeout(r),i()}}};lu([fv(),lv((e=>function(...t){return new Promise(((n,i)=>{let r=e=>{this.off("closed",r),i(new Au({code:Tu.API_CALL_ABORTED,message:nf({key:fh.CONNECTION_ABORTED,data:e})}))};this.on("closed",r),e.apply(this,t).then(n,i).finally((()=>{this.off("closed",r)}))}))}))],gS.prototype,"subscribe",1),lu([fv()],gS.prototype,"unsubscribe",1),lu([gv((()=>"jitter"))],gS.prototype,"setJitterBufferDelay",1);var _S=gS,vS=su(hu()),yS=class extends vS.EventEmitter{constructor(e,t){super(),this.room=e,this.signalChannel=t,cu(this,"log"),cu(this,"cmdIdSeqMap",new Map),cu(this,"messageMap",new Map),this.log=wm.createLogger({id:"cmm",userId:e.userId}),this.onReceiveMsg=this.onReceiveMsg.bind(this),t.on($E.RECEIVE_CUSTOM_MSG,this.onReceiveMsg)}send({cmdId:e,data:t}){let n=this.cmdIdSeqMap.get(e)||Math.floor(16383*Math.random()),i={cmdId:e,msg:btoa(String.fromCharCode(...new Uint8Array(t))),ordered:!0,reliable:!0,streamSeq:n};this.cmdIdSeqMap.set(e,n+1),this.signalChannel.send("channel_msg",i)}onReceiveMsg(e){let{data:t}=e.data,n=this.room.tinyIdToUserIdMap.get(t.srcTinyId);if(n){let e={userId:n,cmdId:t.cmdId,seq:t.streamSeq,data:Uint8Array.from(atob(t.msg),(e=>e.charCodeAt(0))).buffer};if(t.ordered){let t=`${n}_${e.cmdId}`,i=this.messageMap.get(t);if(!i||Math.abs(i.lastSeq-e.seq)>yS.SEQ_INTERVAL)this.messageMap.set(t,{lastSeq:e.seq,cachedMessageMap:new Map}),this.emitMessage(e);else if(e.seq>i.lastSeq){if(e.seq===i.lastSeq+1)this.emitMessage(e);else if(!i.cachedMessageMap.has(e.seq)){let t=setTimeout((()=>this.emitMessage(e,!0)),5e3);i.cachedMessageMap.set(e.seq,{message:e,timeoutId:t})}}else this.log.debug(`drop message ${e.userId}-${e.cmdId}-${e.seq}`)}else this.emit("message",e)}}emitMessage(e,t=!1){var n;let i=this.messageMap.get(`${e.userId}_${e.cmdId}`),r=e;if(i){if(t){let e=[...i.cachedMessageMap.values()].sort(((e,t)=>e.message.seq-t.message.seq));e[0]&&(r=e[0].message)}r.seq-i.lastSeq>1&&this.log.debug(`msg lost userId: ${r.userId} seq: ${i.lastSeq} -> ${r.seq}`),i.lastSeq=r.seq,clearTimeout(null==(n=i.cachedMessageMap.get(r.seq))?void 0:n.timeoutId),i.cachedMessageMap.delete(r.seq)}this.emit("message",r);let o=null==i?void 0:i.cachedMessageMap.get(r.seq+1);o&&this.emitMessage(o.message)}},ES=yS;cu(ES,"SEQ_INTERVAL",300);var{isString:bS,isUndefined:SS,getNetworkType:TS,isEmpty:xS}=Cu,AS=class extends Db{constructor(e){super(e),this._heartbeat=-1,this._lastHeartBeatTime=-1,this._joinTimeout=-1,this._firstPublishedList=null,this._joinReject=null,this._isRelayChanged=!1,this.signalChannel=null,this.uplinkConnection=null,this.singlePC=null,this.enableSPC=rg,this._changeBigSmallRecords=new Map,this._networkQuality=null,this._turnServers=[],this._syncUserListInterval=-1,this._smallStreamConfig={bitrate:100,frameRate:15,height:120,width:160},this.enableSEI=!1,this._enableAudioVolumeEvaluation=!1,this._audioVolumeIntervalId=0,this._enableMultiAuxStream=!1,this._pureAudioPushMode=!1,this.preferHW=!1,this._stats=new class{constructor(e,t){this.room=e,cu(this,"_log"),cu(this,"_prevReportTime",0),cu(this,"_prevReport",{}),cu(this,"_prevStats",null),cu(this,"_prevEncoderImplementation",""),cu(this,"_prevAuxEncoderImpl",""),cu(this,"_prevQualityLimitationReason",""),cu(this,"_prevAuxQualityLimitationReason",""),cu(this,"_prevDecoderImplementationMap",new Map),cu(this,"totalBytesSent",0),cu(this,"totalBytesReceived",0),cu(this,"_spcStats",null),this._log=t}get statInterval(){return 0===this._prevReportTime?2:(Date.now()-this._prevReportTime)/1e3}getSenderStats(e){return du(this,null,(function*(){let t={audio:{bytesSent:0,packetsSent:0,audioLevel:0,totalAudioEnergy:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},small:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},auxiliary:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},rtt:0},n=e.getPeerConnection(),i=e.getSSRC();if(n)try{if((this._spcStats||(yield n.getStats())).forEach((n=>{var r,o,a;if("outbound-rtp"===n.type)if((n.mediaType||n.kind)===ld.VIDEO){let a,s;if(n.ssrc===i.video?(a=ld.VIDEO,s=e.localMainVideoTrack):n.ssrc===i.small?a=ld.SMALL:n.ssrc===i.auxiliary&&(s=e.localAuxVideoTrack,a=ld.AUXILIARY),!a)return;if(t[a].bytesSent=n.bytesSent,t[a].packetsSent=n.packetsSent,t[a].framesEncoded=n.framesEncoded,Ff(n.keyFramesEncoded)||(t[a].keyFramesEncoded=n.keyFramesEncoded),Ff(n.nackCount)||(t[a].nackCount=n.nackCount),Ff(n.pliCount)||(t[a].pliCount=n.pliCount),Ff(n.retransmittedPacketsSent)||(t[a].retransmittedPacketsSent=n.retransmittedPacketsSent),Ff(n.totalEncodeTime)||(t[a].totalEncodeTime=n.totalEncodeTime),Ff(n.totalPacketSendDelay)||(t[a].totalPacketSendDelay=n.totalPacketSendDelay),!Ff(n.encoderImplementation)&&(a===ld.VIDEO&&this._prevEncoderImplementation!==n.encoderImplementation||a===ld.AUXILIARY&&this._prevAuxEncoderImpl!==n.encoderImplementation)){let t=2,i=this._prevEncoderImplementation;a===ld.AUXILIARY&&(t=7,i=this._prevAuxEncoderImpl),af.emit("262",{userId:e.userId,streamType:t,prevImplementation:i,implementation:n.encoderImplementation,codec:e.videoCodec,isHWCodec:n.powerEfficientEncoder}),this[a===ld.VIDEO?"_prevEncoderImplementation":"_prevAuxEncoderImpl"]=n.encoderImplementation,this._log.info(`${a===ld.AUXILIARY?"aux ":""}encoderImplementation change to ${n.encoderImplementation}(${e.videoCodec}) HWEncoder: ${n.powerEfficientEncoder}`)}if(n.ssrc===i.video?!Ff(n.qualityLimitationReason)&&0!==n.bytesSent&&this._prevQualityLimitationReason!==n.qualityLimitationReason&&(this._log.info(`qualityLimitationReason change to ${n.qualityLimitationReason}`),af.emit("263",{userId:e.userId,reason:n.qualityLimitationReason,prevReason:this._prevQualityLimitationReason,streamType:2,isQosClearFirst:null==(r=e.localMainVideoTrack)?void 0:r.isQosClearFirst}),this._prevQualityLimitationReason=n.qualityLimitationReason):n.ssrc===i.auxiliary&&!Ff(n.qualityLimitationReason)&&0!==n.bytesSent&&this._prevAuxQualityLimitationReason!==n.qualityLimitationReason&&(this._log.info(`aux qualityLimitationReason change to ${n.qualityLimitationReason}`),af.emit("263",{userId:e.userId,reason:n.qualityLimitationReason,prevReason:this._prevAuxQualityLimitationReason,streamType:7,isQosClearFirst:null==(o=e.localAuxVideoTrack)?void 0:o.isQosClearFirst}),this._prevAuxQualityLimitationReason=n.qualityLimitationReason),s)for(let e of Object.keys(s.stat))t[a][e]&&(s.stat[e]=t[a][e])}else t.audio.bytesSent=n.bytesSent,t.audio.packetsSent=n.packetsSent;else"candidate-pair"===n.type?qm(n)&&Hf(n.currentRoundTripTime)&&(t.rtt=Math.floor(1e3*n.currentRoundTripTime),this.totalBytesSent=n.bytesSent):"media-source"===n.type&&(n.kind===ld.AUDIO?(t.audio.audioLevel=n.audioLevel||0,t.audio.totalAudioEnergy=n.totalAudioEnergy||0,n.echoReturnLoss,n.totalSamplesDuration&&(t.audio.totalSamplesDuration=n.totalSamplesDuration)):n.kind===ld.VIDEO&&(n.trackIdentifier===e.getVideoTrackId(ld.VIDEO)?t.video.fpsCapture=n.framesPerSecond:n.trackIdentifier===e.getVideoTrackId(ld.AUXILIARY)?t.auxiliary.fpsCapture=n.framesPerSecond:t.small.fpsCapture=n.framesPerSecond));if(!Ff(n.audioLevel)&&(null==(a=e.localMainAudioTrack)?void 0:a.mediaTrack)&&n.trackIdentifier===e.localMainAudioTrack.mediaTrack.id&&(t.audio.audioLevel=n.audioLevel||0),!Ff(n.frameWidth)){let r=ld.SMALL;n.trackIdentifier===e.getVideoTrackId(ld.VIDEO)||n.ssrc===i.video?r=ld.VIDEO:(n.trackIdentifier===e.getVideoTrackId(ld.AUXILIARY)||n.ssrc===i.auxiliary)&&(r=ld.AUXILIARY),t[r].frameWidth=n.frameWidth,t[r].frameHeight=n.frameHeight,t[r].framesSent=n.framesSent}})),e.localMainAudioTrack){let n=e.localMainAudioTrack.getInternalAudioLevel();t.audio.micAudioLevel=n,0===t.audio.audioLevel&&(t.audio.audioLevel=n)}this.totalBytesSent||(this.totalBytesSent+=t.audio.bytesSent+t.video.bytesSent+t.auxiliary.bytesSent)}catch(e){this._log.warn(`failed to getStats on sender connection ${e}`)}return t}))}getReceiverStats(e){return du(this,null,(function*(){let t={tinyId:e.tinyId,userId:e.userId,rtt:0,hasAudio:!1,hasVideo:!1,hasAuxiliary:!1,isSmallSubscribed:!1,audio:{bytesReceived:0,packetsReceived:0,packetsLost:0,p2pDelay:0,totalJitter:0,totalJitterCount:0,audioLevel:0,totalAudioEnergy:0,insertedSamplesForDeceleration:0,removedSamplesForAcceleration:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,fpsDecoded:0,freezeCount:0,totalFreezesDuration:0,totalJitter:0,totalJitterCount:0},auxiliary:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,fpsDecoded:0,totalJitter:0,totalJitterCount:0}},n=e.getPeerConnection();if(n)try{let{ssrc:i}=e,{muteState:r,subscribeState:o}=e;(this._spcStats||(yield n.getStats())).forEach((n=>{if("inbound-rtp"===n.type){let a=(n.mediaType||n.kind)===ld.AUDIO;if(a){if(n.ssrc!==i.audio||!r.hasAudio)return;t.audio.packetsReceived=n.packetsReceived,t.audio.bytesReceived=n.bytesReceived,t.audio.packetsLost=n.packetsLost,n.insertedSamplesForDeceleration&&(t.audio.insertedSamplesForDeceleration=n.insertedSamplesForDeceleration),n.removedSamplesForAcceleration&&(t.audio.removedSamplesForAcceleration=n.removedSamplesForAcceleration),n.totalSamplesDuration&&(t.audio.totalSamplesDuration=n.totalSamplesDuration),n.totalSamplesReceived&&(t.audio.totalSamplesReceived=n.totalSamplesReceived),n.concealedSamples&&(t.audio.concealedSamples=n.concealedSamples);let{remoteAudioTrack:o}=e;o.stat.packetsReceived=n.packetsReceived,o.stat.bytesReceived=n.bytesReceived,o.stat.packetsLost=n.packetsLost,t.audio.p2pDelay=o.stat.end2EndDelay,t.hasAudio=!0}else{if(Nh&&0===n.bytesReceived)return;let a;n.ssrc===i.video&&r.hasVideo&&(t.video.packetsReceived=n.packetsReceived,t.video.bytesReceived=n.bytesReceived,t.video.packetsLost=n.packetsLost,t.video.framesReceived=n.framesReceived,t.video.framesDecoded=n.framesDecoded,t.video.fpsDecoded=n.framesPerSecond,t.hasVideo=!0,a=e.remoteVideoTrack,r.hasSmall&&o.smallVideo&&(t.isSmallSubscribed=!0),n.decoderImplementation&&(!this._prevDecoderImplementationMap.has(t.userId)||this._prevDecoderImplementationMap.get(t.userId)!==n.decoderImplementation)&&(this._log.info(`${t.userId} decoderImplementation change to ${n.decoderImplementation} HWDecoder: ${n.powerEfficientDecoder}`),af.emit("262",{userId:this.room.userId,remoteUserId:t.userId,prevImplementation:this._prevDecoderImplementationMap.get(t.userId),implementation:n.decoderImplementation,codec:e.videoCodec,isHWCodec:n.powerEfficientDecoder}),this._prevDecoderImplementationMap.set(t.userId,n.decoderImplementation))),n.ssrc===i.auxiliary&&r.hasAuxiliary&&(t.auxiliary.packetsReceived=n.packetsReceived,t.auxiliary.bytesReceived=n.bytesReceived,t.auxiliary.packetsLost=n.packetsLost,t.auxiliary.framesReceived=n.framesReceived,t.auxiliary.framesDecoded=n.framesDecoded,t.auxiliary.fpsDecoded=n.framesPerSecond,a=e.remoteAuxiliaryTrack,t.hasAuxiliary=!0),a&&(a.stat.packetsReceived=n.packetsReceived,a.stat.bytesReceived=n.bytesReceived,a.stat.packetsLost=n.packetsLost,a.stat.framesReceived=n.framesReceived,a.stat.framesDecoded=n.framesDecoded,n.jitterBufferDelay&&(a.stat.jitterBufferDelay=Math.floor(n.jitterBufferDelay/n.jitterBufferEmittedCount*1e3)))}n.jitterBufferDelay&&(a?(t.audio.totalJitter=n.jitterBufferDelay,t.audio.totalJitterCount=n.jitterBufferEmittedCount):n.ssrc===i.video&&r.hasVideo?(t.video.totalJitter=n.jitterBufferDelay,t.video.totalJitterCount=n.jitterBufferEmittedCount):n.ssrc===i.auxiliary&&r.hasAuxiliary&&(t.auxiliary.totalJitter=n.jitterBufferDelay,t.auxiliary.totalJitterCount=n.jitterBufferEmittedCount))}else"candidate-pair"===n.type&&qm(n)&&Hf(n.currentRoundTripTime)&&(t.rtt=Math.floor(1e3*n.currentRoundTripTime),this.totalBytesReceived=n.bytesReceived);Ff(n.frameWidth)||((n.trackIdentifier===e.getMainStreamVideoTrackId()||n.ssrc===i.video)&&(t.video.frameWidth=n.frameWidth,t.video.frameHeight=n.frameHeight,e.remoteVideoTrack.stat.frameWidth=n.frameWidth,e.remoteVideoTrack.stat.frameHeight=n.frameHeight),(n.trackIdentifier===e.getAuxStreamVideoTrackId()||n.ssrc===i.auxiliary)&&(t.auxiliary.frameWidth=n.frameWidth,t.auxiliary.frameHeight=n.frameHeight,e.remoteAuxiliaryTrack.stat.frameWidth=n.frameWidth,e.remoteAuxiliaryTrack.stat.frameHeight=n.frameHeight)),!Ff(n.audioLevel)&&e.muteState.audioAvailable&&e.remoteAudioTrack.mediaTrack&&n.trackIdentifier===e.remoteAudioTrack.mediaTrack.id&&(t.audio.audioLevel=n.audioLevel||0,t.audio.totalAudioEnergy=n.totalAudioEnergy||0)})),0===t.audio.audioLevel&&e.muteState.audioAvailable&&(t.audio.audioLevel=e.remoteAudioTrack.getInternalAudioLevel()||0),this.totalBytesReceived||(this.totalBytesReceived+=t.audio.bytesReceived+t.video.bytesReceived+t.auxiliary.bytesReceived)}catch(e){this._log.warn(`failed to getStats on receiver connection ${e}`)}return t}))}getStats(e,t){return du(this,null,(function*(){let n={},i=[];if(this.room.singlePC){let e=this.room.singlePC.getPeerConnection();if(!e)return{senderStats:n,receiverStats:i};let t=Qf(),r=yield e.getStats(),o=Qf();o-t>2e3&&this._log.warn(`getStats cost ${o-t}ms`);let a=[],s=new Set(["inbound-rtp","outbound-rtp","track","candidate-pair","media-source"]);r.forEach((e=>s.has(e.type)&&a.push(e))),this._spcStats=a}e&&(n=yield this.getSenderStats(e));for(let[e,n]of t){let e=yield this.getReceiverStats(n);i.push(e)}return{senderStats:n,receiverStats:i}}))}getDifferenceValue(e,t){if(ev(e))return t;let n=t-e;return n<0?0:n}prepareReport({stats:e,report:t,freezeMap:n}){var i;if(!ev(e.senderStats)){let n={uint32_audio_level:e.senderStats.audio.audioLevel*ph,uint32_audio_energy:1e6*e.senderStats.audio.totalAudioEnergy,uint32_audio_codec_bitrate:e.senderStats.audio.bytesSent};e.senderStats.audio.micAudioLevel&&(n.uint32_mic_audio_level=e.senderStats.audio.micAudioLevel*ph),e.senderStats.audio.totalSamplesDuration&&(t.msg_device_info.uint32_audio_capture_cost=e.senderStats.audio.totalSamplesDuration);let i=[];if(e.senderStats.video.bytesSent){let t={uint32_video_stream_type:2,uint32_video_codec_fps:e.senderStats.video.framesSent,uint32_video_capture_fps:e.senderStats.video.fpsCapture,uint32_video_width:e.senderStats.video.frameWidth,uint32_video_height:e.senderStats.video.frameHeight,uint32_video_codec_bitrate:e.senderStats.video.bytesSent,uint32_video_enc_fps:e.senderStats.video.framesEncoded,uint32_key_frame_count:e.senderStats.video.keyFramesEncoded,uint32_nack_count:e.senderStats.video.nackCount,uint32_pli_count:e.senderStats.video.pliCount,uint32_encode_cost:1e3*(e.senderStats.video.totalEncodeTime||0),uint32_send_packet_cost:1e3*(e.senderStats.video.totalPacketSendDelay||0),uint32_video_arq_packets:e.senderStats.video.retransmittedPacketsSent};i.push(t)}if(e.senderStats.small.bytesSent){let t={uint32_video_stream_type:3,uint32_video_codec_fps:e.senderStats.small.framesSent||0,uint32_video_capture_fps:e.senderStats.small.fpsCapture||0,uint32_video_width:e.senderStats.small.frameWidth||0,uint32_video_height:e.senderStats.small.frameHeight||0,uint32_video_codec_bitrate:e.senderStats.small.bytesSent,uint32_video_enc_fps:e.senderStats.small.framesEncoded||0,uint32_key_frame_count:e.senderStats.small.keyFramesEncoded,uint32_nack_count:e.senderStats.small.nackCount,uint32_pli_count:e.senderStats.small.pliCount,uint32_encode_cost:1e3*(e.senderStats.small.totalEncodeTime||0),uint32_send_packet_cost:1e3*(e.senderStats.small.totalPacketSendDelay||0),uint32_video_arq_packets:e.senderStats.small.retransmittedPacketsSent};i.push(t)}if(e.senderStats.auxiliary.bytesSent){let t={uint32_video_stream_type:7,uint32_video_codec_fps:e.senderStats.auxiliary.framesSent||0,uint32_video_capture_fps:e.senderStats.auxiliary.fpsCapture||0,uint32_video_width:e.senderStats.auxiliary.frameWidth||0,uint32_video_height:e.senderStats.auxiliary.frameHeight||0,uint32_video_codec_bitrate:e.senderStats.auxiliary.bytesSent,uint32_video_enc_fps:e.senderStats.auxiliary.framesEncoded||0,uint32_key_frame_count:e.senderStats.auxiliary.keyFramesEncoded,uint32_nack_count:e.senderStats.auxiliary.nackCount,uint32_pli_count:e.senderStats.auxiliary.pliCount,uint32_encode_cost:1e3*(e.senderStats.auxiliary.totalEncodeTime||0),uint32_send_packet_cost:1e3*(e.senderStats.auxiliary.totalPacketSendDelay||0),uint32_video_arq_packets:e.senderStats.auxiliary.retransmittedPacketsSent};i.push(t)}let r={uint32_bitrate:0,uint32_lost:0,uint32_rtt:e.senderStats.rtt};t.msg_up_stream_info={msg_audio_status:n,msg_video_status:i,msg_network_status:r}}let{statInterval:r}=this;t.msg_down_stream_info=[],e.receiverStats.forEach((e=>{let i={msg_user_info:{str_identifier:e.userId,uint64_tinyid:e.tinyId},msg_network_status:{uint32_rtt:e.rtt,uint32_bitrate:0,uint32_lost:0},msg_audio_status:{},msg_video_status:[]};if(e.hasAudio){let t={uint32_audio_p2p_delay:e.audio.p2pDelay,uint32_audio_cache_ms:e.audio.totalJitter,uint32_audio_cache_ms_count:e.audio.totalJitterCount,uint32_audio_codec_bitrate:e.audio.bytesReceived,uint32_audio_total_bitrate:e.audio.bytesReceived,uint32_audio_level:1e8*e.audio.audioLevel,uint32_audio_energy:1e6*e.audio.totalAudioEnergy,uint32_audio_receive:e.audio.packetsReceived,uint32_audio_origin_lost:e.audio.packetsLost};i.msg_audio_status=t}if(e.hasVideo){let t=n.get(`${e.userId}_${Ed}`),r=t?t.duration:0,o={uint32_video_stream_type:e.isSmallSubscribed?3:2,uint32_video_receive_fps:e.video.framesReceived,uint32_video_width:e.video.frameWidth,uint32_video_height:e.video.frameHeight,uint32_video_codec_bitrate:e.video.bytesReceived,uint32_video_receive:e.video.packetsReceived,uint32_video_origin_lost:e.video.packetsLost,uint32_video_block_time:r,uint32_video_dec_fps:e.video.framesDecoded,uint32_video_cache_ms:e.video.totalJitter,uint32_video_cache_ms_count:e.video.totalJitterCount};i.msg_video_status.push(o)}if(e.hasAuxiliary){let t=n.get(`${e.userId}_${bd}`),r=t?t.duration:0,o={uint32_video_stream_type:7,uint32_video_receive_fps:e.auxiliary.framesReceived,uint32_video_width:e.auxiliary.frameWidth,uint32_video_height:e.auxiliary.frameHeight,uint32_video_codec_bitrate:e.auxiliary.bytesReceived,uint32_video_receive:e.auxiliary.packetsReceived+e.auxiliary.packetsLost,uint32_video_origin_lost:e.auxiliary.packetsLost,uint32_video_block_time:r,uint32_video_dec_fps:e.auxiliary.framesDecoded,uint32_video_cache_ms:e.auxiliary.totalJitter,uint32_video_cache_ms_count:e.auxiliary.totalJitterCount};i.msg_video_status.push(o)}t.msg_down_stream_info.push(i)}));let o=this._prevReport,a=this._prevStats;if(this._prevReport=JSON.parse(JSON.stringify(t)),this._prevStats=JSON.parse(JSON.stringify(e)),t.msg_up_stream_info.msg_audio_status&&o.msg_up_stream_info.msg_audio_status){let e=o.msg_up_stream_info.msg_audio_status,n=t.msg_up_stream_info.msg_audio_status;if(0===e.uint32_audio_codec_bitrate)n.uint32_audio_codec_bitrate=0;else{let i=this.getDifferenceValue(e.uint32_audio_codec_bitrate,n.uint32_audio_codec_bitrate);n.uint32_audio_codec_bitrate=Math.round(8*i/r),t.msg_up_stream_info.msg_network_status.uint32_bitrate+=n.uint32_audio_codec_bitrate}null!=(i=o.msg_device_info)&&i.uint32_audio_capture_cost?t.msg_device_info.uint32_audio_capture_cost=2*Math.floor(1e3*this.getDifferenceValue(o.msg_device_info.uint32_audio_capture_cost,t.msg_device_info.uint32_audio_capture_cost)/r):delete t.msg_device_info.uint32_audio_capture_cost}let s=o.msg_up_stream_info.msg_video_status;t.msg_up_stream_info.msg_video_status.forEach((e=>{let n=s.find((t=>t.uint32_video_stream_type===e.uint32_video_stream_type));if(!n||0===n.uint32_video_codec_bitrate)return e.uint32_video_codec_bitrate=0,e.uint32_video_enc_fps=0,void(e.uint32_video_codec_fps=0);let i=0,o=0,a=0;n&&e.uint32_video_codec_bitrate>=n.uint32_video_codec_bitrate&&(i=n.uint32_video_codec_bitrate,o=n.uint32_video_enc_fps,a=n.uint32_video_codec_fps);let l=this.getDifferenceValue(i,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*l/r),t.msg_up_stream_info.msg_network_status.uint32_bitrate+=e.uint32_video_codec_bitrate,e.uint32_video_enc_fps=Math.round(this.getDifferenceValue(o,e.uint32_video_enc_fps)/r),e.uint32_video_codec_fps=Math.round(this.getDifferenceValue(a,e.uint32_video_codec_fps)/r),lp&&115===wp()&&0===n.uint32_video_width&&0===n.uint32_video_height&&0===n.uint32_video_codec_fps&&(e.uint32_video_codec_fps=e.uint32_video_enc_fps),Ff(n.uint32_key_frame_count)||(e.uint32_key_frame_count=Math.round(this.getDifferenceValue(n.uint32_key_frame_count,e.uint32_key_frame_count))),Ff(n.uint32_nack_count)||(e.uint32_nack_count=Math.round(this.getDifferenceValue(n.uint32_nack_count,e.uint32_nack_count))),Ff(n.uint32_pli_count)||(e.uint32_pli_count=Math.round(this.getDifferenceValue(n.uint32_pli_count,e.uint32_pli_count))),Ff(n.uint32_video_arq_packets)||(e.uint32_video_arq_packets=Math.round(this.getDifferenceValue(n.uint32_video_arq_packets,e.uint32_video_arq_packets))),Ff(n.uint32_encode_cost)||(e.uint32_encode_cost=Math.round(this.getDifferenceValue(n.uint32_encode_cost,e.uint32_encode_cost)/r)),Ff(n.uint32_send_packet_cost)||(e.uint32_send_packet_cost=Math.round(this.getDifferenceValue(n.uint32_send_packet_cost,e.uint32_send_packet_cost)/r))}));let l=o.msg_down_stream_info;t.msg_down_stream_info=t.msg_down_stream_info.filter((e=>l.find((t=>t.msg_user_info.uint64_tinyid===e.msg_user_info.uint64_tinyid))));let c=t.msg_down_stream_info;return c.forEach((e=>{let t=l.find((t=>t.msg_user_info.uint64_tinyid===e.msg_user_info.uint64_tinyid));if(ev(e.msg_audio_status)||ev(t.msg_audio_status))e.msg_audio_status={};else{let n=e.msg_audio_status,i=t.msg_audio_status,o=this.getDifferenceValue(i.uint32_audio_cache_ms_count,n.uint32_audio_cache_ms_count);delete n.uint32_audio_cache_ms_count,n.uint32_audio_cache_ms=Math.floor(1e3*this.getDifferenceValue(i.uint32_audio_cache_ms,n.uint32_audio_cache_ms)/o)||0;let a=this.room.remotePublishedUserMap.get(e.msg_user_info.str_identifier);a&&(a.remoteAudioTrack.stat.jitterBufferDelay=n.uint32_audio_cache_ms),n.uint32_audio_origin_lost=this.getDifferenceValue(i.uint32_audio_origin_lost,n.uint32_audio_origin_lost),n.uint32_audio_receive=this.getDifferenceValue(i.uint32_audio_receive,n.uint32_audio_receive),n.uint32_audio_receive+=n.uint32_audio_origin_lost;let s=this.getDifferenceValue(i.uint32_audio_codec_bitrate,n.uint32_audio_codec_bitrate);n.uint32_audio_codec_bitrate=Math.round(8*s/r),n.uint32_audio_total_bitrate=Math.round(8*s/r)}if(e.msg_video_status&&t.msg_video_status){let n=t.msg_video_status;e.msg_video_status=e.msg_video_status.filter((e=>n.find((t=>t.uint32_video_stream_type===e.uint32_video_stream_type)))),e.msg_video_status.forEach((e=>{let t=n.find((t=>t.uint32_video_stream_type===e.uint32_video_stream_type)),i=t.uint32_video_receive,o=t.uint32_video_origin_lost,a=t.uint32_video_codec_bitrate,s=t.uint32_video_receive_fps,l=t.uint32_video_dec_fps;e.uint32_video_origin_lost=this.getDifferenceValue(o,e.uint32_video_origin_lost),e.uint32_video_receive=this.getDifferenceValue(i,e.uint32_video_receive)+e.uint32_video_origin_lost;let c=this.getDifferenceValue(a,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*c/r);let u=this.getDifferenceValue(s,e.uint32_video_receive_fps);e.uint32_video_receive_fps=Math.round(u/r),e.uint32_video_dec_fps=Math.round(this.getDifferenceValue(l,e.uint32_video_dec_fps)/r);let d=this.getDifferenceValue(t.uint32_video_cache_ms_count,e.uint32_video_cache_ms_count);delete e.uint32_video_cache_ms_count,e.uint32_video_cache_ms=Math.floor(1e3*this.getDifferenceValue(t.uint32_video_cache_ms,e.uint32_video_cache_ms)/d)||0}))}})),a&&e.receiverStats.forEach((e=>{if(e.audio.concealedSamples&&e.audio.totalSamplesReceived){let t=a.receiverStats.find((t=>t.userId===e.userId));if(t&&t.audio.concealedSamples&&t.audio.totalSamplesReceived){let n=e.audio.concealedSamples-t.audio.concealedSamples,i=e.audio.totalSamplesReceived-t.audio.totalSamplesReceived,o=Math.floor(n/i*1e3*r);if(o>r/5){let t=c.find((t=>t.msg_user_info.str_identifier===e.userId));t&&(t.msg_audio_status.uint32_audio_block_time=o)}}}})),t}getStatsReport(e){return du(this,arguments,(function*({uplinkConnection:e,downlinkConnections:t,freezeMap:n}){let i={msg_device_info:{},msg_up_stream_info:{msg_audio_status:{uint32_audio_format:11,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_level:0,uint32_audio_energy:0},msg_video_status:[],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}},msg_down_stream_info:[{msg_user_info:{str_identifier:"",uint64_tinyid:0},msg_audio_status:{uint32_audio_cache_ms:0,uint32_audio_format:11,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_total_bitrate:0,uint32_audio_level:0,uint32_audio_energy:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_final_lost:0},msg_video_status:[{uint32_video_cache_ms:0,uint32_video_stream_type:0,uint32_video_receive_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_block_time:0,uint32_video_dec_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}}]},r=yield this.getStats(e,t);return"{}"===JSON.stringify(this._prevReport)&&(this._prevReport=JSON.parse(JSON.stringify(i))),this.prepareReport({stats:r,report:i,freezeMap:n}),this._prevReportTime=Date.now(),i}))}reset(){this._prevReportTime=0,this._prevReport={},this._prevEncoderImplementation="",this._prevQualityLimitationReason="",this._prevDecoderImplementationMap=new Map}}(this,this._log),this.userManager=new Iy(this.userId,this._log),this._version=Nu,this.sdpSemantics=Hd,SS(e.sdpSemantics)?Cm.isUnifiedPlanDefault()&&(this.sdpSemantics=Bd):this.sdpSemantics=e.sdpSemantics,this._log.info(`sdpSemantics: ${this.sdpSemantics}, netType: ${TS()}`),e.iceTransportPolicy&&(this._iceTransportPolicy=e.iceTransportPolicy),this._enableMultiAuxStream=!SS(e.enableMultiAuxStream)&&e.enableMultiAuxStream,this.enableSEI=e.enableSEI&&rg,!SS(e.enableSPC)&&rg&&(this.enableSPC=e.enableSPC),this.preferHW=!!e.preferHW,this._initBusinessInfo(e),this.healthDetector=new tS(this)}get isMainStreamPublished(){var e;return!(null==(e=this.uplinkConnection)||!e.isMainStreamPublished)}get isMainAudioPublished(){var e;return!(null==(e=this.uplinkConnection)||!e.localMainAudioTrack)}get isAuxStreamPublished(){var e;return!(null==(e=this.uplinkConnection)||!e.isAuxStreamPublished)}get hasAuxStream(){return[...this.remotePublishedUserMap.values()].findIndex((e=>e.muteState.hasAuxiliary))>=0}get userMap(){return this.userManager.userMap}get remotePublishedUserMap(){return this.userManager.remotePublishedUserMap}get tinyIdToUserIdMap(){return new Map([...this.userMap.values()].map((e=>[e.tinyId,e.userId])))}join(e,t,n){return du(this,null,(function*(){return this.userManager.mySelfId=this.userId,this.userManager.on("1",(e=>{this.emit("peer-join",e)})),this.userManager.on("2",(e=>{this.closeDownLinkConnection(e,"remote user exitRoom"),this.emit("peer-leave",e)})),this.userManager.on("3",this.createDownlinkConnection,this),this.userManager.on("5",this.closeDownLinkConnection,this),this.userManager.on("6",(e=>{var t=((e,t)=>{var n={};for(var i in e)Qc.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&Jc)for(var i of Jc(e))t.indexOf(i)<0&&Zc.call(e,i)&&(n[i]=e[i]);return n})(e,[]);af.emit(xm.REMOTE_PUBLISH_STATE_CHANGED,iu({room:this},t)),this.emit("remote-publish-state-changed",iu({},t))})),this.joinParams=e,new Promise(((t,n)=>du(this,null,(function*(){var i,r;this._joinReject=n;try{this.checkDestroy();try{yield Promise.all([this.initialize(),this.initSinglePC()])}catch(e){if(!(e instanceof Au&&e.code===Tu.SPC_INITIALIZED_FAILED))return n(e);null==(i=this.signalChannel)||i.destroy(),yield this.initialize()}yield this.doJoin(e,null==(r=this.singlePC)?void 0:r.clientAbility),t(),this._firstPublishedList&&this.onPublishedUserList({data:{userList:this._firstPublishedList}})}catch(e){n(e)}this._joinReject=null}))))}))}initSinglePC(){return du(this,null,(function*(){if(this.enableSPC&&!this.singlePC){this.singlePC=new sS({signalChannel:this.signalChannel,room:this,enableCustomMessage:!1}),this.singlePC.on("sei-message",(e=>this.emit("sei-message",e))),this.singlePC.once("error",(()=>this.fallbackToMPC()));try{return yield this.singlePC.initialize()}catch(e){throw this.fallbackToMPC(),new Au({code:Tu.SPC_INITIALIZED_FAILED,message:null==e?void 0:e.message})}}}))}doJoin(e,t){return new Promise(((n,i)=>du(this,null,(function*(){var r,o,a;e.privateMapKey&&(this.privateMapKey=e.privateMapKey),e.latencyLevel&&(this.latencyLevel=e.latencyLevel),this.signalChannel.once("5",(e=>{this.clearJoinTimeout(),af.emit(xm.JOIN_SIGNAL_CONNECTION_END,{room:this,error:e}),i(e)})),zf(null==(o=null==(r=this.scheduleResult)?void 0:r.config)?void 0:o.singlePC)&&rg&&(this.enableSPC=this.scheduleResult.config.singlePC),this.keyPointManager.setConnectionType(this.singlePC?1:2);let s={roomId:String(e.roomId||e.strRoomId),useStringRoomId:this.useStringRoomId,privateMapKey:this.privateMapKey,latencyLevel:this.latencyLevel,trtcRole:e.role,trtcScene:"live"===this.scene?2:1,sdpSemantics:this.sdpSemantics,version:this._version,ua:navigator&&navigator.userAgent||"",terminalType:Qp(),netType:wf(),bussinessInfo:this._businessInfo,ability:t,sdkType:this._sdkType,userSig:this.userSig};this._log.debug(`join room signal data: ${JSON.stringify(s)}`);let l=5e3;(null==(a=this.scheduleResult.config)?void 0:a.enterRoomTimeout)&&this.scheduleResult.config.enterRoomTimeout>=1&&(l=1e3*this.scheduleResult.config.enterRoomTimeout),this._joinTimeout=window.setTimeout((()=>{i(new Au({code:Tu.JOIN_ROOM_FAILED,message:nf({key:fh.JOIN_ROOM_TIMEOUT})}))}),l),af.emit(xm.JOIN_SEND_CMD,{room:this}),this.signalChannel.send(this.singlePC?"join/v2":"join",s),this.signalChannel.once($E.JOIN_ROOM_RESULT,(e=>{this.clearJoinTimeout();let{code:t,message:r,data:o,tinyId:a}=e.data;af.emit(xm.JOIN_RECEIVED_CMD_RES,{room:this,code:t}),0===t?(this._log.info("Join room success, start heartbeat"),a&&(this.tinyId=a),this.startHeartbeat(),this.syncUserList(),this.startSyncUserListInterval(),this._firstPublishedList=o.publishers,this.singlePC&&this.singlePC.connect(o.ability).catch((()=>{})),n()):(this._log.error(`Join room failed result: ${t} error: ${r}`),i(new Au({code:Tu.JOIN_ROOM_FAILED,extraCode:t,message:nf({key:fh.JOIN_ROOM_FAILED,data:{error:r,code:t}})})))}))}))))}reJoin(e=!0){return du(this,null,(function*(){if(this.isJoined)try{this._log.warn(`reJoin pending: ${this.joinParams.roomId}`);let t,n=[];if(this.singlePC&&(this.singlePC.close(),this.singlePC=null,n.push(this.initSinglePC().then((e=>(t=e,e))))),this.signalChannel&&(this.signalChannel.race=e,this.signalChannel.close(),n.push(this.signalChannel.connect())),yield Promise.all(n),yield this.doJoin(ru(iu({},this.joinParams),{role:"anchor"===this.role?20:21,privateMapKey:this.privateMapKey,latencyLevel:this.latencyLevel}),t),this._log.warn("reJoin success"),lf.logSuccessEvent({userId:this.userId,eventType:Ld.REJOIN}),this.singlePC){let e=t=>{var n;"CONNECTED"===t.state&&(null==(n=this.singlePC)||n.off(nS.CONNECTION_STATE_CHANGED,e),this.uplinkConnection instanceof fS&&(this.uplinkConnection.installEvents(),this.uplinkConnection.onSinglePCReconnected()),this.remotePublishedUserMap.forEach((e=>{e.installEvents(),e.onSinglePCReconnected()})))};this.singlePC.on(nS.CONNECTION_STATE_CHANGED,e),this.checkConnectionsToReconnect(),this.uplinkConnection instanceof gb&&!this.uplinkConnection.getIsReconnecting()&&this.uplinkConnection.startReconnection()}}catch(e){this._log.warn(`reJoin fail ${e}`),this.reset(),lf.logFailedEvent({userId:this.userId,eventType:Ld.REJOIN,error:e}),this.emit("error",new Au({code:Tu.JOIN_ROOM_FAILED,message:nf({key:fh.REJOIN_ROOM_FAILED,data:{roomId:this.joinParams.roomId}})}))}else this._log.warn("reJoin abort")}))}initialize(){return du(this,null,(function*(){let e,{mainUrl:t,backupUrl:n}=this.getSignalChannelUrl(),i=this.signalChannel||function(e){let t=[...QE.values()].find((t=>t.room.userId===e&&!t.room.isJoined));return t||null}(this.userId),r=!!(i&&i.isConnected&&i.keepAlive);return Array.isArray(this.scheduleResult.domains)&&this.scheduleResult.domains.length>0&&(e=this.scheduleResult.domains[0]),this._log.info((r?"reuse":"setup")+" signal channel"),r?(i.url=t,i.backupUrl=n,i.room=this,this.signalChannel=i):(this.signalChannel=new ZE({sdkAppId:this.sdkAppId,userId:this.userId,userSig:this.userSig,url:t,backupUrl:n,race:this.enableSPC&&!this.proxy_ws,room:this,signalDomainWhenUnifiedProxy:this.proxy_unified?e:void 0}),this._customMessageManager=new ES(this,this.signalChannel),this._customMessageManager.on("message",(e=>{this.emit("custom-message",e)}))),this._networkQuality||(this._networkQuality=new yb({signalChannel:this.signalChannel,room:this}),this._networkQuality.on(yb.EVENT_NETWORK_QUALITY,(e=>{this.emit("network-quality",e)}))),Pg(this,this.signalChannel).add("2",(e=>{af.emit(xm.SIGNAL_CONNECTION_STATE_CHANGED,iu({room:this},e)),this.emit("signal-connection-state-changed",e)})).add("4",(e=>{this.reset(),this.emit("error",e)})).add($E.PEER_JOIN,(e=>{let{srcTinyId:t,userId:n,role:i}=e.data.data;this.userManager.addUser({userId:n,tinyId:t,role:i})})).add($E.PEER_LEAVE,(e=>{let{userId:t,reason:n=0}=e.data.data;this.userManager.deleteUser(t,n)})).add($E.UPDATE_REMOTE_MUTE_STAT,(e=>{this._lastHeartBeatTime>0&&Date.now()-this._lastHeartBeatTime>=1e4&&this.doHeartbeat(),this.onPublishedUserList(e.data)})).add($E.CLIENT_BANNED,(e=>{let t=e.data.data,{reason:n}=t;if(lf.uploadEvent({log:`stat-banned:${n}`,userId:this.userId}),"user_time_out"===n)return this._log.warn(`${n} last heart beat time: ${this._lastHeartBeatTime} interval: ${Date.now()-this._lastHeartBeatTime}, visibility: ${document.visibilityState}`),void this.reJoin();this._log["kick"===n?"error":"info"](`user was banned because of [${n}]`),this.reset(),this.emit("banned",{reason:n})})),this.signalChannel.once("1",(e=>{this.tinyId=e.signalInfo.tinyId,af.emit(xm.JOIN_SIGNAL_CONNECTION_END,{room:this})})),af.emit(xm.JOIN_SIGNAL_CONNECTION_START,{room:this}),yield this.signalChannel.connect(),r&&af.emit(xm.JOIN_SIGNAL_CONNECTION_END,{room:this}),r}))}setSignalChannel(e){this.signalChannel=e,e||Lg(this)}leave(){return du(this,null,(function*(){var e;try{yield this.doHeartbeat()}catch(e){}this._log.info("leave() => leaving room"),af.emit(xm.LEAVE_SEND_CMD,{room:this}),null==(e=this.signalChannel)||e.send("leave")}))}clearNetworkQuality(){this._networkQuality&&(this._networkQuality.stop(),this._networkQuality=null)}closeConnections(){this.remotePublishedUserMap.forEach((e=>{this.closeDownLinkConnection(e.userId,"you exitRoom")}))}clearJoinTimeout(){clearTimeout(this._joinTimeout),this._joinTimeout=-1}startHeartbeat(){-1===this._heartbeat&&(this._heartbeat=kg.run(ah,this.doHeartbeat.bind(this),{delay:2e3}))}stopHeartbeat(){-1!==this._heartbeat&&(this._log.info("stopHeartbeat"),kg.clearTask(this._heartbeat),this._heartbeat=-1,this._lastHeartBeatTime=-1)}doHeartbeat(){return du(this,null,(function*(){var e;let t=this.badCaseDetector.getMonitorFreeze(),n=yield this._stats.getStatsReport({uplinkConnection:this.uplinkConnection,downlinkConnections:this.remotePublishedUserMap,freezeMap:t});if(this.badCaseDetector.resetMonitor(),null==(e=this.signalChannel)||!e.isConnected)return;let i=this.signalChannel.isConnected?function(e){if(xy.has(e)){let t=xy.get(e).map((e=>({uint32_event_id:e.eventId,uint64_date:e.timestamp,str_userid:e.remoteUserId,uint32_param1:e.param1,uint32_param2:e.param2,uint32_video_stream_type:e.streamType})));return xy.delete(e),t}return[]}(this.userId):[],r=ru(iu({str_sdk_version:ku,uint64_datetime:(new Date).getTime(),msg_user_info:{str_identifier:this.userId,uint64_tinyid:this.tinyId},msg_event_msg:i,str_acc_ip:this.getSignalInfo().relayIp,str_client_ip:this.getSignalInfo().clientIp},n),{msg_device_info:iu({uint32_terminal_type:15,str_device_name:navigator.platform,str_os_version:"",uint32_net_type:wf()},n.msg_device_info)});this.heartbeatReport=r,af.emit(xm.HEARTBEAT_REPORT,{room:this,report:r}),this.signalChannel.send("quality_report",r),this.emit("heartbeat-report",ru(iu({},r),{bytes_sent:this._stats.totalBytesSent+this.signalChannel.bytesSent,bytes_received:this._stats.totalBytesReceived+this.signalChannel.bytesReceived}));let o=Date.now();this._lastHeartBeatTime>0&&o-this._lastHeartBeatTime>1e4&&this._log.warn("heartbeat took "+(o-this._lastHeartBeatTime)),this.signalChannel.isConnected&&(this._lastHeartBeatTime=o),!this._isRelayChanged&&this.isRelayMaybeFailed()&&(this.reJoin(),this._isRelayChanged=!0)}))}onPublishedUserList(e){if(!this.isJoined)return;let t=e.data.userList.map((({userId:e,srcTinyId:t,flag:n})=>{e===this.userId&&this.uplinkConnection&&(this.uplinkConnection.flag=n);let i=this.remotePublishedUserMap.get(e);return i&&this.checkSubscribeBigSmallVideo(i),{userId:e,tinyId:t,flag:n}}));af.emit(xm.RECEIVED_PUBLISHED_USER_LIST,{room:this,publishedUserList:t}),this.userManager.setRemotePublishedUserList(t)}closeUplink(e="you unpublished"){this.uplinkConnection&&(this.localTracks.size>0&&this.uplinkConnection.doUnpublish(),this.uplinkConnection.close(e),this.uplinkConnection instanceof gb&&(this.uplinkConnection=null)),this.localTracks.forEach((e=>e.unpublish())),this.localTracks.clear()}createDownlinkConnection({userId:e,tinyId:t,flag:n}){let i=new(this.singlePC?_S:hb)({userId:e,tinyId:t,room:this,signalChannel:this.signalChannel,enableSEI:this.enableSEI,flag:n});this.userManager.addRemotePublishedUser(i),this.installDownlinkEvents(i,e),this.emit("remote-published",i)}closeDownLinkConnection(e,t="remote user unpublished"){let n=this.remotePublishedUserMap.get(e);n&&(n.close(t),this.emit("remote-unpublished",n))}installDownlinkEvents(e,t){e.on("error",(e=>{let n=e.getCode();n!==Tu.ICE_TRANSPORT_ERROR&&(n===Tu.DOWNLINK_RECONNECTION_FAILED&&this.closeDownLinkConnection(t),this.emit("error",e))})),e.on("connection-state-changed",(t=>{this.emit("media-connection-state-changed",ru(iu({},t),{userId:e.userId}))})),e.on("firewall-restriction",(()=>{this.emit("firewall-restriction")}))}startSyncUserListInterval(){-1===this._syncUserListInterval&&(this._syncUserListInterval=kg.run(ah,this.syncUserList.bind(this)))}stopSyncUserListInterval(){kg.clearTask(this._syncUserListInterval),this._syncUserListInterval=-1}syncUserList(){return this.getUserList().then((e=>{this.userManager.setUserList(e)})).catch((e=>{this._log.debug(`sync user list failed: ${e}`)}))}getUserList(){var e;return null!=(e=this.signalChannel)&&e.isConnected?this.signalChannel.sendWaitForResponse({command:"get_user_list",responseCommand:$E.USER_LIST_RES,enableLog:!1,timeout:2e3}).then((({data:e})=>{let{code:t,message:n}=e;if(0===t)return(e.data&&e.data.userList||[]).map((({userId:e,srcTinyId:t,role:n})=>({userId:e,tinyId:t,role:n})));throw nf({key:fh.SIGNAL_RESPONSE_FAILED,data:{signalResponse:$E.USER_LIST_RES,code:t,message:n}})})):Promise.reject("not connected")}getAllConnections(){let e=[...this.remotePublishedUserMap.values()];return this.uplinkConnection&&e.push(this.uplinkConnection),e}isRelayMaybeFailed(){if(this.signalChannel&&!this.signalChannel.isOnline||!rb)return!1;if(this.singlePC)return this.singlePC.reconnectionCount>6;let e=this.getAllConnections();if(0===e.length)return!1;for(let t=0;t<e.length;t++)if(e[t].getReconnectionCount()<6)return!1;return!0}checkConnectionsToReconnect(){var e;this.singlePC?(null==(e=this.singlePC.getPeerConnection())?void 0:e.connectionState)===Md.CLOSED&&!this.singlePC.isReconnecting&&(this._log.warn("spc pc is closed but not reconnect"),this.singlePC.startReconnection()):this.getAllConnections().forEach((e=>{if(e instanceof ob&&!e.getIsReconnecting()){let t=e.getPeerConnection();t&&t.connectionState===Md.CLOSED&&(this._log.warn(`[${e.getUserId()}] pc is closed but not reconnect`),e.startReconnection())}}))}fallbackToMPC(){return du(this,null,(function*(){var e;if(this._log.warn("fallback to multi pc"),lf.uploadEvent({log:"stat-fallback",userId:this.userId}),this.enableSPC=!1,null==(e=this.singlePC)||e.close(),this.singlePC=null,this.isJoined&&(yield this.reJoin(!1)),this.uplinkConnection){let e=this.uplinkConnection;this.uplinkConnection=new gb({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this.signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}),e.isMainStreamPublished&&(yield this.uplinkConnection.publish({localAudioTrack:e.localMainAudioTrack,localVideoTrack:e.localMainVideoTrack,isAuxiliary:!1})),e.isAuxStreamPublished&&(yield this.uplinkConnection.publish({localAudioTrack:e.localAuxAudioTrack,localVideoTrack:e.localAuxVideoTrack,isAuxiliary:!0})),e.close()}this.remotePublishedUserMap.forEach((e=>{let t=new hb({userId:e.userId,tinyId:e.tinyId,room:this,signalChannel:this.signalChannel,enableSEI:this.enableSEI,flag:e.flag,remoteAudioTrack:e.remoteAudioTrack,remoteVideoTrack:e.remoteVideoTrack,remoteAuxiliaryTrack:e.remoteAuxiliaryTrack});this.installDownlinkEvents(t,e.userId),this.remotePublishedUserMap.set(e.userId,t),e.isMainStreamSubscribed&&t.subscribe(e.subscribeState,"main"),e.isAuxStreamSubscribed&&t.subscribe(e.subscribeState,"auxiliary")}))}))}destroy(){this.isDestroyed||(this.signalChannel&&(this._log.info("destroying SignalChannel"),this.signalChannel.close(),this.signalChannel=null),super.destroy(),this._joinReject&&(this._joinReject(new Au({code:Tu.INVALID_OPERATION,message:nf({key:fh.CLIENT_DESTROYED,data:{funName:"join"}})})),this.clearJoinTimeout(),this.reset()),this.removeAllListeners(),this.healthDetector.destroy())}switchRole(e){return du(this,null,(function*(){this.role!==e&&("audience"===e&&this.uplinkConnection&&this.closeUplink("you switch role to audience"),yield this.doSwitchRole(e))}))}doSwitchRole(e){let t={command:"change_role",data:{role:"anchor"===e?20:21,privateMapKey:this.privateMapKey,latencyLevel:this.latencyLevel},responseCommand:$E.SWITCH_ROLE_RES,retries:1};return this._log.info(`switchRole signal data: ${JSON.stringify(t.data)}`),this.signalChannel.sendWaitForResponseWithRetry(t).then((t=>{let{code:n,message:i}=t.data;if(0!==n)throw new Au({code:Tu.SWITCH_ROLE_FAILED,message:nf({key:fh.SWITCH_ROLE_FAILED,data:{message:i,code:n}})});this.role=e})).catch((e=>{throw e instanceof Au&&e.getCode()===Tu.API_CALL_TIMEOUT&&(e=new Au({code:Tu.SWITCH_ROLE_FAILED,message:nf({key:fh.SWITCH_ROLE_TIMEOUT})})),this._log.error(e),e}))}publish(...e){return du(this,null,(function*(){let t={},n={};e.forEach((e=>{e instanceof Ev&&(e instanceof wv?n.audio=e:t.audio=e),e instanceof Sv&&(e instanceof Av&&2===e.mediaType?n.video=e:t.video=e)}));let i=xS(t),r=xS(n);(!i||!r)&&!this.uplinkConnection&&(this.singlePC?this.uplinkConnection=new fS({userId:this.userId,tinyId:this.tinyId,room:this}):this.uplinkConnection=new gb({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this.signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}),this.uplinkConnection.on("connection-state-changed",(e=>{this.emit("media-connection-state-changed",ru(iu({},e),{userId:this.userId}))})),this.uplinkConnection.on("firewall-restriction",(()=>{this.emit("firewall-restriction")})),this.uplinkConnection.on("error",(e=>{let t=e.getCode();t!==Tu.ICE_TRANSPORT_ERROR&&(t===Tu.UPLINK_RECONNECTION_FAILED&&this.closeUplink(),this.emit("error",e))})));let o=e.map((e=>e.kind)).join(",");i||(this._log.info(`publish() => main ${o}`),yield this.uplinkConnection.publish({localAudioTrack:t.audio,localVideoTrack:t.video,isAuxiliary:!1}),this._log.info("main is published")),r||(this._log.info(`publish() => aux ${o}`),yield this.uplinkConnection.publish({localAudioTrack:n.audio,localVideoTrack:n.video,isAuxiliary:!0}),this._log.info("aux is published"))}))}unpublish(...e){return du(this,null,(function*(){if("live"===this.scene&&"anchor"!==this.role||!this.isMainStreamPublished&&!this.isAuxStreamPublished||!this.uplinkConnection)return;let t={},n={};e.forEach((e=>{!e.mediaTrack||!e.isPublished||(e instanceof Ev&&(e instanceof wv?n.audio=e:t.audio=e),e instanceof Sv&&(e instanceof Av&&2===e.mediaType?n.video=e:t.video=e))}));try{let i=e.map((e=>e.kind)).join(",");xS(t)||(this._log.info(`unpublish() => main ${i}`),yield this.uplinkConnection.unpublish({localAudioTrack:t.audio,localVideoTrack:t.video})),xS(n)||(this._log.info(`unpublish() => aux ${i}`),yield this.uplinkConnection.unpublish({localAudioTrack:n.audio,localVideoTrack:n.video}))}catch(e){}0===this.localTracks.size&&this.closeUplink("you unpublished")}))}addTrack(e){if(!this.uplinkConnection||!e.mediaTrack)return Promise.resolve();let t=this.uplinkConnection.addTrack(e);return e.publish(this,t),t}removeTrack(e){return this.uplinkConnection&&e.mediaTrack?this.uplinkConnection.removeTrack(e).then((t=>(e.unpublish(),t))):Promise.resolve()}replaceTrack(e){return this.uplinkConnection&&e.mediaTrack&&ag()?this.uplinkConnection.replaceTrack(e).then((t=>{t&&af.emit(xm.LOCAL_TRACK_REPLACED,{track:e})})):Promise.resolve()}setBandWidth(e){return du(this,null,(function*(){!this.uplinkConnection||(yield this.uplinkConnection.setBandwidth(e),yield this.uplinkConnection.sendMediaSettings())}))}enableSmall(e){return du(this,null,(function*(){if(!this.uplinkConnection||!this.uplinkConnection.localMainVideoTrack)return Promise.resolve();e&&this.uplinkConnection.localMainVideoTrack.small&&(yield this.setBandWidth({type:ld.VIDEO,videoType:ld.SMALL,bandwidth:this.uplinkConnection.localMainVideoTrack.small.bitrate})),yield this.uplinkConnection.enableSmall(e)}))}subscribe(...e){return du(this,null,(function*(){if(e=e.filter((e=>!e.isSubscribed)),0===e.length)return;let{userId:t}=e[0],n=this.remotePublishedUserMap.get(t);if(!n)return;let i=e.find((e=>2===e.mediaType))?"auxiliary":"main";try{let r=iu({},n.subscribeState);e.forEach((e=>{switch(e.mediaType){case 1:r.audio=!0;break;case 4:r.video=!0;break;case 8:r.smallVideo=!0;break;case 2:r.auxiliary=!0}}));let o=this._changeBigSmallRecords.get(t);o&&o.options.smallVideo&&n.muteState.hasSmall&&r.video&&(r.video=!1,r.smallVideo=!0),af.emit(xm.SUBSCRIBE_START,{room:this,streamType:i,remotePublishedUser:n,subscribeState:r}),this._log.info(`subscribe() => ${t} ${i} [${cb(r)}] prev: [${cb(n.subscribeState)}]`),yield n.subscribe(r,i),this._log.info(`subscribe ${t} ${i} done`);for(let t of e)t.mediaTrack||(yield t.waitHasMediaTrack());af.emit(xm.SUBSCRIBE_SUCCESS,{room:this,streamType:i,remotePublishedUser:n})}catch(e){let n=e instanceof Au?e.getCode():Tu.UNKNOWN,r=e;throw e instanceof Au?n===Tu.REMOTE_STREAM_NOT_EXIST&&(r=new Au({code:Tu.API_CALL_ABORTED,message:nf({key:fh.API_CALL_ABORTED,data:{message:e.message,userId:t,streamType:i}})}),this._log.warn(r)):(r=new Au({code:n,message:nf({key:fh.SUBSCRIBE_FAILED,data:{message:e.message,userId:t,streamType:i}})}),this._log.error(r)),r}}))}unsubscribe(...e){return du(this,null,(function*(){let{userId:t}=e[0],n=this.remotePublishedUserMap.get(t);if(!n)return;let i=e.find((e=>2===e.mediaType))?"auxiliary":"main";this._log.info(`unsubscribe() => ${t} ${i}`);try{yield n.unsubscribe({remoteTracks:e,streamType:i})}catch(e){this._log.warn(`unsubscribe() => failed ${e}`)}e.forEach((e=>{e.unsubscribe(),8===e.mediaType&&e.setMediaType(4)})),af.emit(xm.UNSUBSCRIBE_SUCCESS,{room:this,streamType:i,remotePublishedUser:n})}))}setEncodedDataProcessingListener(e){throw new Error("Method not implemented.")}enableAudioVolumeEvaluation(e=2e3,t){if(e<=0)return this._enableAudioVolumeEvaluation=!1,void kg.clearTask(this._audioVolumeIntervalId);e=Math.floor(Math.max(e,100)),af.emit(xm.AUDIO_LEVEL_INTERVAL,{interval:e}),this._audioVolumeIntervalId&&kg.clearTask(this._audioVolumeIntervalId),this._enableAudioVolumeEvaluation=!0,this._audioVolumeIntervalId=kg.run(sh,(()=>{var e;let t=[];null==(e=this.remotePublishedUserMap)||e.forEach((e=>{if(e.muteState.hasAudio){let n=Math.floor(100*e.remoteAudioTrack.getAudioLevel());t.push({userId:e.userId,volume:n})}})),this.emit("audio-volume",t)}),{fps:1e3/e,backgroundTask:t})}getLocalAudioStats(){return du(this,null,(function*(){let e={};if(e[this.userId]={bytesSent:0,packetsSent:0},this.uplinkConnection){let t=yield this._stats.getSenderStats(this.uplinkConnection);e[this.userId]={bytesSent:t.audio.bytesSent,packetsSent:t.audio.packetsSent}}return e}))}getLocalVideoStats(){return du(this,null,(function*(){let e={};if(e[this.userId]={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0},this.uplinkConnection){let{video:{bytesSent:t,packetsSent:n,framesEncoded:i,framesSent:r,frameWidth:o,frameHeight:a}}=yield this._stats.getSenderStats(this.uplinkConnection);e[this.userId]={bytesSent:t,packetsSent:n,framesEncoded:i,framesSent:r,frameWidth:o,frameHeight:a}}return e}))}getTransportStats(){return du(this,null,(function*(){let e={rtt:0,downlinksRTT:{}};if(this.uplinkConnection){let t=yield this._stats.getSenderStats(this.uplinkConnection);e.rtt=t.rtt}for(let[,t]of this.remotePublishedUserMap){let n=yield this._stats.getReceiverStats(t);e.downlinksRTT[n.userId]=n.rtt}return e}))}getRemoteVideoStats(e){return du(this,null,(function*(){let t={};for(let[n,i]of this.remotePublishedUserMap)"main"===e&&i.muteState.hasVideo&&(t[n]=i.remoteVideoTrack.stat),"auxiliary"===e&&i.muteState.hasAuxiliary&&(t[n]=i.remoteAuxiliaryTrack.stat);return t}))}getRemoteAudioStats(){return du(this,null,(function*(){let e={};for(let[t,n]of this.remotePublishedUserMap)n.muteState.hasAudio&&(e[t]=n.remoteAudioTrack.stat);return e}))}setTurnServer(e,t){this._log.info(`set turn server: ${JSON.stringify(e)} ${t||""}`);let n=[];Array.isArray(e)?e.forEach((e=>n.push(Cu.getTurnServer(e)))):Cu.isPlainObject(e)&&n.push(Cu.getTurnServer(e)),this._turnServers=n,t&&(this._iceTransportPolicy=t)}sendStartMixTranscode(e){return this.signalChannel.sendWaitForResponse({command:"start_mcu_mix",data:e,timeout:5e3,responseCommand:$E.START_MIX_TRANSCODE_RES,commandDesc:"startMixTranscode"})}sendStopMixTranscode(e){return this.signalChannel.sendWaitForResponse({command:"stop_mcu_mix",data:e,timeout:5e3,responseCommand:$E.STOP_MIX_TRANSCODE_RES,commandDesc:"stopMixTranscode"})}sendStartPublishCDN(e,t=!0){return this.signalChannel.sendWaitForResponse({command:t?"start_publishing":"start_push_user_cdn",data:e,timeout:5e3,responseCommand:t?$E.START_PUBLISH_TENCENT_CDN_RES:$E.START_PUBLISH_GIVEN_CDN_RES,commandDesc:"startPublishCDN"})}sendStopPublishCDN(e,t=!0){return this.signalChannel.sendWaitForResponse({command:t?"stop_publishing":"stop_push_user_cdn",data:e,timeout:5e3,responseCommand:t?$E.STOP_PUBLISH_TENCENT_CDN_RES:$E.STOP_PUBLISH_GIVEN_CDN_RES,commandDesc:"stopPublishCDN"})}sendAbilityStatus(e){var t;null==(t=this.signalChannel)||t.sendWaitForResponse({command:"ability_status_report",data:e,timeout:5e3,responseCommand:$E.ABILITY_STATUS_REPORT_RESULT,commandDesc:"ability status report"}).catch((e=>{}))}getIceServers(){return 0===this._turnServers.length&&this.scheduleResult.iceServers?this.scheduleResult.iceServers:this._turnServers}getIceTransportPolicy(){return this._iceTransportPolicy||this.scheduleResult.iceTransportPolicy||"all"}getLogger(){return this._log}enableAIVoice(){throw new Error("Method not implemented.")}getSignalChannelUrl(){let e={mainUrl:"",backupUrl:""},t=Cu.getEnv();return t?(e.mainUrl=`wss://${t}.rtc.qq.com`,e.backupUrl=e.mainUrl):this.proxy_ws?(e.mainUrl=this.proxy_ws,e.backupUrl=e.mainUrl):this.proxy_unified?(e.mainUrl=`wss://${this.proxy_unified}`,e.backupUrl=e.mainUrl):Array.isArray(this.scheduleResult.domains)&&this.scheduleResult.domains.length>0&&(e.mainUrl=`wss://${this.scheduleResult.domains[0]}`,e.backupUrl=e.mainUrl,this.scheduleResult.domains[1]&&(e.backupUrl=`wss://${this.scheduleResult.domains[1]}`)),e}getSignalInfo(){var e;return(null==(e=this.signalChannel)?void 0:e.getSignalInfo())||{clientIp:"",relayIp:""}}reset(e=!1){this.stopSyncUserListInterval(),this.stopHeartbeat(),this.closeConnections(),this.clearNetworkQuality(),this.closeUplink("you exitRoom"),this.signalChannel&&(e&&this.signalChannel.keepAlive&&this.signalChannel.isConnected?this.signalChannel.stopKeepAliveIn(3600):this.signalChannel.close(),this.setSignalChannel(null)),this._stats.reset(),this.userManager.clear(),this.userManager.removeAllListeners(),this.singlePC&&(this.singlePC.close(),this.singlePC=null),this.scheduleResult={domains:null,iceServers:null,iceTransportPolicy:null,trtcAutoConf:null}}checkSubscribeBigSmallVideo(e){return du(this,null,(function*(){let{subscribeState:t,userId:n,muteState:{hasSmall:i,hasVideo:r}}=e;if(!i&&!r||!t.video&&!t.smallVideo)return;let o=this._changeBigSmallRecords.get(n);if(!o||o.isSubscribing||o.reSubscribeCount<=0)return;let{options:a,reSubscribeCount:s}=o;if(a.video&&t.video||a.smallVideo&&t.smallVideo&&i)return;let l={audio:e.remoteAudioTrack.isSubscribed||e.remoteAudioTrack.isSubscribing,auxiliary:e.remoteAuxiliaryTrack.isSubscribed||e.remoteAuxiliaryTrack.isSubscribing,video:a.video,smallVideo:a.smallVideo};try{if(!i&&l.smallVideo&&(l.video=!0,l.smallVideo=!1),l.smallVideo===t.smallVideo&&l.video===t.video)return;o.isSubscribing=!0,o.reSubscribeCount=s-1,yield e.subscribe(l,"main"),e.remoteVideoTrack.setMediaType(l.smallVideo?8:4),this._log.info(`change [${n}] to ${l.smallVideo?"small":"big"} video successfully. count ${rh-o.reSubscribeCount}.`),o.isSubscribing=!1,o.reSubscribeCount=rh}catch(e){this._log.info(`change [${n}] to ${l.smallVideo?"small":"big"} video failed. count ${rh-o.reSubscribeCount}.`),o.isSubscribing=!1,0===o.reSubscribeCount&&this._changeBigSmallRecords.delete(n)}}))}changeType(e,t){let n={options:{video:!e,smallVideo:e},isSubscribing:!1,reSubscribeCount:rh};this._changeBigSmallRecords.set(t.userId,n),this._log.info(`set [${t.userId}] video prefer type: ${e?"small":"big"}`)}get smallStreamConfig(){return this._smallStreamConfig}_initBusinessInfo(e){this._businessInfo=e.businessInfo;let t={};if(bS(e.businessInfo)&&(t=JSON.parse(e.businessInfo)),!SS(e.pureAudioPushMode)){if(!Number.isInteger(Number(e.pureAudioPushMode)))throw new Au({code:Tu.INVALID_PARAMETER,message:nf({key:fh.INVALID_PURE_AUDIO})});this._pureAudioPushMode=e.pureAudioPushMode,t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.pure_audio_push_mod=this._pureAudioPushMode}if(!SS(e.userDefineRecordId)){let n=/^[A-Za-z0-9_-]{1,64}$/gi;if(null===e.userDefineRecordId.match(n))throw new Au({code:Tu.INVALID_PARAMETER,message:nf({key:fh.INVALID_USER_DEFINE_RECORDID})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_record_id=e.userDefineRecordId}if(!SS(e.userDefinePushArgs)){if(!(bS(e.userDefinePushArgs)&&String(e.userDefinePushArgs)&&String(e.userDefinePushArgs).length<=256))throw new Au({code:Tu.INVALID_PARAMETER,message:nf({key:fh.INVALID_USER_DEFINE_PUSH_ARGS})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_push_args=e.userDefinePushArgs}xS(t)||(this._businessInfo=JSON.stringify(t))}sendCustomMessage(e){var t;null==(t=this._customMessageManager)||t.send(e)}enableInsertableStreams(){if(this.singlePC&&!this.singlePC.enableInsertableStreams)return this.singlePC.enableInsertableStreams=!0,this.singlePC.startReconnection()}sendSignalMessage(e){var t;return this.signalChannel?null==(t=this.signalChannel)?void 0:t.sendWaitForResponseWithRetry(e):Promise.reject(new Au({code:Tu.INVALID_OPERATION,message:"not join"}))}};lu([Bb(["left",jb.INIT],"joined"),Vg({settings:{retries:1,timeout:0},onError(e,t,n){this._isUsingCachedSchedule&&!this.isDestroyed?(this._log.warn("is using cached schedule, retry join"),df(!0),this.reset(),t()):this.signalChannel&&this.signalChannel.isConnected&&this.signalChannel.keepAlive?(this._log.warn("is using keepAlive ws, retry join"),this.signalChannel.close(),this.reset(),t()):(this.reset(),this._log.error(e),n(e))}}),lv((e=>{let t=new class{constructor(){this._set=new Set,af.on(xm.LEAVE_SUCCESS,this.delete,this)}add({room:e,roomId:t}){if("rtc"===e.scene)return;let n=this.getKey(e.userId,t||e.roomId,e.sdkAppId,e.useStringRoomId);this._set.add(n)}delete({room:e,roomId:t}){if("rtc"===e.scene)return;let n=this.getKey(e.userId,e.roomId||t,e.sdkAppId,e.useStringRoomId);this._set.delete(n)}getKey(e,t,n,i){return`${n}_${t}_${e}_${i}`}isJoined({userId:e,roomId:t,sdkAppId:n,room:i}){return"rtc"!==i.scene&&this._set.has(this.getKey(e,t,n,i.useStringRoomId))}};return function(n,i,r){return du(this,null,(function*(){let o=String(n.roomId||n.strRoomId);if(this.userId=n.userId,this.sdkAppId=n.sdkAppId,this.userSig=n.userSig,this._log.setSdkAppId(this.sdkAppId),this._log.setUserId(this.userId),this.scene=i,n.privateMapKey=n.privateMapKey||"",this.isJoined)throw new Au({code:Tu.INVALID_OPERATION,message:nf({key:fh.INVALID_JOIN})});if(this.checkDestroy(),t.isJoined({userId:this.userId,roomId:o,sdkAppId:this.sdkAppId,room:this}))throw new Au({code:Tu.INVALID_OPERATION,message:nf({key:fh.REPEAT_JOIN,data:this.userId})});t.add({room:this,roomId:o}),this.role=21===n.role?"audience":"anchor",this._log.info(`Join() => joining room: ${o} useStringRoomId: ${this.useStringRoomId} scene: ${this.scene} role: ${this.role}`),af.emit(xm.JOIN_START,{room:this,roomId:o,params:n}),this.checkSystemResult=yield Cm.checkSystemRequirementsInternal(),this.checkDestroy();let a=Cu.getEnv();a||(a=Qu.QCLOUD,this.proxy_ws&&(this.proxy_ws.startsWith(ud.OLD_CLOUD_LADDER)?a=Qu.OLD_CLOUD_LADDER:this.proxy_ws.startsWith(ud.WEBRTC)&&(a=Qu.WEBRTC))),lf.setConfig({env:a,sdkAppId:String(this.sdkAppId),userId:this.userId,roomId:o}),BE.call(this);let{isH264EncodeSupported:s,isVp8EncodeSupported:l}=this.checkSystemResult.detail;if(!Cm.isWebRTCSupported()||!s&&!l)throw new Au({code:Tu.NOT_SUPPORTED,message:nf({key:fh.NOT_SUPPORTED_WEBRTC})});try{!this.proxy_ws&&!this.proxy_wt&&!this.scheduleResult.domains&&!Cu.getEnv()&&(yield this.schedule(n,r));let t=yield e.call(this,n,i,r);return this.roomId=o,this._joinedTimestamp=Cu.performanceNow(),af.emit(xm.JOIN_SUCCESS,{room:this}),30===r&&!n.component&&lf.uploadEvent({log:`stat-conv-${Number(Hp)}-${location.hostname}`,userId:this.userId}),t}catch(e){throw t.delete({room:this,roomId:o}),af.emit(xm.JOIN_FAILED,{room:this,error:e}),e}}))}}))],AS.prototype,"join",1),lu([Bb("joined","left",{ignoreError:!0,success(){this.reset(!0)}}),lv((e=>function(...t){return du(this,null,(function*(){af.emit(xm.LEAVE_START,{room:this}),yield e.call(this),af.emit(xm.LEAVE_SUCCESS,{room:this,roomId:this.roomId})}))})),mv("leave room"),Fg({fnName:"publish",validateArgs:!1}),Fg({fnName:"unsubscribe",validateArgs:!1})],AS.prototype,"leave",1),lu([fv(),lv((e=>function(...t){return du(this,null,(function*(){if("live"===this.scene&&"anchor"!==this.role||(t=t.filter((e=>e.outMediaTrack&&"capture"===e.state)),!t.length))return;af.emit("61",{room:this});let n=e.apply(this,t);return t.forEach((e=>e.publish(this,n))),n}))})),Vg({settings:{retries:Dd,timeout:e=>Lf(e)},onError(e,t,n){var i;null!=(i=e.message)&&i.includes("timeout")?(this._log.warn("publish timeout"),t()):(this._log.error(`publish failed: ${e}`),n(e),af.emit(xm.PUBLISH_FAILED,{room:this}))}})],AS.prototype,"publish",1),lu([Fg({fnName:"publish"}),("api-call",function(e,t,n){let i=n.value;return n.value=function(...e){let t=hv.get(this);if(t){let n=t.queue.filter(((t,n)=>{if(0===n)return!0;let i=!0;return t.args.forEach((t=>{e.find((e=>e===t))||(i=!1)})),!i||(t.reject(new Au({code:Tu.API_CALL_ABORTED,message:"api-call"})),!1)}));t.queue=n}return i.apply(this,e)},n}),fv(),lv((e=>function(...t){let n=e.apply(this,t);return t.forEach((e=>e.unpublish())),n})),sv((function(){var e,t;0===this.localTracks.size&&tg()&&(null==(t=null==(e=this.singlePC)?void 0:e.getPeerConnection())||t.getSenders().forEach((e=>e.track&&e.replaceTrack(null))))}))],AS.prototype,"unpublish",1),lu([gv((e=>e.userId))],AS.prototype,"replaceTrack",1),lu([gv(((...e)=>e[0].userId)),Rv(),lv((e=>function(...t){let n=e.apply(this,t);return t.forEach((e=>!e.isSubscribed&&e.subscribe(n))),n})),Vg({settings:{retries:Dd,timeout:e=>Lf(e)},onError(e,t,n,i){e.message.includes("timeout")?(this._log.warn("subscribe timeout"),t()):(this._log.error(`subscribe failed: ${e}`),n(e),af.emit(xm.SUBSCRIBE_FAILED,{room:this,remoteTracks:i}))}})],AS.prototype,"subscribe",1),lu([Fg({fnName:"subscribe",callback(...e){this.singlePC||e.forEach((e=>{let t=this.remotePublishedUserMap.get(e.userId);t&&!t.isMainStreamSubscribed&&!t.isAuxStreamSubscribed&&t.close("you unsubscribed")}))}}),gv(((...e)=>e[0].userId))],AS.prototype,"unsubscribe",1),FE.create=FE._create.bind(FE,AS);var wS=FE,IS=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},RS=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};const CS=function(e){var t,n=e.token,i=e.taskId,r=e.tokenType,o=e.env,a=void 0===o?"prod":o;try{this.instance=new WebSocket("".concat("https"===(null===(t=CM.proxy)||void 0===t?void 0:t.protocol)?"wss":"ws","://").concat(CM.proxy.host||"interactive-virtualhuman".concat("int"===a?"-int":"",".xiaoice.com"),"/openapi/interactive/websocket_v2406?taskId=").concat(i,"&token=").concat(n,"&tokenType=").concat(r))}catch(e){console.log(e)}};var MS=function(e,t){return"".concat(e<0?e*t/100:e/100,"em")},kS=function(e,t){return"".concat(e<0?e*t/100:e/100,"em")},NS=function(e){return"".concat(e/100,"em")},DS=function(e){return"".concat(e/100,"em")};function OS(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function PS(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function LS(e){if("string"==typeof e)try{var t=JSON.parse(e);return!("object"!=typeof t||!t)}catch(e){return!1}return!1}var US=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},VS=function(){function e(e){this.roundDialogs=new Map,this.dialogs=new Map,this.hasTalked=[],this.waitTalk=new Map,this.subscribe=new Map,this.sessionId=e}return e.prototype.updateOrCreate=function(e,t){var n,i,r,o,a,s=this;if(2===t.state||1===t.state){if(2===t.state)if(this.roundDialogs.set(e,null==t?void 0:t.splitTexts),null===(n=null==t?void 0:t.splitTexts)||void 0===n?void 0:n.length)null===(o=this.subscribe.get(e))||void 0===o||o[0]({newContent:{text:"",id:t.queryId},dialog:t});else{var l=LS(t.replyText)?null===(i=JSON.parse(t.replyText))||void 0===i?void 0:i.text:t.replyText;null===(r=this.subscribe.get(e))||void 0===r||r[0]({newContent:{text:l,id:t.queryId},dialog:t})}var c=null==t?void 0:t.splitTexts.filter((function(e){return!s.hasTalked.some((function(t){return e.id==t.id}))}));console.log("difference:",c),(null==c?void 0:c.length)&&c.forEach((function(n){var i,r;s.subscribeText(e,s.subscribeCb,(function(){}),!(null===(i=s.hasTalked)||void 0===i?void 0:i.length)),null===(r=s.subscribe.get(e))||void 0===r||r[0]({newContent:n,dialog:t}),s.hasTalked=US(US([],s.hasTalked,!0),[n],!1)}))}else 3===t.state&&(null===(a=this.subscribe.get(e))||void 0===a||a[1](t),this.subscribe.delete(e))},e.prototype.subscribeText=function(e,t,n,i){return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var r=this;return function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}(this,(function(o){return[2,new Promise((function(n,i){r.subscribeCb=t,r.subscribe.set(e,[n,i])})).then((function(n){return null==t||t(n.newContent,e,n.dialog,r.sessionId,i),n})).catch((function(e){return null==n||n(e,r.sessionId,e),e}))]}))}))},e.prototype.traceDialog=function(e){this.sessionId=e+"trace"},e}();const FS=VS;var BS=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},HS=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},zS=__webpack_require__(964),jS=__webpack_require__.n(zS),GS=function(){return GS=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},GS.apply(this,arguments)},$S=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},WS=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},qS=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};const XS=function(e){e.tvRef;var t=e.signature,n=e.onPlayStream,i=void 0===n?function(){}:n,r=e.onError,a=void 0===r?function(){}:r,s=e.onStopStream,l=void 0===s?function(){}:s,c=e.onTalkEnd,u=void 0===c?function(e){}:c,d=e.onTalkStart,h=void 0===d?function(e){}:d,p=e.onInited,f=void 0===p?function(e){}:p,m=e.onJoinRoom,g=void 0===m?function(e){}:m,_=e.mode,v=void 0===_?0:_,y=(e.asr,e.timeout),E=void 0===y?3e5:y,S=(e.rtcVersion,e.bitrateEnum),T=void 0===S?"R_720P":S,x=e.env,A=void 0===x?"prod":x,j=(e.projectId,function(e){void 0===e&&(e={});var t=(0,o.useState)(e),n=t[0],i=t[1];return[n,(0,o.useCallback)((function(e){i((function(t){return Kt(Kt({},t),e instanceof Function?e(t):e)}))}),[])]}({test:!1,init:!1,listening:!1,bgm:"",bgVideo:{volume:0,loop:!0,videoUrl:"",videoPoster:""},color:{primaryColor:"#5991FF",secondaryColor:"#5991FF"},chating:!0,speaking:!1,asring:!1,asrModal:!0,chatList:[],chatValue:"",loading:!1,pageLoad:!0,loadPercentage:0,animationState:kl.STATIC,isBusy:!1,stt:"",connect:!1,mediaData:null,carArea:"",eleFeedArea:"",status:"recording",displayImages:[],displayTexts:[],human:{Height:0,Width:0,X:0,Y:0,mediaUrl:"string",webIndex:1,zIndex:1},companyId:"",createUserId:"",videoRatio:"",videoSize:{width:0,height:0},globalImage:[],globalTexts:[],globalVideo:[],globalAudio:null,displayAudio:null,displayVideo:[],caption:null,emoje:"",startAction:b,closeAction:b,chatAction:b,modeAction:b,thinkAction:b,preAns:"",preQue:"",templateName:"",canUse:!0,openArea:!1,checked:!1,hobbies:[""],waitOrStart:"pre",ticketInfo:{},showpreAns:"",mode:0===v?"work":1===v?"fun":"big",showModeMask:!1,thinkImg:"",overTwo:"",holdOn:!1,trans:!1,liveOrMatt:"live",interactiveModes:[0,1,2]})),G=j[0],$=j[1],W=((0,o.useRef)(""),(0,o.useRef)(null)),q=(0,o.useRef)(""),X=(0,o.useRef)(null),Y=(0,o.useRef)(OS()),J=(0,o.useRef)(null),K=(0,o.useRef)({player:null,controller:null,authInfo:{},webSorcket:void 0,audio:null,playing:!1,connect:!1}),Q=(0,o.useRef)(PS()),Z=(0,o.useRef)(OS()),ee=((0,o.useRef)(""),(0,o.useRef)(""),(0,o.useRef)("")),te=(0,o.useRef)(OS()),ne=(0,o.useRef)(0),ie=((0,o.useRef)(G.status),(0,o.useRef)(!1)),re=((0,o.useRef)({}),(0,o.useRef)(0)),oe=(0,o.useRef)([]),ae=(0,o.useRef)([]),se=(0,o.useRef)([]),le=(0,o.useRef)(null),ce=(0,o.useRef)({}),ue=(0,o.useRef)(!1),de=(0,o.useRef)(0),he=(0,o.useRef)(0),pe=((0,o.useRef)(0),(0,o.useRef)(0)),fe=(0,o.useRef)(""),me=(0,o.useRef)(""),ge=(0,o.useRef)("v3"),_e=(0,o.useRef)(0),ve=(0,o.useRef)(0),ye=(0,o.useRef)(""),Ee=(0,o.useRef)(""),be=(0,o.useRef)(null),Se=(0,o.useRef)(""),Te=(0,o.useRef)(""),xe=function(e){var t=e.sessionIdRef,n=e.projectId,i=e.dialogRef,r=e.onError,a=e.taskIdRef,s=e.userIdRef,l=(0,o.useRef)(new Map),c=(0,o.useRef)(!1),u=(0,o.useRef)(0);console.log("================useAskStream====ask======OUT==========",n);var d={ask:function(e,t,n,o){return BS(void 0,void 0,void 0,(function(){var s,d;return HS(this,(function(h){switch(h.label){case 0:console.log("================useAskStream====ask================",n),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,(p={sessionId:e,text:t,projectId:n,event:o,taskId:null==a?void 0:a.current,textSplitParam:{type:1}},qt({method:"POST",url:"/openapi/talk/askStream",params:{projectId:null==p?void 0:p.projectId},data:Xt(Xt({},p),{preview:!0})})).catch((function(e){r&&r(D)}))];case 2:return s=h.sent(),console.log("===============askStreamAnswer  res====================="),console.log(s),console.log("==============askStreamAnswer  res======================"),s?(d=s.traceId,i.current=new FS(e),l.current.set(d,i.current),u.current=(new Date).getTime(),c.current=!1,[2,{traceId:d,dialog:i.current}]):[2,{traceId:1011001,dialog:s}];case 3:return[2,{traceId:"",dialog:h.sent()}];case 4:return[2]}var p}))}))},get:function(e){return BS(void 0,void 0,void 0,(function(){var i,o,h,p,f;return HS(this,(function(m){switch(m.label){case 0:return i=l.current.get(e),[4,(g={traceId:e},qt({method:"GET",url:"/openapi/talk/getStreamAnswer",params:{traceId:null==g?void 0:g.traceId},data:g})).catch((function(e){r&&r(O)}))];case 1:return o=m.sent(),null==i||i.updateOrCreate(e,o),console.log("===============getStreamAnswer  res=====================",o),(null==o?void 0:o.replyText)&&!c.current&&(h=(new Date).getTime()-u.current,c.current=!0,Jt({publishType:"common",clientType:"web",preview:!1,taskId:null==a?void 0:a.current,projectId:n,userId:null==s?void 0:s.current,costMillis:h,statisticBizType:103,clientVersion:"1.6.1",extras:{answerSource:null==o?void 0:o.from,modelType:null===(f=null==o?void 0:o.extra)||void 0===f?void 0:f.modelType,askId:t.current}})),2===(null==o?void 0:o.state)||3===(null==o?void 0:o.state)?[2,!0]:1===(null==o?void 0:o.state)?(p=setTimeout((function(){d.get(e),clearTimeout(p)}),400),[2,!0]):[2]}var g}))}))}};return{streamController:d,streamList:l}}({sessionIdRef:Y,projectId:CM.project,dialogRef:be,onError:a,taskIdRef:Se,userIdRef:Te}),Ae=xe.streamController,we=xe.streamList,Ie=((0,o.useRef)(""),(0,o.useRef)("")),Re=(0,o.useRef)(new Map),Ce=(0,o.useRef)(new Map),Me=(0,o.useRef)(0),ke=(0,o.useRef)(0),Ne=function(){De(),he.current=(new Date).getTime(),We(Dl.PING,"heartbeat"),de.current=setInterval((function(){var e;if(ie.current)return Ne(),console.log("speaking"),void We(Dl.PING,"heartbeat");We(Dl.PING,"heartbeat"),console.log("handleDo"),(new Date).getTime()-he.current>(E||3e5)&&(console.log(""),a(B),st(),null===(e=K.current.webSorcket)||void 0===e||e.close(),Yt({taskId:Q.current}))}),1e3)};(0,o.useEffect)((function(){CM._sendMessage=We}),[G.mode]);var De=function(){de.current&&(clearInterval(de.current),de.current=void 0)},Oe=function(){pe.current&&(clearInterval(pe.current),pe.current=void 0)},Pe=function(){var e;CM.project?Le():(e=CM.exclusiveVirtualHumanId,qt({method:"GET",url:"/openapi/talk/rtc/project/get",params:{exclusiveVirtualHumanId:e}})).then((function(e){CM.project=e.id,Le()})).catch((function(e){a(C)}))},Le=function(){Ve()};(0,o.useEffect)((function(){return setTimeout((function(){Pe()}),50),CM._getConfig=Pe,function(){Be.cutLine(lt),De(),Oe()}}),[]),(0,o.useEffect)((function(){var e,t;G.animationState===kl.INPUT&&(null===(t=null===(e=X.current)||void 0===e?void 0:e.focus)||void 0===t||t.call(e))}),[G.animationState]),(0,o.useEffect)((function(){rt(".chat-list")}),[G.chatList]),(0,o.useEffect)((function(){rt(".long-conten")}),[G.showpreAns]);var Ue=function(){var e;Me.current<3?(Me.current++,setTimeout((function(){Be.joinChannle()}),3e3)):(Be.cutLine(),(e=CM.project+"*"+Q.current,qt({method:"POST",url:"/openapi/session/handshake/error",data:{sessionId:e}})).catch((function(e){a(H)})).then((function(e){return $S(void 0,void 0,void 0,(function(){var t,n;return WS(this,(function(i){return(null==e?void 0:e.code)?(t=e.code,n=e.message,617===t&&Cl.warning("20s"),console.error("socektError~",t,n),a({code:t,error:n})):(console.log(""),a(H)),[2]}))}))})))},Ve=function(){return $S(void 0,void 0,void 0,(function(){var e,t,n,i,r,o,s,l,c,u,d,h,p,m,g,_,v,y,E,S,T,x,A,R;return WS(this,(function(C){switch(C.label){case 0:return C.trys.push([0,2,,3]),[4,(M=CM.project,qt({method:"GET",url:"/openapi/talk/rtc/get",params:{projectId:M}}))];case 1:return(null==(e=C.sent())?void 0:e.dataJson)&&(null==e?void 0:e.companyId)&&(t=e.companyId,n=e.createUserId,i=e.dataJson,r=i.canvasData,o=i.csPersonDesign,s=i.config.interactiveModes,ye.current=t,Ee.current=n,l=r.videoRatio,c=r.videoSize,u=r.templateName,d=r.iceScenes,h=d.backgroundImage.mediaUrl,p=d.backgroundVideo,m=d.caption,g=d.displayImages,_=d.displayTexts,v=d.displayVideos,y=void 0===v?[]:v,E=d.backgroundMusic,S=void 0===E?{}:E,T=d.virtualHuman.attributes,_e.current=c.height,ve.current=c.width,$({init:"ipone9:16"!==u,bgm:h,bgVideo:{loop:null==p?void 0:p.loop,volume:null===(A=null==p?void 0:p.attributes)||void 0===A?void 0:A.videoVolume,videoUrl:null==p?void 0:p.mediaUrl,videoPoster:null===(R=null==p?void 0:p.attributes)||void 0===R?void 0:R.mediaUrl},human:T,companyId:t,createUserId:n,videoRatio:l,videoSize:c,templateName:u,globalImage:g,globalTexts:_,globalAudio:S,globalVideo:y,caption:m,interactiveModes:s,startAction:g.find((function(e){return"startAction"===e.attributes.toolType}))||b,closeAction:g.find((function(e){return"closeAction"===e.attributes.toolType}))||b,chatAction:g.find((function(e){return"chatAction"===e.attributes.toolType}))||b,thinkAction:g.find((function(e){return"thinkAction"===e.attributes.toolType}))||b,modeAction:g.find((function(e){return"modeAction"===e.attributes.toolType}))||b,hobbies:null==o?void 0:o.hobbies})),function(e){var t,n,i;try{if(CM._startRTC=Be.clickToStart,CM._stopRTC=function(){var e;CM.webInstance&&(null===(e=K.current.webSorcket)||void 0===e||e.close(),st(),Yt({taskId:Q.current}))},CM._unmount=function(){var e;null===(e=K.current.webSorcket)||void 0===e||e.close(),null==lt||lt()},e){var r=e.asrHotTableInfo,o=e.dataJson,a=((null==r?void 0:r.hotWordDetails)||[]||[]).map((function(e){return"".concat(e.hotWord,"|").concat(e.weight)})).join(","),s=(null===(i=null===(n=null===(t=null==o?void 0:o.canvasData)||void 0===t?void 0:t.iceScenes)||void 0===n?void 0:n.tts)||void 0===i?void 0:i.language)||"";null==f||f({base_info:e,hotword_list:a,engine_model_type:s})}}catch(e){}}(e),[3,3];case 2:return x=C.sent(),console.log("err:",x),401==x.code?a(w):a(I),[3,3];case 3:return[2]}var M}))}))},Fe=(0,o.useRef)(""),Be={joinChannle:function(){return $S(void 0,void 0,void 0,(function(){var e;return WS(this,(function(n){return G.animationState===kl.LOADING||(e=new CS({token:t,tokenType:1,taskId:Q.current,env:A}).instance,K.current.webSorcket=e,CM.webInstance=e,CM._sendMessage=We,CM._changeMode=Be.setMode,$S(void 0,void 0,void 0,(function(){return WS(this,(function(e){return K.current.webSorcket?($({animationState:kl.LOADING}),K.current.webSorcket.onmessage=function(e){Ze(JSON.parse(e.data))},K.current.webSorcket.onerror=function(e){De(),Oe(),Ue()},K.current.webSorcket.onclose=function(e){console.log(e),De(),Oe(),1e3==e.code?Be.cutLine():Ue()},K.current.webSorcket.onopen=function(){return $S(void 0,void 0,void 0,(function(){return WS(this,(function(e){return console.log("socket open"),Me.current=0,$({animationState:kl.LOADING}),setTimeout((function(){$({waitOrStart:"start",holdOn:!1})}),1e3),Ne(),[2]}))}))},[2]):[2]}))})),console.log("join")),[2]}))}))},cutLine:function(e){return $S(void 0,void 0,void 0,(function(){var t,n,i,r,o,a,s;return WS(this,(function(l){switch(l.label){case 0:CM.humanState="offline",CM.webInstance=void 0,CM._sendMessage=void 0,CM._changeMode=void 0,null===(n=ut.current)||void 0===n||n.cancel(""),$({animationState:kl.STATIC,listening:!1,connect:!1,displayTexts:[],displayImages:[],displayAudio:null,displayVideo:[],checked:!1,thinkImg:{},speaking:!1,preAns:"",showpreAns:"",preQue:"",asring:!1,asrModal:!0,chatList:[],chatValue:"",openArea:!1,ticketInfo:{},mode:"work",showModeMask:!1,init:"ipone9:16"!==G.templateName,overTwo:"",holdOn:!0,trans:!1}),setTimeout((function(){$({waitOrStart:"pre",holdOn:!1})}),1e3),K.current.connect=!1,it(),Qe(),null===(o=null===(r=null===(i=K.current)||void 0===i?void 0:i.controller)||void 0===r?void 0:r.stopHandleRecognitionResult)||void 0===o||o.call(r),null===(s=null===(a=K.current.webSorcket)||void 0===a?void 0:a.close)||void 0===s||s.call(a,1e3),K.current.webSorcket=void 0,ee.current="",ie.current=!1,ue.current=!1,oe.current=[],ae.current=[],se.current=[],le.current=null,ce.current={},me.current="",De(),Oe(),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,null==st?void 0:st()];case 2:return l.sent(),e&&(null==e||e()),[3,4];case 3:return t=l.sent(),console.log(t),[3,4];case 4:return[2]}}))}))},endCommunication:function(){We("","answer"),console.log("end"),$({animationState:kl.ENDING})},closeBusyModal:function(){var e;$({animationState:kl.STATIC,isBusy:!1}),(null===(e=K.current)||void 0===e?void 0:e.audio)&&(K.current.audio.pause(),K.current.audio.load()),ne.current&&clearTimeout(ne.current)},changeToASR:function(){G.connect&&($({animationState:kl.SPEAKING,asrModal:!0}),$({asring:!0}))},changeToInput:function(){G.connect&&$({animationState:kl.INPUT,asrModal:!1,asring:!1})},clickToStart:function(e){return $S(void 0,void 0,void 0,(function(){return WS(this,(function(t){return console.log("clickToStart",CM.webInstance,G.holdOn,K.current.connect),CM.webInstance||G.holdOn||K.current.connect||((null==e?void 0:e.projectId)&&(CM.project=null==e?void 0:e.projectId),ke.current=(new Date).getTime(),$({holdOn:!0}),K.current.connect=!0,setTimeout((function(){K.current.connect=!1}),700),Q.current=PS(),Me.current=0,Be.joinChannle(),$S(void 0,void 0,void 0,(function(){var e,t,n;return WS(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(r={businessId:Q.current,projectId:CM.project,taskId:Q.current,bitrateEnum:T},qt({method:"POST",url:"/openapi/talk/task/rtc/sync/start",data:r}))];case 1:return e=i.sent(),console.log("startRtc=====success=====",e),Se.current=(null==e?void 0:e.taskId)||"",Te.current=(null===(n=null==e?void 0:e.extra)||void 0===n?void 0:n.userId)||"",at(e),[3,3];case 2:return 830==(t=i.sent()).code?null==a||a(M):400==t.code?null==a||a(R):null==a||a(P),Be.cutLine(),[3,3];case 3:return[2]}var r}))}))),[2]}))}))},clickToClose:function(){var e,t;G.holdOn||($({holdOn:!0}),clearTimeout(ct.current),null===(t=null===(e=K.current.webSorcket)||void 0===e?void 0:e.close)||void 0===t||t.call(e),Be.cutLine(lt))},setMode:function(e){var t,n;K.current.connect||(K.current.connect=!0,setTimeout((function(){K.current.connect=!1}),2e3),$({mode:e,showModeMask:!1}),e!==G.mode&&(He(e),it(),null===(n=null===(t=K.current.controller)||void 0===t?void 0:t.stopHandleRecognitionResult)||void 0===n||n.call(t)))},clickChangeMode:function(){$({showModeMask:!G.showModeMask})},mousedown:function(){Fe.current=setTimeout((function(){$({test:!G.test})}),5e3)},mouseUp:function(){clearTimeout(Fe.current)}},He=function(e){return $S(void 0,void 0,void 0,(function(){return WS(this,(function(e){switch(e.label){case 0:return Y.current=OS()+"welcome",[4,ze({text:"",sessionId:Y.current,event:"welcome"})];case 1:return e.sent(),[2]}}))}))},ze=function(e){return $S(void 0,void 0,void 0,(function(){var t,n,i,r,o,s;return WS(this,(function(l){switch(l.label){case 0:return t=e.text,n=e.sessionId,i=e.event,console.log("===================getNewAnswer=================",i),Ce.current.set(n,(new Date).getTime()),[4,Ae.ask(n,t,CM.project,i)];case 1:return r=l.sent(),o=r.traceId,s=r.dialog,1011001==o?a(z):(o&&s?null==s||s.subscribeText(o,Ge,(function(){}),!0):($({checked:!1}),console.log("===================================="),console.log(s),console.log("===================================="),a(k)),Ae.get(o)),[2]}}))}))},je=(0,o.useRef)(null),Ge=function(e,t,n,i,r){var o,s;void 0===r&&(r=!1),je.current=n,console.log("=================onSubscribe===================",n);var l=OS(),c=n.queryId,u=void 0===c?"":c;if(r&&e.text&&Re.current.set(e.id,(new Date).getTime()),2===(null==n?void 0:n.state)){var d=n.sessionEnd,h=n.emotionPackUrl,p=void 0===h?"":h,f=(n.emotionType,n.from),m=n.replyText,g=void 0===m?"":m;return console.log("===================================="),console.log("sessionEnd",d,"sessionId",i,"sessionIdRef.current",Y.current,"from",f,"ans",e,"speakRef.current",ie.current,"queryId",u),(null==i?void 0:i.endsWith("welcome"))?g?(q.current=e.text,Ie.current=e.text,$e({payload:LS(g)?JSON.parse(g):g,que:"",first:!0,id:l,wait:!0,queryId:e.id,chunk:e.text})):($({asring:!0,openArea:!0,checked:!1}),void(ue.current=!1)):(Ie.current=e.text,$e({payload:LS(g)?JSON.parse(g):g,que:n.requestText,first:!1,id:l,wait:!0,queryId:e.id,chunk:e.text}))}if(3!==n.state){null===(o=be.current)||void 0===o||o.subscribeText(t,Ge);var _=n.replyText,v=(g=void 0===_?"":_,n.emotionPackUrl);return p=void 0===v?"":v,n.emotionType,r?($({emoje:p}),null===(s=be.current)||void 0===s||s.traceDialog(i),$e({payload:LS(g)?JSON.parse(g):g,que:n.requestText,first:!1,id:l+"trace",wait:!0,queryId:e.id,chunk:e.text})):$e({payload:LS(g)?JSON.parse(g):g,que:n.requestText,first:!1,id:l,wait:!0,queryId:e.id,chunk:e.text})}console.log(""),a(N)},$e=function(e){var t=e.payload,n=e.que,i=(e.first,e.id),r=e.wait,o=e.queryId,a=e.chunk;if(1===re.current&&(re.current=2),$({animationState:kl.INPUT}),t&&a){var s=t.canvasData,l=void 0===s?{}:s;if(t.text,"noMatchResponse"!==t.type||!ie.current){var c=l.displayImages,u=void 0===c?[]:c,d=l.displayTexts,h=void 0===d?[]:d,p=l.displayVideos,f=void 0===p?[]:p,m=l.backgroundMusic,g=void 0===m?{}:m;oe.current=u,ae.current=h,se.current=f,le.current=g;var _=oe.current.find((function(e){var t;return"think"===(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t.imgType)}));return _&&(ce.current=_),fe.current=q.current?OS():void 0,We(a,"answer",i||(fe.current?fe.current:void 0),r,o),n&&G.chatList.unshift({type:"que",label:n}),G.chatList.unshift({type:"ans",label:a}),$({chatList:qS([],G.chatList,!0),preQue:n}),a}}},We=function(e,t,n,i,r,o){var s,l,c,u;void 0===o&&(o={}),"talk"===t&&(je.current=[]);var d=o.ttsFileUrl,h=o.arrayBuffer,p=o.sampleRate;if(d)return null===(s=K.current.webSorcket)||void 0===s||s.send(JSON.stringify({id:n||te.current,type:"answer",ttsFileUrl:d,wait:!!i})),n;if(h){if(!p)return console.error("sampleRate"),void a(L);if((null==h?void 0:h.length)%2!=0)return console.error(""),void a(U);if((null==h?void 0:h.byteLength)>2097152)return console.error("2M"),void a(V);var f=window.protobuf.Root.fromJSON(jS()).lookupType("WsMessage"),m={id:n||te.current,type:"answer",text:"",ttsFileUrl:"",wait:!!i,ttsBuffer:h,sampleRate:p},g=f.encode(m).finish(),_=f.decode(g);return console.log("protobuf===data:",m),console.log("protobuf===encode_data:",g),console.log("protobuf===decode_data:",_),null===(l=K.current.webSorcket)||void 0===l||l.send(g),n}if(te.current=OS(),!ue.current||n==fe.current||"heartbeat"===t){var v=0,y=te.current,E=te.current;"answer"===t&&(console.log("sendMessage","sessionIdRef.current",Y.current,"queryId",r),v=2,Re.current.get(r)&&(v=1),y=Y.current?Y.current:te.current,E=r||te.current),"ask"===t?function(e,t){$S(void 0,void 0,void 0,(function(){return WS(this,(function(n){return Y.current=OS(),ze({text:e,sessionId:Y.current,event:t}),[2]}))}))}(e):"talk"===t?(console.log("talktalktalktalk",e),null===(c=K.current.webSorcket)||void 0===c||c.send(JSON.stringify({id:y,type:"answer",text:e,wait:!!i,firstSend:v,fragmentId:E}))):null===(u=K.current.webSorcket)||void 0===u||u.send(JSON.stringify({id:y,type:t,text:e,wait:!!i,firstSend:v,fragmentId:E}))}},qe=(0,o.useRef)(0),Xe=(0,o.useRef)(null),Ye=(0,o.useRef)(null),Je=(0,o.useRef)(null),Ke=function(e){var t;qe.current++,G.displayVideo.length===qe.current&&(null===(t=Xe.current)||void 0===t||t.call(Xe,e),clearInterval(Je.current))},Qe=function(){var e;window.removeEventListener("video-end",Ke),null===(e=null==Ye?void 0:Ye.current)||void 0===e||e.call(Ye),clearInterval(Je.current)},Ze=function(e){e.type,e.id,e.content,e.fragment_id,Dl.PONG},et=(0,o.useRef)(0),tt=(0,o.useRef)(0),nt=(0,o.useRef)(null),it=function(){var e;clearInterval(tt.current),null===(e=nt.current)||void 0===e||e.call(nt),nt.current=function(){},et.current=0,$({showpreAns:""}),me.current=""},rt=function(e){var t=document.querySelector(e);t&&(t.scrollTop=(null==t?void 0:t.scrollHeight)-t.clientHeight)},ot=function(e,t,n,i,r,a,s,l,c,u,d,h,p,f,m,g,_,v){void 0===l&&(l=function(e){}),void 0===c&&(c=function(){}),void 0===u&&(u=function(e){}),void 0===d&&(d=function(e){});var y=(0,o.useRef)(null),E=(0,o.useRef)(zt.CancelToken),b=(0,o.useRef)(E.current.source()),S=function(){return IS(void 0,void 0,void 0,(function(){var t,n,r,o;return RS(this,(function(a){switch(a.label){case 0:if(!(null===(n=e.current)||void 0===n?void 0:n.player))return[2];a.label=1;case 1:return a.trys.push([1,3,,4]),console.log("leave"),null==c||c(),[4,null===(o=(r=e.current.player).exitRoom)||void 0===o?void 0:o.call(r)];case 2:return a.sent(),i({trans:!1}),[3,4];case 3:return t=a.sent(),console.log(t),[3,4];case 4:return[2]}}))}))};return{TCJoin:function(n){return IS(void 0,void 0,void 0,(function(){var r,o,a,c,h;return RS(this,(function(f){switch(f.label){case 0:f.trys.push([0,5,,6]),void 0!==(null==(r=(null==n?void 0:n.extra)||{})?void 0:r.alpha)&&i({liveOrMatt:(null==r?void 0:r.alpha)?"matt":"live"}),p.current=(null==r?void 0:r.vhGeneration)||"v3",t.current=Hl(),null===(h=null===(c=document.querySelector("#video"))||void 0===c?void 0:c.play)||void 0===h||h.call(c),e.current.authInfo=r,e.current.player=wS.create({enableSEI:!0}),e.current.player.on(wS.EVENT.ERROR,(function(t){var n,r;console.error("TRTC.EVENT.ERROR==============>"+t);var o=t.getCode();i({animationState:kl.STATIC,isBusy:!1,stt:"",connect:!1,carArea:"",eleFeedArea:""}),null===(n=e.current.controller)||void 0===n||n.stopHandleRecognitionResult(),null===(r=e.current.webSorcket)||void 0===r||r.close(),S(),null==u||u({code:o,message:""})})),e.current.player.on(wS.EVENT.AUTOPLAY_FAILED,(function(e){null==u||u(F),console.info(",startRTC")})),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,e.current.player.enterRoom({scene:wS.TYPE.SCENE_RTC,sdkAppId:r.appId-0,userId:r.userId,userSig:r.token,strRoomId:r.channelId})];case 2:return f.sent(),console.log(""),[3,4];case 3:return o=f.sent(),console.error(" "+o),null==u||u({code:"",message:""}),[3,4];case 4:return e.current.player.on(wS.EVENT.SEI_MESSAGE,(function(e){var t=new TextDecoder("utf-8").decode(e.data);v(JSON.parse(t))})),e.current.player.on(wS.EVENT.REMOTE_VIDEO_AVAILABLE,(function(t){var n=t.userId,r=void 0===n?"":n,o=t.streamType,a=void 0===o?"":o;return IS(void 0,void 0,void 0,(function(){return RS(this,(function(t){switch(t.label){case 0:return console.log(": userId"+r+"streamType"+a),[4,e.current.player.startRemoteVideo({userId:r,streamType:a,view:"remoteStreamContainer",option:{canvasRender:!1}})];case 1:return t.sent(),i({connect:!0,init:!0,animationState:kl.SPEAKING,trans:!0}),s(),d({taskId:_.current}),null==l||l(p.current),[2]}}))}))})),[3,6];case 5:return a=f.sent(),console.log(a),[3,6];case 6:return[2]}}))}))},leave:S,destroy:function(){return IS(void 0,void 0,void 0,(function(){var t,n,i,r,o,a,s;return RS(this,(function(l){switch(l.label){case 0:if(console.log(null===(n=e.current)||void 0===n?void 0:n.player),!(null===(i=e.current)||void 0===i?void 0:i.player))return[2];l.label=1;case 1:return l.trys.push([1,3,,4]),console.log("destroy"),null==c||c(),[4,null===(o=(r=e.current.player).exitRoom)||void 0===o?void 0:o.call(r)];case 2:return l.sent(),null===(s=null===(a=null==e?void 0:e.current.player)||void 0===a?void 0:a.destroy)||void 0===s||s.call(a),e.current.player=null,[3,4];case 3:return t=l.sent(),console.log(t),[3,4];case 4:return[2]}}))}))},getConfigRef:y,sourceRef:b}}(K,Z,0,$,0,CM.project,(function(){G.connect||$({connect:!0,animationState:kl.SPEAKING});var e=(new Date).getTime()-ke.current;Jt({publishType:"common",clientType:"web",preview:!1,taskId:null==Se?void 0:Se.current,projectId:CM.project,userId:Te.current,statisticBizType:200,clientVersion:"1.6.1",costMillis:e,extras:{}}),He("work")}),i,l,a,g,0,ge,0,0,0,Q,(function(e){return $S(void 0,void 0,void 0,(function(){var t,n,i,r,o,a,s,l,c,d,p,f,m,g,_,v,y,E;return WS(this,(function(b){switch(b.label){case 0:return t=e.type,n=e.id,i=e.content,r=e.fragment_id,i===Dl.PONG?[2]:(o=function(e){var t,n={};if(LS(e))try{n=(null===(t=JSON.parse(e))||void 0===t?void 0:t.canvasData)||{}}catch(e){n={}}return n}(null===(d=je.current)||void 0===d?void 0:d.replyText),t===Nl.FIRST_FRAME&&(null===(m=null===(f=null===(p=K.current)||void 0===p?void 0:p.controller)||void 0===f?void 0:f.stopHandleRecognitionResult)||void 0===m||m.call(f),CM.humanState="busy",$({preAns:i,speaking:!0,displayImages:oe.current,displayTexts:ae.current,displayAudio:le.current,displayVideo:se.current,thinkImg:ce.current}),oe.current=[],ae.current=[],se.current=[],le.current=null,ce.current={},ee.current="",ie.current=!0,re.current=1,Ne(),null==h||h(GS(GS({},e),{originalAnswer:je.current,materials:o}))),t!==Nl.LAST_FRAME?[3,3]:(CM.humanState="idle",a=we.current.get(n),s=null===(g=null==a?void 0:a.roundDialogs)||void 0===g?void 0:g.get(n),console.log("dialogList:",s,r),me.current.length?[4,(S=me.current,tt.current&&clearInterval(tt.current),new Promise((function(e,t){nt.current=e,tt.current=setInterval((function(){var e,t=S.slice(et.current,et.current+1);et.current%10==0&&Ne(),et.current+=1,et.current>=S.length&&(null===(e=nt.current)||void 0===e||e.call(nt),nt.current=function(){},clearInterval(tt.current)),$((function(e){return{showpreAns:e.showpreAns+t}}))}),1e3/6)})))]:[3,2]));case 1:b.sent(),console.log("down"),b.label=2;case 2:me.current="",null===(y=null===(v=null===(_=K.current)||void 0===_?void 0:_.controller)||void 0===v?void 0:v.startHandleRecognitionResult)||void 0===y||y.call(v),n===fe.current&&($({asring:!0,openArea:!0}),ue.current=!1),l=2==re.current?{speaking:!0,displayImages:[],displayTexts:[],thinkImg:{},displayAudio:{},emoje:"",checked:!1}:{speaking:!1,displayImages:[],displayTexts:[],displayAudio:{},thinkImg:{},emoje:"",checked:!1},$(l),ee.current="",ie.current=!1,re.current=0,Ne(),c=!1,r===(null===(E=null==s?void 0:s[(null==s?void 0:s.length)-1])||void 0===E?void 0:E.id)&&(c=!0),null==u||u(GS(GS({},e),{originalAnswer:je.current,materials:o,last_fragment:c})),b.label=3;case 3:return[2]}var S}))}))})),at=ot.TCJoin,st=ot.leave,lt=ot.destroy,ct=ot.getConfigRef,ut=ot.sourceRef;return{humanRef:J,state:G,setState:$,humanInstanse:W,reset:function(){$({chatList:[]})},inputRef:X,handle:Be,waitTextRef:me}},YS="156",JS=1,KS=2,QS=3,ZS=0,eT=1,tT=2,nT=0,iT=100,rT=0,oT=1,aT=2,sT=0,lT=1,cT=2,uT=3,dT=4,hT=5,pT=301,fT=302,mT=306,gT=1e3,_T=1001,vT=1002,yT=1003,ET=1005,bT=1006,ST=1008,TT=1009,xT=1012,AT=1014,wT=1015,IT=1016,RT=1017,CT=1018,MT=1020,kT=1023,NT=1026,DT=1027,OT=1029,PT=1031,LT=1033,UT=33776,VT=33777,FT=33778,BT=33779,HT=36492,zT=2300,jT=2301,GT=2302,$T=3001,WT="srgb",qT="srgb-linear",XT="display-p3",YT=7680,JT="300 es",KT=1035,QT=2e3,ZT=2001;class ex{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const tx=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],nx=Math.PI/180,ix=180/Math.PI;function rx(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(tx[255&e]+tx[e>>8&255]+tx[e>>16&255]+tx[e>>24&255]+"-"+tx[255&t]+tx[t>>8&255]+"-"+tx[t>>16&15|64]+tx[t>>24&255]+"-"+tx[63&n|128]+tx[n>>8&255]+"-"+tx[n>>16&255]+tx[n>>24&255]+tx[255&i]+tx[i>>8&255]+tx[i>>16&255]+tx[i>>24&255]).toLowerCase()}function ox(e,t,n){return Math.max(t,Math.min(n,e))}function ax(e,t,n){return(1-n)*e+n*t}function sx(e){return 0==(e&e-1)&&0!==e}function lx(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function cx(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function ux(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class dx{constructor(e=0,t=0){dx.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ox(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class hx{constructor(e,t,n,i,r,o,a,s,l){hx.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,a,s,l)}set(e,t,n,i,r,o,a,s,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=r,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],p=n[8],f=i[0],m=i[3],g=i[6],_=i[1],v=i[4],y=i[7],E=i[2],b=i[5],S=i[8];return r[0]=o*f+a*_+s*E,r[3]=o*m+a*v+s*b,r[6]=o*g+a*y+s*S,r[1]=l*f+c*_+u*E,r[4]=l*m+c*v+u*b,r[7]=l*g+c*y+u*S,r[2]=d*f+h*_+p*E,r[5]=d*m+h*v+p*b,r[8]=d*g+h*y+p*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-n*r*c+n*a*s+i*r*l-i*o*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=c*o-a*l,d=a*s-c*r,h=l*r-o*s,p=t*u+n*d+i*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(a*n-i*o)*f,e[3]=d*f,e[4]=(c*t-i*s)*f,e[5]=(i*r-a*t)*f,e[6]=h*f,e[7]=(n*s-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,a){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(px.makeScale(e,t)),this}rotate(e){return this.premultiply(px.makeRotation(-e)),this}translate(e,t){return this.premultiply(px.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const px=new hx;function fx(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function mx(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function gx(){const e=mx("canvas");return e.style.display="block",e}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const _x={};function vx(e){e in _x||(_x[e]=!0,console.warn(e))}function yx(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ex(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const bx=(new hx).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Sx=(new hx).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Tx={[qT]:e=>e,[WT]:e=>e.convertSRGBToLinear(),[XT]:function(e){return e.convertSRGBToLinear().applyMatrix3(Sx)}},xx={[qT]:e=>e,[WT]:e=>e.convertLinearToSRGB(),[XT]:function(e){return e.applyMatrix3(bx).convertLinearToSRGB()}},Ax={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return qT},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=Tx[t],r=xx[n];if(void 0===i||void 0===r)throw new Error(`Unsupported color space conversion, "${t}" to "${n}".`);return r(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let wx;class Ix{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===wx&&(wx=mx("canvas")),wx.width=e.width,wx.height=e.height;const n=wx.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=wx}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=mx("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*yx(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*yx(t[e]/255)):t[e]=yx(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Rx=0;class Cx{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Rx++}),this.uuid=rx(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(Mx(i[t].image)):e.push(Mx(i[t]))}else e=Mx(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function Mx(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ix.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kx=0;class Nx extends ex{constructor(e=Nx.DEFAULT_IMAGE,t=Nx.DEFAULT_MAPPING,n=1001,i=1001,r=bT,o=ST,a=kT,s=TT,l=Nx.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kx++}),this.uuid=rx(),this.name="",this.source=new Cx(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new dx(0,0),this.repeat=new dx(1,1),this.center=new dx(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new hx,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(vx("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===$T?WT:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case gT:e.x=e.x-Math.floor(e.x);break;case _T:e.x=e.x<0?0:1;break;case vT:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case gT:e.y=e.y-Math.floor(e.y);break;case _T:e.y=e.y<0?0:1;break;case vT:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return vx("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===WT?$T:3e3}set encoding(e){vx("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===$T?WT:""}}Nx.DEFAULT_IMAGE=null,Nx.DEFAULT_MAPPING=300,Nx.DEFAULT_ANISOTROPY=1;class Dx{constructor(e=0,t=0,n=0,i=1){Dx.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,a=.1,s=e.elements,l=s[0],c=s[4],u=s[8],d=s[1],h=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-d)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+d)<a&&Math.abs(u+f)<a&&Math.abs(p+m)<a&&Math.abs(l+h+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(h+1)/2,_=(g+1)/2,v=(c+d)/4,y=(u+f)/4,E=(p+m)/4;return e>s&&e>_?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=v/n,r=y/n):s>_?s<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=v/i,r=E/i):_<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=y/r,i=E/r),this.set(n,i,r,t),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(d-c)*(d-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(d-c)/_,this.w=Math.acos((l+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ox extends ex{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Dx(0,0,e,t),this.scissorTest=!1,this.viewport=new Dx(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==n.encoding&&(vx("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===$T?WT:""),this.texture=new Nx(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:bT,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Cx(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Px extends Ox{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Lx extends Nx{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=yT,this.minFilter=yT,this.wrapR=_T,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ux extends Nx{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=yT,this.minFilter=yT,this.wrapR=_T,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Vx{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,a){let s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const d=r[o+0],h=r[o+1],p=r[o+2],f=r[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===a)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=f);if(u!==f||s!==d||l!==h||c!==p){let e=1-a;const t=s*d+l*h+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,a=Math.sin(a*o)/r}const r=a*n;if(s=s*e+d*r,l=l*e+h*r,c=c*e+p*r,u=u*e+f*r,e===1-a){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const a=n[i],s=n[i+1],l=n[i+2],c=n[i+3],u=r[o],d=r[o+1],h=r[o+2],p=r[o+3];return e[t]=a*p+c*u+s*h-l*d,e[t+1]=s*p+c*d+l*u-a*h,e[t+2]=l*p+c*h+a*d-s*u,e[t+3]=c*p-a*u-s*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),c=a(i/2),u=a(r/2),d=s(n/2),h=s(i/2),p=s(r/2);switch(o){case"XYZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"YXZ":this._x=d*c*u+l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"ZXY":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u-d*h*p;break;case"ZYX":this._x=d*c*u-l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u+d*h*p;break;case"YZX":this._x=d*c*u+l*h*p,this._y=l*h*u+d*c*p,this._z=l*c*p-d*h*u,this._w=l*c*u-d*h*p;break;case"XZY":this._x=d*c*u-l*h*p,this._y=l*h*u-d*c*p,this._z=l*c*p+d*h*u,this._w=l*c*u+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+a+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-s)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>a&&n>u){const e=2*Math.sqrt(1+n-a-u);this._w=(c-s)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-a);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ox(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+o*a+i*l-r*s,this._y=i*c+o*s+r*a-n*l,this._z=r*c+o*l+n*s-i*a,this._w=o*c-n*a-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=o*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Fx{constructor(e=0,t=0,n=0){Fx.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Hx.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Hx.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*n,c=s*n+a*t-r*i,u=s*i+r*n-o*t,d=-r*t-o*n-a*i;return this.x=l*s+d*-r+c*-a-u*-o,this.y=c*s+d*-o+u*-r-l*-a,this.z=u*s+d*-a+l*-o-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Bx.copy(this).projectOnVector(e),this.sub(Bx)}reflect(e){return this.sub(Bx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ox(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Bx=new Fx,Hx=new Vx;class zx{constructor(e=new Fx(1/0,1/0,1/0),t=new Fx(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Gx.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Gx.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Gx.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),$x.copy(e.boundingBox),$x.applyMatrix4(e.matrixWorld),this.union($x);else{const n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)Gx.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(Gx)}else null===n.boundingBox&&n.computeBoundingBox(),$x.copy(n.boundingBox),$x.applyMatrix4(e.matrixWorld),this.union($x)}const n=e.children;for(let e=0,i=n.length;e<i;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Gx),Gx.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Qx),Zx.subVectors(this.max,Qx),Wx.subVectors(e.a,Qx),qx.subVectors(e.b,Qx),Xx.subVectors(e.c,Qx),Yx.subVectors(qx,Wx),Jx.subVectors(Xx,qx),Kx.subVectors(Wx,Xx);let t=[0,-Yx.z,Yx.y,0,-Jx.z,Jx.y,0,-Kx.z,Kx.y,Yx.z,0,-Yx.x,Jx.z,0,-Jx.x,Kx.z,0,-Kx.x,-Yx.y,Yx.x,0,-Jx.y,Jx.x,0,-Kx.y,Kx.x,0];return!!nA(t,Wx,qx,Xx,Zx)&&(t=[1,0,0,0,1,0,0,0,1],!!nA(t,Wx,qx,Xx,Zx)&&(eA.crossVectors(Yx,Jx),t=[eA.x,eA.y,eA.z],nA(t,Wx,qx,Xx,Zx)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Gx).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Gx).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(jx[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),jx[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),jx[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),jx[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),jx[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),jx[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),jx[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),jx[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(jx)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const jx=[new Fx,new Fx,new Fx,new Fx,new Fx,new Fx,new Fx,new Fx],Gx=new Fx,$x=new zx,Wx=new Fx,qx=new Fx,Xx=new Fx,Yx=new Fx,Jx=new Fx,Kx=new Fx,Qx=new Fx,Zx=new Fx,eA=new Fx,tA=new Fx;function nA(e,t,n,i,r){for(let o=0,a=e.length-3;o<=a;o+=3){tA.fromArray(e,o);const a=r.x*Math.abs(tA.x)+r.y*Math.abs(tA.y)+r.z*Math.abs(tA.z),s=t.dot(tA),l=n.dot(tA),c=i.dot(tA);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>a)return!1}return!0}const iA=new zx,rA=new Fx,oA=new Fx;class aA{constructor(e=new Fx,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):iA.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;rA.subVectors(e,this.center);const t=rA.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(rA,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(oA.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(rA.copy(e.center).add(oA)),this.expandByPoint(rA.copy(e.center).sub(oA))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const sA=new Fx,lA=new Fx,cA=new Fx,uA=new Fx,dA=new Fx,hA=new Fx,pA=new Fx;class fA{constructor(e=new Fx,t=new Fx(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,sA)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=sA.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(sA.copy(this.origin).addScaledVector(this.direction,t),sA.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){lA.copy(e).add(t).multiplyScalar(.5),cA.copy(t).sub(e).normalize(),uA.copy(this.origin).sub(lA);const r=.5*e.distanceTo(t),o=-this.direction.dot(cA),a=uA.dot(this.direction),s=-uA.dot(cA),l=uA.lengthSq(),c=Math.abs(1-o*o);let u,d,h,p;if(c>0)if(u=o*s-a,d=o*a-s,p=r*c,u>=0)if(d>=-p)if(d<=p){const e=1/c;u*=e,d*=e,h=u*(u+o*d+2*a)+d*(o*u+d+2*s)+l}else d=r,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*s)+l;else d=-r,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*s)+l;else d<=-p?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-s),r),h=-u*u+d*(d+2*s)+l):d<=p?(u=0,d=Math.min(Math.max(-r,-s),r),h=d*(d+2*s)+l):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-s),r),h=-u*u+d*(d+2*s)+l);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),h=-u*u+d*(d+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(lA).addScaledVector(cA,d),h}intersectSphere(e,t){sA.subVectors(e.center,this.origin);const n=sA.dot(this.direction),i=sA.dot(sA)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,s=n+o;return s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,a,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),n>o||r>i?null:((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),u>=0?(a=(e.min.z-d.z)*u,s=(e.max.z-d.z)*u):(a=(e.max.z-d.z)*u,s=(e.min.z-d.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,sA)}intersectTriangle(e,t,n,i,r){dA.subVectors(t,e),hA.subVectors(n,e),pA.crossVectors(dA,hA);let o,a=this.direction.dot(pA);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}uA.subVectors(this.origin,e);const s=o*this.direction.dot(hA.crossVectors(uA,hA));if(s<0)return null;const l=o*this.direction.dot(dA.cross(uA));if(l<0)return null;if(s+l>a)return null;const c=-o*uA.dot(pA);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class mA{constructor(e,t,n,i,r,o,a,s,l,c,u,d,h,p,f,m){mA.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,a,s,l,c,u,d,h,p,f,m)}set(e,t,n,i,r,o,a,s,l,c,u,d,h,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new mA).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/gA.setFromMatrixColumn(e,0).length(),r=1/gA.setFromMatrixColumn(e,1).length(),o=1/gA.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*c,n=o*u,i=a*c,r=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-a*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*s}else if("YXZ"===e.order){const e=s*c,n=s*u,i=l*c,r=l*u;t[0]=e+r*a,t[4]=i*a-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=n*a-i,t[6]=r+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*c,n=s*u,i=l*c,r=l*u;t[0]=e-r*a,t[4]=-o*u,t[8]=i+n*a,t[1]=n+i*a,t[5]=o*c,t[9]=r-e*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*c,n=o*u,i=a*c,r=a*u;t[0]=s*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*s,n=o*l,i=a*s,r=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=o*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=a*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(vA,e,yA)}lookAt(e,t,n){const i=this.elements;return SA.subVectors(e,t),0===SA.lengthSq()&&(SA.z=1),SA.normalize(),EA.crossVectors(n,SA),0===EA.lengthSq()&&(1===Math.abs(n.z)?SA.x+=1e-4:SA.z+=1e-4,SA.normalize(),EA.crossVectors(n,SA)),EA.normalize(),bA.crossVectors(SA,EA),i[0]=EA.x,i[4]=bA.x,i[8]=SA.x,i[1]=EA.y,i[5]=bA.y,i[9]=SA.y,i[2]=EA.z,i[6]=bA.z,i[10]=SA.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],E=n[15],b=i[0],S=i[4],T=i[8],x=i[12],A=i[1],w=i[5],I=i[9],R=i[13],C=i[2],M=i[6],k=i[10],N=i[14],D=i[3],O=i[7],P=i[11],L=i[15];return r[0]=o*b+a*A+s*C+l*D,r[4]=o*S+a*w+s*M+l*O,r[8]=o*T+a*I+s*k+l*P,r[12]=o*x+a*R+s*N+l*L,r[1]=c*b+u*A+d*C+h*D,r[5]=c*S+u*w+d*M+h*O,r[9]=c*T+u*I+d*k+h*P,r[13]=c*x+u*R+d*N+h*L,r[2]=p*b+f*A+m*C+g*D,r[6]=p*S+f*w+m*M+g*O,r[10]=p*T+f*I+m*k+g*P,r[14]=p*x+f*R+m*N+g*L,r[3]=_*b+v*A+y*C+E*D,r[7]=_*S+v*w+y*M+E*O,r[11]=_*T+v*I+y*k+E*P,r[15]=_*x+v*R+y*N+E*L,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+r*s*u-i*l*u-r*a*d+n*l*d+i*a*h-n*s*h)+e[7]*(+t*s*h-t*l*d+r*o*d-i*o*h+i*l*c-r*s*c)+e[11]*(+t*l*u-t*a*h-r*o*u+n*o*h+r*a*c-n*l*c)+e[15]*(-i*a*c-t*s*u+t*a*d+i*o*u-n*o*d+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*d*l+f*s*h-a*m*h-u*s*g+a*d*g,v=p*d*l-c*m*l-p*s*h+o*m*h+c*s*g-o*d*g,y=c*f*l-p*u*l+p*a*h-o*f*h-c*a*g+o*u*g,E=p*u*s-c*f*s-p*a*d+o*f*d+c*a*m-o*u*m,b=t*_+n*v+i*y+r*E;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/b;return e[0]=_*S,e[1]=(f*d*r-u*m*r-f*i*h+n*m*h+u*i*g-n*d*g)*S,e[2]=(a*m*r-f*s*r+f*i*l-n*m*l-a*i*g+n*s*g)*S,e[3]=(u*s*r-a*d*r-u*i*l+n*d*l+a*i*h-n*s*h)*S,e[4]=v*S,e[5]=(c*m*r-p*d*r+p*i*h-t*m*h-c*i*g+t*d*g)*S,e[6]=(p*s*r-o*m*r-p*i*l+t*m*l+o*i*g-t*s*g)*S,e[7]=(o*d*r-c*s*r+c*i*l-t*d*l-o*i*h+t*s*h)*S,e[8]=y*S,e[9]=(p*u*r-c*f*r-p*n*h+t*f*h+c*n*g-t*u*g)*S,e[10]=(o*f*r-p*a*r+p*n*l-t*f*l-o*n*g+t*a*g)*S,e[11]=(c*a*r-o*u*r-c*n*l+t*u*l+o*n*h-t*a*h)*S,e[12]=E*S,e[13]=(c*f*i-p*u*i+p*n*d-t*f*d-c*n*m+t*u*m)*S,e[14]=(p*a*i-o*f*i-p*n*s+t*f*s+o*n*m-t*a*m)*S,e[15]=(o*u*i-c*a*i+c*n*s-t*u*s-o*n*d+t*a*d)*S,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,l=r*o,c=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+n,c*s-i*o,0,l*s-i*a,c*s+i*o,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,c=o+o,u=a+a,d=r*l,h=r*c,p=r*u,f=o*c,m=o*u,g=a*u,_=s*l,v=s*c,y=s*u,E=n.x,b=n.y,S=n.z;return i[0]=(1-(f+g))*E,i[1]=(h+y)*E,i[2]=(p-v)*E,i[3]=0,i[4]=(h-y)*b,i[5]=(1-(d+g))*b,i[6]=(m+_)*b,i[7]=0,i[8]=(p+v)*S,i[9]=(m-_)*S,i[10]=(1-(d+f))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=gA.set(i[0],i[1],i[2]).length();const o=gA.set(i[4],i[5],i[6]).length(),a=gA.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],_A.copy(this);const s=1/r,l=1/o,c=1/a;return _A.elements[0]*=s,_A.elements[1]*=s,_A.elements[2]*=s,_A.elements[4]*=l,_A.elements[5]*=l,_A.elements[6]*=l,_A.elements[8]*=c,_A.elements[9]*=c,_A.elements[10]*=c,t.setFromRotationMatrix(_A),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,i,r,o,a=2e3){const s=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),d=(n+i)/(n-i);let h,p;if(a===QT)h=-(o+r)/(o-r),p=-2*o*r/(o-r);else{if(a!==ZT)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);h=-o/(o-r),p=-o*r/(o-r)}return s[0]=l,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=c,s[9]=d,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,i,r,o,a=2e3){const s=this.elements,l=1/(t-e),c=1/(n-i),u=1/(o-r),d=(t+e)*l,h=(n+i)*c;let p,f;if(a===QT)p=(o+r)*u,f=-2*u;else{if(a!==ZT)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*u,f=-1*u}return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-d,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=f,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const gA=new Fx,_A=new mA,vA=new Fx(0,0,0),yA=new Fx(1,1,1),EA=new Fx,bA=new Fx,SA=new Fx,TA=new mA,xA=new Vx;class AA{constructor(e=0,t=0,n=0,i=AA.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],o=i[4],a=i[8],s=i[1],l=i[5],c=i[9],u=i[2],d=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(ox(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ox(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(ox(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-ox(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(ox(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-ox(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return TA.makeRotationFromQuaternion(e),this.setFromRotationMatrix(TA,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return xA.setFromEuler(this),this.setFromQuaternion(xA,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}AA.DEFAULT_ORDER="XYZ";class wA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let IA=0;const RA=new Fx,CA=new Vx,MA=new mA,kA=new Fx,NA=new Fx,DA=new Fx,OA=new Vx,PA=new Fx(1,0,0),LA=new Fx(0,1,0),UA=new Fx(0,0,1),VA={type:"added"},FA={type:"removed"};class BA extends ex{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:IA++}),this.uuid=rx(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=BA.DEFAULT_UP.clone();const e=new Fx,t=new AA,n=new Vx,i=new Fx(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new mA},normalMatrix:{value:new hx}}),this.matrix=new mA,this.matrixWorld=new mA,this.matrixAutoUpdate=BA.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=BA.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new wA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return CA.setFromAxisAngle(e,t),this.quaternion.multiply(CA),this}rotateOnWorldAxis(e,t){return CA.setFromAxisAngle(e,t),this.quaternion.premultiply(CA),this}rotateX(e){return this.rotateOnAxis(PA,e)}rotateY(e){return this.rotateOnAxis(LA,e)}rotateZ(e){return this.rotateOnAxis(UA,e)}translateOnAxis(e,t){return RA.copy(e).applyQuaternion(this.quaternion),this.position.add(RA.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(PA,e)}translateY(e){return this.translateOnAxis(LA,e)}translateZ(e){return this.translateOnAxis(UA,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(MA.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?kA.copy(e):kA.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),NA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?MA.lookAt(NA,kA,this.up):MA.lookAt(kA,NA,this.up),this.quaternion.setFromRotationMatrix(MA),i&&(MA.extractRotation(i.matrixWorld),CA.setFromRotationMatrix(MA),this.quaternion.premultiply(CA.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(VA)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(FA)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),MA.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),MA.multiply(e.parent.matrixWorld)),e.applyMatrix4(MA),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const r=this.children[i].getObjectsByProperty(e,t);r.length>0&&(n=n.concat(r))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(NA,e,DA),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(NA,OA,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),a=o(e.images),s=o(e.shapes),l=o(e.skeletons),c=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}BA.DEFAULT_UP=new Fx(0,1,0),BA.DEFAULT_MATRIX_AUTO_UPDATE=!0,BA.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const HA=new Fx,zA=new Fx,jA=new Fx,GA=new Fx,$A=new Fx,WA=new Fx,qA=new Fx,XA=new Fx,YA=new Fx,JA=new Fx;let KA=!1;class QA{constructor(e=new Fx,t=new Fx,n=new Fx){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),HA.subVectors(e,t),i.cross(HA);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){HA.subVectors(i,t),zA.subVectors(n,t),jA.subVectors(e,t);const o=HA.dot(HA),a=HA.dot(zA),s=HA.dot(jA),l=zA.dot(zA),c=zA.dot(jA),u=o*l-a*a;if(0===u)return r.set(-2,-1,-1);const d=1/u,h=(l*s-a*c)*d,p=(o*c-a*s)*d;return r.set(1-h-p,p,h)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,GA),GA.x>=0&&GA.y>=0&&GA.x+GA.y<=1}static getUV(e,t,n,i,r,o,a,s){return!1===KA&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),KA=!0),this.getInterpolation(e,t,n,i,r,o,a,s)}static getInterpolation(e,t,n,i,r,o,a,s){return this.getBarycoord(e,t,n,i,GA),s.setScalar(0),s.addScaledVector(r,GA.x),s.addScaledVector(o,GA.y),s.addScaledVector(a,GA.z),s}static isFrontFacing(e,t,n,i){return HA.subVectors(n,t),zA.subVectors(e,t),HA.cross(zA).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return HA.subVectors(this.c,this.b),zA.subVectors(this.a,this.b),.5*HA.cross(zA).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return QA.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return QA.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return!1===KA&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),KA=!0),QA.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}getInterpolation(e,t,n,i,r){return QA.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return QA.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return QA.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,a;$A.subVectors(i,n),WA.subVectors(r,n),XA.subVectors(e,n);const s=$A.dot(XA),l=WA.dot(XA);if(s<=0&&l<=0)return t.copy(n);YA.subVectors(e,i);const c=$A.dot(YA),u=WA.dot(YA);if(c>=0&&u<=c)return t.copy(i);const d=s*u-c*l;if(d<=0&&s>=0&&c<=0)return o=s/(s-c),t.copy(n).addScaledVector($A,o);JA.subVectors(e,r);const h=$A.dot(JA),p=WA.dot(JA);if(p>=0&&h<=p)return t.copy(r);const f=h*l-s*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(WA,a);const m=c*p-h*u;if(m<=0&&u-c>=0&&h-p>=0)return qA.subVectors(r,i),a=(u-c)/(u-c+(h-p)),t.copy(i).addScaledVector(qA,a);const g=1/(m+f+d);return o=f*g,a=d*g,t.copy(n).addScaledVector($A,o).addScaledVector(WA,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let ZA=0;class ew extends ex{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ZA++}),this.uuid=rx(),this.name="",this.type="Material",this.blending=1,this.side=ZS,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=iT,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=YT,this.stencilZFail=YT,this.stencilZPass=YT,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==ZS&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const tw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},nw={h:0,s:0,l:0},iw={h:0,s:0,l:0};function rw(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class ow{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=WT){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ax.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Ax.workingColorSpace){return this.r=e,this.g=t,this.b=n,Ax.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Ax.workingColorSpace){if(e=(e%(r=1)+r)%r,t=ox(t,0,1),n=ox(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=rw(r,i,e+1/3),this.g=rw(r,i,e),this.b=rw(r,i,e-1/3)}var r;return Ax.toWorkingColorSpace(this,i),this}setStyle(e,t=WT){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=WT){const n=tw[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=yx(e.r),this.g=yx(e.g),this.b=yx(e.b),this}copyLinearToSRGB(e){return this.r=Ex(e.r),this.g=Ex(e.g),this.b=Ex(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=WT){return Ax.fromWorkingColorSpace(aw.copy(this),e),65536*Math.round(ox(255*aw.r,0,255))+256*Math.round(ox(255*aw.g,0,255))+Math.round(ox(255*aw.b,0,255))}getHexString(e=WT){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ax.workingColorSpace){Ax.fromWorkingColorSpace(aw.copy(this),t);const n=aw.r,i=aw.g,r=aw.b,o=Math.max(n,i,r),a=Math.min(n,i,r);let s,l;const c=(a+o)/2;if(a===o)s=0,l=0;else{const e=o-a;switch(l=c<=.5?e/(o+a):e/(2-o-a),o){case n:s=(i-r)/e+(i<r?6:0);break;case i:s=(r-n)/e+2;break;case r:s=(n-i)/e+4}s/=6}return e.h=s,e.s=l,e.l=c,e}getRGB(e,t=Ax.workingColorSpace){return Ax.fromWorkingColorSpace(aw.copy(this),t),e.r=aw.r,e.g=aw.g,e.b=aw.b,e}getStyle(e=WT){Ax.fromWorkingColorSpace(aw.copy(this),e);const t=aw.r,n=aw.g,i=aw.b;return e!==WT?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(nw),nw.h+=e,nw.s+=t,nw.l+=n,this.setHSL(nw.h,nw.s,nw.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(nw),e.getHSL(iw);const n=ax(nw.h,iw.h,t),i=ax(nw.s,iw.s,t),r=ax(nw.l,iw.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const aw=new ow;ow.NAMES=tw;class sw extends ew{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ow(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const lw=new Fx,cw=new dx;class uw{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=wT,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)cw.fromBufferAttribute(this,t),cw.applyMatrix3(e),this.setXY(t,cw.x,cw.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)lw.fromBufferAttribute(this,t),lw.applyMatrix3(e),this.setXYZ(t,lw.x,lw.y,lw.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)lw.fromBufferAttribute(this,t),lw.applyMatrix4(e),this.setXYZ(t,lw.x,lw.y,lw.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)lw.fromBufferAttribute(this,t),lw.applyNormalMatrix(e),this.setXYZ(t,lw.x,lw.y,lw.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)lw.fromBufferAttribute(this,t),lw.transformDirection(e),this.setXYZ(t,lw.x,lw.y,lw.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=cx(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ux(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=cx(t,this.array)),t}setX(e,t){return this.normalized&&(t=ux(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=cx(t,this.array)),t}setY(e,t){return this.normalized&&(t=ux(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=cx(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ux(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=cx(t,this.array)),t}setW(e,t){return this.normalized&&(t=ux(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ux(t,this.array),n=ux(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=ux(t,this.array),n=ux(n,this.array),i=ux(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=ux(t,this.array),n=ux(n,this.array),i=ux(i,this.array),r=ux(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class dw extends uw{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class hw extends uw{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class pw extends uw{constructor(e,t,n){super(new Float32Array(e),t,n)}}let fw=0;const mw=new mA,gw=new BA,_w=new Fx,vw=new zx,yw=new zx,Ew=new Fx;class bw extends ex{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:fw++}),this.uuid=rx(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(fx(e)?hw:dw)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new hx).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return mw.makeRotationFromQuaternion(e),this.applyMatrix4(mw),this}rotateX(e){return mw.makeRotationX(e),this.applyMatrix4(mw),this}rotateY(e){return mw.makeRotationY(e),this.applyMatrix4(mw),this}rotateZ(e){return mw.makeRotationZ(e),this.applyMatrix4(mw),this}translate(e,t,n){return mw.makeTranslation(e,t,n),this.applyMatrix4(mw),this}scale(e,t,n){return mw.makeScale(e,t,n),this.applyMatrix4(mw),this}lookAt(e){return gw.lookAt(e),gw.updateMatrix(),this.applyMatrix4(gw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_w).negate(),this.translate(_w.x,_w.y,_w.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new pw(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new zx);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Fx(-1/0,-1/0,-1/0),new Fx(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];vw.setFromBufferAttribute(n),this.morphTargetsRelative?(Ew.addVectors(this.boundingBox.min,vw.min),this.boundingBox.expandByPoint(Ew),Ew.addVectors(this.boundingBox.max,vw.max),this.boundingBox.expandByPoint(Ew)):(this.boundingBox.expandByPoint(vw.min),this.boundingBox.expandByPoint(vw.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new aA);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Fx,1/0);if(e){const n=this.boundingSphere.center;if(vw.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];yw.setFromBufferAttribute(n),this.morphTargetsRelative?(Ew.addVectors(vw.min,yw.min),vw.expandByPoint(Ew),Ew.addVectors(vw.max,yw.max),vw.expandByPoint(Ew)):(vw.expandByPoint(yw.min),vw.expandByPoint(yw.max))}vw.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Ew.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Ew));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],a=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)Ew.fromBufferAttribute(o,t),a&&(_w.fromBufferAttribute(e,t),Ew.add(_w)),i=Math.max(i,n.distanceToSquared(Ew))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new uw(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new Fx,c[e]=new Fx;const u=new Fx,d=new Fx,h=new Fx,p=new dx,f=new dx,m=new dx,g=new Fx,_=new Fx;function v(e,t,n){u.fromArray(i,3*e),d.fromArray(i,3*t),h.fromArray(i,3*n),p.fromArray(o,2*e),f.fromArray(o,2*t),m.fromArray(o,2*n),d.sub(u),h.sub(u),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(h,-f.y).multiplyScalar(r),_.copy(h).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(_),c[t].add(_),c[n].add(_))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)v(n[e+0],n[e+1],n[e+2])}const E=new Fx,b=new Fx,S=new Fx,T=new Fx;function x(e){S.fromArray(r,3*e),T.copy(S);const t=l[e];E.copy(t),E.sub(S.multiplyScalar(S.dot(t))).normalize(),b.crossVectors(T,t);const n=b.dot(c[e])<0?-1:1;s[4*e]=E.x,s[4*e+1]=E.y,s[4*e+2]=E.z,s[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)x(n[e+0]),x(n[e+1]),x(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new uw(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Fx,r=new Fx,o=new Fx,a=new Fx,s=new Fx,l=new Fx,c=new Fx,u=new Fx;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);i.fromBufferAttribute(t,h),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),a.fromBufferAttribute(n,h),s.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(c),s.add(c),l.add(c),n.setXYZ(h,a.x,a.y,a.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ew.fromBufferAttribute(e,t),Ew.normalize(),e.setXYZ(t,Ew.x,Ew.y,Ew.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let a=0,s=0;for(let r=0,l=t.length;r<l;r++){a=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)o[s++]=n[a++]}return new uw(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new bw,n=this.index.array,i=this.attributes;for(const r in i){const o=e(i[r],n);t.setAttribute(r,o)}const r=this.morphAttributes;for(const i in r){const o=[],a=r[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);o.push(i)}t.morphAttributes[i]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];o.push(i.toJSON(e.data))}o.length>0&&(i[t]=o,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Sw=new mA,Tw=new fA,xw=new aA,Aw=new Fx,ww=new Fx,Iw=new Fx,Rw=new Fx,Cw=new Fx,Mw=new Fx,kw=new dx,Nw=new dx,Dw=new dx,Ow=new Fx,Pw=new Fx,Lw=new Fx,Uw=new Fx,Vw=new Fx;class Fw extends BA{constructor(e=new bw,t=new sw){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(r&&a){Mw.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],s=r[n];0!==i&&(Cw.fromBufferAttribute(s,e),o?Mw.addScaledVector(Cw,i):Mw.addScaledVector(Cw.sub(t),i))}t.add(Mw)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),xw.copy(n.boundingSphere),xw.applyMatrix4(r),Tw.copy(e.ray).recast(e.near),!1===xw.containsPoint(Tw.origin)){if(null===Tw.intersectSphere(xw,Aw))return;if(Tw.origin.distanceToSquared(Aw)>(e.far-e.near)**2)return}Sw.copy(r).invert(),Tw.copy(e.ray).applyMatrix4(Sw),null!==n.boundingBox&&!1===Tw.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Tw)}}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,a=r.index,s=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,d=r.groups,h=r.drawRange;if(null!==a)if(Array.isArray(o))for(let r=0,s=d.length;r<s;r++){const s=d[r],p=o[s.materialIndex];for(let r=Math.max(s.start,h.start),o=Math.min(a.count,Math.min(s.start+s.count,h.start+h.count));r<o;r+=3)i=Bw(this,p,e,n,l,c,u,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=s.materialIndex,t.push(i))}else for(let r=Math.max(0,h.start),s=Math.min(a.count,h.start+h.count);r<s;r+=3)i=Bw(this,o,e,n,l,c,u,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i));else if(void 0!==s)if(Array.isArray(o))for(let r=0,a=d.length;r<a;r++){const a=d[r],p=o[a.materialIndex];for(let r=Math.max(a.start,h.start),o=Math.min(s.count,Math.min(a.start+a.count,h.start+h.count));r<o;r+=3)i=Bw(this,p,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,t.push(i))}else for(let r=Math.max(0,h.start),a=Math.min(s.count,h.start+h.count);r<a;r+=3)i=Bw(this,o,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}function Bw(e,t,n,i,r,o,a,s,l,c){e.getVertexPosition(s,ww),e.getVertexPosition(l,Iw),e.getVertexPosition(c,Rw);const u=function(e,t,n,i,r,o,a,s){let l;if(l=t.side===eT?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,t.side===ZS,s),null===l)return null;Vw.copy(s),Vw.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Vw);return c<n.near||c>n.far?null:{distance:c,point:Vw.clone(),object:e}}(e,t,n,i,ww,Iw,Rw,Uw);if(u){r&&(kw.fromBufferAttribute(r,s),Nw.fromBufferAttribute(r,l),Dw.fromBufferAttribute(r,c),u.uv=QA.getInterpolation(Uw,ww,Iw,Rw,kw,Nw,Dw,new dx)),o&&(kw.fromBufferAttribute(o,s),Nw.fromBufferAttribute(o,l),Dw.fromBufferAttribute(o,c),u.uv1=QA.getInterpolation(Uw,ww,Iw,Rw,kw,Nw,Dw,new dx),u.uv2=u.uv1),a&&(Ow.fromBufferAttribute(a,s),Pw.fromBufferAttribute(a,l),Lw.fromBufferAttribute(a,c),u.normal=QA.getInterpolation(Uw,ww,Iw,Rw,Ow,Pw,Lw,new Fx),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const e={a:s,b:l,c,normal:new Fx,materialIndex:0};QA.getNormal(ww,Iw,Rw,e.normal),u.face=e}return u}class Hw extends bw{constructor(e=1,t=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const a=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const s=[],l=[],c=[],u=[];let d=0,h=0;function p(e,t,n,i,r,o,p,f,m,g,_){const v=o/m,y=p/g,E=o/2,b=p/2,S=f/2,T=m+1,x=g+1;let A=0,w=0;const I=new Fx;for(let o=0;o<x;o++){const a=o*y-b;for(let s=0;s<T;s++){const d=s*v-E;I[e]=d*i,I[t]=a*r,I[n]=S,l.push(I.x,I.y,I.z),I[e]=0,I[t]=0,I[n]=f>0?1:-1,c.push(I.x,I.y,I.z),u.push(s/m),u.push(1-o/g),A+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=d+t+T*e,i=d+t+T*(e+1),r=d+(t+1)+T*(e+1),o=d+(t+1)+T*e;s.push(n,i,o),s.push(i,r,o),w+=6}a.addGroup(h,w,_),h+=w,d+=A}p("z","y","x",-1,-1,n,t,e,o,r,0),p("z","y","x",1,-1,n,t,-e,o,r,1),p("x","z","y",1,1,e,n,t,i,o,2),p("x","z","y",1,-1,e,n,-t,i,o,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new pw(l,3)),this.setAttribute("normal",new pw(c,3)),this.setAttribute("uv",new pw(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hw(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function zw(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function jw(e){const t={};for(let n=0;n<e.length;n++){const i=zw(e[n]);for(const e in i)t[e]=i[e]}return t}function Gw(e){return null===e.getRenderTarget()?e.outputColorSpace:qT}const $w={clone:zw,merge:jw};class Ww extends ew{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zw(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class qw extends BA{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new mA,this.projectionMatrix=new mA,this.projectionMatrixInverse=new mA,this.coordinateSystem=QT}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Xw extends qw{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ix*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*nx*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ix*Math.atan(Math.tan(.5*nx*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*nx*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/a,i*=o.width/e,n*=o.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Yw=-90;class Jw extends BA{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null;const i=new Xw(Yw,1,e,t);i.layers=this.layers,this.add(i);const r=new Xw(Yw,1,e,t);r.layers=this.layers,this.add(r);const o=new Xw(Yw,1,e,t);o.layers=this.layers,this.add(o);const a=new Xw(Yw,1,e,t);a.layers=this.layers,this.add(a);const s=new Xw(Yw,1,e,t);s.layers=this.layers,this.add(s);const l=new Xw(Yw,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,o,a,s]=t;for(const e of t)this.remove(e);if(e===QT)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==ZT)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,r,o,a,s,l]=this.children,c=e.getRenderTarget(),u=e.xr.enabled;e.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u,n.texture.needsPMREMUpdate=!0}}class Kw extends Nx{constructor(e,t,n,i,r,o,a,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:pT,n,i,r,o,a,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Qw extends Px{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];void 0!==t.encoding&&(vx("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===$T?WT:""),this.texture=new Kw(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:bT}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new Hw(5,5,5),a=new Ww({name:"CubemapFromEquirect",uniforms:zw(n),vertexShader:i,fragmentShader:r,side:eT,blending:nT});a.uniforms.tEquirect.value=t;const s=new Fw(o,a),l=t.minFilter;return t.minFilter===ST&&(t.minFilter=bT),new Jw(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}const Zw=new Fx,eI=new Fx,tI=new hx;class nI{constructor(e=new Fx(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Zw.subVectors(n,t).cross(eI.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Zw),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||tI.getNormalMatrix(e),i=this.coplanarPoint(Zw).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const iI=new aA,rI=new Fx;class oI{constructor(e=new nI,t=new nI,n=new nI,i=new nI,r=new nI,o=new nI){this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=i[6],d=i[7],h=i[8],p=i[9],f=i[10],m=i[11],g=i[12],_=i[13],v=i[14],y=i[15];if(n[0].setComponents(s-r,d-l,m-h,y-g).normalize(),n[1].setComponents(s+r,d+l,m+h,y+g).normalize(),n[2].setComponents(s+o,d+c,m+p,y+_).normalize(),n[3].setComponents(s-o,d-c,m-p,y-_).normalize(),n[4].setComponents(s-a,d-u,m-f,y-v).normalize(),t===QT)n[5].setComponents(s+a,d+u,m+f,y+v).normalize();else{if(t!==ZT)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,u,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),iI.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),iI.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(iI)}intersectsSprite(e){return iI.center.set(0,0,0),iI.radius=.7071067811865476,iI.applyMatrix4(e.matrixWorld),this.intersectsSphere(iI)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(rI.x=i.normal.x>0?e.max.x:e.min.x,rI.y=i.normal.y>0?e.max.y:e.min.y,rI.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(rI)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function aI(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function sI(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=i.get(t);void 0===o?i.set(t,function(t,i){const r=t.array,o=t.usage,a=e.createBuffer();let s;if(e.bindBuffer(i,a),e.bufferData(i,r,o),t.onUploadCallback(),r instanceof Float32Array)s=e.FLOAT;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");s=e.HALF_FLOAT}else s=e.UNSIGNED_SHORT;else if(r instanceof Int16Array)s=e.SHORT;else if(r instanceof Uint32Array)s=e.UNSIGNED_INT;else if(r instanceof Int32Array)s=e.INT;else if(r instanceof Int8Array)s=e.BYTE;else if(r instanceof Uint8Array)s=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);s=e.UNSIGNED_BYTE}return{buffer:a,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(function(t,i,r){const o=i.array,a=i.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,o):(n?e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1),i.onUploadCallback()}(o.buffer,t,r),o.version=t.version)}}}class lI extends bw{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,a=Math.floor(n),s=Math.floor(i),l=a+1,c=s+1,u=e/a,d=t/s,h=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*d-o;for(let n=0;n<l;n++){const i=n*u-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/a),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),o=t+1+l*e;h.push(n,i,o),h.push(i,r,o)}this.setIndex(h),this.setAttribute("position",new pw(p,3)),this.setAttribute("normal",new pw(f,3)),this.setAttribute("uv",new pw(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lI(e.width,e.height,e.widthSegments,e.heightSegments)}}const cI={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},uI={common:{diffuse:{value:new ow(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new hx},alphaMap:{value:null},alphaMapTransform:{value:new hx},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new hx}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new hx}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new hx}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new hx},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new hx},normalScale:{value:new dx(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new hx},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new hx}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new hx}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new hx}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ow(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ow(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new hx},alphaTest:{value:0},uvTransform:{value:new hx}},sprite:{diffuse:{value:new ow(16777215)},opacity:{value:1},center:{value:new dx(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new hx},alphaMap:{value:null},alphaMapTransform:{value:new hx},alphaTest:{value:0}}},dI={basic:{uniforms:jw([uI.common,uI.specularmap,uI.envmap,uI.aomap,uI.lightmap,uI.fog]),vertexShader:cI.meshbasic_vert,fragmentShader:cI.meshbasic_frag},lambert:{uniforms:jw([uI.common,uI.specularmap,uI.envmap,uI.aomap,uI.lightmap,uI.emissivemap,uI.bumpmap,uI.normalmap,uI.displacementmap,uI.fog,uI.lights,{emissive:{value:new ow(0)}}]),vertexShader:cI.meshlambert_vert,fragmentShader:cI.meshlambert_frag},phong:{uniforms:jw([uI.common,uI.specularmap,uI.envmap,uI.aomap,uI.lightmap,uI.emissivemap,uI.bumpmap,uI.normalmap,uI.displacementmap,uI.fog,uI.lights,{emissive:{value:new ow(0)},specular:{value:new ow(1118481)},shininess:{value:30}}]),vertexShader:cI.meshphong_vert,fragmentShader:cI.meshphong_frag},standard:{uniforms:jw([uI.common,uI.envmap,uI.aomap,uI.lightmap,uI.emissivemap,uI.bumpmap,uI.normalmap,uI.displacementmap,uI.roughnessmap,uI.metalnessmap,uI.fog,uI.lights,{emissive:{value:new ow(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:cI.meshphysical_vert,fragmentShader:cI.meshphysical_frag},toon:{uniforms:jw([uI.common,uI.aomap,uI.lightmap,uI.emissivemap,uI.bumpmap,uI.normalmap,uI.displacementmap,uI.gradientmap,uI.fog,uI.lights,{emissive:{value:new ow(0)}}]),vertexShader:cI.meshtoon_vert,fragmentShader:cI.meshtoon_frag},matcap:{uniforms:jw([uI.common,uI.bumpmap,uI.normalmap,uI.displacementmap,uI.fog,{matcap:{value:null}}]),vertexShader:cI.meshmatcap_vert,fragmentShader:cI.meshmatcap_frag},points:{uniforms:jw([uI.points,uI.fog]),vertexShader:cI.points_vert,fragmentShader:cI.points_frag},dashed:{uniforms:jw([uI.common,uI.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:cI.linedashed_vert,fragmentShader:cI.linedashed_frag},depth:{uniforms:jw([uI.common,uI.displacementmap]),vertexShader:cI.depth_vert,fragmentShader:cI.depth_frag},normal:{uniforms:jw([uI.common,uI.bumpmap,uI.normalmap,uI.displacementmap,{opacity:{value:1}}]),vertexShader:cI.meshnormal_vert,fragmentShader:cI.meshnormal_frag},sprite:{uniforms:jw([uI.sprite,uI.fog]),vertexShader:cI.sprite_vert,fragmentShader:cI.sprite_frag},background:{uniforms:{uvTransform:{value:new hx},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:cI.background_vert,fragmentShader:cI.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:cI.backgroundCube_vert,fragmentShader:cI.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:cI.cube_vert,fragmentShader:cI.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:cI.equirect_vert,fragmentShader:cI.equirect_frag},distanceRGBA:{uniforms:jw([uI.common,uI.displacementmap,{referencePosition:{value:new Fx},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:cI.distanceRGBA_vert,fragmentShader:cI.distanceRGBA_frag},shadow:{uniforms:jw([uI.lights,uI.fog,{color:{value:new ow(0)},opacity:{value:1}}]),vertexShader:cI.shadow_vert,fragmentShader:cI.shadow_frag}};dI.physical={uniforms:jw([dI.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new hx},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new hx},clearcoatNormalScale:{value:new dx(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new hx},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new hx},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new hx},sheen:{value:0},sheenColor:{value:new ow(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new hx},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new hx},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new hx},transmissionSamplerSize:{value:new dx},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new hx},attenuationDistance:{value:0},attenuationColor:{value:new ow(0)},specularColor:{value:new ow(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new hx},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new hx},anisotropyVector:{value:new dx},anisotropyMap:{value:null},anisotropyMapTransform:{value:new hx}}]),vertexShader:cI.meshphysical_vert,fragmentShader:cI.meshphysical_frag};const hI={r:0,b:0,g:0};function pI(e,t,n,i,r,o,a){const s=new ow(0);let l,c,u=!0===o?0:1,d=null,h=0,p=null;function f(t,n){t.getRGB(hI,Gw(e)),i.buffers.color.setClear(hI.r,hI.g,hI.b,n,a)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),u=t,f(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,f(s,u)},render:function(o,m){let g=!1,_=!0===m.isScene?m.background:null;_&&_.isTexture&&(_=(m.backgroundBlurriness>0?n:t).get(_)),null===_?f(s,u):_&&_.isColor&&(f(_,1),g=!0);const v=e.xr.getEnvironmentBlendMode();"additive"===v?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===v&&i.buffers.color.setClear(0,0,0,0,a),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===mT)?(void 0===c&&(c=new Fw(new Hw(1,1,1),new Ww({name:"BackgroundCubeMaterial",uniforms:zw(dI.backgroundCube.uniforms),vertexShader:dI.backgroundCube.vertexShader,fragmentShader:dI.backgroundCube.fragmentShader,side:eT,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=_.colorSpace!==WT,d===_&&h===_.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=_,h=_.version,p=e.toneMapping),c.layers.enableAll(),o.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new Fw(new lI(2,2),new Ww({name:"BackgroundMaterial",uniforms:zw(dI.background.uniforms),vertexShader:dI.background.vertexShader,fragmentShader:dI.background.fragmentShader,side:ZS,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=_.colorSpace!==WT,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),d===_&&h===_.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=_,h=_.version,p=e.toneMapping),l.layers.enableAll(),o.unshift(l,l.geometry,l.material,0,0,null))}}}function fI(e,t,n,i){const r=e.getParameter(e.MAX_VERTEX_ATTRIBS),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==o,s={},l=p(null);let c=l,u=!1;function d(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,r){const o=c.newAttributes,a=c.enabledAttributes,s=c.attributeDivisors;o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function _(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,i,r,o,a,s){!0===s?e.vertexAttribIPointer(t,n,i,o,a):e.vertexAttribPointer(t,n,i,r,o,a)}function y(){E(),u=!0,c!==l&&(c=l,d(c.object))}function E(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,E){let b=!1;if(a){const t=function(t,n,r){const a=!0===r.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[a];return void 0===u&&(u=p(i.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[a]=u),u}(y,h,l);c!==t&&(c=t,d(c.object)),b=function(e,t,n,i){const r=c.attributes,o=t.attributes;let a=0;const s=n.getAttributes();for(const t in s)if(s[t].location>=0){const n=r[t];let i=o[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;a++}return c.attributesNum!==a||c.index!==i}(r,y,h,E),b&&function(e,t,n,i){const r={},o=t.attributes;let a=0;const s=n.getAttributes();for(const t in s)if(s[t].location>=0){let n=o[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[t]=i,a++}c.attributes=r,c.attributesNum=a,c.index=i}(r,y,h,E)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,b=!0)}null!==E&&n.update(E,e.ELEMENT_ARRAY_BUFFER),(b||u)&&(u=!1,function(r,o,a,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=s.attributes,c=a.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const o=c[t];if(o.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){const t=a.normalized,l=a.itemSize,c=n.get(a);if(void 0===c)continue;const u=c.buffer,d=c.type,h=c.bytesPerElement,p=!0===i.isWebGL2&&(d===e.INT||d===e.UNSIGNED_INT||1013===a.gpuType);if(a.isInterleavedBufferAttribute){const n=a.data,i=n.stride,c=a.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<o.locationSize;e++)g(o.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<o.locationSize;e++)m(o.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<o.locationSize;e++)v(o.location+e,l/o.locationSize,d,t,i*h,(c+l/o.locationSize*e)*h,p)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<o.locationSize;e++)g(o.location+e,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<o.locationSize;e++)m(o.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<o.locationSize;e++)v(o.location+e,l/o.locationSize,d,t,l*h,l/o.locationSize*e*h,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(o.location,n);break;case 3:e.vertexAttrib3fv(o.location,n);break;case 4:e.vertexAttrib4fv(o.location,n);break;default:e.vertexAttrib1fv(o.location,n)}}}}_()}(r,l,h,y),null!==E&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(E).buffer))},reset:y,resetDefaultState:E,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)h(i[e].object),delete i[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:_}}function mI(e,t,n,i){const r=i.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,i){e.drawArrays(o,t,i),n.update(i,o,1)},this.renderInstances=function(i,a,s){if(0===s)return;let l,c;if(r)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,i,a,s),n.update(a,o,s)}}function gI(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let a=void 0!==n.precision?n.precision:"highp";const s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=o||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=d>0,y=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(e.MAX_SAMPLES):0}}function _I(e){const t=this;let n=null,i=0,r=!1,o=!1;const a=new nI,s=new hx,l={value:null,needsUpdate:!1};function c(e,n,i,r){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==r||null===c){const t=i+4*o,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==o;++t,n+=4)a.copy(e[t]).applyMatrix4(r,s),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,s,u){const d=a.clippingPlanes,h=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!r||null===d||0===d.length||o&&!p)o?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0);else{const e=o?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(d,s,t,u);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function vI(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=pT:304===t&&(e.mapping=fT),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const o=r.mapping;if(303===o||304===o){if(t.has(r))return n(t.get(r).texture,r.mapping);{const o=r.image;if(o&&o.height>0){const a=new Qw(o.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class yI extends qw{constructor(e=-1,t=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const EI=[.125,.215,.35,.446,.526,.582],bI=20,SI=new yI,TI=new ow;let xI=null;const AI=(1+Math.sqrt(5))/2,wI=1/AI,II=[new Fx(1,1,1),new Fx(-1,1,1),new Fx(1,1,-1),new Fx(-1,1,-1),new Fx(0,AI,wI),new Fx(0,AI,-wI),new Fx(wI,0,AI),new Fx(-wI,0,AI),new Fx(AI,wI,0),new Fx(-AI,wI,0)];class RI{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){xI=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=NI(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=kI(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xI),e.scissorTest=!1,MI(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===pT||e.mapping===fT?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),xI=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:bT,minFilter:bT,generateMipmaps:!1,type:IT,format:kT,colorSpace:qT,depthBuffer:!1},i=CI(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=CI(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const o=e-4+1+EI.length;for(let a=0;a<o;a++){const o=Math.pow(2,r);n.push(o);let s=1/o;a>e-4?s=EI[a-e+4-1]:0===a&&(s=0),i.push(s);const l=1/(o-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*h),v=new Float32Array(m*p*h),y=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];_.set(i,f*p*e),v.set(d,m*p*e);const r=[e,e,e,e,e,e];y.set(r,g*p*e)}const E=new bw;E.setAttribute("position",new uw(_,f)),E.setAttribute("uv",new uw(v,m)),E.setAttribute("faceIndex",new uw(y,g)),t.push(E),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(bI),r=new Fx(0,1,0);return new Ww({name:"SphericalGaussianBlur",defines:{n:bI,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:nT,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){const t=new Fw(this._lodPlanes[0],e);this._renderer.compile(t,SI)}_sceneToCubeUV(e,t,n,i){const r=new Xw(90,1,t,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.toneMapping;s.getClearColor(TI),s.toneMapping=sT,s.autoClear=!1;const u=new sw({name:"PMREM.Background",side:eT,depthWrite:!1,depthTest:!1}),d=new Fw(new Hw,u);let h=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,h=!0):(u.color.copy(TI),h=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(r.up.set(0,o[t],0),r.lookAt(a[t],0,0)):1===n?(r.up.set(0,0,o[t]),r.lookAt(0,a[t],0)):(r.up.set(0,o[t],0),r.lookAt(0,0,a[t]));const l=this._cubeSize;MI(i,n*l,t>2?l:0,l,l),s.setRenderTarget(i),h&&s.render(d,r),s.render(e,r)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===pT||e.mapping===fT;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=NI()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=kI());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new Fw(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const a=this._cubeSize;MI(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(o,SI)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=II[(t-1)%II.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,a){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Fw(this._lodPlanes[i],l),u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/h,f=isFinite(r)?1+Math.floor(3*p):bI;f>bI&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<bI;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a);const{_lodMax:_}=this;u.dTheta.value=h,u.mipInt.value=_-n;const v=this._sizeLods[i];MI(t,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),s.setRenderTarget(t),s.render(c,SI)}}function CI(e,t,n){const i=new Px(e,t,n);return i.texture.mapping=mT,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function MI(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function kI(){return new Ww({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:nT,depthTest:!1,depthWrite:!1})}function NI(){return new Ww({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:nT,depthTest:!1,depthWrite:!1})}function DI(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping,a=303===o||304===o,s=o===pT||o===fT;if(a||s){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let i=t.get(r);return null===n&&(n=new RI(e)),i=a?n.fromEquirectangular(r,i):n.fromCubemap(r,i),t.set(r,i),i.texture}if(t.has(r))return t.get(r).texture;{const o=r.image;if(a&&o&&o.height>0||s&&o&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(o)){null===n&&(n=new RI(e));const o=a?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,o),r.addEventListener("dispose",i),o.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function OI(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function PI(e,t,n,i){const r={},o=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);for(const e in s.morphAttributes){const n=s.morphAttributes[e];for(let e=0,i=n.length;e<i;e++)t.remove(n[e])}s.removeEventListener("dispose",a),delete r[s.id];const l=o.get(s);l&&(t.remove(l),o.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],i=e.index,r=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{if(void 0===r)return;{const e=r.array;a=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const s=new(fx(n)?hw:dw)(n,1);s.version=a;const l=o.get(e);l&&t.remove(l),o.set(e,s)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const n in i)t.update(i[n],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)t.update(i[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function LI(e,t,n,i){const r=i.isWebGL2;let o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,i){e.drawElements(o,i,a,t*s),n.update(i,o,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,d;if(r)u=e,d="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](o,l,a,i*s,c),n.update(l,o,c)}}function UI(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function VI(e,t){return e[0]-t[0]}function FI(e,t){return Math.abs(t[1])-Math.abs(e[1])}function BI(e,t,n){const i={},r=new Float32Array(8),o=new WeakMap,a=new Dx,s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(l,c,u){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const h=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==h?h.length:0;let f=o.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const _=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,E=c.morphAttributes.position||[],b=c.morphAttributes.normal||[],S=c.morphAttributes.color||[];let T=0;!0===_&&(T=1),!0===v&&(T=2),!0===y&&(T=3);let x=c.attributes.position.count*T,A=1;x>t.maxTextureSize&&(A=Math.ceil(x/t.maxTextureSize),x=t.maxTextureSize);const w=new Float32Array(x*A*4*p),I=new Lx(w,x,A,p);I.type=wT,I.needsUpdate=!0;const R=4*T;for(let M=0;M<p;M++){const k=E[M],N=b[M],D=S[M],O=x*A*4*M;for(let P=0;P<k.count;P++){const L=P*R;!0===_&&(a.fromBufferAttribute(k,P),w[O+L+0]=a.x,w[O+L+1]=a.y,w[O+L+2]=a.z,w[O+L+3]=0),!0===v&&(a.fromBufferAttribute(N,P),w[O+L+4]=a.x,w[O+L+5]=a.y,w[O+L+6]=a.z,w[O+L+7]=0),!0===y&&(a.fromBufferAttribute(D,P),w[O+L+8]=a.x,w[O+L+9]=a.y,w[O+L+10]=a.z,w[O+L+11]=4===D.itemSize?a.w:1)}}function C(){I.dispose(),o.delete(c),c.removeEventListener("dispose",C)}f={count:p,texture:I,size:new dx(x,A)},o.set(c,f),c.addEventListener("dispose",C)}let m=0;for(let U=0;U<d.length;U++)m+=d[U];const g=c.morphTargetsRelative?1:1-m;u.getUniforms().setValue(e,"morphTargetBaseInfluence",g),u.getUniforms().setValue(e,"morphTargetInfluences",d),u.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const V=void 0===d?0:d.length;let F=i[c.id];if(void 0===F||F.length!==V){F=[];for(let G=0;G<V;G++)F[G]=[G,0];i[c.id]=F}for(let $=0;$<V;$++){const W=F[$];W[0]=$,W[1]=d[$]}F.sort(FI);for(let q=0;q<8;q++)q<V&&F[q][1]?(s[q][0]=F[q][0],s[q][1]=F[q][1]):(s[q][0]=Number.MAX_SAFE_INTEGER,s[q][1]=0);s.sort(VI);const B=c.morphAttributes.position,H=c.morphAttributes.normal;let z=0;for(let X=0;X<8;X++){const Y=s[X],J=Y[0],K=Y[1];J!==Number.MAX_SAFE_INTEGER&&K?(B&&c.getAttribute("morphTarget"+X)!==B[J]&&c.setAttribute("morphTarget"+X,B[J]),H&&c.getAttribute("morphNormal"+X)!==H[J]&&c.setAttribute("morphNormal"+X,H[J]),r[X]=K,z+=K):(B&&!0===c.hasAttribute("morphTarget"+X)&&c.deleteAttribute("morphTarget"+X),H&&!0===c.hasAttribute("morphNormal"+X)&&c.deleteAttribute("morphNormal"+X),r[X]=0)}const j=c.morphTargetsRelative?1:1-z;u.getUniforms().setValue(e,"morphTargetBaseInfluence",j),u.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function HI(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const s=i.render.frame,l=a.geometry,c=t.get(a,l);if(r.get(c)!==s&&(t.update(c),r.set(c,s)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",o)&&a.addEventListener("dispose",o),r.get(a)!==s&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),r.set(a,s))),a.isSkinnedMesh){const e=a.skeleton;r.get(e)!==s&&(e.update(),r.set(e,s))}return c},dispose:function(){r=new WeakMap}}}const zI=new Nx,jI=new Lx,GI=new Ux,$I=new Kw,WI=[],qI=[],XI=new Float32Array(16),YI=new Float32Array(9),JI=new Float32Array(4);function KI(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=WI[r];if(void 0===o&&(o=new Float32Array(r),WI[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function QI(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function ZI(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function eR(e,t){let n=qI[t];void 0===n&&(n=new Int32Array(t),qI[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function tR(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function nR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(QI(n,t))return;e.uniform2fv(this.addr,t),ZI(n,t)}}function iR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(QI(n,t))return;e.uniform3fv(this.addr,t),ZI(n,t)}}function rR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(QI(n,t))return;e.uniform4fv(this.addr,t),ZI(n,t)}}function oR(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(QI(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ZI(n,t)}else{if(QI(n,i))return;JI.set(i),e.uniformMatrix2fv(this.addr,!1,JI),ZI(n,i)}}function aR(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(QI(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ZI(n,t)}else{if(QI(n,i))return;YI.set(i),e.uniformMatrix3fv(this.addr,!1,YI),ZI(n,i)}}function sR(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(QI(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ZI(n,t)}else{if(QI(n,i))return;XI.set(i),e.uniformMatrix4fv(this.addr,!1,XI),ZI(n,i)}}function lR(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function cR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(QI(n,t))return;e.uniform2iv(this.addr,t),ZI(n,t)}}function uR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(QI(n,t))return;e.uniform3iv(this.addr,t),ZI(n,t)}}function dR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(QI(n,t))return;e.uniform4iv(this.addr,t),ZI(n,t)}}function hR(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function pR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(QI(n,t))return;e.uniform2uiv(this.addr,t),ZI(n,t)}}function fR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(QI(n,t))return;e.uniform3uiv(this.addr,t),ZI(n,t)}}function mR(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(QI(n,t))return;e.uniform4uiv(this.addr,t),ZI(n,t)}}function gR(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||zI,r)}function _R(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||GI,r)}function vR(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||$I,r)}function yR(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||jI,r)}function ER(e,t){e.uniform1fv(this.addr,t)}function bR(e,t){const n=KI(t,this.size,2);e.uniform2fv(this.addr,n)}function SR(e,t){const n=KI(t,this.size,3);e.uniform3fv(this.addr,n)}function TR(e,t){const n=KI(t,this.size,4);e.uniform4fv(this.addr,n)}function xR(e,t){const n=KI(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function AR(e,t){const n=KI(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function wR(e,t){const n=KI(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function IR(e,t){e.uniform1iv(this.addr,t)}function RR(e,t){e.uniform2iv(this.addr,t)}function CR(e,t){e.uniform3iv(this.addr,t)}function MR(e,t){e.uniform4iv(this.addr,t)}function kR(e,t){e.uniform1uiv(this.addr,t)}function NR(e,t){e.uniform2uiv(this.addr,t)}function DR(e,t){e.uniform3uiv(this.addr,t)}function OR(e,t){e.uniform4uiv(this.addr,t)}function PR(e,t,n){const i=this.cache,r=t.length,o=eR(n,r);QI(i,o)||(e.uniform1iv(this.addr,o),ZI(i,o));for(let e=0;e!==r;++e)n.setTexture2D(t[e]||zI,o[e])}function LR(e,t,n){const i=this.cache,r=t.length,o=eR(n,r);QI(i,o)||(e.uniform1iv(this.addr,o),ZI(i,o));for(let e=0;e!==r;++e)n.setTexture3D(t[e]||GI,o[e])}function UR(e,t,n){const i=this.cache,r=t.length,o=eR(n,r);QI(i,o)||(e.uniform1iv(this.addr,o),ZI(i,o));for(let e=0;e!==r;++e)n.setTextureCube(t[e]||$I,o[e])}function VR(e,t,n){const i=this.cache,r=t.length,o=eR(n,r);QI(i,o)||(e.uniform1iv(this.addr,o),ZI(i,o));for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||jI,o[e])}class FR{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return tR;case 35664:return nR;case 35665:return iR;case 35666:return rR;case 35674:return oR;case 35675:return aR;case 35676:return sR;case 5124:case 35670:return lR;case 35667:case 35671:return cR;case 35668:case 35672:return uR;case 35669:case 35673:return dR;case 5125:return hR;case 36294:return pR;case 36295:return fR;case 36296:return mR;case 35678:case 36198:case 36298:case 36306:case 35682:return gR;case 35679:case 36299:case 36307:return _R;case 35680:case 36300:case 36308:case 36293:return vR;case 36289:case 36303:case 36311:case 36292:return yR}}(t.type)}}class BR{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ER;case 35664:return bR;case 35665:return SR;case 35666:return TR;case 35674:return xR;case 35675:return AR;case 35676:return wR;case 5124:case 35670:return IR;case 35667:case 35671:return RR;case 35668:case 35672:return CR;case 35669:case 35673:return MR;case 5125:return kR;case 36294:return NR;case 36295:return DR;case 36296:return OR;case 35678:case 36198:case 36298:case 36306:case 35682:return PR;case 35679:case 36299:case 36307:return LR;case 35680:case 36300:case 36308:case 36293:return UR;case 36289:case 36303:case 36311:case 36292:return VR}}(t.type)}}class HR{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}}}const zR=/(\w+)(\])?(\[|\.)?/g;function jR(e,t){e.seq.push(t),e.map[t.id]=t}function GR(e,t,n){const i=e.name,r=i.length;for(zR.lastIndex=0;;){const o=zR.exec(i),a=zR.lastIndex;let s=o[1];const l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===r){jR(n,void 0===c?new FR(s,e,t):new BR(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new HR(s),jR(n,e)),n=e}}}class $R{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);GR(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],a=n[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function WR(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let qR=0;function XR(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const i=parseInt(o[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let e=r;e<o;e++){const r=e+1;i.push(`${r===t?">":" "} ${r}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function YR(e,t){const n=function(e){switch(e){case qT:return["Linear","( value )"];case WT:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function JR(e,t){let n;switch(t){case lT:n="Linear";break;case cT:n="Reinhard";break;case uT:n="OptimizedCineon";break;case dT:n="ACESFilmic";break;case hT:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function KR(e){return""!==e}function QR(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ZR(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const eC=/^[ \t]*#include +<([\w\d./]+)>/gm;function tC(e){return e.replace(eC,iC)}const nC=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function iC(e,t){let n=cI[t];if(void 0===n){const e=nC.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=cI[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return tC(n)}const rC=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function oC(e){return e.replace(rC,aC)}function aC(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function sC(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function lC(e,t,n,i){const r=e.getContext(),o=n.defines;let a=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===JS?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===KS?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===QS&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case pT:case fT:t="ENVMAP_TYPE_CUBE";break;case mT:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===fT&&(t="ENVMAP_MODE_REFRACTION"),t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case rT:t="ENVMAP_BLENDING_MULTIPLY";break;case oT:t="ENVMAP_BLENDING_MIX";break;case aT:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(KR).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),m=r.createProgram();let g,_,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(KR).join("\n"),g.length>0&&(g+="\n"),_=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(KR).join("\n"),_.length>0&&(_+="\n")):(g=[sC(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(KR).join("\n"),_=[p,sC(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==sT?"#define TONE_MAPPING":"",n.toneMapping!==sT?cI.tonemapping_pars_fragment:"",n.toneMapping!==sT?JR("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",cI.colorspace_pars_fragment,YR("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(KR).join("\n")),a=tC(a),a=QR(a,n),a=ZR(a,n),s=tC(s),s=QR(s,n),s=ZR(s,n),a=oC(a),s=oC(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",n.glslVersion===JT?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===JT?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const y=v+g+a,E=v+_+s,b=WR(r,r.VERTEX_SHADER,y),S=WR(r,r.FRAGMENT_SHADER,E);if(r.attachShader(m,b),r.attachShader(m,S),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){const t=r.getProgramInfoLog(m).trim(),n=r.getShaderInfoLog(b).trim(),i=r.getShaderInfoLog(S).trim();let o=!0,a=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(o=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,m,b,S);else{const e=XR(r,b,"vertex"),n=XR(r,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==n&&""!==i||(a=!1);a&&(this.diagnostics={runnable:o,programLog:t,vertexShader:{log:n,prefix:g},fragmentShader:{log:i,prefix:_}})}let T,x;return r.deleteShader(b),r.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new $R(r,m)),T},this.getAttributes=function(){return void 0===x&&(x=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),o=i.name;let a=1;i.type===e.FLOAT_MAT2&&(a=2),i.type===e.FLOAT_MAT3&&(a=3),i.type===e.FLOAT_MAT4&&(a=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:a}}return n}(r,m)),x},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=qR++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=S,this}let cC=0;class uC{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new dC(e),t.set(e,n)),n}}class dC{constructor(e){this.id=cC++,this.code=e,this.usedTimes=0}}function hC(e,t,n,i,r,o,a){const s=new wA,l=new uC,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,h=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(o,s,c,g,_){const v=g.fog,y=_.geometry,E=o.isMeshStandardMaterial?g.environment:null,b=(o.isMeshStandardMaterial?n:t).get(o.envMap||E),S=b&&b.mapping===mT?b.image.height:null,T=f[o.type];null!==o.precision&&(p=r.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const x=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,A=void 0!==x?x.length:0;let w,I,R,C,M=0;if(void 0!==y.morphAttributes.position&&(M=1),void 0!==y.morphAttributes.normal&&(M=2),void 0!==y.morphAttributes.color&&(M=3),T){const e=dI[T];w=e.vertexShader,I=e.fragmentShader}else w=o.vertexShader,I=o.fragmentShader,l.update(o),R=l.getVertexShaderID(o),C=l.getFragmentShaderID(o);const k=e.getRenderTarget(),N=!0===_.isInstancedMesh,D=!!o.map,O=!!o.matcap,P=!!b,L=!!o.aoMap,U=!!o.lightMap,V=!!o.bumpMap,F=!!o.normalMap,B=!!o.displacementMap,H=!!o.emissiveMap,z=!!o.metalnessMap,j=!!o.roughnessMap,G=o.anisotropy>0,$=o.clearcoat>0,W=o.iridescence>0,q=o.sheen>0,X=o.transmission>0,Y=G&&!!o.anisotropyMap,J=$&&!!o.clearcoatMap,K=$&&!!o.clearcoatNormalMap,Q=$&&!!o.clearcoatRoughnessMap,Z=W&&!!o.iridescenceMap,ee=W&&!!o.iridescenceThicknessMap,te=q&&!!o.sheenColorMap,ne=q&&!!o.sheenRoughnessMap,ie=!!o.specularMap,re=!!o.specularColorMap,oe=!!o.specularIntensityMap,ae=X&&!!o.transmissionMap,se=X&&!!o.thicknessMap,le=!!o.gradientMap,ce=!!o.alphaMap,ue=o.alphaTest>0,de=!!o.alphaHash,he=!!o.extensions,pe=!!y.attributes.uv1,fe=!!y.attributes.uv2,me=!!y.attributes.uv3;let ge=sT;return o.toneMapped&&(null!==k&&!0!==k.isXRRenderTarget||(ge=e.toneMapping)),{isWebGL2:u,shaderID:T,shaderType:o.type,shaderName:o.name,vertexShader:w,fragmentShader:I,defines:o.defines,customVertexShaderID:R,customFragmentShaderID:C,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,instancing:N,instancingColor:N&&null!==_.instanceColor,supportsVertexTextures:h,outputColorSpace:null===k?e.outputColorSpace:!0===k.isXRRenderTarget?k.texture.colorSpace:qT,map:D,matcap:O,envMap:P,envMapMode:P&&b.mapping,envMapCubeUVHeight:S,aoMap:L,lightMap:U,bumpMap:V,normalMap:F,displacementMap:h&&B,emissiveMap:H,normalMapObjectSpace:F&&1===o.normalMapType,normalMapTangentSpace:F&&0===o.normalMapType,metalnessMap:z,roughnessMap:j,anisotropy:G,anisotropyMap:Y,clearcoat:$,clearcoatMap:J,clearcoatNormalMap:K,clearcoatRoughnessMap:Q,iridescence:W,iridescenceMap:Z,iridescenceThicknessMap:ee,sheen:q,sheenColorMap:te,sheenRoughnessMap:ne,specularMap:ie,specularColorMap:re,specularIntensityMap:oe,transmission:X,transmissionMap:ae,thicknessMap:se,gradientMap:le,opaque:!1===o.transparent&&1===o.blending,alphaMap:ce,alphaTest:ue,alphaHash:de,combine:o.combine,mapUv:D&&m(o.map.channel),aoMapUv:L&&m(o.aoMap.channel),lightMapUv:U&&m(o.lightMap.channel),bumpMapUv:V&&m(o.bumpMap.channel),normalMapUv:F&&m(o.normalMap.channel),displacementMapUv:B&&m(o.displacementMap.channel),emissiveMapUv:H&&m(o.emissiveMap.channel),metalnessMapUv:z&&m(o.metalnessMap.channel),roughnessMapUv:j&&m(o.roughnessMap.channel),anisotropyMapUv:Y&&m(o.anisotropyMap.channel),clearcoatMapUv:J&&m(o.clearcoatMap.channel),clearcoatNormalMapUv:K&&m(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Q&&m(o.clearcoatRoughnessMap.channel),iridescenceMapUv:Z&&m(o.iridescenceMap.channel),iridescenceThicknessMapUv:ee&&m(o.iridescenceThicknessMap.channel),sheenColorMapUv:te&&m(o.sheenColorMap.channel),sheenRoughnessMapUv:ne&&m(o.sheenRoughnessMap.channel),specularMapUv:ie&&m(o.specularMap.channel),specularColorMapUv:re&&m(o.specularColorMap.channel),specularIntensityMapUv:oe&&m(o.specularIntensityMap.channel),transmissionMapUv:ae&&m(o.transmissionMap.channel),thicknessMapUv:se&&m(o.thicknessMap.channel),alphaMapUv:ce&&m(o.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(F||G),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUv1s:pe,vertexUv2s:fe,vertexUv3s:me,pointsUvs:!0===_.isPoints&&!!y.attributes.uv&&(D||ce),fog:!!v,useFog:!0===o.fog,fogExp2:v&&v.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:A,morphTextureStride:M,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,useLegacyLights:e._useLegacyLights,decodeVideoTexture:D&&!0===o.map.isVideoTexture&&o.map.colorSpace===WT,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===tT,flipSided:o.side===eT,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:he&&!0===o.extensions.derivatives,extensionFragDepth:he&&!0===o.extensions.fragDepth,extensionDrawBuffers:he&&!0===o.extensions.drawBuffers,extensionShaderTextureLOD:he&&!0===o.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0),t.supportsVertexTextures&&s.enable(1),t.instancing&&s.enable(2),t.instancingColor&&s.enable(3),t.matcap&&s.enable(4),t.envMap&&s.enable(5),t.normalMapObjectSpace&&s.enable(6),t.normalMapTangentSpace&&s.enable(7),t.clearcoat&&s.enable(8),t.iridescence&&s.enable(9),t.alphaTest&&s.enable(10),t.vertexColors&&s.enable(11),t.vertexAlphas&&s.enable(12),t.vertexUv1s&&s.enable(13),t.vertexUv2s&&s.enable(14),t.vertexUv3s&&s.enable(15),t.vertexTangents&&s.enable(16),t.anisotropy&&s.enable(17),e.push(s.mask),s.disableAll(),t.fog&&s.enable(0),t.useFog&&s.enable(1),t.flatShading&&s.enable(2),t.logarithmicDepthBuffer&&s.enable(3),t.skinning&&s.enable(4),t.morphTargets&&s.enable(5),t.morphNormals&&s.enable(6),t.morphColors&&s.enable(7),t.premultipliedAlpha&&s.enable(8),t.shadowMapEnabled&&s.enable(9),t.useLegacyLights&&s.enable(10),t.doubleSided&&s.enable(11),t.flipSided&&s.enable(12),t.useDepthPacking&&s.enable(13),t.dithering&&s.enable(14),t.transmission&&s.enable(15),t.sheen&&s.enable(16),t.opaque&&s.enable(17),t.pointsUvs&&s.enable(18),t.decodeVideoTexture&&s.enable(19),e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=dI[t];n=$w.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new lC(e,n,t,o),c.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function pC(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function fC(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function mC(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function gC(){const e=[];let t=0;const n=[],i=[],r=[];function o(n,i,r,o,a,s){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:o,renderOrder:n.renderOrder,z:a,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=a,l.group=s),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,a,s,l,c){const u=o(e,t,a,s,l,c);a.transmission>0?i.push(u):!0===a.transparent?r.push(u):n.push(u)},unshift:function(e,t,a,s,l,c){const u=o(e,t,a,s,l,c);a.transmission>0?i.unshift(u):!0===a.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||fC),i.length>1&&i.sort(t||mC),r.length>1&&r.sort(t||mC)}}}function _C(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new gC,e.set(t,[r])):n>=i.length?(r=new gC,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function vC(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Fx,color:new ow};break;case"SpotLight":n={position:new Fx,direction:new Fx,color:new ow,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Fx,color:new ow,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Fx,skyColor:new ow,groundColor:new ow};break;case"RectAreaLight":n={color:new ow,position:new Fx,halfWidth:new Fx,halfHeight:new Fx}}return e[t.id]=n,n}}}let yC=0;function EC(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function bC(e,t){const n=new vC,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dx};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dx,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)r.probe.push(new Fx);const o=new Fx,a=new mA,s=new mA;return{setup:function(o,a){let s=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,d=0,h=0,p=0,f=0,m=0,g=0,_=0,v=0,y=0;o.sort(EC);const E=!0===a?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],a=t.color,b=t.intensity,S=t.distance,T=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=a.r*b*E,l+=a.g*b*E,c+=a.b*b*E;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],b);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*E),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=T,r.directionalShadowMatrix[u]=t.shadow.matrix,m++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(b*E),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[h]=e;const o=t.shadow;if(t.map&&(r.spotLightMap[v]=t.map,v++,o.updateMatrices(t),t.castShadow&&y++),r.spotLightMatrix[h]=o.matrix,t.castShadow){const e=i.get(t);e.shadowBias=o.bias,e.shadowNormalBias=o.normalBias,e.shadowRadius=o.radius,e.shadowMapSize=o.mapSize,r.spotShadow[h]=e,r.spotShadowMap[h]=T,_++}h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(a).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*E),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[d]=n,r.pointShadowMap[d]=T,r.pointShadowMatrix[d]=t.shadow.matrix,g++}r.point[d]=e,d++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(b*E),e.groundColor.copy(t.groundColor).multiplyScalar(b*E),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=uI.LTC_FLOAT_1,r.rectAreaLTC2=uI.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=uI.LTC_HALF_1,r.rectAreaLTC2=uI.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=l,r.ambient[2]=c;const b=r.hash;b.directionalLength===u&&b.pointLength===d&&b.spotLength===h&&b.rectAreaLength===p&&b.hemiLength===f&&b.numDirectionalShadows===m&&b.numPointShadows===g&&b.numSpotShadows===_&&b.numSpotMaps===v||(r.directional.length=u,r.spot.length=h,r.rectArea.length=p,r.point.length=d,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=_+v-y,r.spotLightMap.length=v,r.numSpotLightShadowsWithMaps=y,b.directionalLength=u,b.pointLength=d,b.spotLength=h,b.rectAreaLength=p,b.hemiLength=f,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=_,b.numSpotMaps=v,r.version=yC++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let t=0,h=e.length;t<h;t++){const h=e[t];if(h.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(h.matrixWorld),o.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),n++}else if(h.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(h.matrixWorld),o.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),l++}else if(h.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),s.identity(),a.copy(h.matrixWorld),a.premultiply(d),s.extractRotation(a),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(h.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),i++}else if(h.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(d),u++}}},state:r}}function SC(e,t){const n=new bC(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function TC(e,t){let n=new WeakMap;return{get:function(i,r=0){const o=n.get(i);let a;return void 0===o?(a=new SC(e,t),n.set(i,[a])):r>=o.length?(a=new SC(e,t),o.push(a)):a=o[r],a},dispose:function(){n=new WeakMap}}}class xC extends ew{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class AC extends ew{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function wC(e,t,n){let i=new oI;const r=new dx,o=new dx,a=new Dx,s=new xC({depthPacking:3201}),l=new AC,c={},u=n.maxTextureSize,d={[ZS]:eT,[eT]:ZS,[tT]:tT},h=new Ww({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new dx},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const f=new bw;f.setAttribute("position",new uw(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Fw(f,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=JS;let _=this.type;function v(n,i){const o=t.update(m);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Px(r.x,r.y)),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,h,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,p,m,null)}function y(t,n,i,r){let o=null;const a=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)o=a;else if(o=!0===i.isPointLight?l:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=o.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=o.clone(),i[t]=r),o=r}return o.visible=n.visible,o.wireframe=n.wireframe,o.side=r===QS?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],o.alphaMap=n.alphaMap,o.alphaTest=n.alphaTest,o.map=n.map,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.clipIntersection=n.clipIntersection,o.displacementMap=n.displacementMap,o.displacementScale=n.displacementScale,o.displacementBias=n.displacementBias,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,!0===i.isPointLight&&!0===o.isMeshDistanceMaterial&&(e.properties.get(o).light=i),o}function E(n,r,o,a,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===QS)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=r[c.materialIndex];if(u&&u.visible){const t=y(n,u,a,s);e.renderBufferDirect(o,null,i,t,n,c)}}}else if(r.visible){const t=y(n,r,a,s);e.renderBufferDirect(o,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)E(l[e],r,o,a,s)}this.render=function(t,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(nT),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=_!==QS&&this.type===QS,f=_===QS&&this.type!==QS;for(let l=0,c=t.length;l<c;l++){const c=t[l],d=c.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;r.copy(d.mapSize);const m=d.getFrameExtents();if(r.multiply(m),o.copy(d.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/m.x),r.x=o.x*m.x,d.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/m.y),r.y=o.y*m.y,d.mapSize.y=o.y)),null===d.map||!0===p||!0===f){const e=this.type!==QS?{minFilter:yT,magFilter:yT}:{};null!==d.map&&d.map.dispose(),d.map=new Px(r.x,r.y,e),d.map.texture.name=c.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const g=d.getViewportCount();for(let e=0;e<g;e++){const t=d.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),h.viewport(a),d.updateMatrices(c,e),i=d.getFrustum(),E(n,s,d.camera,c,this.type)}!0!==d.isPointLightShadow&&this.type===QS&&v(d,s),d.needsUpdate=!1}_=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function IC(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new Dx;let i=null;const r=new Dx(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,a,s){!0===s&&(t*=a,i*=a,o*=a),n.set(t,i,o,a),!1===r.equals(n)&&(e.clearColor(t,i,o,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(t){t?B(e.DEPTH_TEST):H(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},a=new function(){let t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(n){t||(n?B(e.STENCIL_TEST):H(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&o===a||(e.stencilFunc(t,n,a),i=t,r=n,o=a)},setOp:function(t,n,i){a===t&&s===n&&l===i||(e.stencilOp(t,n,i),a=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,c=null}}},s=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,h=[],p=null,f=!1,m=null,g=null,_=null,v=null,y=null,E=null,b=null,S=!1,T=null,x=null,A=null,w=null,I=null;const R=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,M=0;const k=e.getParameter(e.VERSION);-1!==k.indexOf("WebGL")?(M=parseFloat(/^WebGL (\d)/.exec(k)[1]),C=M>=1):-1!==k.indexOf("OpenGL ES")&&(M=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),C=M>=2);let N=null,D={};const O=e.getParameter(e.SCISSOR_BOX),P=e.getParameter(e.VIEWPORT),L=(new Dx).fromArray(O),U=(new Dx).fromArray(P);function V(t,n,r,o){const a=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<r;s++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage3D(n,0,e.RGBA,1,1,o,0,e.RGBA,e.UNSIGNED_BYTE,a);return s}const F={};function B(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function H(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}F[e.TEXTURE_2D]=V(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=V(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(F[e.TEXTURE_2D_ARRAY]=V(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),F[e.TEXTURE_3D]=V(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),B(e.DEPTH_TEST),o.setFunc(3),$(!1),W(1),B(e.CULL_FACE),G(nT);const z={[iT]:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(i)z[103]=e.MIN,z[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(z[103]=e.MIN_EXT,z[104]=e.MAX_EXT)}const j={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,204:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,205:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA};function G(t,n,i,r,o,a,s,l){if(t!==nT){if(!1===f&&(B(e.BLEND),f=!0),5===t)o=o||n,a=a||i,s=s||r,n===g&&o===y||(e.blendEquationSeparate(z[n],z[o]),g=n,y=o),i===_&&r===v&&a===E&&s===b||(e.blendFuncSeparate(j[i],j[r],j[a],j[s]),_=i,v=r,E=a,b=s),m=t,S=!1;else if(t!==m||l!==S){if(g===iT&&y===iT||(e.blendEquation(e.FUNC_ADD),g=iT,y=iT),l)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}_=null,v=null,E=null,b=null,m=t,S=l}}else!0===f&&(H(e.BLEND),f=!1)}function $(t){T!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),T=t)}function W(t){0!==t?(B(e.CULL_FACE),t!==x&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):H(e.CULL_FACE),x=t}function q(t,n,i){t?(B(e.POLYGON_OFFSET_FILL),w===n&&I===i||(e.polygonOffset(n,i),w=n,I=i)):H(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:o,stencil:a},enable:B,disable:H,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,r){let o=h,a=!1;if(i)if(o=d.get(r),void 0===o&&(o=[],d.set(r,o)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(o.length!==t.length||o[0]!==e.COLOR_ATTACHMENT0){for(let n=0,i=t.length;n<i;n++)o[n]=e.COLOR_ATTACHMENT0+n;o.length=t.length,a=!0}}else o[0]!==e.COLOR_ATTACHMENT0&&(o[0]=e.COLOR_ATTACHMENT0,a=!0);else o[0]!==e.BACK&&(o[0]=e.BACK,a=!0);a&&(n.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:G,setMaterial:function(t,n){t.side===tT?H(e.CULL_FACE):B(e.CULL_FACE);let i=t.side===eT;n&&(i=!i),$(i),1===t.blending&&!1===t.transparent?G(nT):G(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),r.setMask(t.colorWrite);const s=t.stencilWrite;a.setTest(s),s&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?B(e.SAMPLE_ALPHA_TO_COVERAGE):H(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:$,setCullFace:W,setLineWidth:function(t){t!==A&&(C&&e.lineWidth(t),A=t)},setPolygonOffset:q,setScissorTest:function(t){t?B(e.SCISSOR_TEST):H(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+R-1),N!==t&&(e.activeTexture(t),N=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===N?e.TEXTURE0+R-1:N);let r=D[i];void 0===r&&(r={type:void 0,texture:void 0},D[i]=r),r.type===t&&r.texture===n||(N!==i&&(e.activeTexture(i),N=i),e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=D[N];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=l.get(n);void 0===i&&(i=new WeakMap,l.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=l.get(n).get(t);s.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),s.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===L.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),L.copy(t))},viewport:function(t){!1===U.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},N=null,D={},u={},d=new WeakMap,h=[],p=null,f=!1,m=null,g=null,_=null,v=null,y=null,E=null,b=null,S=!1,T=null,x=null,A=null,w=null,I=null,L.set(0,0,e.canvas.width,e.canvas.height),U.set(0,0,e.canvas.width,e.canvas.height),r.reset(),o.reset(),a.reset()}}}function RC(e,t,n,i,r,o,a){const s=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,h=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return _?new OffscreenCanvas(e,t):mx("canvas")}function y(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?lx:Math.floor,o=i(r*e.width),a=i(r*e.height);void 0===m&&(m=v(o,a));const s=n?v(o,a):m;return s.width=o,s.height=a,s.getContext("2d").drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function E(e){return sx(e.width)&&sx(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==yT&&e.minFilter!==bT}function S(t){e.generateMipmap(t)}function T(n,i,r,o,a=!1){if(!1===s)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;return i===e.RED&&(r===e.FLOAT&&(l=e.R32F),r===e.HALF_FLOAT&&(l=e.R16F),r===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(l=e.R8UI),r===e.UNSIGNED_SHORT&&(l=e.R16UI),r===e.UNSIGNED_INT&&(l=e.R32UI),r===e.BYTE&&(l=e.R8I),r===e.SHORT&&(l=e.R16I),r===e.INT&&(l=e.R32I)),i===e.RG&&(r===e.FLOAT&&(l=e.RG32F),r===e.HALF_FLOAT&&(l=e.RG16F),r===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RGBA&&(r===e.FLOAT&&(l=e.RGBA32F),r===e.HALF_FLOAT&&(l=e.RGBA16F),r===e.UNSIGNED_BYTE&&(l=o===WT&&!1===a?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)),l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function x(e,t,n){return!0===b(e,n)||e.isFramebufferTexture&&e.minFilter!==yT&&e.minFilter!==bT?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function A(t){return t===yT||1004===t||t===ET?e.NEAREST:e.LINEAR}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=g.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&R(e),0===Object.keys(r).length&&g.delete(n)}i.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function I(t){const n=t.target;n.removeEventListener("dispose",I),function(t){const n=t.texture,r=i.get(t),o=i.get(n);if(void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(r.__webglFramebuffer[t]))for(let n=0;n<r.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(r.__webglFramebuffer[t][n]);else e.deleteFramebuffer(r.__webglFramebuffer[t]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),a.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}(n)}function R(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete g.get(r)[n.__cacheKey],a.memory.textures--}let C=0;function M(t,r){const o=i.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void L(o,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,o.__webglTexture,e.TEXTURE0+r)}const k={[gT]:e.REPEAT,[_T]:e.CLAMP_TO_EDGE,[vT]:e.MIRRORED_REPEAT},N={[yT]:e.NEAREST,1004:e.NEAREST_MIPMAP_NEAREST,[ET]:e.NEAREST_MIPMAP_LINEAR,[bT]:e.LINEAR,1007:e.LINEAR_MIPMAP_NEAREST,[ST]:e.LINEAR_MIPMAP_LINEAR},D={512:e.NEVER,519:e.ALWAYS,513:e.LESS,515:e.LEQUAL,514:e.EQUAL,518:e.GEQUAL,516:e.GREATER,517:e.NOTEQUAL};function O(n,o,a){if(a?(e.texParameteri(n,e.TEXTURE_WRAP_S,k[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,k[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,k[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,N[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,N[o.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),o.wrapS===_T&&o.wrapT===_T||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,A(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,A(o.minFilter)),o.minFilter!==yT&&o.minFilter!==bT&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,D[o.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(o.magFilter===yT)return;if(o.minFilter!==ET&&o.minFilter!==ST)return;if(o.type===wT&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&o.type===IT&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function P(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const r=n.source;let o=g.get(r);void 0===o&&(o={},g.set(r,o));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===o[s]&&(o[s]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),o[s].usedTimes++;const r=o[t.__cacheKey];void 0!==r&&(o[t.__cacheKey].usedTimes--,0===r.usedTimes&&R(n)),t.__cacheKey=s,t.__webglTexture=o[s].texture}return i}function L(t,r,a){let l=e.TEXTURE_2D;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),r.isData3DTexture&&(l=e.TEXTURE_3D);const c=P(t,r),d=r.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+a);const h=i.get(d);if(d.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+a),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=function(e){return!s&&(e.wrapS!==_T||e.wrapT!==_T||e.minFilter!==yT&&e.minFilter!==bT)}(r)&&!1===E(r.image);let i=y(r.image,t,!1,u);i=z(r,i);const p=E(i)||s,f=o.convert(r.format,r.colorSpace);let m,g=o.convert(r.type),_=T(r.internalFormat,f,g,r.colorSpace,r.isVideoTexture);O(l,r,p);const v=r.mipmaps,A=s&&!0!==r.isVideoTexture,w=void 0===h.__version||!0===c,I=x(r,i,p);if(r.isDepthTexture)_=e.DEPTH_COMPONENT,s?_=r.type===wT?e.DEPTH_COMPONENT32F:r.type===AT?e.DEPTH_COMPONENT24:r.type===MT?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===wT&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===NT&&_===e.DEPTH_COMPONENT&&r.type!==xT&&r.type!==AT&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=AT,g=o.convert(r.type)),r.format===DT&&_===e.DEPTH_COMPONENT&&(_=e.DEPTH_STENCIL,r.type!==MT&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=MT,g=o.convert(r.type))),w&&(A?n.texStorage2D(e.TEXTURE_2D,1,_,i.width,i.height):n.texImage2D(e.TEXTURE_2D,0,_,i.width,i.height,0,f,g,null));else if(r.isDataTexture)if(v.length>0&&p){A&&w&&n.texStorage2D(e.TEXTURE_2D,I,_,v[0].width,v[0].height);for(let t=0,i=v.length;t<i;t++)m=v[t],A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,f,g,m.data);r.generateMipmaps=!1}else A?(w&&n.texStorage2D(e.TEXTURE_2D,I,_,i.width,i.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,i.width,i.height,f,g,i.data)):n.texImage2D(e.TEXTURE_2D,0,_,i.width,i.height,0,f,g,i.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){A&&w&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,_,v[0].width,v[0].height,i.depth);for(let t=0,o=v.length;t<o;t++)m=v[t],r.format!==kT?null!==f?A?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,m.width,m.height,i.depth,f,m.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,_,m.width,m.height,i.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,m.width,m.height,i.depth,f,g,m.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,_,m.width,m.height,i.depth,0,f,g,m.data)}else{A&&w&&n.texStorage2D(e.TEXTURE_2D,I,_,v[0].width,v[0].height);for(let t=0,i=v.length;t<i;t++)m=v[t],r.format!==kT?null!==f?A?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,m.data):n.compressedTexImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,m.width,m.height,f,g,m.data):n.texImage2D(e.TEXTURE_2D,t,_,m.width,m.height,0,f,g,m.data)}else if(r.isDataArrayTexture)A?(w&&n.texStorage3D(e.TEXTURE_2D_ARRAY,I,_,i.width,i.height,i.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isData3DTexture)A?(w&&n.texStorage3D(e.TEXTURE_3D,I,_,i.width,i.height,i.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,i.width,i.height,i.depth,f,g,i.data)):n.texImage3D(e.TEXTURE_3D,0,_,i.width,i.height,i.depth,0,f,g,i.data);else if(r.isFramebufferTexture){if(w)if(A)n.texStorage2D(e.TEXTURE_2D,I,_,i.width,i.height);else{let t=i.width,r=i.height;for(let i=0;i<I;i++)n.texImage2D(e.TEXTURE_2D,i,_,t,r,0,f,g,null),t>>=1,r>>=1}}else if(v.length>0&&p){A&&w&&n.texStorage2D(e.TEXTURE_2D,I,_,v[0].width,v[0].height);for(let t=0,i=v.length;t<i;t++)m=v[t],A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,g,m):n.texImage2D(e.TEXTURE_2D,t,_,f,g,m);r.generateMipmaps=!1}else A?(w&&n.texStorage2D(e.TEXTURE_2D,I,_,i.width,i.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,g,i)):n.texImage2D(e.TEXTURE_2D,0,_,f,g,i);b(r,p)&&S(l),h.__version=d.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function U(t,r,a,s,l,c){const u=o.convert(a.format,a.colorSpace),d=o.convert(a.type),p=T(a.internalFormat,u,d,a.colorSpace);if(!i.get(r).__hasExternalTextures){const t=Math.max(1,r.width>>c),i=Math.max(1,r.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,p,t,i,r.depth,0,u,d,null):n.texImage2D(l,c,p,t,i,0,u,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),H(r)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,l,i.get(a).__webglTexture,0,B(r)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,l,i.get(a).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function V(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let r=e.DEPTH_COMPONENT16;if(i||H(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===wT?r=e.DEPTH_COMPONENT32F:t.type===AT&&(r=e.DEPTH_COMPONENT24));const i=B(n);H(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,r,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,r,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const r=B(n);i&&!1===H(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):H(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let r=0;r<t.length;r++){const a=t[r],s=o.convert(a.format,a.colorSpace),l=o.convert(a.type),c=T(a.internalFormat,s,l,a.colorSpace),u=B(n);i&&!1===H(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,n.width,n.height):H(n)?h.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function F(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),M(r.depthTexture,0);const o=i.get(r.depthTexture).__webglTexture,a=B(r);if(r.depthTexture.format===NT)H(r)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(r.depthTexture.format!==DT)throw new Error("Unknown depthTexture format");H(r)?h.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),V(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),V(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function B(e){return Math.min(d,e.samples)}function H(e){const n=i.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function z(e,n){const i=e.colorSpace,r=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===KT||i!==qT&&""!==i&&(i===WT||i===XT?!1===s?!0===t.has("EXT_sRGB")&&r===kT?(e.format=KT,e.minFilter=bT,e.generateMipmaps=!1):n=Ix.sRGBToLinear(n):r===kT&&o===TT||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const e=C;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),C+=1,e},this.resetTextureUnits=function(){C=0},this.setTexture2D=M,this.setTexture2DArray=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?L(o,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?L(o,t,r):n.bindTexture(e.TEXTURE_3D,o.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,r,a){if(6!==r.image.length)return;const l=P(t,r),u=r.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const d=i.get(u);if(u.version!==d.__version||!0===l){n.activeTexture(e.TEXTURE0+a),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=r.isCompressedTexture||r.image[0].isCompressedTexture,i=r.image[0]&&r.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=t||i?i?r.image[e].image:r.image[e]:y(r.image[e],!1,!0,c),h[e]=z(r,h[e]);const p=h[0],f=E(p)||s,m=o.convert(r.format,r.colorSpace),g=o.convert(r.type),_=T(r.internalFormat,m,g,r.colorSpace),v=s&&!0!==r.isVideoTexture,A=void 0===d.__version||!0===l;let w,I=x(r,p,f);if(O(e.TEXTURE_CUBE_MAP,r,f),t){v&&A&&n.texStorage2D(e.TEXTURE_CUBE_MAP,I,_,p.width,p.height);for(let t=0;t<6;t++){w=h[t].mipmaps;for(let i=0;i<w.length;i++){const o=w[i];r.format!==kT?null!==m?v?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,o.width,o.height,m,o.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,_,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,o.width,o.height,m,g,o.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,_,o.width,o.height,0,m,g,o.data)}}}else{w=r.mipmaps,v&&A&&(w.length>0&&I++,n.texStorage2D(e.TEXTURE_CUBE_MAP,I,_,h[0].width,h[0].height));for(let t=0;t<6;t++)if(i){v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,h[t].width,h[t].height,m,g,h[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,h[t].width,h[t].height,0,m,g,h[t].data);for(let i=0;i<w.length;i++){const r=w[i].image[t].image;v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,m,g,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,_,r.width,r.height,0,m,g,r.data)}}else{v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m,g,h[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,_,m,g,h[t]);for(let i=0;i<w.length;i++){const r=w[i];v?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,m,g,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,_,m,g,r.image[t])}}}b(r,f)&&S(e.TEXTURE_CUBE_MAP),d.__version=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(a,t,r):n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+r)},this.rebindTextures=function(t,n,r){const o=i.get(t);void 0!==n&&U(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&F(t)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),u=i.get(l);t.addEventListener("dispose",I),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,a.memory.textures++);const d=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,p=E(t)||s;if(d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(s&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(s&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(h)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&t.samples>0&&!1===H(t)){const i=h?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const r=i[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const a=o.convert(r.format,r.colorSpace),s=o.convert(r.type),l=T(r.internalFormat,a,s,r.colorSpace,!0===t.isXRRenderTarget),u=B(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),V(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(d){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),O(e.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(s&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)U(c.__webglFramebuffer[n][i],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else U(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);b(l,p)&&S(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){const r=t.texture;for(let o=0,a=r.length;o<a;o++){const a=r[o],s=i.get(a);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),O(e.TEXTURE_2D,a,p),U(c.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D,0),b(a,p)&&S(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,u.__webglTexture),O(i,l,p),s&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)U(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,i,n);else U(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i,0);b(l,p)&&S(i),n.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(t){const r=E(t)||s,o=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,s=o.length;a<s;a++){const s=o[a];if(b(s,r)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=i.get(s).__webglTexture;n.bindTexture(r,o),S(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===H(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.width,a=t.height;let s=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const h=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===h&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===h&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),d){const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,o,a,0,0,o,a,s,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const o=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,o,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=U,this.useMultisampledRTT=H}function CC(e,t,n){const i=n.isWebGL2;return{convert:function(n,r=""){let o;const a=r===WT||r===XT?1:0;if(n===TT)return e.UNSIGNED_BYTE;if(n===RT)return e.UNSIGNED_SHORT_4_4_4_4;if(n===CT)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===xT)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(n===AT)return e.UNSIGNED_INT;if(n===wT)return e.FLOAT;if(n===IT)return i?e.HALF_FLOAT:(o=t.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===kT)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===NT)return e.DEPTH_COMPONENT;if(n===DT)return e.DEPTH_STENCIL;if(n===KT)return o=t.get("EXT_sRGB"),null!==o?o.SRGB_ALPHA_EXT:null;if(1028===n)return e.RED;if(n===OT)return e.RED_INTEGER;if(1030===n)return e.RG;if(n===PT)return e.RG_INTEGER;if(n===LT)return e.RGBA_INTEGER;if(n===UT||n===VT||n===FT||n===BT)if(1===a){if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(n===UT)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===VT)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===FT)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===BT)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=t.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(n===UT)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===VT)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===FT)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===BT)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(o=t.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(35840===n)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return o=t.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(o=t.get("WEBGL_compressed_texture_etc"),null===o)return null;if(37492===n)return 1===a?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(37496===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(o=t.get("WEBGL_compressed_texture_astc"),null===o)return null;if(37808===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return 1===a?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===HT||36494===n||36495===n){if(o=t.get("EXT_texture_compression_bptc"),null===o)return null;if(n===HT)return 1===a?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(o=t.get("EXT_texture_compression_rgtc"),null===o)return null;if(n===HT)return o.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===MT?i?e.UNSIGNED_INT_24_8:(o=t.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class MC extends Xw{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class kC extends BA{constructor(){super(),this.isGroup=!0,this.type="Group"}}const NC={type:"move"};class DC{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new kC,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new kC,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Fx,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Fx),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new kC,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Fx,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Fx),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),r=this._getHandJoint(l,i);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),s=.02,c=.005;l.inputState.pinching&&a>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(NC)))}return null!==a&&(a.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new kC;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class OC extends Nx{constructor(e,t,n,i,r,o,a,s,l,c){if((c=void 0!==c?c:NT)!==NT&&c!==DT)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===NT&&(n=AT),void 0===n&&c===DT&&(n=MT),super(null,i,r,o,a,s,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:yT,this.minFilter=void 0!==s?s:yT,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class PC extends ex{constructor(e,t){super();const n=this;let i=null,r=1,o=null,a="local-floor",s=1,l=null,c=null,u=null,d=null,h=null,p=null;const f=t.getContextAttributes();let m=null,g=null;const _=[],v=[],y=new Xw;y.layers.enable(1),y.viewport=new Dx;const E=new Xw;E.layers.enable(2),E.viewport=new Dx;const b=[y,E],S=new MC;S.layers.enable(1),S.layers.enable(2);let T=null,x=null;function A(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||o),n.dispatchEvent({type:e.type,data:e.inputSource}))}function w(){i.removeEventListener("select",A),i.removeEventListener("selectstart",A),i.removeEventListener("selectend",A),i.removeEventListener("squeeze",A),i.removeEventListener("squeezestart",A),i.removeEventListener("squeezeend",A),i.removeEventListener("end",w),i.removeEventListener("inputsourceschange",I);for(let e=0;e<_.length;e++){const t=v[e];null!==t&&(v[e]=null,_[e].disconnect(t))}T=null,x=null,e.setRenderTarget(m),h=null,d=null,u=null,i=null,g=null,N.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=v.indexOf(n);i>=0&&(v[i]=null,_[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=v.indexOf(n);if(-1===i){for(let e=0;e<_.length;e++){if(e>=v.length){v.push(n),i=e;break}if(null===v[e]){v[e]=n,i=e;break}}if(-1===i)break}const r=_[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=_[e];return void 0===t&&(t=new DC,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new DC,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new DC,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",A),i.addEventListener("selectstart",A),i.addEventListener("selectend",A),i.addEventListener("squeeze",A),i.addEventListener("squeezestart",A),i.addEventListener("squeezeend",A),i.addEventListener("end",w),i.addEventListener("inputsourceschange",I),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:h}),g=new Px(h.framebufferWidth,h.framebufferHeight,{format:kT,type:TT,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,o=null,a=null;f.depth&&(a=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?DT:NT,o=f.stencil?MT:AT);const s={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:r};u=new XRWebGLBinding(i,t),d=u.createProjectionLayer(s),i.updateRenderState({layers:[d]}),g=new Px(d.textureWidth,d.textureHeight,{format:kT,type:TT,depthTexture:new OC(d.textureWidth,d.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(s),l=null,o=await i.requestReferenceSpace(a),N.setContext(i),N.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const R=new Fx,C=new Fx;function M(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;S.near=E.near=y.near=e.near,S.far=E.far=y.far=e.far,T===S.near&&x===S.far||(i.updateRenderState({depthNear:S.near,depthFar:S.far}),T=S.near,x=S.far);const t=e.parent,n=S.cameras;M(S,t);for(let e=0;e<n.length;e++)M(n[e],t);2===n.length?function(e,t,n){R.setFromMatrixPosition(t.matrixWorld),C.setFromMatrixPosition(n.matrixWorld);const i=R.distanceTo(C),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],d=(o[8]+1)/o[0],h=a*u,p=a*d,f=i/(-u+d),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+f,_=s+f,v=h-m,y=p+(i-m),E=l*s/_*g,b=c*s/_*g;e.projectionMatrix.makePerspective(v,y,E,b,g,_),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(S,y,E):S.projectionMatrix.copy(y.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*ix*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,S,t)},this.getCamera=function(){return S},this.getFoveation=function(){if(null!==d||null!==h)return s},this.setFoveation=function(e){s=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)};let k=null;const N=new aI;N.setAnimationLoop((function(t,i){if(c=i.getViewerPose(l||o),p=i,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(g,h.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==S.cameras.length&&(S.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let o=null;if(null!==h)o=h.getViewport(r);else{const t=u.getViewSubImage(d,r);o=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let a=b[i];void 0===a&&(a=new Xw,a.layers.enable(i),a.viewport=new Dx,b[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(o.x,o.y,o.width,o.height),0===i&&(S.matrix.copy(a.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),!0===n&&S.cameras.push(a)}}for(let e=0;e<_.length;e++){const t=v[e],n=_[e];null!==t&&void 0!==n&&n.update(t,i,l||o)}k&&k(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function LC(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,r){i.opacity.value=r.opacity,r.color&&i.diffuse.value.copy(r.color),r.emissive&&i.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(i.map.value=r.map,n(r.map,i.mapTransform)),r.alphaMap&&(i.alphaMap.value=r.alphaMap,n(r.alphaMap,i.alphaMapTransform)),r.bumpMap&&(i.bumpMap.value=r.bumpMap,n(r.bumpMap,i.bumpMapTransform),i.bumpScale.value=r.bumpScale,r.side===eT&&(i.bumpScale.value*=-1)),r.normalMap&&(i.normalMap.value=r.normalMap,n(r.normalMap,i.normalMapTransform),i.normalScale.value.copy(r.normalScale),r.side===eT&&i.normalScale.value.negate()),r.displacementMap&&(i.displacementMap.value=r.displacementMap,n(r.displacementMap,i.displacementMapTransform),i.displacementScale.value=r.displacementScale,i.displacementBias.value=r.displacementBias),r.emissiveMap&&(i.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,i.emissiveMapTransform)),r.specularMap&&(i.specularMap.value=r.specularMap,n(r.specularMap,i.specularMapTransform)),r.alphaTest>0&&(i.alphaTest.value=r.alphaTest);const o=t.get(r).envMap;if(o&&(i.envMap.value=o,i.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,i.reflectivity.value=r.reflectivity,i.ior.value=r.ior,i.refractionRatio.value=r.refractionRatio),r.lightMap){i.lightMap.value=r.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=r.lightMapIntensity*t,n(r.lightMap,i.lightMapTransform)}r.aoMap&&(i.aoMap.value=r.aoMap,i.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Gw(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,o,a,s){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform)),e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform));t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===eT&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,s)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,o,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function UC(e,t,n,i){let r={},o={},a=[];const s=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const i=e.value;if(void 0===n[t]){if("number"==typeof i)n[t]=i;else{const e=Array.isArray(i)?i:[i],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());n[t]=r}return!0}if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],r=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(r[t]))return n.copy(r[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete o[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,d){let h=r[n.id];void 0===h&&(function(e){const t=e.uniforms;let n=0;let i=0;for(let e=0,r=t.length;e<r;e++){const r=t[e],o={boundary:0,storage:0},a=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=a.length;e<t;e++){const t=c(a[e]);o.boundary+=t.boundary,o.storage+=t.storage}r.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,e>0&&(i=n%16,0!==i&&16-i-o.boundary<0&&(n+=16-i,r.__offset=n)),n+=o.storage}i=n%16,i>0&&(n+=16-i),e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,o=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,o),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=h,n.addEventListener("dispose",u));const p=d.program;i.updateUBOMapping(n,p);const f=t.render.frame;o[n.id]!==f&&(function(t){const n=r[t.id],i=t.uniforms,o=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=i.length;t<n;t++){const n=i[t];if(!0===l(n,t,o)){const t=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let r=0;for(let o=0;o<i.length;o++){const a=i[o],s=c(a);"number"==typeof a?(n.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+r,n.__data)):a.isMatrix3?(n.__data[0]=a.elements[0],n.__data[1]=a.elements[1],n.__data[2]=a.elements[2],n.__data[3]=a.elements[0],n.__data[4]=a.elements[3],n.__data[5]=a.elements[4],n.__data[6]=a.elements[5],n.__data[7]=a.elements[0],n.__data[8]=a.elements[6],n.__data[9]=a.elements[7],n.__data[10]=a.elements[8],n.__data[11]=a.elements[0]):(a.toArray(n.__data,r),r+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),o[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);a=[],r={},o={}}}}class VC{constructor(e={}){const{canvas:t=gx(),context:n=null,depth:i=!0,stencil:r=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:o;const h=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=WT,this._useLegacyLights=!1,this.toneMapping=sT,this.toneMappingExposure=1;const v=this;let y=!1,E=0,b=0,S=null,T=-1,x=null;const A=new Dx,w=new Dx;let I=null;const R=new ow(0);let C=0,M=t.width,k=t.height,N=1,D=null,O=null;const P=new Dx(0,0,M,k),L=new Dx(0,0,M,k);let U=!1;const V=new oI;let F=!1,B=!1,H=null;const z=new mA,j=new dx,G=new Fx,$={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===S?N:1}let q,X,Y,J,K,Q,Z,ee,te,ne,ie,re,oe,ae,se,le,ce,ue,de,he,pe,fe,me,ge,_e=n;function ve(e,n){for(let i=0;i<e.length;i++){const r=e[i],o=t.getContext(r,n);if(null!==o)return o}return null}try{const e={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${YS}`),t.addEventListener("webglcontextlost",be,!1),t.addEventListener("webglcontextrestored",Se,!1),t.addEventListener("webglcontextcreationerror",Te,!1),null===_e){const t=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&t.shift(),_e=ve(t,e),null===_e)throw ve(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&_e instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ye(){q=new OI(_e),X=new gI(_e,q,e),q.init(X),fe=new CC(_e,q,X),Y=new IC(_e,q,X),J=new UI(_e),K=new pC,Q=new RC(_e,q,Y,K,X,fe,J),Z=new vI(v),ee=new DI(v),te=new sI(_e,X),me=new fI(_e,q,te,X),ne=new PI(_e,te,J,me),ie=new HI(_e,ne,te,J),de=new BI(_e,X,Q),le=new _I(K),re=new hC(v,Z,ee,q,X,me,le),oe=new LC(v,K),ae=new _C,se=new TC(q,X),ue=new pI(v,Z,ee,Y,ie,d,s),ce=new wC(v,ie,X),ge=new UC(_e,J,X,Y),he=new mI(_e,q,J,X),pe=new LI(_e,q,J,X),J.programs=re.programs,v.capabilities=X,v.extensions=q,v.properties=K,v.renderLists=ae,v.shadowMap=ce,v.state=Y,v.info=J}ye();const Ee=new PC(v,_e);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const e=J.autoReset,t=ce.enabled,n=ce.autoUpdate,i=ce.needsUpdate,r=ce.type;ye(),J.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=i,ce.type=r}function Te(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function xe(e){const t=e.target;t.removeEventListener("dispose",xe),function(e){(function(e){const t=K.get(e).programs;void 0!==t&&(t.forEach((function(e){re.releaseProgram(e)})),e.isShaderMaterial&&re.releaseShaderCache(e))})(e),K.remove(e)}(t)}this.xr=Ee,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=q.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=q.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(e){void 0!==e&&(N=e,this.setSize(M,k,!1))},this.getSize=function(e){return e.set(M,k)},this.setSize=function(e,n,i=!0){Ee.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,k=n,t.width=Math.floor(e*N),t.height=Math.floor(n*N),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(M*N,k*N).floor()},this.setDrawingBufferSize=function(e,n,i){M=e,k=n,N=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(A)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,i){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,i),Y.viewport(A.copy(P).multiplyScalar(N).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),Y.scissor(w.copy(L).multiplyScalar(N).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(e){Y.setScissorTest(U=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==S){const t=S.texture.format;e=t===LT||t===PT||t===OT}if(e){const e=S.texture.type,t=e===TT||e===AT||e===xT||e===MT||e===RT||e===CT,n=ue.getClearColor(),i=ue.getClearAlpha(),r=n.r,o=n.g,a=n.b;t?(h[0]=r,h[1]=o,h[2]=a,h[3]=i,_e.clearBufferuiv(_e.COLOR,0,h)):(p[0]=r,p[1]=o,p[2]=a,p[3]=i,_e.clearBufferiv(_e.COLOR,0,p))}else i|=_e.COLOR_BUFFER_BIT}t&&(i|=_e.DEPTH_BUFFER_BIT),n&&(i|=_e.STENCIL_BUFFER_BIT),_e.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",be,!1),t.removeEventListener("webglcontextrestored",Se,!1),t.removeEventListener("webglcontextcreationerror",Te,!1),ae.dispose(),se.dispose(),K.dispose(),Z.dispose(),ee.dispose(),ie.dispose(),me.dispose(),ge.dispose(),re.dispose(),Ee.dispose(),Ee.removeEventListener("sessionstart",we),Ee.removeEventListener("sessionend",Ie),H&&(H.dispose(),H=null),Re.stop()},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=$);const a=r.isMesh&&r.matrixWorld.determinant()<0,s=function(e,t,n,i,r){!0!==t.isScene&&(t=$),Q.resetTextureUnits();const o=t.fog,a=i.isMeshStandardMaterial?t.environment:null,s=null===S?v.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:qT,l=(i.isMeshStandardMaterial?ee:Z).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=sT;i.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=v.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,_=void 0!==g?g.length:0,y=K.get(i),E=m.state.lights;if(!0===F&&(!0===B||e!==x)){const t=e===x&&i.id===T;le.setState(i,e,t)}let b=!1;i.version===y.__version?y.needsLights&&y.lightsStateVersion!==E.state.version||y.outputColorSpace!==s||r.isInstancedMesh&&!1===y.instancing?b=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?b=!0:r.isSkinnedMesh||!0!==y.skinning?r.isInstancedMesh&&!0===y.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===y.instancingColor&&null!==r.instanceColor||y.envMap!==l||!0===i.fog&&y.fog!==o?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===le.numPlanes&&y.numIntersection===le.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==u||y.morphTargets!==d||y.morphNormals!==h||y.morphColors!==p||y.toneMapping!==f||!0===X.isWebGL2&&y.morphTargetsCount!==_)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,y.__version=i.version);let A=y.currentProgram;!0===b&&(A=De(i,t,r));let w=!1,I=!1,R=!1;const C=A.getUniforms(),M=y.uniforms;if(Y.useProgram(A.program)&&(w=!0,I=!0,R=!0),i.id!==T&&(T=i.id,I=!0),w||x!==e){C.setValue(_e,"projectionMatrix",e.projectionMatrix),C.setValue(_e,"viewMatrix",e.matrixWorldInverse);const t=C.map.cameraPosition;void 0!==t&&t.setValue(_e,G.setFromMatrixPosition(e.matrixWorld)),X.logarithmicDepthBuffer&&C.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&C.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),x!==e&&(x=e,I=!0,R=!0)}if(r.isSkinnedMesh){C.setOptional(_e,r,"bindMatrix"),C.setOptional(_e,r,"bindMatrixInverse");const e=r.skeleton;e&&(X.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),C.setValue(_e,"boneTexture",e.boneTexture,Q),C.setValue(_e,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D=n.morphAttributes;var O,P;if((void 0!==D.position||void 0!==D.normal||void 0!==D.color&&!0===X.isWebGL2)&&de.update(r,n,A),(I||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,C.setValue(_e,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(M.envMap.value=l,M.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),I&&(C.setValue(_e,"toneMappingExposure",v.toneMappingExposure),y.needsLights&&(P=R,(O=M).ambientLightColor.needsUpdate=P,O.lightProbe.needsUpdate=P,O.directionalLights.needsUpdate=P,O.directionalLightShadows.needsUpdate=P,O.pointLights.needsUpdate=P,O.pointLightShadows.needsUpdate=P,O.spotLights.needsUpdate=P,O.spotLightShadows.needsUpdate=P,O.rectAreaLights.needsUpdate=P,O.hemisphereLights.needsUpdate=P),o&&!0===i.fog&&oe.refreshFogUniforms(M,o),oe.refreshMaterialUniforms(M,i,N,k,H),$R.upload(_e,y.uniformsList,M,Q)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&($R.upload(_e,y.uniformsList,M,Q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&C.setValue(_e,"center",r.center),C.setValue(_e,"modelViewMatrix",r.modelViewMatrix),C.setValue(_e,"normalMatrix",r.normalMatrix),C.setValue(_e,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(X.isWebGL2){const n=e[t];ge.update(n,A),ge.bind(n,A)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return A}(e,t,n,i,r);Y.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=ne.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,d=n.attributes.position;let h=u.start*c,p=(u.start+u.count)*c;null!==o&&(h=Math.max(h,o.start*c),p=Math.min(p,(o.start+o.count)*c)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):null!=d&&(h=Math.max(h,0),p=Math.min(p,d.count));const f=p-h;if(f<0||f===1/0)return;let g;me.setup(r,i,s,n,l);let _=he;if(null!==l&&(g=te.get(l),_=pe,_.setIndex(g)),r.isMesh)!0===i.wireframe?(Y.setLineWidth(i.wireframeLinewidth*W()),_.setMode(_e.LINES)):_.setMode(_e.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),Y.setLineWidth(e*W()),r.isLineSegments?_.setMode(_e.LINES):r.isLineLoop?_.setMode(_e.LINE_LOOP):_.setMode(_e.LINE_STRIP)}else r.isPoints?_.setMode(_e.POINTS):r.isSprite&&_.setMode(_e.TRIANGLES);if(r.isInstancedMesh)_.renderInstances(h,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);_.renderInstances(h,f,t)}else _.render(h,f)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===tT&&!1===e.forceSinglePass?(e.side=eT,e.needsUpdate=!0,De(e,t,n),e.side=ZS,e.needsUpdate=!0,De(e,t,n),e.side=tT):De(e,t,n)}m=se.get(e),m.init(),_.push(m),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(v._useLegacyLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++)n(i[r],e,t);else n(i,e,t)})),_.pop(),m=null};let Ae=null;function we(){Re.stop()}function Ie(){Re.start()}const Re=new aI;function Ce(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||V.intersectsSprite(e)){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);const t=ie.update(e),r=e.material;r.visible&&f.push(e,t,r,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||V.intersectsObject(e))){const t=ie.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(z)),Array.isArray(r)){const i=t.groups;for(let o=0,a=i.length;o<a;o++){const a=i[o],s=r[a.materialIndex];s&&s.visible&&f.push(e,t,s,n,G.z,a)}}else r.visible&&f.push(e,t,r,n,G.z,null)}const r=e.children;for(let e=0,o=r.length;e<o;e++)Ce(r[e],t,n,i)}function Me(e,t,n,i){const r=e.opaque,o=e.transmissive,a=e.transparent;m.setupLightsView(n),!0===F&&le.setGlobalState(v.clippingPlanes,n),o.length>0&&function(e,t,n,i){const r=X.isWebGL2;null===H&&(H=new Px(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")?IT:TT,minFilter:ST,samples:r?4:0})),v.getDrawingBufferSize(j),r?H.setSize(j.x,j.y):H.setSize(lx(j.x),lx(j.y));const o=v.getRenderTarget();v.setRenderTarget(H),v.getClearColor(R),C=v.getClearAlpha(),C<1&&v.setClearColor(16777215,.5),v.clear();const a=v.toneMapping;v.toneMapping=sT,ke(e,n,i),Q.updateMultisampleRenderTarget(H),Q.updateRenderTargetMipmap(H);let s=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e],o=r.object,a=r.geometry,l=r.material,c=r.group;if(l.side===tT&&o.layers.test(i.layers)){const e=l.side;l.side=eT,l.needsUpdate=!0,Ne(o,n,i,a,l,c),l.side=e,l.needsUpdate=!0,s=!0}}!0===s&&(Q.updateMultisampleRenderTarget(H),Q.updateRenderTargetMipmap(H)),v.setRenderTarget(o),v.setClearColor(R,C),v.toneMapping=a}(r,o,t,n),i&&Y.viewport(A.copy(i)),r.length>0&&ke(r,t,n),o.length>0&&ke(o,t,n),a.length>0&&ke(a,t,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function ke(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],a=o.object,s=o.geometry,l=null===i?o.material:i,c=o.group;a.layers.test(n.layers)&&Ne(a,t,n,s,l,c)}}function Ne(e,t,n,i,r,o){e.onBeforeRender(v,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(v,t,n,i,e,o),!0===r.transparent&&r.side===tT&&!1===r.forceSinglePass?(r.side=eT,r.needsUpdate=!0,v.renderBufferDirect(n,t,i,r,e,o),r.side=ZS,r.needsUpdate=!0,v.renderBufferDirect(n,t,i,r,e,o),r.side=tT):v.renderBufferDirect(n,t,i,r,e,o),e.onAfterRender(v,t,n,i,r,o)}function De(e,t,n){!0!==t.isScene&&(t=$);const i=K.get(e),r=m.state.lights,o=m.state.shadowsArray,a=r.state.version,s=re.getParameters(e,r.state,o,t,n),l=re.getProgramCacheKey(s);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ee:Z).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",xe),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===a)return Oe(e,s),u}else s.uniforms=re.getUniforms(e),e.onBuild(n,s,v),e.onBeforeCompile(s,v),u=re.acquireProgram(s,l),c.set(l,u),i.uniforms=s.uniforms;const d=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=le.uniform),Oe(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix);const h=u.getUniforms(),p=$R.seqWithValue(h.seq,d);return i.currentProgram=u,i.uniformsList=p,u}function Oe(e,t){const n=K.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Re.setAnimationLoop((function(e){Ae&&Ae(e)})),"undefined"!=typeof self&&Re.setContext(self),this.setAnimationLoop=function(e){Ae=e,Ee.setAnimationLoop(e),null===e?Re.stop():Re.start()},Ee.addEventListener("sessionstart",we),Ee.addEventListener("sessionend",Ie),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ee.enabled&&!0===Ee.isPresenting&&(!0===Ee.cameraAutoUpdate&&Ee.updateCamera(t),t=Ee.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,S),m=se.get(e,_.length),m.init(),_.push(m),z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),V.setFromProjectionMatrix(z),B=this.localClippingEnabled,F=le.init(this.clippingPlanes,B),f=ae.get(e,g.length),f.init(),g.push(f),Ce(e,t,0,v.sortObjects),f.finish(),!0===v.sortObjects&&f.sort(D,O),this.info.render.frame++,!0===F&&le.beginShadows();const n=m.state.shadowsArray;if(ce.render(n,e,t),!0===F&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(f,e),m.setupLights(v._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];Me(f,e,i,i.viewport)}}else Me(f,e,t);null!==S&&(Q.updateMultisampleRenderTarget(S),Q.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(v,e,t),me.resetDefaultState(),T=-1,x=null,_.pop(),m=_.length>0?_[_.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,n){K.get(e.texture).__webglTexture=t,K.get(e.depthTexture).__webglTexture=n;const i=K.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===q.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=K.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){S=e,E=t,b=n;let i=!0,r=null,o=!1,a=!1;if(e){const s=K.get(e);void 0!==s.__useDefaultFramebuffer?(Y.bindFramebuffer(_e.FRAMEBUFFER,null),i=!1):void 0===s.__webglFramebuffer?Q.setupRenderTarget(e):s.__hasExternalTextures&&Q.rebindTextures(e,K.get(e.texture).__webglTexture,K.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],o=!0):r=X.isWebGL2&&e.samples>0&&!1===Q.useMultisampledRTT(e)?K.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,A.copy(e.viewport),w.copy(e.scissor),I=e.scissorTest}else A.copy(P).multiplyScalar(N).floor(),w.copy(L).multiplyScalar(N).floor(),I=U;if(Y.bindFramebuffer(_e.FRAMEBUFFER,r)&&X.drawBuffers&&i&&Y.drawBuffers(e,r),Y.viewport(A),Y.scissor(w),Y.setScissorTest(I),o){const i=K.get(e.texture);_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(a){const i=K.get(e.texture),r=t||0;_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}T=-1},this.readRenderTargetPixels=function(e,t,n,i,r,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){Y.bindFramebuffer(_e.FRAMEBUFFER,s);try{const a=e.texture,s=a.format,l=a.type;if(s!==kT&&fe.convert(s)!==_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===IT&&(q.has("EXT_color_buffer_half_float")||X.isWebGL2&&q.has("EXT_color_buffer_float"));if(!(l===TT||fe.convert(l)===_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_TYPE)||l===wT&&(X.isWebGL2||q.has("OES_texture_float")||q.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&_e.readPixels(t,n,i,r,fe.convert(s),fe.convert(l),o)}finally{const e=null!==S?K.get(S).__webglFramebuffer:null;Y.bindFramebuffer(_e.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),o=Math.floor(t.image.height*i);Q.setTexture2D(t,0),_e.copyTexSubImage2D(_e.TEXTURE_2D,n,0,0,e.x,e.y,r,o),Y.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,o=t.image.height,a=fe.convert(n.format),s=fe.convert(n.type);Q.setTexture2D(n,0),_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,n.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?_e.texSubImage2D(_e.TEXTURE_2D,i,e.x,e.y,r,o,a,s,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(_e.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):_e.texSubImage2D(_e.TEXTURE_2D,i,e.x,e.y,a,s,t.image),0===i&&n.generateMipmaps&&_e.generateMipmap(_e.TEXTURE_2D),Y.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=fe.convert(i.format),c=fe.convert(i.type);let u;if(i.isData3DTexture)Q.setTexture3D(i,0),u=_e.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Q.setTexture2DArray(i,0),u=_e.TEXTURE_2D_ARRAY}_e.pixelStorei(_e.UNPACK_FLIP_Y_WEBGL,i.flipY),_e.pixelStorei(_e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),_e.pixelStorei(_e.UNPACK_ALIGNMENT,i.unpackAlignment);const d=_e.getParameter(_e.UNPACK_ROW_LENGTH),h=_e.getParameter(_e.UNPACK_IMAGE_HEIGHT),p=_e.getParameter(_e.UNPACK_SKIP_PIXELS),f=_e.getParameter(_e.UNPACK_SKIP_ROWS),m=_e.getParameter(_e.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;_e.pixelStorei(_e.UNPACK_ROW_LENGTH,g.width),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,g.height),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,e.min.x),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,e.min.y),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?_e.texSubImage3D(u,r,t.x,t.y,t.z,o,a,s,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(u,r,t.x,t.y,t.z,o,a,s,l,g.data)):_e.texSubImage3D(u,r,t.x,t.y,t.z,o,a,s,l,c,g),_e.pixelStorei(_e.UNPACK_ROW_LENGTH,d),_e.pixelStorei(_e.UNPACK_IMAGE_HEIGHT,h),_e.pixelStorei(_e.UNPACK_SKIP_PIXELS,p),_e.pixelStorei(_e.UNPACK_SKIP_ROWS,f),_e.pixelStorei(_e.UNPACK_SKIP_IMAGES,m),0===r&&i.generateMipmaps&&_e.generateMipmap(u),Y.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?Q.setTextureCube(e,0):e.isData3DTexture?Q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Q.setTexture2DArray(e,0):Q.setTexture2D(e,0),Y.unbindTexture()},this.resetState=function(){E=0,b=0,S=null,Y.reset(),me.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return QT}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===WT?$T:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===$T?WT:qT}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class extends VC{}).prototype.isWebGL1Renderer=!0;class FC extends BA{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class BC extends Nx{constructor(e,t,n,i,r,o,a,s,l){super(e,t,n,i,r,o,a,s,l),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:bT,this.magFilter=void 0!==r?r:bT,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}function HC(e,t,n){return jC(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function zC(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function jC(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}class GC{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const a=t[1];e<a&&(n=2,r=a);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class $C extends GC{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=e,a=2*t-n;break;case 2402:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+i[1]-i[0];break;default:o=e-1,s=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,_=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,v=(-1-h)*m+(1.5+h)*f+.5*p,y=h*m-h*f;for(let e=0;e!==a;++e)r[e]=g*o[c+e]+_*o[l+e]+v*o[s+e]+y*o[u+e];return r}}class WC extends GC{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(n-t)/(i-t),u=1-c;for(let e=0;e!==a;++e)r[e]=o[l+e]*u+o[s+e]*c;return r}}class qC extends GC{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class XC{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=zC(t,this.TimeBufferType),this.values=zC(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:zC(e.times,Array),values:zC(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new qC(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new WC(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new $C(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case zT:t=this.InterpolantFactoryMethodDiscrete;break;case jT:t=this.InterpolantFactoryMethodLinear;break;case GT:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return zT;case this.InterpolantFactoryMethodLinear:return jT;case this.InterpolantFactoryMethodSmooth:return GT}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=HC(n,r,o),this.values=HC(this.values,r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==o&&o>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,o),e=!1;break}o=i}if(void 0!==i&&jC(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=HC(this.times),t=HC(this.values),n=this.getValueSize(),i=this.getInterpolation()===GT,r=e.length-1;let o=1;for(let a=1;a<r;++a){let r=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(i)r=!0;else{const e=a*n,i=e-n,o=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[o+a]){r=!0;break}}}if(r){if(a!==o){e[o]=e[a];const i=a*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,a=0;a!==n;++a)t[i+a]=t[e+a];++o}return o!==e.length?(this.times=HC(e,0,o),this.values=HC(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=HC(this.times,0),t=HC(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}XC.prototype.TimeBufferType=Float32Array,XC.prototype.ValueBufferType=Float32Array,XC.prototype.DefaultInterpolation=jT;class YC extends XC{}YC.prototype.ValueTypeName="bool",YC.prototype.ValueBufferType=Array,YC.prototype.DefaultInterpolation=zT,YC.prototype.InterpolantFactoryMethodLinear=void 0,YC.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends XC{}).prototype.ValueTypeName="color";(class extends XC{}).prototype.ValueTypeName="number";class JC extends GC{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)Vx.slerpFlat(r,0,o,l-a,o,l,s);return r}}class KC extends XC{InterpolantFactoryMethodLinear(e){return new JC(this.times,this.values,this.getValueSize(),e)}}KC.prototype.ValueTypeName="quaternion",KC.prototype.DefaultInterpolation=jT,KC.prototype.InterpolantFactoryMethodSmooth=void 0;class QC extends XC{}QC.prototype.ValueTypeName="string",QC.prototype.ValueBufferType=Array,QC.prototype.DefaultInterpolation=zT,QC.prototype.InterpolantFactoryMethodLinear=void 0,QC.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends XC{}).prototype.ValueTypeName="vector";class ZC extends Error{constructor(e,t){super(e),this.response=t}}const eM="\\[\\]\\.:\\/",tM=new RegExp("["+eM+"]","g"),nM="[^"+eM+"]",iM="[^"+eM.replace("\\.","")+"]",rM=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",nM)+/(WCOD+)?/.source.replace("WCOD",iM)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",nM)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",nM)+"$"),oM=["material","materials","bones","map"];class aM{constructor(e,t,n){this.path=t,this.parsedPath=n||aM.parseTrackName(t),this.node=aM.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new aM.Composite(e,t,n):new aM(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tM,"")}static parseTrackName(e){const t=rM.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==oM.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=aM.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}aM.Composite=class{constructor(e,t,n){const i=n||aM.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},aM.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},aM.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},aM.prototype.GetterByBindingType=[aM.prototype._getValue_direct,aM.prototype._getValue_array,aM.prototype._getValue_arrayElement,aM.prototype._getValue_toArray],aM.prototype.SetterByBindingTypeAndVersioning=[[aM.prototype._setValue_direct,aM.prototype._setValue_direct_setNeedsUpdate,aM.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[aM.prototype._setValue_array,aM.prototype._setValue_array_setNeedsUpdate,aM.prototype._setValue_array_setMatrixWorldNeedsUpdate],[aM.prototype._setValue_arrayElement,aM.prototype._setValue_arrayElement_setNeedsUpdate,aM.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[aM.prototype._setValue_fromArray,aM.prototype._setValue_fromArray_setNeedsUpdate,aM.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:YS}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=YS);var sM={auto:"auto",canvas2d:"canvas2d",three:"three"},lM="default_canvas_2d_canvas",cM=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},uM=function(e){return"".concat("==>tv_log"," ").concat(e)},dM={log:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.log.apply(console,cM([uM(e)],t,!1))},warn:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.warn.apply(console,cM([uM(e)],t,!1))},error:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.error.apply(console,cM([uM(e)],t,!1))}};const hM=dM;var pM=function(e,t){var n=0,i=document.createElement("div");function r(e){return i.appendChild(e.dom),e}function o(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}i.style.cssText="position:fixed;top:0;left:100px;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),o(++n%i.children.length)}),!1);var a=(performance||Date).now(),s=a,l=0,c=r(new pM.Panel("FPS","#0ff","#002")),u=r(new pM.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=r(new pM.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:i,addPanel:r,showPanel:o,begin:function(){a=(performance||Date).now()},end:function(){l++;var n=(performance||Date).now(),i=n-a;if(u.update(i,200),null==t||t(i),n>=s+1e3){var r=1e3*l/(n-s);if(c.update(r,100),null==e||e(r),s=n,l=0,d){var o=performance.memory;d.update(o.usedJSHeapSize/1048576,o.jsHeapSizeLimit/1048576)}}return n},update:function(){a=this.end()},domElement:i,setMode:o}};pM.Panel=function(e,t,n){var i=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,d=3*a,h=15*a,p=74*a,f=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(d,h,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(d,h,p,f),{dom:m,update:function(l,_){i=Math.min(i,l),r=Math.max(r,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,h),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(i)+"-"+o(r)+")",c,u),g.drawImage(m,d+a,h,p-a,f,d,h,p-a,f),g.fillRect(d+p-a,h,a,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(d+p-a,h,a,o((1-l/_)*f))}}};const fM=pM;var mM=function(e,t){return new Promise((function(n,i){setTimeout((function(){n(t)}),e)}))},gM=function(e){var t=getComputedStyle(e);return{width:parseInt(t.width,10),height:parseInt(t.height,10)}},_M=function(e){var t=e.debug,n=e.debugStatsMode,i=e.containerDom,r=e.debugStatsFpsChange,o=e.debugStatsMsChange,a=t?new fM(r,o):null;return a&&(a.showPanel(n),i.appendChild(a.dom)),a},vM=function(e,t){Object.keys(t).forEach((function(n){e.style[n]=t[n]}))},yM=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},EM=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},bM="videoDom  containerDom ",SM="getComputedStyle(videoDom)  height , %s, ";var TM=function(){return TM=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},TM.apply(this,arguments)},xM=(0,o.forwardRef)((function(e,t){var n=e.className,i=e.style,r=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["className","style"]),a=(0,o.useRef)(null),s=function(e){var t=e.getVideoDom,n=e.getContainerDom,i=e.renderMode,r=void 0===i?sM.auto:i,a=e.canvasClassName,s=e.fps,l=e.debug,c=e.debugStatsMode,u=void 0===c?1:c,d=e.debugStatsFpsChange,h=e.debugStatsMsChange,p=(0,o.useMemo)((function(){var e="number"==typeof s;return e?{isValid:e,unitTime:parseInt((1e3/s).toString(),10)}:{isValid:e,unitTime:0}}),[s]),f=(0,o.useCallback)((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];l&&hM.log.apply(hM,e)}),[l]),m=(0,o.useMemo)((function(){var e=sM[r]?r:sM.auto;return e===sM.auto?function(){try{var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return Boolean(t&&t instanceof WebGLRenderingContext)}catch(e){return hM.warn("webgl detect error",e),!1}}()?sM.three:sM.canvas2d:e}),[r]),g=(0,o.useRef)(!1),_=(0,o.useRef)(0);return(0,o.useEffect)((function(){return f("input mode: %s, actual mode: %s",r,m),console.log("==>tv mode",m),function(){g.current=!1}}),[]),{startTransform:m===sM.three?function(){return yM(void 0,void 0,void 0,(function(){var e,i,r,o,s,c,f,m,v,y,E,b,S,T;return EM(this,(function(x){switch(x.label){case 0:return e=null==t?void 0:t(),i=null==n?void 0:n(),e&&i?g.current?(g.current=!1,[4,mM(50)]):[3,2]:(hM.error(bM,e,i),[2]);case 1:x.sent(),x.label=2;case 2:return g.current=!0,r=gM(e),o=r.width,(s=r.height)%2?(hM.error(SM,s),[2]):(i.innerHTML="",(c=new VC).setClearColor(16777215,0),c.setSize(o,s/2),vM(c.domElement,{width:"",height:""}),c.domElement.className=Bo()(lM,a),i.appendChild(c.domElement),f=new FC,(m=new yI(-o/2,o/2,s/2,0,1,100)).position.set(0,0,1),m.lookAt(0,0,0),v=new lI(o,s),(y=new BC(e)).minFilter=bT,y.magFilter=bT,y.format=kT,E=new Ww({vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vUv = uv;\n}\n",fragmentShader:"\nuniform sampler2D videoTexture;\nuniform vec2 resolution;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 color = texture2D(videoTexture, vUv);\n\n  // \n  float alpha = 1.0;\n  if (vUv.y > 0.5) {\n    vec4 lowerColor = texture2D(videoTexture, vec2(vUv.x, vUv.y - 0.5));\n    alpha = lowerColor.r;\n  }\n\n  gl_FragColor = vec4(color.rgb, alpha);\n}\n",transparent:!0,uniforms:{resolution:{value:new dx(window.innerWidth,window.innerHeight)},videoTexture:{value:y}}}),b=new Fw(v,E),f.add(b),S=_M({debug:l,debugStatsMode:u,containerDom:i,debugStatsFpsChange:d,debugStatsMsChange:h}),(T=function(){var e=Date.now();(!p.isValid||e-_.current>p.unitTime)&&(_.current=e,null==S||S.update(),c.render(f,m)),g.current&&requestAnimationFrame(T)})(),[2])}}))}))}:function(){return yM(void 0,void 0,void 0,(function(){var e,i,r,o,s,c,f,m,v,y,E;return EM(this,(function(b){switch(b.label){case 0:return e=null==t?void 0:t(),i=null==n?void 0:n(),e&&i?(r=gM(e),o=r.width,(s=r.height)%2?(hM.error(SM,s),[2]):(i.innerHTML="",(c=document.createElement("canvas")).id="default_canvas_2d_hide_canvas",c.width=o,c.height=s,vM(c,{opacity:"0",position:"fixed",zIndex:"-1",left:"0",top:"0"}),i.appendChild(c),f=c.getContext("2d"),(m=document.createElement("canvas")).className=Bo()(lM,a),m.width=o,m.height=s/2,i.appendChild(m),v=m.getContext("2d"),g.current?(g.current=!1,[4,mM(50)]):[3,2])):(hM.error(bM,e,i),[2]);case 1:b.sent(),b.label=2;case 2:return g.current=!0,y=_M({debug:l,debugStatsMode:u,containerDom:i,debugStatsFpsChange:d,debugStatsMsChange:h}),E=function(){var t=Date.now();if(!p.isValid||t-_.current>p.unitTime){_.current=t,null==y||y.update(),f.drawImage(e,0,0,o,s);for(var n=f.getImageData(0,0,o,s),i=n.data.length/2,r=0;r<i;r+=4){var a=i+r;n.data[r+3]=n.data[a]}v.putImageData(n,0,0)}g.current&&requestAnimationFrame(E)},E(),[2]}}))}))}}}(TM(TM({},r),{getContainerDom:function(){return a.current}})).startTransform;return(0,o.useImperativeHandle)(t,(function(){return{startTransform:s}})),o.createElement("div",{className:n,style:i,ref:a})}));const AM=xM;var wM=function(){return wM=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},wM.apply(this,arguments)};const IM=function(e){var t,n,i,r,a,s,l,c,u,d,h,p,f,m,g,_,v,y,E,b,T,x,A,w,I,R,C,M,k,N,D,O,P,L,U,V,F,B,H,z,j,G,$,W,q,X,Y,J,K,Q,Z,ee,te,ne,ie,re=e.projectId,oe=e.signature,ae=e.mountClass,se=e.onPlayStream,ce=void 0===se?function(e){}:se,ue=e.onError,de=void 0===ue?function(){}:ue,he=e.onJoinRoom,pe=void 0===he?function(e){}:he,fe=e.onStopStream,me=void 0===fe?function(){}:fe,ge=e.onTalkEnd,_e=void 0===ge?function(e){}:ge,ve=e.onTalkStart,ye=void 0===ve?function(e){}:ve,Ee=e.onInited,be=void 0===Ee?function(){}:Ee,Se=e.includeUI,Te=e.mode,xe=e.asr,Ae=void 0!==xe&&xe,we=e.timeout,Ie=void 0===we?3e5:we,Re=e.bitrateEnum,Ce=void 0===Re?"R_720P":Re,Me=e.rtcVersion,ke=void 0===Me?"v2":Me,Ne=e.env,De=void 0===Ne?"prod":Ne,Oe=e.showDefaultStaticImage,Pe=void 0!==Oe&&Oe,Le=(0,o.useRef)(null),Ue=(0,o.useRef)(null),Ve=XS({tvRef:Le,signature:oe,onPlayStream:ce,onError:de,onStopStream:me,onTalkEnd:_e,onTalkStart:ye,onInited:be,onJoinRoom:pe,mode:Te,asr:Ae,timeout:Ie,bitrateEnum:Ce,rtcVersion:ke,env:De,projectId:re}),Fe=(Ve.humanRef,Ve.state);Ve.setState,Ve.humanInstanse,Ve.reset,Ve.inputRef,Ve.handle,Ve.waitTextRef,(0,o.useEffect)((function(){var e;Le.current&&(null===(e=Le.current)||void 0===e||e.startTransform())}),[Fe.trans]),(0,o.useLayoutEffect)((function(){if(Fe.videoSize.width&&Fe.videoSize.height){var e=document.querySelector(ae?".".concat(ae):S);if(e){ae||(e.style.width="100vw",e.style.height="100vh");var t=e.getClientRects()[0],n=t.width,i=t.height,r=Math.min(n/Fe.videoSize.width,i/Fe.videoSize.height);e.style.fontSize="".concat(100*r,"px")}}}),[Fe.videoSize]),(0,o.useLayoutEffect)((function(){var e;e="https://lf1-cdn-tos.bytegoofy.com/obj/iconpark/icons_22525_90.63898555774fb1e6965505d908f8c75a.es5.js",new Promise((function(t,n){var i=document.createElement("script");i.src=e,i.onload=function(){t()},i.onerror=function(t){console.log("==>loadScriptError",e,t),n()},document.head.appendChild(i)}))}),[]),(0,o.useEffect)((function(){var e,t,n;Ue.current&&(Fe.connect?(Ue.current.volume=(null===(e=Fe.bgVideo)||void 0===e?void 0:e.volume)||0,null===(t=Ue.current)||void 0===t||t.play()):(Ue.current.currentTime=0,null===(n=Ue.current)||void 0===n||n.pause()))}),[Fe.connect]);var Be=Se&&Fe.connect?{backgroundImage:"url(".concat(Fe.bgm,")"),backgroundSize:"100% 100%"}:{};return o.createElement("div",{className:"moke-wrap"},o.createElement("div",{className:"rtc-container"},function(){var e,t,n,i;return!Fe.connect&&Pe?o.createElement("div",{style:{backgroundImage:Se?"url(".concat(Fe.bgm,")"):"none",backgroundSize:"100% 100%",width:"".concat((null===(e=Fe.videoSize)||void 0===e?void 0:e.width)/100,"em"),height:"".concat((null===(t=Fe.videoSize)||void 0===t?void 0:t.height)/100,"em"),position:"absolute"}},o.createElement("div",{style:{position:"absolute",width:NS(Fe.human.Width),zIndex:Fe.human.webIndex,height:DS(Fe.human.Height),left:MS(Fe.human.X,Fe.videoSize.width),top:kS(Fe.human.Y,Fe.videoSize.height),opacity:(null===(n=Fe.human)||void 0===n?void 0:n.zIndex)?1:0}},o.createElement("img",{src:null===(i=null==Fe?void 0:Fe.human)||void 0===i?void 0:i.mediaUrl,width:"100%",height:"100%"}))):o.createElement(o.Fragment,null)}(),o.createElement("div",{id:"remoteStreamContainer",className:"".concat("matt"===Fe.liveOrMatt?"matt":""),style:"matt"!==Fe.liveOrMatt?(null===(t=null==Fe?void 0:Fe.human)||void 0===t?void 0:t.Width)?{width:NS(Fe.human.Width),zIndex:Fe.human.webIndex,height:DS(Fe.human.Height),left:MS(Fe.human.X,Fe.videoSize.width),top:kS(Fe.human.Y,Fe.videoSize.height),opacity:(null===(n=Fe.human)||void 0===n?void 0:n.zIndex)?1:0}:{}:{position:"absolute",left:Fe.test?0:-9999,width:"ipone9:16"===Fe.templateName?null===(i=Fe.videoSize)||void 0===i?void 0:i.width:null===(r=Fe.videoSize)||void 0===r?void 0:r.width,height:"ipone9:16"===Fe.templateName?null===(a=Fe.videoSize)||void 0===a?void 0:a.height:null===(s=Fe.videoSize)||void 0===s?void 0:s.height}}),Fe.connect&&Fe.trans&&"matt"===Fe.liveOrMatt&&o.createElement(AM,{className:"show-video",ref:Le,getVideoDom:function(){var e;return null===(e=document.querySelector("#remoteStreamContainer"))||void 0===e?void 0:e.children[0]},fps:16,style:(null===(l=null==Fe?void 0:Fe.human)||void 0===l?void 0:l.Width)?{width:NS(Fe.human.Width),zIndex:Fe.human.webIndex,height:DS(Fe.human.Height),left:MS(Fe.human.X,Fe.videoSize.width),top:kS(Fe.human.Y,Fe.videoSize.height),opacity:(null===(c=Fe.human)||void 0===c?void 0:c.zIndex)?1:0}:{}}),(null==Fe?void 0:Fe.init)&&o.createElement("div",{className:"rtc-human",style:wM({width:"".concat((null===(u=Fe.videoSize)||void 0===u?void 0:u.width)/100,"em"),height:"".concat((null===(d=Fe.videoSize)||void 0===d?void 0:d.height)/100,"em")},Be)},Se&&o.createElement(o.Fragment,null,Fe.bgVideo.videoUrl&&Fe.connect&&o.createElement("video",{poster:Fe.bgVideo.videoPoster,ref:Ue,height:"100%",src:Fe.bgVideo.videoUrl,loop:Fe.bgVideo.loop}),Fe.connect&&o.createElement(o.Fragment,null,Boolean(null===(h=Fe.globalImage)||void 0===h?void 0:h.length)&&Fe.globalImage.map((function(e,t){var n,i;return o.createElement(o.Fragment,null,e.attributes.toolType?o.createElement(o.Fragment,null):o.createElement("div",{key:"globalImage"+t,className:"anima"},o.createElement("div",{className:"global-image",style:(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Width)?{width:NS(e.attributes.Width),height:DS(e.attributes.Height),left:MS(e.attributes.X,Fe.videoSize.width),top:kS(e.attributes.Y,Fe.videoSize.height),zIndex:e.attributes.webIndex,opacity:(null===(i=e.attributes)||void 0===i?void 0:i.zIndex)?1:0}:{}},o.createElement("img",{alt:"",src:null==e?void 0:e.mediaUrl,width:"100%",height:"100%"}))))})),Fe.displayImages.length?Fe.displayImages.map((function(e,t){var n,i,r;return o.createElement(o.Fragment,null,"think"!==(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.imgType)?o.createElement("div",{key:"displayImages"+(null==e?void 0:e.mediaUrl),className:"anima"},o.createElement("div",{className:"display-image",style:(null===(i=null==e?void 0:e.attributes)||void 0===i?void 0:i.Width)?{width:NS(e.attributes.Width),height:DS(e.attributes.Height),left:MS(e.attributes.X,Fe.videoSize.width),top:kS(e.attributes.Y,Fe.videoSize.height),zIndex:e.attributes.webIndex,opacity:(null===(r=e.attributes)||void 0===r?void 0:r.zIndex)?1:0}:{}},o.createElement("img",{alt:"",src:null==e?void 0:e.mediaUrl,width:"100%",height:"100%"}))):o.createElement(o.Fragment,null))})):o.createElement(o.Fragment,null),(null===(p=Fe.globalVideo)||void 0===p?void 0:p.length)&&Fe.connect?o.createElement(o.Fragment,null,Fe.globalVideo.map((function(e,t){var n,i;return o.createElement("div",{key:"displayImages"+t,className:"anima",style:(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Width)?{width:NS(e.attributes.Width),height:DS(e.attributes.Height),left:MS(e.attributes.X,Fe.videoSize.width),top:kS(e.attributes.Y,Fe.videoSize.height),zIndex:e.attributes.webIndex,opacity:(null===(i=e.attributes)||void 0===i?void 0:i.zIndex)?1:0}:{}},o.createElement("video",{className:"global-video",src:null==e?void 0:e.mediaUrl,key:"video"+t,muted:!0,preload:"auto",onPlay:function(t){var n,i;t.currentTarget.volume=(null===(i=null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Effects[0])||void 0===i?void 0:i.Gain)||.3},playsInline:!0,autoPlay:!0,controls:!0,onTouchStart:function(t){var n,i;t.currentTarget.volume=(null===(i=null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Effects[0])||void 0===i?void 0:i.Gain)||.3,t.currentTarget.play()},onClick:function(t){var n,i;t.currentTarget.volume=(null===(i=null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Effects[0])||void 0===i?void 0:i.Gain)||.3,t.currentTarget.play()},loop:!0}))}))):o.createElement(o.Fragment,null),(null===(f=Fe.displayVideo)||void 0===f?void 0:f.length)&&Fe.connect?o.createElement(o.Fragment,null,Fe.displayVideo.map((function(e,t){var n,i;return o.createElement("div",{key:"displayImages"+t,className:"anima",style:(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Width)?{width:NS(e.attributes.Width),height:DS(e.attributes.Height),left:MS(e.attributes.X,Fe.videoSize.width),top:kS(e.attributes.Y,Fe.videoSize.height),zIndex:e.attributes.webIndex,opacity:(null===(i=e.attributes)||void 0===i?void 0:i.zIndex)?1:0}:{}},o.createElement("video",{className:"display-video",src:null==e?void 0:e.mediaUrl,key:"video"+t,muted:!0,preload:"auto",onPlay:function(t){var n,i;t.currentTarget.volume=(null===(i=null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Effects[0])||void 0===i?void 0:i.Gain)||.3},autoPlay:!0,playsInline:!0,controls:!0,loop:!0}))}))):o.createElement(o.Fragment,null),(null===(m=Fe.caption)||void 0===m?void 0:m.attributes)&&o.createElement("div",{className:"display-caption",style:(null===(_=null===(g=null==Fe?void 0:Fe.caption)||void 0===g?void 0:g.attributes)||void 0===_?void 0:_.Width)?{position:"absolute",width:NS(null===(y=null===(v=Fe.caption)||void 0===v?void 0:v.attributes)||void 0===y?void 0:y.Width),height:DS(null===(b=null===(E=Fe.caption)||void 0===E?void 0:E.attributes)||void 0===b?void 0:b.Height),left:MS(null===(x=null===(T=Fe.caption)||void 0===T?void 0:T.attributes)||void 0===x?void 0:x.X,null===(A=Fe.videoSize)||void 0===A?void 0:A.width),top:kS(null===(I=null===(w=Fe.caption)||void 0===w?void 0:w.attributes)||void 0===I?void 0:I.selfY,null===(R=Fe.videoSize)||void 0===R?void 0:R.height),zIndex:null===(M=null===(C=Fe.caption)||void 0===C?void 0:C.attributes)||void 0===M?void 0:M.webIndex,fontFamily:null===(N=null===(k=Fe.caption)||void 0===k?void 0:k.attributes)||void 0===N?void 0:N.Font,fontStyle:(null===(P=null===(O=null===(D=Fe.caption)||void 0===D?void 0:D.attributes)||void 0===O?void 0:O.FontFace)||void 0===P?void 0:P.Italic)?"italic":"normal",fontWeight:(null===(V=null===(U=null===(L=Fe.caption)||void 0===L?void 0:L.attributes)||void 0===U?void 0:U.FontFace)||void 0===V?void 0:V.Bold)?"bold":"normal",textDecoration:(null===(H=null===(B=null===(F=Fe.caption)||void 0===F?void 0:F.attributes)||void 0===B?void 0:B.FontFace)||void 0===H?void 0:H.Underline)?"underline":"none",color:null===(j=null===(z=Fe.caption)||void 0===z?void 0:z.attributes)||void 0===j?void 0:j.FontColor,opacity:null===($=null===(G=Fe.caption)||void 0===G?void 0:G.attributes)||void 0===$?void 0:$.FontColorOpacity,visibility:(null===(q=null===(W=Fe.caption)||void 0===W?void 0:W.attributes)||void 0===q?void 0:q.visible)?"visible":"hidden",lineHeight:"".concat((null===(Y=null===(X=Fe.caption)||void 0===X?void 0:X.attributes)||void 0===Y?void 0:Y.fontLineHeight)/100,"em"),textAlign:(null===(K=null===(J=Fe.caption)||void 0===J?void 0:J.attributes)||void 0===K?void 0:K.Alignment)===Ml.CENTER?"center":(null===(Z=null===(Q=Fe.caption)||void 0===Q?void 0:Q.attributes)||void 0===Z?void 0:Z.Alignment)===Ml.LEFT?"left":"right",letterSpacing:"".concat((null===(te=null===(ee=Fe.caption)||void 0===ee?void 0:ee.attributes)||void 0===te?void 0:te.Spacing)/100,"em")}:{}},o.createElement("div",{style:{fontSize:"".concat((null===(ie=null===(ne=Fe.caption)||void 0===ne?void 0:ne.attributes)||void 0===ie?void 0:ie.fontSize)/100,"em")}},Fe.preAns)),Fe.displayTexts&&Fe.displayTexts.map((function(e,t){var n;return o.createElement(le,{key:"displayTexts"+t,timeout:300,classNames:"anima"},o.createElement("div",{key:"displayTexts"+t,className:"display-text",style:(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Width)?{width:NS(e.attributes.Width),height:DS(e.attributes.Height),left:MS(e.attributes.X,Fe.videoSize.width),top:kS(e.attributes.selfY,Fe.videoSize.height),zIndex:e.attributes.webIndex,fontFamily:e.attributes.Font,fontStyle:e.attributes.FontFace.Italic?"italic":"normal",fontWeight:e.attributes.FontFace.Bold?"bold":"normal",textDecoration:e.attributes.FontFace.Underline?"underline":"none",color:e.attributes.FontColor,opacity:e.attributes.FontColorOpacity,visibility:e.attributes.visible?"visible":"hidden",lineHeight:"".concat(e.attributes.fontLineHeight/100,"em")}:{}},o.createElement("div",{style:{fontSize:"".concat(e.attributes.fontSize/100,"em")}},e.content)))})),Fe.globalTexts&&Fe.globalTexts.map((function(e,t){var n,i,r;return o.createElement(le,{key:"displayTexts"+t,timeout:300,classNames:"anima"},o.createElement("div",{key:"displayTexts"+t,className:"global-text",style:(null===(n=null==e?void 0:e.attributes)||void 0===n?void 0:n.Height)?{width:NS(null===(i=null==e?void 0:e.attributes)||void 0===i?void 0:i.Width),height:DS(null===(r=null==e?void 0:e.attributes)||void 0===r?void 0:r.Height),left:MS(e.attributes.X,Fe.videoSize.width),top:kS(e.attributes.selfY,Fe.videoSize.height),zIndex:e.attributes.webIndex,fontFamily:e.attributes.Font,fontStyle:e.attributes.FontFace.Italic?"italic":"normal",fontWeight:e.attributes.FontFace.Bold?"bold":"normal",textDecoration:e.attributes.FontFace.Underline?"underline":"none",color:e.attributes.FontColor,opacity:e.attributes.FontColorOpacity,visibility:e.attributes.visible?"visible":"hidden",lineHeight:"".concat(e.attributes.fontLineHeight/100,"em"),whiteSpace:"pre"}:{}},o.createElement("div",{style:{fontSize:"".concat(e.attributes.fontSize/100,"em")}},e.content)))})))))))};__webpack_require__(854);var RM=function(){return RM=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},RM.apply(this,arguments)},CM=function(){function e(t){this.ele=null,this.props=t,e._mount||this.init(),e.proxy=t.proxy||e.proxy}return e.prototype.init=function(){var t,n,i,a,s,l,c,u,d;if(!this.props)return null===(n=null===(t=this.props)||void 0===t?void 0:t.onError)||void 0===n||n.call(t,T),console.error("");if(!e._mount){if((null===(i=this.props)||void 0===i?void 0:i.mountClass)?((null===(a=this.props)||void 0===a?void 0:a.mountClass.startsWith("."))&&(this.props.mountClass=this.props.mountClass.slice(1)),this.ele=document.querySelector(".".concat(this.props.mountClass))||document.createElement("div")):(this.ele=document.createElement("div"),this.ele.className=S.slice(1),document.body.appendChild(this.ele)),!this.props.signature)return null===(l=null===(s=this.props)||void 0===s?void 0:s.onError)||void 0===l||l.call(s,x),console.error("signature is required");if(qt.defaults.headers.common.signature=this.props.signature,!this.props.projectId&&!this.props.exclusiveVirtualHumanId)return null===(u=null===(c=this.props)||void 0===c?void 0:c.onError)||void 0===u||u.call(c,A),console.error("At least one of projectId or exclusiveVirtualHumanId required");this.props.projectId&&(e.project=this.props.projectId),this.props.exclusiveVirtualHumanId&&(e.exclusiveVirtualHumanId=this.props.exclusiveVirtualHumanId),this.props.proxy?qt.defaults.baseURL="".concat(this.props.proxy.protocol,"://").concat(this.props.proxy.host,"/"):qt.defaults.baseURL="https://interactive-virtualhuman".concat("int"===(null===(d=this.props)||void 0===d?void 0:d.env)?"-int":"",".xiaoice.com/"),this.root=r.createRoot(this.ele),this.root.render(o.createElement(IM,RM({},this.props))),e._mount=!0}},e.prototype.talk=function(t,n){var i;if(e.webInstance&&(null==e?void 0:e._sendMessage))return null===(i=null==e?void 0:e._sendMessage)||void 0===i?void 0:i.call(e,t,"talk","",n)},e.prototype.talkByArrayBuffer=function(t,n,i){var r;return function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){return function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}(this,(function(o){return e.webInstance&&(null==e?void 0:e._sendMessage)?[2,null===(r=null==e?void 0:e._sendMessage)||void 0===r?void 0:r.call(e,"","talk",OS(),i,"",{arrayBuffer:t,sampleRate:n})]:[2]}))}))},e.prototype.ask=function(t){var n;if(e.webInstance&&(null==e?void 0:e._sendMessage))return null===(n=e._sendMessage)||void 0===n?void 0:n.call(e,t,"ask")},e.prototype.talkByAudio=function(t,n){var i;if(e.webInstance&&(null==e?void 0:e._sendMessage))return null===(i=null==e?void 0:e._sendMessage)||void 0===i?void 0:i.call(e,"","talk",OS(),n,"",{ttsFileUrl:t})},e.prototype.destroy=function(){var t,n;this.root&&(this.root.unmount(),null===(t=null==e?void 0:e._unmount)||void 0===t||t.call(e),e._mount=!1,this.ele&&(null===(n=this.ele)||void 0===n||n.remove(),this.ele=null),this.root=null,e.webInstance=void 0,e._sendMessage=function(){},e._startRTC=function(){},e._stopRTC=function(){},e._unmount=function(){},e._changeMode=function(){})},e.prototype.startRTC=function(t){var n;null===(n=null==e?void 0:e._startRTC)||void 0===n||n.call(e,t)},e.prototype.endRTC=function(){var t;null===(t=null==e?void 0:e._stopRTC)||void 0===t||t.call(e)},e.prototype.breakTalking=function(){var t;e.webInstance&&(null===(t=null==e?void 0:e._sendMessage)||void 0===t||t.call(e,"break","break"))},e.prototype.changeMode=function(t){var n;e.webInstance&&(null===(n=null==e?void 0:e._changeMode)||void 0===n||n.call(e,0===t?"work":1===t?"fun":"big"))},e.prototype.changeProject=function(t){e.project=t,e._getConfig()},e._mount=!1,e.project="",e.exclusiveVirtualHumanId="",e.proxy={host:"",protocol:"https"},e._startRTC=function(){},e._stopRTC=function(){},e._unmount=function(){},e._getConfig=function(){},e.clientState="OUT_ROOM",e.humanState="offline",e}();window.RTCInteraction=CM})(),__webpack_exports__=__webpack_exports__.default,__webpack_exports__})()));